var ca=Object.defineProperty,da=Object.defineProperties;var ua=Object.getOwnPropertyDescriptors;var is=Object.getOwnPropertySymbols;var ha=Object.prototype.hasOwnProperty,fa=Object.prototype.propertyIsEnumerable;var ss=Math.pow,rs=(d,t,e)=>t in d?ca(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e,Gt=(d,t)=>{for(var e in t||(t={}))ha.call(t,e)&&rs(d,e,t[e]);if(is)for(var e of is(t))fa.call(t,e)&&rs(d,e,t[e]);return d},Wt=(d,t)=>da(d,ua(t));var ne=(d,t,e)=>new Promise((i,s)=>{var r=l=>{try{a(e.next(l))}catch(o){s(o)}},n=l=>{try{a(e.throw(l))}catch(o){s(o)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(r,n);a((e=e.apply(d,t)).next())});import{D as pa}from"./base.b65bdcd1.js";import"./tooltip.afcd3f9d.js";import{E as ma}from"./popper.aedd2598.js";/* empty css               */import{bE as ns,S as as,M as nn,a as fi,f as pi,m as zt,J as ga,H as ya,r as _a,o as va,u as Ue,j as Ee,e as Qt,O as xe,k as os,F as Ea,g as ls,Q as xa,R as Sa}from"./index.965ac11d.js";import{a as Ta,u as ba,k as Aa,m as La}from"./useFileUpload.a56ef935.js";import{u as Ia,a as Zi}from"./useCommon.eb7f3fe8.js";import{_ as wa}from"./plugin-vue_export-helper.21dcd24c.js";import"./request.2ccc188b.js";import"./focus-trap.2030fc87.js";import"./common.df582fdd.js";import"./checkbox.c90315f5.js";import"./event.776e7e11.js";import"./index.c4c36dd3.js";import"./_Uint8Array.4350f927.js";/* empty css              */import"./index.22cf9654.js";import"./use-outside-click.18deedcf.js";import"./directive.d58852f6.js";import"./XCircleIcon.af7bde30.js";import"./index.0f169a7e.js";import"./index.efd5e5c6.js";import"./scroll.06c8f1a5.js";import"./validator.58bcb820.js";import"./index.871a70d2.js";var Ra="/assets/video-download.3a226681.png",Da="/assets/video-thunder.5e7f4cec.png",Ca="/assets/video-motrix.95ef7e61.png",ka="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAOeUlEQVR4Xu3dy5EjuRWF4TMGyA550ibIgPZirJjFODIeaDVOaDMvSREKRdRKGy0UVF1mZTV5yGS+ACSA/G/EV1F1p7unu4pA4nEB6nK5fIeG/UN/vvyuL5df9fXyi75///zHq9/00+UP/fye+9vVr3q7cZnw7deMvy/+jPiz4s+MPz/+PyH+v//Wnx7+PmiKPIEKRUMbG/nYuIdG7Q34GPF3GTuJ4e/4hc6hDfIEDjY29njaRqN6/cSu29gxDCMTOoUKyRMoLIbS8dSs7ameS/wbx5FC/Nv9+4Gi5AlkNj7hhzl1/w1+ztghMEI4hDyBDOJJF8PgWFDzBoB745SB0UER8gQSGRs9T/nthl0MOoOM5AnswJM+n7EzYJqQlDyBDWL+OqzYP75wkd6w5fjl4eeA1eQJLDQU4MRqdrvbdK0bipWYIuwgT2AGT/s6xc+EjmA1eQITYt+auX394mfE9GAxeQI3YsGJlfw2DT+zrywaviZP4MNw8IX5fevoCF6SJ04tXiTDqTqe+L0ZOwL/mZ+cPHFaNPxzGEqPWSP4IE+cTrwYWNw7H3YNruSJ0/i2j//44sB5xGvgxOsD8sQpsMCHe/FaOOX6gDzRNYb7eCVeGyebFsgTXRrO4DPcxzIxQvTXUKfkie4M12uxuo91TrJbIE90g6c+Uuh8NCBPdGE4l89TH2l0vDYgTzRvuLf+8YcI7NfdToE80awY8nNMF7nFa6yjugF5okkM+VFSvNY6mRLIE81hyI9jdFE8JE80g1V+1CBeg/7abIg80YRo/FT0oRYNrwvIE9Vjvo8aNbouIE9UbXiHXA7xoFZvrXUC8kS1WOxDG95aKiGWJ6pE40d7mtghkCeqM5zd928uUL8GzhHIE1Vhmw+tq7wTkCeqQeNHLyruBOSJKtD40ZtKC4bkicPR+NGrCkcC8sShaPzoXWWdgDxxGFb7cRYVdQLyxCHY58f5VFEnIE8UN5T3+jcH6F8FFYPyRFHU9uPcDi8blieKiUMTNH7g0ANE8kQRcXaaI73AINrCQfcJyBNFcJkHcC8uFfF2UoA8kR17/cBzB2wPyhNZsd0HvFZ4UVCeyIZFP2CJoouC8kQWLPoByxVcFJQnsuAde4B1Ci0KyhPJMe8HtspeLixPJDXM+/0fBWCZ7OsB8kQyzPuB/aJmxttWQvJEMuz3A2lkrA+QJ5LghB+QVqapgDyRBEN/IK1oU97OEpAnduNmHyCPDFMBeWIXVv2BvBJPBeSJXTjlB+SVeFdAntiMgh+glGQFQvLEJrHnz0EfoJS3VGcF5IlN2PMHykr0TkPyxGos/AHHSLAgKE+sxsIfcIwEC4LyxCpU/AHH2nmDkDyxChV/wLF2VgjKE4ux7QfUYvO2oDyxGE9/oA47rhCTJxbh6b/Pv969/WXw9yf/HVhv0yhAnpjFRR/7/Pevl4f4zw90BNhn4yhAnpjF03+7eOJPxf/+Ofx3/z3AcqtHAfLELJ7+2z17+nvEr2E0gC027AjIEy+x77/Pmohpgf9+YN6qUYA88RJVf/usjZgWxIKh/znAlJXVgfLEJJ7++20NpgVYY0V1oDwxiXf32W9vsEiIJVa8q5A88RQn/tJIEUwLsMTCk4LyxFNc9JlGyqB2AK8svEBUnniK237SSB3UDmDa28Xb8RPyxAMW/9LJFbFIyLQAbsFioDzxgMW/dHIHtQO4tWAxUJ64M1z2+fgHY5sSwbQAt2bOB8gTd1j8S6tkUDuAMLMYKE/cofIvrSOC0cC5zVQGyhOf2PtP76igduDcXtQEyBOfGP6nd3RQO3BOL6YB8sQnhv/p1RJMC87lxTRAnrhi+J9HTUHtwLlMTAPkiSuG/3nUGNQOnMPENECeuKL4J49ag9qB/k0UBckTFP9kVHtQO9C3J0VB8gS1/xm1EkwL+vTkbIA8wVt9Z9RSUDvQnydvKS5PcOtvRi0G04J+PLk1WHcJtv/yajVYJOyHbQfq9osLb/qRV+tB7UAP7q4N1+0XzP8z6yUoKW6XrQPo9gvKfzPrKZgWtMnKgvX5Bfv/+fUYLBK256YeQOMn7P8X0HNQO9COm3oAjZ9Q/19A70HtQBtuzgVo/IT6/wLOEkwL6nZzLkDjJxQAFXC2YJGwTjcFQbp+wgJgGWcMpgV1+lgIVHygArCQMwe1A3X5WAhUfLhQAVjG2YPagZpcKwIVH6gALIQYgkXC431UBCo+sANQCHEf1A4c52MnQPGBEuBCiMdgkfAYHzsBig8X3v67DGI6mBaUd+0A2AIsh5gPFgnLeW/7YguwIGJZMC0o43d9EYeACiLWBbUDeV07AGoAyiHWB7UD+fyi78UpwIKI7cEiYXrXDoAioHKI/UHtQDrvbZ8OoCQiTbBImMZv+klUARZEpA2mBfv8oZ9FFWBBRJ5gkXCbawfARSDlEPmCacF6722fDqAkIn9QO7DGW9QBcA6gFKJMUDuw1LUD8CRyIcoGb2U2iw6gJOKYoHZgEh1AScRxEaMB/3mADqAo4thgXeABHUBJxLERi4P+Mzk5OoCSiOPDfyYnRwdQEnFssA7wgA6gJOLYYEvwAYVAJRHHBQuAz1AJWBRRPjgx+MobZwFKIsoF5cDzroeBOA5cDlEmOBC0zLUD4EKQcoi8Qe3/Otf7AOgAyiHyBMP9ba5XgnEnYDlE+mC4v931UlCuBS+HSBfcALTftQPgjUHKIdIEw/00Pt4XgLcGK4XYF+zpp/aVNwctidgWDPfzuL43IG8PXg6xPhju5/P+8H//ePnuQjlwGcTyYLif33vbj4/fUQ5cCDEfDPfLiDb/2QFQDFQG8Tq4vLOcaPOfHQDFQGUQz4PhfnnR5j87AGoByiDugxLeI3293IwAqAUogfgWDPePFW3+swNgK7AMguF+LaLNf3YA7ASUceZguF+Tt8tHu9f4CTsBBZw1OLFXl48dgKDxE04FFnC24IKOOkVbf+gAWAjM7yzBcL9uHwuAQeMnLAQWcIZguF+/jwXAoPGTKxYC8+o5GO634aMEeKTbL6gIzKzHYLjflo8KwJFuv7hQEZhXb8Fwv0XXCsCRbr/gcpDMeglO7LUr2vhkBxBYB8inh2C43y6b/wd5gnWAjFoOSnjbZ/P/IE9QD5BRi8Fwvx83+/8jeYJ6gIxaC4b7fbnZ/x/JE1e8YWgerQTD/f5Em/Z2PtkBcC4gj9qD4X6/bur/b8kTV2wH5lFzcEFH32z7byRPfGI7ML0ag+F+/55s/43kiU9MA9KrKSjhPY+J4X+QJz4xDUivlmC4fy4Tw/8gT9xhGpDW0cFw/3xeDP+DPHGHaUBaRwXD/fN6MfwP8sQdpgFpHRGc2Du3F8P/IE884LLQdEoGF3Tg5vLPKfLEA84GpFMiGO5j9KT238kTD4azAbx9eAq5g+E+vvm8+/8VeeIpjginkSsY7sM9Ofr7jDzxFIuBaaQOhvuYMrP4N5InJrEYuF/KYLiPKQsW/0byxCQWA/dLEZzYw5wFi38jeeIl7gnYZ28w3Mecmco/J0+8xLXh+2wNSnix3N2133PkiZdiS5DzAdutDYb7WCPa5pNrv16RJ2ZxPmC7NcFwH2vN1P0/I0/MojBouxjKzwXDfWzztvbpH+SJRRgFbBNP9alguI89Njz9gzyxCKOA7WL/3oPhPvbZ9PQP8sRi7AhsF0P8aPQ88ZHGqpX/W/LEYuwIAMfbsPJ/S55YhVEAcLTNT/8gT6xGdSBwjIl3+1lDnliNMwLAMVbU/E+RJzbhpCBQ1ooTf6/IE5sM9wWwLQiU8bb0vP8ceWIzioOAMjYW/TwjT2zGtiCQ38rjvnPkiV1YEATySrDwd0ue2I0LRIE8Fl70uYY8sRtTASC9nRV/U+SJJJgKAGklHvqP5IlkmAoAaWQY+o/kiWSYCgD7ZRr6j+SJpJgKAPskKviZIk8kR4EQsE3Cgp8p8kQWnBgE1klU6z9HnsiC9QBguczz/lvyRDasBwBLJDvos4Q8kRU3CAFzdt3ws5Y8kR31AcBzGff7p8gT2cXchkVB4F6C6722kCeKYFEQ+Kbgop+TJ4qIfyy3CAGh6KKfkyeKYmcA5/aW65DPUvJEcewM4KwObvxBnjgE5cI4n6LbfVPkicOwPYizKFDjv5Q8cSg6AfTugL3+V+SJw9EJoFeVNf4gT1SBdxpCbyps/EGeqAYjAfSi0sYf5Imq0AmgdRU3/iBPVIdOAK2qaLV/ijxRJeoE0J4q9vnnyBPVomIQbTi8vHcNeaJqw9kBDhChVoce7NlCnqhefIM5SozaxGuyscYf5IkmcKkIahJ1Kwed599LnmhGfMPZIcDRKt/mmyNPNIfFQRyjqcW+KfJEk1gXQEmNzvefkSeaFVMCzhAgt4bn+8/IE82jaAh5xPZzE8U9a8gTXWBKgJRix6mTIb+TJ7rBLgFSaKCefw95ojuxUstoAGvFa6aDVf458kSXGA1gjXjqd7TQ94o80TXWBvBKx3P9KfLEKQw7BRwqwqjLFf4l5InTYFqAEK+Bkwz3n5EnTmP8oceQj4NF5xMFPScb7j8jT5xWDAFZH+jfSVb3l5InTi1GBcPhItYHejN07qec578iT+AydAQsFPaBhv+SPAETHQFTg/bQ8BeRJzCBNYI2xIIuc/zF5AnMiBcXx47rw6r+JvIEFhqqClknOFKMyE5UtpuDPIENGBWU9Hb9XjPMT0KewA7jqIDCovSG7+lXnvZpyRNIZOwMWDjcLhp9fA+Z22cjTyADRgZLDcP7eNLT6IuQJ5DZcAjpy/UQCqODsTT3x+v3hOF9cfIECosnXTzxztIhDPv0NPhKyBM42DhCiClDDIdb7hTi7z78G76nwddJnkCFouHcjhSiUQ3rCTXUILxd/y5jQx/n7zT2JsgTaMzYOQxvnR7lyvG0jSH2t45iKJiJkUR0GKPHhjwaf/3YsIfpSexoDA08/l808i78HzPcPJXn8KhQAAAAAElFTkSuQmCC",Ma="/assets/video-iina.1db26170.png",Pa="/assets/video-vlc.54e63a7e.png",Oa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAK2UlEQVR4Xu2dC3BUZxXHD4g4VlukLRTEIKhYochjeBRaCoggpQaqBSrQWFuCwLbFDpRhQIs4Y8YRO1Lr4JSWJkCJVihgy0PerxapUhqaQrCFIkUghM1rs7sJVCYcz3d3v+Tuud+9e/dFdpPvP/OfwAzs3j0//v9zv2x2ANDS0tLS0tLS0tLS0tLS0tLS0tJqEHrhi1gJM+jrOqyAf2A5vEFeSr8exP+sVopFg59C9pJR6UrYRu7F/55WCkQJWGABoPY1Ss9K+tqZP4ZWkkQwRtGAryuG7+QAgfmFqDj+eFoJiob7nmLgbl1KNTYdEVrzx9WKQ1gFvRVDjt2VcIx8P398rRhFdfWoZbiJ2AvbCcxd/Hm0XIqAeCxDTdz19Lj5qBd/7EoREOkApWWJXvwxKMVADFdXQmkRLX7Qiz+6UgHkagXgyWrAzTWAvw0APh1s8Im5Qb34HZUMINfJ5yoBd/sAl/sB5zYCUHpOELaT+/Jr0YL4gVwmAIcpBQUEYKFi6C5cPy8I+TNr9eKPkFsgAQLwPgFYTzX0K+tw43ctBH4WgLwlevGHZAfkGu2BjwjAVgLwXOQeSJrnRLqU4OSORGjDr7FFSQIRe+A8pWAfQXiRaugZxQCTaQajwU8FoeSJlrz4j1SBZw2lYJFiaKk0BxGGYZiA4Owg7JpdC/359TZ7zQuAhw8rleYQzCBMMKTr6ff5U2rhy/y6m61uJBAnEAoYODPsWQGom9FSFv+NAhIPDAKBPyXnkh8nT/dD6fQAzG7Wiz/VQDgIFQwzCDMMAULCkP4xOccPJVOb6+JPJRAOgsPgqZAwZCrMMH4ShvEIeSr5R+TJftg3obkt/lQA4RDcwFBVlDkVAoSwAYI8iW7Nf0B3hxNqoH68Dwqyq6Arf20ZqWQC4QDcgrCDoUrFw/5GGNnkB8hjyCN8UDe8BvImZ/riTxYQDoGDsNsV5oqyS4WAIVPxkN9IhQFiLHmUgEG+hzzEBwjVUAYXBzwB+5dk5uJPFAiHoAJhB0O1uM2pUFWUTIWAIUAMEhAudUU4PQeheBfCOz6Ew36EQ/4SeNufzV9v2iteIByCHQwVCGEOQqbCXFEShLBIhYAhQEA5+VwOQsk6hCNlCP8MEogAgRAmGG+HfZD8ln8/HKzOnMWfTCBOu8IpFbyieCp6VxKAiw8ifLQC4djHCO8SgH+F3QDD3whDgBDeXxPy3pp62Fv9KuyuS//FHw8QDiIWGHxfqCpqXLWoodEI/1mKcPwownvBEAThIyYYAoSEYU7FwTCIfQYMhN1UY7vIO6vrYIcvD/5eeQufQ9ooViDxgHBa3MJTKAntL/emGlqEcHIvpYCGVxQMgVDBcKqoAyYYe3xmGAjbydsMl8OW6sf5LNJCsQCxA+EEwy4VA6taIVzw0DLeRMvYSxDqCIJwbSOIoyYQFhh+sbitFSVTIWBIEDsEDF8Ixpaw36xCeKPqZUBsxWfSpHIDxCkV0hyEeV8ICA+Ku6GL06iGChBOnCEINPz360IgGmC4SIWqosyp2OuLhCFSIZMhQGw2QCBsqgz5b1WL+EyaVNGAcBgcCE+GhDGNauhm71iET36P8CHtgeJgCIJ0BIjaRhgyFSoY5oqyLm5TRclUmEA0pCIMYiN5A/n1iquwtjZ93te3A8IhcBAcxgzy3RX9qIZ+iXCK9sBxGswHtZEQLKkQIEwVxUEYMEypiKgotridKmpzdSgVEoYBgrxOuBzhLxUL+FyaTBwIh6ACISsqu0rcDT1FNbSRaqgsBECagzDD4KlQwVClQsKQqZAVpV7c1lREwKhA+KuAIVy5jc+lySSBcAgqGI/QmaBVGR3IzuVTDZ0mCDTYD65EglDBsOwKxeK2gxHv4hapUFXUegajkPzn8nf5XJpMAgiHIEGIu6O+5fcjnF9GNUR74EQwBEH4eIww3KTC6WzBFzdPRcTiDleUJRXhinpNwqC7u7XkV737+FyaTHNMQASEMVV0HihdjHBmD0KJrxGA2W5ACMebCleL2xe5uLc6VJQqFRLGGgPI83wuTaaJPvAYe+CTDQj/LrUO3+xYU6GCwUHEe7YwUuGwuEVFOaVCwlgtvl4eyufSdDp51WMZvMoGiBhg8IqKNRXRKsq8uI2zBUuFZXFHVFQIhHDBpfRZ6IbcAHEDIu6K8lthSBDy2x92i5tXVMPZIkpFGSDIq8pOQUGgAx9J08oJiNuKkiAaYIRBqCrK6cTNzxY8FU6L21xRAgSvKJEKM4z8SzvgT95OfBxNLzsgqoriIOJOhaKilItbpsIEgqfCrqJUqRBeVVYKr5RN42NIH6mAcBDxwrA7catguF3cvKKUi7vcurgLvNdglfcP8MfT6futd0MSiKgntxVlt7hVFSXPFqoTd6oXt4SRX3YI8i9nyAeEJJBYQDilQllRNqmwragYFrdTKlZ7vbQrHku7b7E7SgBJFAYHwSvKdnErUqFa3KqKclrcKz6sh8cWvzhs2LD2/OWmv4oFEAcQsVaUanFLGDIVzu/mWVMRraJWX0CY9xL2HTsa87vdcQQBBvKXmTkqDjQCsQOhSkXK381jqTC+/WFKRd4W7PDQw/jz/t3xU6BSAqC/BLPIGf7RawGEg7CkQjjOVERb3KqKsqSC/NIxhNz5mDNiIJ6F1gKA9HVyAfl2/tIyU8W1ViDRUhENhtPibkiFCYQqFYXnEBa+gNnjx+CBrDvMAMwmSnAPf0mZLQ7EDgYHwRe307t5blKxkXbB0k1497SpuGbAN/nguenB4GlyZv64qKMkEA4iGRUVbXGvPIRZT87F34wZhFegLR+6yqKeCsnp8x540iWAcBiuKoqnIlxRTot73SmEZ5ehZ9I4PNPtK3zY0VxCHskvv/lJAnGbiljOFlvLEJa9hlOnP4pvDfk2H7Bb0xPCAnJbfunNU0UExHUqoi1uSsLqA/jdZ+bj+ux7ETu348ON1a+Ts/glN28JIBxGxOKWMGwqatNx7J23DJfnjMcrfboj3vYZxC+0QmxtGW4sPk3+Hr/UlqEiOofYpULcRfHFvfMCtl1eiM8+mYtnRw5A7EYp6HIzpeEmxHZtENtahhuLqTthMflz/DJbjo4SEBUMWVEH6ZZ07U6ctXghvjNxNGKfLog9b0P8xi2IXQlEFwLRke6Q2iWcis3k7vzyWp4EEH62eLMIf/jc87hlxkTE+76F2K8zgaDDWc+OiHfeHoIhU5F4RZ0lj+eX1XIlgOw5i/e9XIj582fhlQcGIw7thjj4q4iDskIwenUKpeLO9o0VJVMRf0V9Sv41+fP8klq0/pszzoPf6YE4/OuI9xKIIWEQ/ama+lEqeplSISsq8VTsJPfg16JFwlFf8+Dw7qFUSBgRFRVOhYDRWaRCLO64YZwnT+bXoGUSjiAgsqKMVIQrykjFreFUJFxR/yP/jpzZnyG/EcIhWZ5QRYVTwSsq8cV9gKz/iwu3olR4lBWV+NmilJxDzqD3s9NA2Kejx5IKubjjO1tcI79A/hJ/Li0Xwrs6TYpc3OFUxFdRh8n9+HNoxSDs2aFHEs4W5eRc1PWUHGGnmw7HubjrySvIt/LH1EpA2AaGUirEyZkP3MlHyYP5Y2klSTTcmRj6F88Hz11N9mDG/7hNBoiG/H3yxwoIwuJw9wo5zT5P0cyFMOCzNPQJGLp13UBeSZ5HTsPPUmhpaWlpaWlpaWlpaWlpaWlpaWlpaWklqv8Da8GBU4g36CAAAAAASUVORK5CYII=",Na="/assets/video-mxplayer.5dfa69aa.png",Fa="/assets/video-mxplayer-pro.10406916.png",an={exports:{}};/*!
 * artplayer.js v4.6.2
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2023 Harvey Zack
 * Released under the MIT License.
 */(function(d,t){(function(e,i,s,r,n){var a=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof as!="undefined"?as:{},l=typeof a[r]=="function"&&a[r],o=l.cache||{},c=typeof ns=="function"&&ns.bind(d);function u(m,_){if(!o[m]){if(!e[m]){var E=typeof a[r]=="function"&&a[r];if(!_&&E)return E(m,!0);if(l)return l(m,!0);if(c&&typeof m=="string")return c(m);var D=new Error("Cannot find module '"+m+"'");throw D.code="MODULE_NOT_FOUND",D}I.resolve=function(x){var P=e[m][1][x];return P!=null?P:x},I.cache={};var O=o[m]=new u.Module(m);e[m][0].call(O.exports,I,O,O.exports,this)}return o[m].exports;function I(x){var P=I.resolve(x);return P===!1?{}:u(P)}}u.isParcelRequire=!0,u.Module=function(m){this.id=m,this.bundle=u,this.exports={}},u.modules=e,u.cache=o,u.parent=l,u.register=function(m,_){e[m]=[function(E,D){D.exports=_},{}]},Object.defineProperty(u,"root",{get:function(){return a[r]}}),a[r]=u;for(var h=0;h<i.length;h++)u(i[h]);if(s){var f=u(s);d.exports=f}})({"5lTcX":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("bundle-text:./style/index.less"),a=r.interopDefault(n),l=e("option-validator"),o=r.interopDefault(l),c=e("./utils/emitter"),u=r.interopDefault(c),h=e("./utils"),f=e("./scheme"),m=r.interopDefault(f),_=e("./config"),E=r.interopDefault(_),D=e("./whitelist"),O=r.interopDefault(D),I=e("./template"),x=r.interopDefault(I),P=e("./i18n"),C=r.interopDefault(P),b=e("./player"),S=r.interopDefault(b),L=e("./control"),A=r.interopDefault(L),U=e("./contextmenu"),B=r.interopDefault(U),G=e("./info"),Q=r.interopDefault(G),nt=e("./subtitle"),ot=r.interopDefault(nt),V=e("./events"),R=r.interopDefault(V),N=e("./hotkey"),j=r.interopDefault(N),X=e("./layer"),rt=r.interopDefault(X),lt=e("./loading"),Tt=r.interopDefault(lt),wt=e("./notice"),Rt=r.interopDefault(wt),tt=e("./mask"),at=r.interopDefault(tt),ft=e("./icons"),ut=r.interopDefault(ft),yt=e("./setting"),At=r.interopDefault(yt),jt=e("./storage"),qt=r.interopDefault(jt),re=e("./plugins"),Xt=r.interopDefault(re),ke=e("./mobile"),Me=r.interopDefault(ke);let Pe=0;const pe=[];class vt extends u.default{constructor(Ne,Le){super(),this.id=++Pe;const Xe=h.mergeDeep(vt.option,Ne);if(this.option=(0,o.default)(Xe,m.default),this.isLock=!1,this.isReady=!1,this.isFocus=!1,this.isInput=!1,this.isRotate=!1,this.isDestroy=!1,this.whitelist=new O.default(this),this.template=new x.default(this),this.events=new R.default(this),this.whitelist.state?(this.storage=new qt.default(this),this.icons=new ut.default(this),this.i18n=new C.default(this),this.notice=new Rt.default(this),this.player=new S.default(this),this.layers=new rt.default(this),this.controls=new A.default(this),this.contextmenu=new B.default(this),this.subtitle=new ot.default(this),this.info=new Q.default(this),this.loading=new Tt.default(this),this.hotkey=new j.default(this),this.mask=new at.default(this),this.setting=new At.default(this),this.plugins=new Xt.default(this)):this.mobile=new Me.default(this),typeof Le=="function"&&this.on("ready",()=>Le.call(this,this)),vt.DEBUG){const ye=fe=>console.log(`[ART.${this.id}] -> ${fe}`);ye("Version@"+vt.version),ye("Env@"+vt.env),ye("Build@"+vt.build);for(let fe=0;fe<E.default.events.length;fe++)this.on("video:"+E.default.events[fe],Ie=>ye("Event@"+Ie.type))}pe.push(this)}static get instances(){return pe}static get version(){return"4.6.2"}static get env(){return"production"}static get build(){return"2023-01-26 15:26:58"}static get config(){return E.default}static get utils(){return h}static get scheme(){return m.default}static get Emitter(){return u.default}static get validator(){return o.default}static get kindOf(){return o.default.kindOf}static get html(){return x.default.html}static get option(){return{id:"",container:"#artplayer",url:"",poster:"",title:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,playsInline:!0,lock:!1,fastForward:!1,autoPlayback:!1,autoOrientation:!1,airplay:!1,layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],whitelist:[],thumbnails:{url:"",number:60,column:10,width:0,height:0},subtitle:{url:"",type:"",style:{},escape:!0,encoding:"utf-8"},moreVideoAttr:{controls:!1,preload:h.isSafari?"auto":"metadata"},i18n:{},icons:{},customType:{},lang:navigator.language.toLowerCase()}}get proxy(){return this.events.proxy}get query(){return this.template.query}get video(){return this.template.$video}destroy(Ne=!0){this.events.destroy(),this.template.destroy(Ne),pe.splice(pe.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}if(s.default=vt,vt.DEBUG=!1,vt.CONTEXTMENU=!0,vt.NOTICE_TIME=2e3,vt.SETTING_WIDTH=250,vt.SETTING_ITEM_WIDTH=200,vt.SETTING_ITEM_HEIGHT=35,vt.INDICATOR_SIZE=14,vt.INDICATOR_SIZE_ICON=16,vt.INDICATOR_SIZE_MOBILE=18,vt.INDICATOR_SIZE_MOBILE_ICON=20,vt.VOLUME_PANEL_WIDTH=60,vt.VOLUME_HANDLE_WIDTH=12,vt.RESIZE_TIME=500,vt.SCROLL_TIME=200,vt.SCROLL_GAP=50,vt.AUTO_PLAYBACK_MAX=10,vt.AUTO_PLAYBACK_MIN=5,vt.AUTO_PLAYBACK_TIMEOUT=3e3,vt.RECONNECT_TIME_MAX=5,vt.RECONNECT_SLEEP_TIME=1e3,vt.CONTROL_HIDE_TIME=3e3,vt.DB_CLICE_TIME=300,vt.MOBILE_AUTO_PLAYBACKRATE=3,vt.MOBILE_AUTO_PLAYBACKRATE_TIME=1e3,vt.MOBILE_AUTO_ORIENTATION_TIME=200,vt.INFO_LOOP_TIME=1e3,vt.FAST_FORWARD_VALUE=3,vt.FAST_FORWARD_TIME=1e3,vt.TOUCH_MOVE_RATIO=.5,vt.VOLUME_STEP=.1,vt.SEEK_STEP=5,vt.PROGRESS_HEIGHT=6,vt.PLAYBACK_RATE=[.5,.75,1,1.25,1.5,2],vt.ASPECT_RATIO=["default","4:3","16:9"],vt.FLIP=["normal","horizontal","vertical"],vt.FULLSCREEN_WEB_IN_BODY=!1,typeof document!="undefined"&&!document.getElementById("artplayer-style")){const Oe=h.createElement("style");Oe.id="artplayer-style",Oe.textContent=a.default,document.head.appendChild(Oe)}typeof window!="undefined"&&(window.Artplayer=vt),console.log(`%c ArtPlayer %c ${vt.version} %c https://artplayer.org`,"color: #fff; background: #5f5f5f","color: #fff; background: #4bc729","")},{"bundle-text:./style/index.less":"0016T","option-validator":"bAWi2","./utils/emitter":"66mFZ","./utils":"71aH7","./scheme":"AKEiO","./config":"lyjeQ","./whitelist":"9L0ao","./template":"X13Zf","./i18n":"3jKkj","./player":"a90nx","./control":"8Z0Uf","./contextmenu":"2KYsr","./info":"02ajl","./subtitle":"eSWto","./events":"jo4S1","./hotkey":"6NoFy","./layer":"6G6hZ","./loading":"3dsEe","./notice":"dWGTw","./mask":"5POkG","./icons":"6OeNg","./setting":"3eYNH","./storage":"2aaJe","./plugins":"8MTUM","./mobile":"7mil2","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"0016T":[function(e,i,s){i.exports='.art-video-player{z-index:20;width:100%;height:100%;zoom:1;color:#eee;text-align:left;direction:ltr;user-select:none;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#000;outline:0;margin:0 auto;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:14px;line-height:1.3;display:flex;position:relative}.art-video-player *,.art-video-player :before,.art-video-player :after{box-sizing:border-box;margin:0;padding:0}.art-video-player ::-webkit-scrollbar{width:5px;height:5px}.art-video-player ::-webkit-scrollbar-thumb{background-color:#666}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:#ccc}.art-video-player .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-video-player .art-icon svg{fill:#fff}.art-video-player img{max-width:100%;vertical-align:top}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-video-player .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-video-player .art-video{z-index:10;width:100%;height:100%;cursor:pointer;background-color:#000;position:absolute;inset:0}.art-video-player .art-poster{z-index:11;width:100%;height:100%;user-select:none;pointer-events:none;background-position:50%;background-repeat:no-repeat;background-size:cover;position:absolute;inset:0}.art-video-player .art-subtitle{z-index:20;width:100%;text-align:center;color:#fff;pointer-events:none;text-shadow:1px 0 1px #000,0 1px 1px #000,-1px 0 1px #000,0 -1px 1px #000,1px 1px 1px #000,-1px -1px 1px #000,1px -1px 1px #000,-1px 1px 1px #000;padding:0 20px;font-size:20px;transition:bottom .2s;display:none;position:absolute;bottom:10px}.art-video-player .art-subtitle p{word-break:break-all;height:fit-content;margin:5px 0 0;line-height:1.2}.art-video-player.art-subtitle-show .art-subtitle{display:block}.art-video-player.art-control-show .art-subtitle{bottom:50px}.art-video-player .art-danmuku{z-index:30;width:100%;height:100%;pointer-events:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers{z-index:40;width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:block}.art-video-player .art-mask{z-index:50;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-mask .art-state{width:60px;height:60px;opacity:.85;cursor:pointer;pointer-events:auto;justify-content:center;align-items:center;display:flex;position:absolute;bottom:65px;right:30px}.art-video-player.art-mask-show .art-mask{display:flex}.art-video-player.art-mobile .art-state{position:static}.art-video-player .art-loading{z-index:70;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{z-index:60;height:100px;opacity:0;visibility:hidden;pointer-events:none;background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x;flex-direction:column;justify-content:space-between;padding:50px 10px 0;transition:all .2s ease-in-out;display:flex;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-bottom .art-progress{z-index:0;pointer-events:auto;flex:1;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress{height:4px;cursor:pointer;flex-direction:row;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner{height:50%;width:100%;background:#fff3;align-items:center;transition:all .2s;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{z-index:10;height:100%;width:0;background:#fff6;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{z-index:20;height:100%;width:0;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{z-index:30;height:100%;pointer-events:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{width:7px;height:100%;pointer-events:auto;background:#ffffff80;display:inline-block;position:absolute;top:0;left:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:hidden;z-index:40;border-radius:50%;justify-content:center;align-items:center;transition:transform .1s ease-in-out;position:absolute;transform:scale(.1)}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{width:100%;height:100%;pointer-events:none;user-select:none}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator:hover{transform:scale(1.2)!important}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{z-index:50;height:20px;color:#fff;text-align:center;white-space:nowrap;background:#000000b3;border-radius:3px;padding:0 5px;font-size:12px;font-weight:700;line-height:20px;display:none;position:absolute;top:-25px;left:0}.art-video-player .art-bottom .art-progress .art-control-thumbnails{pointer-events:none;background-color:#000000b3;border-radius:3px;display:none;position:absolute;bottom:10px;left:0;box-shadow:0 1px 3px #0003,0 1px 2px -1px #0003}.art-video-player .art-bottom .art-progress .art-control-loop{width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-loop .art-loop-point{width:2px;height:8px;background:#ffffffbf;position:absolute;top:-2px;left:0}.art-video-player .art-bottom .art-controls{z-index:1;pointer-events:auto;height:45px;justify-content:space-between;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-controls .art-controls-left,.art-video-player .art-bottom .art-controls .art-controls-right{display:flex}.art-video-player .art-bottom .art-controls .art-controls-center{height:100%;flex:1;justify-content:center;align-items:center;padding:0 10px;display:flex}.art-video-player .art-bottom .art-controls .art-controls-right{justify-content:flex-end}.art-video-player .art-bottom .art-controls .art-control{opacity:.75;min-height:36px;min-width:36px;text-align:center;cursor:pointer;white-space:nowrap;justify-content:center;align-items:center;font-size:12px;line-height:1;transition:opacity .1s ease-in-out;display:flex}.art-video-player .art-bottom .art-controls .art-control .art-icon{float:left;height:36px;width:36px;justify-content:center;align-items:center;transition:transform .2s ease-in-out;display:flex;transform:scale(1)}.art-video-player .art-bottom .art-controls .art-control .art-icon:active{transform:scale(.85)}.art-video-player .art-bottom .art-controls .art-control:hover{opacity:1}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel{float:left;width:0;height:100%;transition:margin .2s cubic-bezier(.4,0,1,1),width .2s cubic-bezier(.4,0,1,1);position:relative;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle{width:12px;height:12px;background:#fff;border-radius:12px;margin-top:-6px;position:absolute;top:50%;left:0}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{background:#fff;left:-54px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{background:#fff3;left:6px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before,.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{content:"";height:3px;width:60px;margin-top:-2px;display:block;position:absolute;top:50%}.art-video-player .art-bottom .art-controls .art-control-volume:hover .art-volume-panel{width:60px}.art-video-player .art-bottom .art-controls .art-control-quality{z-index:30;position:relative}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys{width:100px;text-align:center;color:#fff;background:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;line-height:30px;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item:hover{background-color:#ffffff1a}.art-video-player .art-bottom .art-controls .art-control-quality:hover .art-qualitys{display:block}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:visible;transform:scale(1)}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1;visibility:visible}.art-video-player.art-error .art-progress-indicator,.art-video-player.art-destroy .art-progress-indicator,.art-video-player.art-error .art-progress-tip,.art-video-player.art-destroy .art-progress-tip{display:none!important}.art-video-player.art-mobile .art-bottom{height:105px;padding:50px 7px 0}.art-video-player.art-mobile .art-bottom .art-controls{height:40px}.art-video-player.art-mobile .art-bottom .art-progress-indicator{visibility:visible!important;transform:scale(1)!important}.art-video-player .art-notice{z-index:80;width:100%;pointer-events:none;padding:10px;font-size:14px;display:none;position:absolute;top:0;left:0}.art-video-player .art-notice .art-notice-inner{color:#fff;background-color:#0009;border-radius:3px;padding:5px 10px;display:inline-block}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{z-index:120;min-width:200px;background-color:#000000e6;border-radius:3px;flex-direction:column;padding:5px 0;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-contextmenus .art-contextmenu{cursor:pointer;color:#fff;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;border-bottom:1px solid #ffffff1a;padding:10px 15px;font-size:12px;display:block;overflow:hidden}.art-video-player .art-contextmenus .art-contextmenu a{color:#fff;text-decoration:none}.art-video-player .art-contextmenus .art-contextmenu span{padding:0 7px;display:inline-block}.art-video-player .art-contextmenus .art-contextmenu span:hover,.art-video-player .art-contextmenus .art-contextmenu span.art-current{color:var(--theme)}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:#ffffff1a}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{z-index:90;height:auto;max-height:300px;background-color:#000000e6;border-radius:3px;font-size:13px;transition:all .2s;display:none;position:absolute;bottom:60px;left:0;overflow:auto}.art-video-player .art-settings .art-setting-panel{display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:block}.art-video-player .art-settings .art-setting-panel .art-setting-item{height:35px;cursor:pointer;color:#fffc;justify-content:space-between;align-items:center;padding:0 5px;line-height:1;display:flex;overflow:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item:hover{color:#fff;background-color:#ffffff1a}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current{color:var(--theme)}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon{width:30px;height:30px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{visibility:hidden;height:15px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{white-space:nowrap;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{height:24px;width:24px;justify-content:center;align-items:center;margin-right:10px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{white-space:nowrap;color:#ffffff80;margin-right:5px;font-size:12px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{height:24px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-range{height:3px;width:80px;appearance:none;background-color:#fff3;outline:none}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid #ffffff1a}.art-video-player.art-setting-show .art-settings{display:block}.art-video-player.art-mobile .art-settings{max-height:200px}.art-video-player .art-info{z-index:100;width:350px;color:#fff;-webkit-font-smoothing:antialiased;background-color:#000000e6;flex-direction:column;padding:10px;font-family:Noto Sans CJK SC DemiLight,Roboto,Segoe UI,Tahoma,Arial,Helvetica,sans-serif;font-size:12px;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-info .art-info-item{margin-bottom:5px;display:flex}.art-video-player .art-info .art-info-item .art-info-title{width:100px;text-align:right}.art-video-player .art-info .art-info-item .art-info-content{text-overflow:ellipsis;white-space:nowrap;user-select:all;flex:1;padding-left:5px;overflow:hidden}.art-video-player .art-info .art-info-item:last-child{margin-bottom:0}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;top:5px;right:5px}.art-video-player.art-info-show .art-info{display:flex}.art-video-player.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio] video{box-sizing:content-box;object-fit:fill}.art-video-player.art-fullscreen-web{z-index:9999;width:100%;height:100%;position:fixed;inset:0}.art-video-player .art-mini-header{z-index:110;height:35px;color:#fff;opacity:0;visibility:hidden;background-color:#00000080;justify-content:space-between;align-items:center;line-height:35px;transition:all .2s ease-in-out;display:none;position:absolute;top:0;left:0;right:0}.art-video-player .art-mini-header .art-mini-title{text-overflow:ellipsis;white-space:nowrap;cursor:move;flex:1;padding:0 10px;overflow:hidden}.art-video-player .art-mini-header .art-mini-close{width:35px;text-align:center;cursor:pointer;font-size:22px}.art-video-player.art-is-dragging{opacity:.7}.art-video-player.art-mini{z-index:9999;width:400px;height:225px;position:fixed;box-shadow:0 2px 5px #00000029,0 3px 6px #0003}.art-video-player.art-mini .art-mini-header{user-select:none;display:flex}.art-video-player.art-mini.art-hover .art-mini-header{opacity:1;visibility:visible}.art-video-player.art-mini .art-mask .art-state{position:static}.art-video-player.art-mini .art-contextmenu,.art-video-player.art-mini .art-bottom,.art-video-player.art-mini .art-danmu,.art-video-player.art-mini .art-info,.art-video-player.art-mini .art-layers,.art-video-player.art-mini .art-notice,.art-video-player.art-mini .art-settings,.art-video-player.art-mini .art-subtitle{display:none!important}.art-auto-size{justify-content:center;align-items:center;display:flex}.art-auto-size .art-video-player{transition:all .2s}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layer-miniProgressBar{height:2px;background-color:var(--theme);display:block;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-layer-lock{height:34px;width:34px;color:#fff;background-color:#00000080;border-radius:50%;justify-content:center;align-items:center;display:none;position:absolute;top:calc(50% - 17px);left:15px}.art-video-player .art-layer-autoPlayback{background-color:#000c;border-radius:3px;align-items:center;padding:10px;line-height:1;display:none;position:absolute;bottom:60px;left:20px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close{cursor:pointer;align-items:center;margin-right:10px;display:flex}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close svg{width:15px;height:15px;fill:var(--theme)}.art-video-player .art-layer-autoPlayback .art-autoPlayback-last{margin-right:10px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-jump{color:var(--theme);cursor:pointer}.art-video-player.art-lock .art-bottom{display:none!important}.art-video-player.art-lock .art-subtitle{bottom:10px!important}.art-video-player.art-lock .art-layer-miniProgressBar{display:block!important}.art-video-player.art-control-show .art-layer-miniProgressBar{display:none}.art-video-player.art-control-show .art-layer-lock{display:flex}.art-video-player .art-control-selector{position:relative}.art-video-player .art-control-selector .art-selector-list{min-width:100px;max-width:200px;max-height:200px;text-align:center;color:#fff;background-color:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px;overflow:auto}.art-video-player .art-control-selector .art-selector-list .art-selector-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;padding:0 5px;line-height:30px;overflow:hidden}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{background-color:#ffffff1a}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover,.art-video-player .art-control-selector .art-selector-list .art-selector-item.art-current{color:var(--theme)}.art-video-player .art-control-selector:hover .art-selector-list{display:block}[class*=hint--]{font-style:normal;display:inline-block;position:relative}[class*=hint--]:before,[class*=hint--]:after{visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;transition:all .3s;position:absolute;transform:translate(0,0)}[class*=hint--]:hover:before,[class*=hint--]:hover:after{visibility:visible;opacity:1;transition-delay:.1s}[class*=hint--]:before{content:"";z-index:1000001;background:0 0;border:6px solid #0000;position:absolute}[class*=hint--]:after{color:#fff;white-space:nowrap;background:#000;padding:8px 10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;line-height:12px}[class*=hint--][aria-label]:after{content:attr(aria-label)}[class*=hint--][data-hint]:after{content:attr(data-hint)}[aria-label=""]:before,[aria-label=""]:after,[data-hint=""]:before,[data-hint=""]:after{display:none!important}.hint--top-left:before,.hint--top-right:before,.hint--top:before{border-top-color:#000}.hint--bottom-left:before,.hint--bottom-right:before,.hint--bottom:before{border-bottom-color:#000}.hint--left:before{border-left-color:#000}.hint--right:before{border-right-color:#000}.hint--top:before{margin-bottom:-11px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:before{left:calc(50% - 6px)}.hint--top:after{transform:translate(-50%)}.hint--top:hover:before{transform:translateY(-8px)}.hint--top:hover:after{transform:translate(-50%)translateY(-8px)}.hint--bottom:before{margin-top:-11px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:before{left:calc(50% - 6px)}.hint--bottom:after{transform:translate(-50%)}.hint--bottom:hover:before{transform:translateY(8px)}.hint--bottom:hover:after{transform:translate(-50%)translateY(8px)}.hint--right:before{margin-bottom:-6px;margin-left:-11px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{bottom:50%;left:100%}.hint--right:hover:before,.hint--right:hover:after{transform:translate(8px)}.hint--left:before{margin-bottom:-6px;margin-right:-11px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{bottom:50%;right:100%}.hint--left:hover:before,.hint--left:hover:after{transform:translate(-8px)}.hint--top-left:before{margin-bottom:-11px}.hint--top-left:before,.hint--top-left:after{bottom:100%;left:50%}.hint--top-left:before{left:calc(50% - 6px)}.hint--top-left:after{margin-left:12px;transform:translate(-100%)}.hint--top-left:hover:before{transform:translateY(-8px)}.hint--top-left:hover:after{transform:translate(-100%)translateY(-8px)}.hint--top-right:before{margin-bottom:-11px}.hint--top-right:before,.hint--top-right:after{bottom:100%;left:50%}.hint--top-right:before{left:calc(50% - 6px)}.hint--top-right:after{margin-left:-12px;transform:translate(0)}.hint--top-right:hover:before,.hint--top-right:hover:after{transform:translateY(-8px)}.hint--bottom-left:before{margin-top:-11px}.hint--bottom-left:before,.hint--bottom-left:after{top:100%;left:50%}.hint--bottom-left:before{left:calc(50% - 6px)}.hint--bottom-left:after{margin-left:12px;transform:translate(-100%)}.hint--bottom-left:hover:before{transform:translateY(8px)}.hint--bottom-left:hover:after{transform:translate(-100%)translateY(8px)}.hint--bottom-right:before{margin-top:-11px}.hint--bottom-right:before,.hint--bottom-right:after{top:100%;left:50%}.hint--bottom-right:before{left:calc(50% - 6px)}.hint--bottom-right:after{margin-left:-12px;transform:translate(0)}.hint--bottom-right:hover:before,.hint--bottom-right:hover:after{transform:translateY(8px)}.hint--small:after,.hint--medium:after,.hint--large:after{white-space:normal;word-wrap:break-word;line-height:1.4em}.hint--small:after{width:80px}.hint--medium:after{width:150px}.hint--large:after{width:300px}[class*=hint--]:after{text-shadow:0 -1px #000;box-shadow:4px 4px 8px #0000004d}.hint--error:after{text-shadow:0 -1px #592726;background-color:#b34e4d}.hint--error.hint--top-left:before,.hint--error.hint--top-right:before,.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom-left:before,.hint--error.hint--bottom-right:before,.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{text-shadow:0 -1px #6c5328;background-color:#c09854}.hint--warning.hint--top-left:before,.hint--warning.hint--top-right:before,.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom-left:before,.hint--warning.hint--bottom-right:before,.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{text-shadow:0 -1px #1a3c4d;background-color:#3986ac}.hint--info.hint--top-left:before,.hint--info.hint--top-right:before,.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom-left:before,.hint--info.hint--bottom-right:before,.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{text-shadow:0 -1px #1a321a;background-color:#458746}.hint--success.hint--top-left:before,.hint--success.hint--top-right:before,.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom-left:before,.hint--success.hint--bottom-right:before,.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:before{transform:translateY(-8px)}.hint--always.hint--top:after{transform:translate(-50%)translateY(-8px)}.hint--always.hint--top-left:before{transform:translateY(-8px)}.hint--always.hint--top-left:after{transform:translate(-100%)translateY(-8px)}.hint--always.hint--top-right:before,.hint--always.hint--top-right:after{transform:translateY(-8px)}.hint--always.hint--bottom:before{transform:translateY(8px)}.hint--always.hint--bottom:after{transform:translate(-50%)translateY(8px)}.hint--always.hint--bottom-left:before{transform:translateY(8px)}.hint--always.hint--bottom-left:after{transform:translate(-100%)translateY(8px)}.hint--always.hint--bottom-right:before,.hint--always.hint--bottom-right:after{transform:translateY(8px)}.hint--always.hint--left:before,.hint--always.hint--left:after{transform:translate(-8px)}.hint--always.hint--right:before,.hint--always.hint--right:after{transform:translate(8px)}.hint--rounded:after{border-radius:4px}.hint--no-animate:before,.hint--no-animate:after{transition-duration:0s}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s,visibility .3s,-webkit-transform .3s cubic-bezier(.71,1.7,.77,1.24);-moz-transition:opacity .3s,visibility .3s,-moz-transform .3s cubic-bezier(.71,1.7,.77,1.24);transition:opacity .3s,visibility .3s,transform .3s cubic-bezier(.71,1.7,.77,1.24)}.hint--no-shadow:before,.hint--no-shadow:after{text-shadow:initial;box-shadow:initial}.hint--no-arrow:before{display:none}'},{}],bAWi2:[function(e,i,s){i.exports=function(){function r(h){return(r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f})(h)}var n=Object.prototype.toString,a=function(h){if(h===void 0)return"undefined";if(h===null)return"null";var f=r(h);if(f==="boolean")return"boolean";if(f==="string")return"string";if(f==="number")return"number";if(f==="symbol")return"symbol";if(f==="function")return function(m){return l(m)==="GeneratorFunction"}(h)?"generatorfunction":"function";if(function(m){return Array.isArray?Array.isArray(m):m instanceof Array}(h))return"array";if(function(m){return!(!m.constructor||typeof m.constructor.isBuffer!="function")&&m.constructor.isBuffer(m)}(h))return"buffer";if(function(m){try{if(typeof m.length=="number"&&typeof m.callee=="function")return!0}catch(_){if(_.message.indexOf("callee")!==-1)return!0}return!1}(h))return"arguments";if(function(m){return m instanceof Date||typeof m.toDateString=="function"&&typeof m.getDate=="function"&&typeof m.setDate=="function"}(h))return"date";if(function(m){return m instanceof Error||typeof m.message=="string"&&m.constructor&&typeof m.constructor.stackTraceLimit=="number"}(h))return"error";if(function(m){return m instanceof RegExp||typeof m.flags=="string"&&typeof m.ignoreCase=="boolean"&&typeof m.multiline=="boolean"&&typeof m.global=="boolean"}(h))return"regexp";switch(l(h)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(m){return typeof m.throw=="function"&&typeof m.return=="function"&&typeof m.next=="function"}(h))return"generator";switch(f=n.call(h)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return f.slice(8,-1).toLowerCase().replace(/\s/g,"")};function l(h){return h.constructor?h.constructor.name:null}function o(h,f){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:["option"];return c(h,f,m),u(h,f,m),function(_,E,D){var O=a(E),I=a(_);if(O==="object"){if(I!=="object")throw new Error("[Type Error]: '".concat(D.join("."),"' require 'object' type, but got '").concat(I,"'"));Object.keys(E).forEach(function(x){var P=_[x],C=E[x],b=D.slice();b.push(x),c(P,C,b),u(P,C,b),o(P,C,b)})}if(O==="array"){if(I!=="array")throw new Error("[Type Error]: '".concat(D.join("."),"' require 'array' type, but got '").concat(I,"'"));_.forEach(function(x,P){var C=_[P],b=E[P]||E[0],S=D.slice();S.push(P),c(C,b,S),u(C,b,S),o(C,b,S)})}}(h,f,m),h}function c(h,f,m){if(a(f)==="string"){var _=a(h);if(f[0]==="?"&&(f=f.slice(1)+"|undefined"),!(-1<f.indexOf("|")?f.split("|").map(function(E){return E.toLowerCase().trim()}).filter(Boolean).some(function(E){return _===E}):f.toLowerCase().trim()===_))throw new Error("[Type Error]: '".concat(m.join("."),"' require '").concat(f,"' type, but got '").concat(_,"'"))}}function u(h,f,m){if(a(f)==="function"){var _=f(h,a(h),m);if(_!==!0){var E=a(_);throw E==="string"?new Error(_):E==="error"?_:new Error("[Validator Error]: The scheme for '".concat(m.join("."),"' validator require return true, but got '").concat(_,"'"))}}}return o.kindOf=a,o}()},{}],"66mFZ":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=class{on(r,n,a){const l=this.e||(this.e={});return(l[r]||(l[r]=[])).push({fn:n,ctx:a}),this}once(r,n,a){const l=this;function o(...c){l.off(r,o),n.apply(a,c)}return o._=n,this.on(r,o,a)}emit(r,...n){const a=((this.e||(this.e={}))[r]||[]).slice();for(let l=0;l<a.length;l+=1)a[l].fn.apply(a[l].ctx,n);return this}off(r,n){const a=this.e||(this.e={}),l=a[r],o=[];if(l&&n)for(let c=0,u=l.length;c<u;c+=1)l[c].fn!==n&&l[c].fn._!==n&&o.push(l[c]);return o.length?a[r]=o:delete a[r],this}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(e,i,s){s.interopDefault=function(r){return r&&r.__esModule?r:{default:r}},s.defineInteropFlag=function(r){Object.defineProperty(r,"__esModule",{value:!0})},s.exportAll=function(r,n){return Object.keys(r).forEach(function(a){a==="default"||a==="__esModule"||n.hasOwnProperty(a)||Object.defineProperty(n,a,{enumerable:!0,get:function(){return r[a]}})}),n},s.export=function(r,n,a){Object.defineProperty(r,n,{enumerable:!0,get:a})}},{}],"71aH7":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./dom");r.exportAll(n,s);var a=e("./error");r.exportAll(a,s);var l=e("./subtitle");r.exportAll(l,s);var o=e("./file");r.exportAll(o,s);var c=e("./property");r.exportAll(c,s);var u=e("./time");r.exportAll(u,s);var h=e("./format");r.exportAll(h,s);var f=e("./compatibility");r.exportAll(f,s)},{"./dom":"bSNiV","./error":"hwmZz","./subtitle":"inzwq","./file":"6b7Ip","./property":"5NSdr","./time":"epmNy","./format":"gapRl","./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bSNiV:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"query",()=>a),r.export(s,"queryAll",()=>l),r.export(s,"addClass",()=>o),r.export(s,"removeClass",()=>c),r.export(s,"hasClass",()=>u),r.export(s,"append",()=>h),r.export(s,"remove",()=>f),r.export(s,"setStyle",()=>m),r.export(s,"setStyles",()=>_),r.export(s,"getStyle",()=>E),r.export(s,"sublings",()=>D),r.export(s,"inverseClass",()=>O),r.export(s,"tooltip",()=>I),r.export(s,"isInViewport",()=>x),r.export(s,"includeFromEvent",()=>P),r.export(s,"replaceElement",()=>C),r.export(s,"createElement",()=>b);var n=e("./compatibility");function a(S,L=document){return L.querySelector(S)}function l(S,L=document){return Array.from(L.querySelectorAll(S))}function o(S,L){return S.classList.add(L)}function c(S,L){return S.classList.remove(L)}function u(S,L){return S.classList.contains(L)}function h(S,L){return L instanceof Element?S.appendChild(L):S.insertAdjacentHTML("beforeend",String(L)),S.lastElementChild||S.lastChild}function f(S){return S.parentNode.removeChild(S)}function m(S,L,A){return S.style[L]=A,S}function _(S,L){return Object.keys(L).forEach(A=>{m(S,A,L[A])}),S}function E(S,L,A=!0){const U=window.getComputedStyle(S,null).getPropertyValue(L);return A?parseFloat(U):U}function D(S){return Array.from(S.parentElement.children).filter(L=>L!==S)}function O(S,L){D(S).forEach(A=>c(A,L)),o(S,L)}function I(S,L,A="top"){n.isMobile||(S.setAttribute("aria-label",L),o(S,"hint--rounded"),o(S,`hint--${A}`))}function x(S,L=0){const A=S.getBoundingClientRect(),U=window.innerHeight||document.documentElement.clientHeight,B=window.innerWidth||document.documentElement.clientWidth,G=A.top-L<=U&&A.top+A.height+L>=0,Q=A.left-L<=B+L&&A.left+A.width+L>=0;return G&&Q}function P(S,L){return S.composedPath&&S.composedPath().indexOf(L)>-1}function C(S,L){return L.parentNode.replaceChild(S,L),S}function b(S){return document.createElement(S)}},{"./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6ZTr6":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"userAgent",()=>n),r.export(s,"isMobile",()=>a),r.export(s,"isSafari",()=>l),r.export(s,"isWechat",()=>o),r.export(s,"isIE",()=>c),r.export(s,"isAndroid",()=>u),r.export(s,"isIOS",()=>h);const n=typeof window!="undefined"?window.navigator.userAgent:"",a=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(n),l=/^((?!chrome|android).)*safari/i.test(n),o=/MicroMessenger/i.test(n),c=/MSIE|Trident/i.test(n),u=/android/i.test(n),h=/iPad|iPhone|iPod/i.test(n)&&!window.MSStream},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hwmZz:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"ArtPlayerError",()=>n),r.export(s,"errorHandle",()=>a);class n extends Error{constructor(o,c){super(o),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,c||this.constructor),this.name="ArtPlayerError"}}function a(l,o){if(!l)throw new n(o);return l}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],inzwq:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){return`WEBVTT \r
\r
`.concat((c=o,c.replace(/(\d\d:\d\d:\d\d)[,.](\d+)/g,(u,h,f)=>{let m=f.slice(0,3);return f.length===1&&(m=f+"00"),f.length===2&&(m=f+"0"),`${h},${m}`})).replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").replace(/{[\s\S]*?}/g,"").concat(`\r
\r
`));var c}function a(o){return URL.createObjectURL(new Blob([o],{type:"text/vtt"}))}function l(o){const c=new RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function u(h=""){return h.split(/[:.]/).map((f,m,_)=>{if(m===_.length-1){if(f.length===1)return`.${f}00`;if(f.length===2)return`.${f}0`}else if(f.length===1)return(m===0?"0":":0")+f;return m===0?f:m===_.length-1?`.${f}`:`:${f}`}).join("")}return`WEBVTT

${o.split(/\r?\n/).map(h=>{const f=h.match(c);return f?{start:u(f[1].trim()),end:u(f[2].trim()),text:f[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,`
`).trim().split(/\r?\n/).map(m=>m.trim()).join(`
`)}:null}).filter(h=>h).map((h,f)=>h?`${f+1}
${h.start} --> ${h.end}
${h.text}`:"").filter(h=>h.trim()).join(`

`)}`}r.defineInteropFlag(s),r.export(s,"srtToVtt",()=>n),r.export(s,"vttToBlob",()=>a),r.export(s,"assToVtt",()=>l)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6b7Ip":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(l){return l.includes("?")?n(l.split("?")[0]):l.includes("#")?n(l.split("#")[0]):l.trim().toLowerCase().split(".").pop()}function a(l,o){const c=document.createElement("a");c.style.display="none",c.href=l,c.download=o,document.body.appendChild(c),c.click(),document.body.removeChild(c)}r.defineInteropFlag(s),r.export(s,"getExt",()=>n),r.export(s,"download",()=>a)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5NSdr":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"def",()=>n),r.export(s,"has",()=>l),r.export(s,"get",()=>o),r.export(s,"mergeDeep",()=>c);const n=Object.defineProperty,{hasOwnProperty:a}=Object.prototype;function l(u,h){return a.call(u,h)}function o(u,h){return Object.getOwnPropertyDescriptor(u,h)}function c(...u){const h=f=>f&&typeof f=="object"&&!Array.isArray(f);return u.reduce((f,m)=>(Object.keys(m).forEach(_=>{const E=f[_],D=m[_];Array.isArray(E)&&Array.isArray(D)?f[_]=E.concat(...D):!h(E)||!h(D)||D instanceof Element?f[_]=D:f[_]=c(E,D)}),f),{})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],epmNy:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(o=0){return new Promise(c=>setTimeout(c,o))}function a(o,c,u){let h;function f(...m){clearTimeout(h),h=setTimeout(function(){h=null,o.apply(u,m)},c)}return f.clearTimeout=function(){clearTimeout(h)},f}function l(o,c){let u,h,f=!1;return function m(..._){if(f)return u=_,void(h=this);f=!0,o.apply(this,_),setTimeout(()=>{f=!1,u&&(m.apply(h,u),u=null,h=null)},c)}}r.defineInteropFlag(s),r.export(s,"sleep",()=>n),r.export(s,"debounce",()=>a),r.export(s,"throttle",()=>l)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gapRl:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(u,h,f){return Math.max(Math.min(u,Math.max(h,f)),Math.min(h,f))}function a(u){return u.charAt(0).toUpperCase()+u.slice(1)}function l(u){return["string","number"].includes(typeof u)}function o(u){const h=Math.floor(u/3600),f=Math.floor((u-3600*h)/60),m=Math.floor(u-3600*h-60*f);return(h>0?[h,f,m]:[f,m]).map(_=>_<10?`0${_}`:String(_)).join(":")}function c(u){return u.replace(/[&<>'"]/g,h=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[h]||h)}r.defineInteropFlag(s),r.export(s,"clamp",()=>n),r.export(s,"capitalize",()=>a),r.export(s,"isStringOrNumber",()=>l),r.export(s,"secondToTime",()=>o),r.export(s,"escape",()=>c)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],AKEiO:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"ComponentOption",()=>m);var n=e("../utils");const a="array",l="boolean",o="string",c="number",u="object",h="function";function f(_,E,D){return(0,n.errorHandle)(E===o||E===c||_ instanceof Element,`${D.join(".")} require '${o}' or 'Element' type`)}const m={html:f,disable:`?${l}`,name:`?${o}`,index:`?${c}`,style:`?${u}`,click:`?${h}`,mounted:`?${h}`,tooltip:`?${o}|${c}`,width:`?${c}`,selector:`?${a}`,onSelect:`?${h}`,switch:`?${l}`,onSwitch:`?${h}`,range:`?${a}`,onRange:`?${h}`,onChange:`?${h}`};s.default={id:o,container:f,url:o,poster:o,title:o,type:o,theme:o,lang:o,volume:c,isLive:l,muted:l,autoplay:l,autoSize:l,autoMini:l,loop:l,flip:l,playbackRate:l,aspectRatio:l,screenshot:l,setting:l,hotkey:l,pip:l,mutex:l,backdrop:l,fullscreen:l,fullscreenWeb:l,subtitleOffset:l,miniProgressBar:l,useSSR:l,playsInline:l,lock:l,fastForward:l,autoPlayback:l,autoOrientation:l,airplay:l,plugins:[h],whitelist:[`${o}|${h}|regexp`],layers:[m],contextmenu:[m],settings:[m],controls:[Wt(Gt({},m),{position:(_,E,D)=>{const O=["top","left","right"];return(0,n.errorHandle)(O.includes(_),`${D.join(".")} only accept ${O.toString()} as parameters`)}})],quality:[{default:`?${l}`,html:o,url:o}],highlight:[{time:c,text:o}],thumbnails:{url:o,number:c,column:c,width:c,height:c},subtitle:{url:o,type:o,style:u,escape:l,encoding:o},moreVideoAttr:u,i18n:u,icons:u,customType:u}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lyjeQ:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9L0ao":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("./utils");s.default=class{constructor(n){this.art=n}get state(){const{option:n,constructor:{kindOf:a}}=this.art;return!r.isMobile||!n.whitelist.length||n.whitelist.some(l=>{switch(a(l)){case"string":return l==="*"||r.userAgent.indexOf(l)>-1;case"function":return l(r.userAgent);case"regexp":return l.test(r.userAgent);default:return!1}})}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],X13Zf:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("./utils");class n{constructor(l){this.art=l;const{option:o,constructor:c,whitelist:u}=l;o.container instanceof Element?this.$container=o.container:(this.$container=(0,r.query)(o.container),(0,r.errorHandle)(this.$container,`No container element found by ${o.container}`));const h=this.$container.tagName.toLowerCase();(0,r.errorHandle)(h==="div",`Unsupported container element type, only support 'div' but got '${h}'`),(0,r.errorHandle)(c.instances.every(f=>f.template.$container!==this.$container),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=l.id,this.$original=this.$container.cloneNode(!0),u.state?this.desktop():this.mobile()}static get html(){return'<div class="art-video-player art-subtitle-show art-layer-show art-control-show art-mask-show"><video class="art-video"><track default kind="metadata" src=""></track></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-center"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">4.6.2</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span> x <span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-mini-header"><div class="art-mini-title"></div><div class="art-mini-close">\xD7</div></div><div class="art-contextmenus"></div></div>'}query(l){return(0,r.query)(l,this.$container)}desktop(){const{option:l}=this.art;l.useSSR||(this.$container.innerHTML=n.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$track=this.query("track"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsCenter=this.query(".art-controls-center"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$miniHeader=this.query(".art-mini-header"),this.$miniTitle=this.query(".art-mini-title"),this.$miniClose=this.query(".art-mini-close"),this.$contextmenu=this.query(".art-contextmenus"),l.backdrop&&((0,r.addClass)(this.$setting,"art-backdrop-filter"),(0,r.addClass)(this.$contextmenu,"art-backdrop-filter"),(0,r.addClass)(this.$info,"art-backdrop-filter")),r.isMobile&&(0,r.addClass)(this.$player,"art-mobile")}mobile(){this.$container.innerHTML='<div class="art-video-player"><video class="art-video"></video></div>',this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video")}destroy(l){l?(0,r.replaceElement)(this.$original,this.$container):(0,r.addClass)(this.$player,"art-destroy")}}s.default=n},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3jKkj":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../utils"),a=e("./zh-cn.json"),l=r.interopDefault(a),o=e("./zh-tw.json"),c=r.interopDefault(o),u=e("./pl.json"),h=r.interopDefault(u),f=e("./cs.json"),m=r.interopDefault(f),_=e("./es.json"),E=r.interopDefault(_),D=e("./fa.json"),O=r.interopDefault(D);s.default=class{constructor(I){this.art=I,this.languages={"zh-cn":l.default,"zh-tw":c.default,pl:h.default,cs:m.default,es:E.default,fa:O.default},this.update(I.option.i18n)}init(){const I=this.art.option.lang.toLowerCase();this.language=this.languages[I]||{}}get(I){return this.language[I]||I}update(I){this.languages=(0,n.mergeDeep)(this.languages,I),this.init()}}},{"../utils":"71aH7","./zh-cn.json":"lNQi5","./zh-tw.json":"eRpom","./pl.json":"iEpPa","./cs.json":"dBgp3","./es.json":"dNIrL","./fa.json":"7Plhe","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lNQi5:[function(e,i,s){i.exports=JSON.parse('{"Video Info":"\u7EDF\u8BA1\u4FE1\u606F","Close":"\u5173\u95ED","Video Load Failed":"\u52A0\u8F7D\u5931\u8D25","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u6682\u505C","Rate":"\u901F\u5EA6","Mute":"\u9759\u97F3","Video Flip":"\u753B\u9762\u7FFB\u8F6C","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u8FDE\u63A5","Show Setting":"\u663E\u793A\u8BBE\u7F6E","Hide Setting":"\u9690\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u56FE","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u753B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8BA4","Normal":"\u6B63\u5E38","Open":"\u6253\u5F00","Switch Video":"\u5207\u6362","Switch Subtitle":"\u5207\u6362\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7F51\u9875\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7F51\u9875\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u5F00\u542F\u753B\u4E2D\u753B","Exit PIP Mode":"\u9000\u51FA\u753B\u4E2D\u753B","PIP Not Supported":"\u4E0D\u652F\u6301\u753B\u4E2D\u753B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F6C\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],eRpom:[function(e,i,s){i.exports=JSON.parse('{"Video Info":"\u7D71\u8A08\u8A0A\u606F","Close":"\u95DC\u9589","Video Load Failed":"\u8F09\u5165\u5931\u6557","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u66AB\u505C","Rate":"\u901F\u5EA6","Mute":"\u975C\u97F3","Video Flip":"\u756B\u9762\u7FFB\u8F49","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u9023\u63A5","Show Setting":"\u986F\u793A\u8BBE\u7F6E","Hide Setting":"\u96B1\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u5716","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u756B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8A8D","Normal":"\u6B63\u5E38","Open":"\u6253\u958B","Switch Video":"\u5207\u63DB","Switch Subtitle":"\u5207\u63DB\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7DB2\u9801\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u958B\u555F\u756B\u4E2D\u756B","Exit PIP Mode":"\u9000\u51FA\u756B\u4E2D\u756B","PIP Not Supported":"\u4E0D\u652F\u6301\u756B\u4E2D\u756B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F49\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],iEpPa:[function(e,i,s){i.exports=JSON.parse('{"Video Info":"Informacje o wideo","Close":"Zamknij","Video Load Failed":"B\u0142\u0105d \u0142adowania wideo","Volume":"G\u0142o\u015Bno\u015B\u0107","Play":"Odtw\xF3rz","Pause":"Wstrzymaj","Rate":"Oce\u0144","Mute":"Wycisz","Video Flip":"Rotacja wideo","Horizontal":"Pozioma","Vertical":"Pionowa","Reconnect":"Po\u0142\u0105cz ponownie","Show Setting":"Poka\u017C ustawienia","Hide Setting":"Ukryj ustawienia","Screenshot":"Zrzut ekranu","Play Speed":"Pr\u0119dko\u015B\u0107 odtwarzania","Aspect Ratio":"Wsp\xF3\u0142czynnik proporcji","Default":"Domy\u015Blny","Normal":"Normalny","Open":"Otw\xF3rz","Switch Video":"Prze\u0142\u0105cz wideo","Switch Subtitle":"Prze\u0142\u0105cz napisy","Fullscreen":"Pe\u0142ny ekran","Exit Fullscreen":"Zamknij pe\u0142ny ekran","Web Fullscreen":"Tryb pe\u0142nej strony","Exit Web Fullscreen":"Zamknij tryb pe\u0142nej strony","Mini Player":"Miniodtwarzacz","PIP Mode":"Tryb PiP","Exit PIP Mode":"Zamknij tryb PiP","PIP Not Supported":"Tryb PiP nieobs\u0142ugiwany","Fullscreen Not Supported":"Pe\u0142ny ekran nieobs\u0142ugiwany","Subtitle Offset":"Przesuni\u0119cie napis\xF3w","Last Seen":"Ostatnio widziany","Jump Play":"Skocz do gry","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nie jest dost\u0119pny"}')},{}],dBgp3:[function(e,i,s){i.exports=JSON.parse('{"Video Info":"Info o videu","Close":"Zav\u0159\xEDt","Video Load Failed":"Nahr\xE1n\xED videa selhalo","Volume":"Hlasitost","Play":"P\u0159ehr\xE1t","Pause":"Pozastavit","Rate":"Hodnocen\xED","Mute":"Ztlumit","Video Flip":"Oto\u010Dit video","Horizontal":"Horizont\xE1ln\u011B","Vertical":"Vertik\xE1ln\u011B","Reconnect":"Op\u011Btovn\xE9 p\u0159ipojen\xED","Show Setting":"Zobrazit nastaven\xED","Hide Setting":"Skr\xFDt nastaven\xED","Screenshot":"Sn\xEDmek obrazovky","Play Speed":"Rychlost p\u0159ehr\xE1v\xE1n\xED","Aspect Ratio":"Pom\u011Br stran","Default":"V\xFDchoz\xED","Normal":"Norm\xE1ln\xED","Open":"Otev\u0159\xEDt","Switch Video":"P\u0159epnout video","Switch Subtitle":"P\u0159epnout titulky","Fullscreen":"Cel\xE1 obrazovka","Exit Fullscreen":"Opustit re\u017Eim cel\xE9 obrazovky","Web Fullscreen":"Cel\xE1 str\xE1nka","Exit Web Fullscreen":"Zav\u0159\xEDt re\u017Eim cel\xE9 str\xE1nky","Mini Player":"Mini p\u0159ehr\xE1va\u010D","PIP Mode":"Re\u017Eim PIP","Exit PIP Mode":"Opustit re\u017Eim PIP","PIP Not Supported":"Re\u017Eim PIP nen\xED podporov\xE1n","Fullscreen Not Supported":"Re\u017Eim cel\xE9 obrazovky nen\xED podporov\xE1n","Subtitle Offset":"Posun titulk\u016F","Last Seen":"Naposledy vid\u011Bn","Jump Play":"Hra na skok","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nen\xED k dispozici"}')},{}],dNIrL:[function(e,i,s){i.exports=JSON.parse('{"Video Info":"Informaci\xF3n del video","Close":"Cerrar","Video Load Failed":"Fall\xF3 carga de video","Volume":"Volumen","Play":"Reproduciendo","Pause":"Pausa","Rate":"Velocidad","Mute":"Silencio","Video Flip":"Rotar video","Horizontal":"Horizontal","Vertical":"Vertical","Reconnect":"Reconectando","Show Setting":"Mostrar ajustes","Hide Setting":"Ocultar ajustes","Screenshot":"Captura de Pantalla","Play Speed":"Velocidad de reproducci\xF3n","Aspect Ratio":"Relaci\xF3n de aspecto","Default":"Por defecto","Normal":"Normal","Open":"Abrir","Switch Video":"Cambiar video","Switch Subtitle":"Cambiar subt\xEDtulo","Fullscreen":"Pantalla completa","Exit Fullscreen":"Salir de Pantalla completa","Web Fullscreen":"Pantalla completa Web","Exit Web Fullscreen":"Salir de Pantalla completa","Mini Player":"Mini reproductor","PIP Mode":"Modo PiP","Exit PIP Mode":"Cerrar modo PiP","PIP Not Supported":"Modo PiP no compatible","Fullscreen Not Supported":"Pantalla completa no soportada","Subtitle Offset":"Ajuste subt\xEDtulo","Last Seen":"Visto \xFAltima vez","Jump Play":"Saltar","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay no disponible"}')},{}],"7Plhe":[function(e,i,s){i.exports=JSON.parse('{"Video Info":"\u0627\u0637\u0644\u0627\u0639\u0627\u062A \u0648\u06CC\u062F\u06CC\u0648","Close":"\u0628\u0633\u062A\u0646","Video Load Failed":"\u0628\u0627\u0631\u06AF\u0630\u0627\u0631\u06CC \u0646\u0627\u0645\u0648\u0641\u0642","Play":"\u067E\u062E\u0634","Volume":"\u0645\u06CC\u0632\u0627\u0646 \u0635\u062F\u0627","Pause":"\u062A\u0648\u0642\u0641","Rate":"\u0646\u0631\u062E","Mute":"\u0633\u06A9\u0648\u062A","Video Flip":"\u0686\u0631\u062E\u0634 \u062A\u0635\u0648\u06CC\u0631","Horizontal":"\u0627\u0641\u0642\u06CC","Vertical":"\u0639\u0645\u0648\u062F\u06CC","Reconnect":"\u0627\u062A\u0635\u0627\u0644 \u0645\u062C\u062F\u062F","Show Setting":"\u062A\u0646\u0638\u06CC\u0645\u0627\u062A","Hide Setting":"\u0628\u0633\u062A\u0646 \u062A\u0646\u0638\u06CC\u0645\u0627\u062A","Screenshot":"\u0639\u06A9\u0633 \u0627\u0632 \u0635\u0641\u062D\u0647","Play Speed":"\u0633\u0631\u0639\u062A \u067E\u062E\u0634","Aspect Ratio":"\u0646\u0633\u0628\u062A \u062A\u0635\u0648\u06CC\u0631","Default":"\u062D\u0627\u0644\u062A \u067E\u06CC\u0634\u0641\u0631\u0636","Normal":" \u062D\u0627\u0644\u062A \u0639\u0627\u062F\u06CC","Open":"\u0628\u0627\u0632\u06A9\u0631\u062F\u0646","Switch Video":"\u062A\u063A\u06CC\u06CC\u0631 \u0648\u06CC\u062F\u06CC\u0648","Switch Subtitle":"\u0646\u063A\u06CC\u06CC\u0631 \u0632\u06CC\u0631\u0646\u0648\u06CC\u0633","Fullscreen":"\u062A\u0645\u0627\u0645 \u0635\u0641\u062D\u0647","Exit Fullscreen":"\u06A9\u0648\u0686\u06A9 \u06A9\u0631\u062F\u0646","Web Fullscreen":"\u062D\u0627\u0644\u062A \u062A\u0626\u0627\u062A\u0631","Exit Web Fullscreen":"\u062E\u0631\u0648\u062C \u0627\u0632 \u062D\u0627\u0644\u062A \u062A\u0626\u0627\u062A\u0631","Mini Player":"\u062D\u0627\u0644\u062A \u067E\u062E\u0634 \u06A9\u0648\u0686\u06A9","PIP Mode":" \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","Exit PIP Mode":"\u062E\u0631\u0648\u062C \u0627\u0632 \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","PIP Not Supported":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","Fullscreen Not Supported":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u062D\u0627\u0644\u062A \u062A\u0645\u0627\u0645 \u0635\u0641\u062D\u0647","Subtitle Offset":"\u0627\u0641\u0633\u062A \u0632\u06CC\u0631\u0646\u0648\u06CC\u0633","Last Seen":"\u0622\u062E\u0631\u06CC\u0646 \u0628\u0627\u0632\u062F\u06CC\u062F","Jump Play":"\u062C\u0627\u0645\u067E \u067E\u0644\u06CC","AirPlay":"\u0627\u06CC\u0631 \u067E\u0644\u06CC","AirPlay Not Available":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u0627\u06CC\u0631\u067E\u0644\u06CC"}')},{}],a90nx:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./urlMix"),a=r.interopDefault(n),l=e("./attrMix"),o=r.interopDefault(l),c=e("./playMix"),u=r.interopDefault(c),h=e("./pauseMix"),f=r.interopDefault(h),m=e("./toggleMix"),_=r.interopDefault(m),E=e("./seekMix"),D=r.interopDefault(E),O=e("./volumeMix"),I=r.interopDefault(O),x=e("./currentTimeMix"),P=r.interopDefault(x),C=e("./durationMix"),b=r.interopDefault(C),S=e("./switchMix"),L=r.interopDefault(S),A=e("./playbackRateMix"),U=r.interopDefault(A),B=e("./aspectRatioMix"),G=r.interopDefault(B),Q=e("./screenshotMix"),nt=r.interopDefault(Q),ot=e("./fullscreenMix"),V=r.interopDefault(ot),R=e("./fullscreenWebMix"),N=r.interopDefault(R),j=e("./pipMix"),X=r.interopDefault(j),rt=e("./loadedMix"),lt=r.interopDefault(rt),Tt=e("./playedMix"),wt=r.interopDefault(Tt),Rt=e("./playingMix"),tt=r.interopDefault(Rt),at=e("./autoSizeMix"),ft=r.interopDefault(at),ut=e("./rectMix"),yt=r.interopDefault(ut),At=e("./flipMix"),jt=r.interopDefault(At),qt=e("./miniMix"),re=r.interopDefault(qt),Xt=e("./loopMix"),ke=r.interopDefault(Xt),Me=e("./posterMix"),Pe=r.interopDefault(Me),pe=e("./autoHeightMix"),vt=r.interopDefault(pe),Oe=e("./themeMix"),Ne=r.interopDefault(Oe),Le=e("./titleMix"),Xe=r.interopDefault(Le),ye=e("./typeMix"),fe=r.interopDefault(ye),Ie=e("./normalSizeMix"),zi=r.interopDefault(Ie),Hi=e("./subtitleOffsetMix"),Yi=r.interopDefault(Hi),Fe=e("./airplayMix"),Ei=r.interopDefault(Fe),xi=e("./optionInit"),$e=r.interopDefault(xi),Si=e("./eventInit"),_e=r.interopDefault(Si);s.default=class{constructor(Ct){(0,a.default)(Ct),(0,o.default)(Ct),(0,u.default)(Ct),(0,f.default)(Ct),(0,_.default)(Ct),(0,D.default)(Ct),(0,I.default)(Ct),(0,P.default)(Ct),(0,b.default)(Ct),(0,L.default)(Ct),(0,U.default)(Ct),(0,G.default)(Ct),(0,nt.default)(Ct),(0,V.default)(Ct),(0,N.default)(Ct),(0,X.default)(Ct),(0,lt.default)(Ct),(0,wt.default)(Ct),(0,tt.default)(Ct),(0,ft.default)(Ct),(0,yt.default)(Ct),(0,jt.default)(Ct),(0,re.default)(Ct),(0,ke.default)(Ct),(0,Pe.default)(Ct),(0,vt.default)(Ct),(0,Ne.default)(Ct),(0,Xe.default)(Ct),(0,fe.default)(Ct),(0,zi.default)(Ct),(0,Yi.default)(Ct),(0,Ei.default)(Ct),(0,_e.default)(Ct),(0,$e.default)(Ct)}}},{"./urlMix":"kQoac","./attrMix":"deCma","./playMix":"fOJuP","./pauseMix":"fzHAy","./toggleMix":"cBHxQ","./seekMix":"koAPr","./volumeMix":"6eyuR","./currentTimeMix":"faaWv","./durationMix":"5y91K","./switchMix":"iceD8","./playbackRateMix":"keKwh","./aspectRatioMix":"jihET","./screenshotMix":"36kPY","./fullscreenMix":"2GYOJ","./fullscreenWebMix":"5aYAP","./pipMix":"7EnIB","./loadedMix":"3N9mP","./playedMix":"et96R","./playingMix":"9DzzM","./autoSizeMix":"i1LDY","./rectMix":"IqARI","./flipMix":"7E7Vs","./miniMix":"gpugx","./loopMix":"f1hVG","./posterMix":"1SuFS","./autoHeightMix":"8x4te","./themeMix":"2FqhO","./titleMix":"7Am53","./typeMix":"1fQQs","./normalSizeMix":"ePkBr","./subtitleOffsetMix":"6vlBV","./airplayMix":"eftqT","./optionInit":"fCWZK","./eventInit":"f8Lv3","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kQoac:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,template:{$video:l}}=n;(0,r.def)(n,"url",{get:()=>l.currentSrc,set(c){return ne(this,null,function*(){if(c){const u=a.type||(0,r.getExt)(c),h=a.customType[u];u&&h?(yield(0,r.sleep)(),n.loading.show=!0,h.call(n,l,c,n)):(n.url&&n.url!==c&&n.once("video:canplay",()=>{n.isReady&&n.emit("restart")}),l.src=c,n.option.url=c,n.emit("url",c))}else yield(0,r.sleep)(),n.loading.show=!0})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],deCma:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{template:{$video:a}}=n;(0,r.def)(n,"attr",{value(l,o){if(o===void 0)return a[l];a[l]=o}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fOJuP:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,notice:l,option:o,constructor:{instances:c},template:{$video:u}}=n;(0,r.def)(n,"play",{value:function(){return ne(this,null,function*(){const h=yield u.play();if(l.show=a.get("Play"),n.emit("play"),o.mutex)for(let f=0;f<c.length;f++){const m=c[f];m!==n&&m.pause()}return h})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fzHAy:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{template:{$video:a},i18n:l,notice:o}=n;(0,r.def)(n,"pause",{value(){const c=a.pause();return o.show=l.get("Pause"),n.emit("pause"),c}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cBHxQ:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){(0,r.def)(n,"toggle",{value:()=>n.playing?n.pause():n.play()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],koAPr:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{notice:a}=n;(0,r.def)(n,"seek",{set(l){n.currentTime=l,n.emit("seek",n.currentTime),n.duration&&(a.show=`${(0,r.secondToTime)(n.currentTime)} / ${(0,r.secondToTime)(n.duration)}`)}}),(0,r.def)(n,"forward",{set(l){n.seek=n.currentTime+l}}),(0,r.def)(n,"backward",{set(l){n.seek=n.currentTime-l}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6eyuR":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{template:{$video:a},i18n:l,notice:o,storage:c}=n;(0,r.def)(n,"volume",{get:()=>a.volume||0,set:u=>{a.volume=(0,r.clamp)(u,0,1),o.show=`${l.get("Volume")}: ${parseInt(100*a.volume,10)}`,a.volume!==0&&c.set("volume",a.volume)}}),(0,r.def)(n,"muted",{get:()=>a.muted,set:u=>{a.muted=u}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],faaWv:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{$video:a}=n.template;(0,r.def)(n,"currentTime",{get:()=>a.currentTime||0,set:l=>{l=parseFloat(l),Number.isNaN(l)||(a.currentTime=(0,r.clamp)(l,0,n.duration))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5y91K":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){(0,r.def)(n,"duration",{get:()=>{const{duration:a}=n.template.$video;return a===1/0?0:a||0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],iceD8:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,option:l,notice:o}=n;function c(u,h,f){return new Promise(m=>{if(u===n.url)return m(u);const{playing:_}=n;n.pause(),URL.revokeObjectURL(n.url),n.url=u,n.once("video:canplay",()=>{n.playbackRate=!1,n.aspectRatio=!1,n.flip="normal",n.autoSize=l.autoSize,n.currentTime=f,n.notice.show="",_&&n.play(),h&&(o.show=`${a.get("Switch Video")}: ${h}`),m(u)})})}(0,r.def)(n,"switchQuality",{value:(u,h)=>c(u,h,n.currentTime)}),(0,r.def)(n,"switchUrl",{value:(u,h)=>c(u,h,0)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],keKwh:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{template:{$video:a},i18n:l,notice:o}=n;(0,r.def)(n,"playbackRate",{get:()=>a.playbackRate,set(c){if(c){if(c===a.playbackRate)return;a.playbackRate=c,o.show=`${l.get("Rate")}: ${c===1?l.get("Normal"):`${c}x`}`}else n.playbackRate=1}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jihET:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{template:{$video:a,$player:l},i18n:o,notice:c}=n;(0,r.def)(n,"aspectRatio",{get:()=>l.dataset.aspectRatio||"default",set(u){if(u||(u="default"),u==="default")(0,r.setStyle)(a,"width",null),(0,r.setStyle)(a,"height",null),(0,r.setStyle)(a,"padding",null),delete l.dataset.aspectRatio;else{const h=u.split(":").map(Number),{videoWidth:f,videoHeight:m}=a,{clientWidth:_,clientHeight:E}=l,D=f/m,O=h[0]/h[1];if(D>O){const I=O*m/f;(0,r.setStyle)(a,"width",100*I+"%"),(0,r.setStyle)(a,"height","100%"),(0,r.setStyle)(a,"padding",`0 ${(_-_*I)/2}px`)}else{const I=f/O/m;(0,r.setStyle)(a,"width","100%"),(0,r.setStyle)(a,"height",100*I+"%"),(0,r.setStyle)(a,"padding",(E-E*I)/2+"px 0")}l.dataset.aspectRatio=u}c.show=`${o.get("Aspect Ratio")}: ${u==="default"?o.get("Default"):u}`,n.emit("aspectRatio",u)}}),(0,r.def)(n,"aspectRatioReset",{set(u){if(u){const{aspectRatio:h}=n;n.aspectRatio=h}}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"36kPY":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,notice:l,template:{$video:o}}=n,c=(0,r.createElement)("canvas");(0,r.def)(n,"getDataURL",{value:()=>new Promise((u,h)=>{try{c.width=o.videoWidth,c.height=o.videoHeight,c.getContext("2d").drawImage(o,0,0),u(c.toDataURL("image/png"))}catch(f){l.show=f,h(f)}})}),(0,r.def)(n,"getBlobUrl",{value:()=>new Promise((u,h)=>{try{c.width=o.videoWidth,c.height=o.videoHeight,c.getContext("2d").drawImage(o,0,0),c.toBlob(f=>{u(URL.createObjectURL(f))})}catch(f){l.show=f,h(f)}})}),(0,r.def)(n,"screenshot",{value:()=>ne(this,null,function*(){const u=yield n.getDataURL();return(0,r.download)(u,`${a.title||"artplayer"}_${(0,r.secondToTime)(o.currentTime)}.png`),n.emit("screenshot",u),u})})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2GYOJ":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../libs/screenfull"),a=r.interopDefault(n),l=e("../utils");s.default=function(o){const{i18n:c,notice:u,template:{$video:h,$player:f}}=o;o.once("video:loadedmetadata",()=>{a.default.isEnabled?(m=>{a.default.on("change",()=>{m.emit("fullscreen",a.default.isFullscreen)}),(0,l.def)(m,"fullscreen",{get:()=>a.default.isFullscreen,set(E){return ne(this,null,function*(){E?(m.normalSize="fullscreen",m.aspectRatioReset=!0,m.autoSize=!1,yield a.default.request(f),(0,l.addClass)(f,"art-fullscreen"),m.emit("resize"),u.show=""):(m.aspectRatioReset=!0,m.autoSize=m.option.autoSize,yield a.default.exit(),(0,l.removeClass)(f,"art-fullscreen"),m.emit("resize"),u.show="")})}})})(o):document.fullscreenEnabled||h.webkitSupportsFullscreen?(m=>{(0,l.def)(m,"fullscreen",{get:()=>h.webkitDisplayingFullscreen,set(_){_?(m.normalSize="fullscreen",h.webkitEnterFullscreen(),m.emit("fullscreen",!0),u.show=""):(h.webkitExitFullscreen(),m.emit("fullscreen",!1),u.show="")}})})(o):(0,l.def)(o,"fullscreen",{get:()=>!1,set(){u.show=c.get("Fullscreen Not Supported")}}),(0,l.def)(o,"fullscreen",(0,l.get)(o,"fullscreen"))})}},{"../libs/screenfull":"8v40z","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8v40z":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);const r=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=(()=>{if(typeof document=="undefined")return!1;const o=r[0],c={};for(const u of r)if(u[1]in document){for(const[h,f]of u.entries())c[o[h]]=f;return c}return!1})(),a={change:n.fullscreenchange,error:n.fullscreenerror};let l={request:(o=document.documentElement,c)=>new Promise((u,h)=>{const f=()=>{l.off("change",f),u()};l.on("change",f);const m=o[n.requestFullscreen](c);m instanceof Promise&&m.then(f).catch(h)}),exit:()=>new Promise((o,c)=>{if(!l.isFullscreen)return void o();const u=()=>{l.off("change",u),o()};l.on("change",u);const h=document[n.exitFullscreen]();h instanceof Promise&&h.then(u).catch(c)}),toggle:(o,c)=>l.isFullscreen?l.exit():l.request(o,c),onchange(o){l.on("change",o)},onerror(o){l.on("error",o)},on(o,c){const u=a[o];u&&document.addEventListener(u,c,!1)},off(o,c){const u=a[o];u&&document.removeEventListener(u,c,!1)},raw:n};Object.defineProperties(l,{isFullscreen:{get:()=>Boolean(document[n.fullscreenElement])},element:{enumerable:!0,get:()=>document[n.fullscreenElement]},isEnabled:{enumerable:!0,get:()=>Boolean(document[n.fullscreenEnabled])}}),n||(l={isEnabled:!1}),s.default=l},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5aYAP":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{notice:a,constructor:l,template:{$container:o,$player:c}}=n;(0,r.def)(n,"fullscreenWeb",{get:()=>(0,r.hasClass)(c,"art-fullscreen-web"),set(u){u?(l.FULLSCREEN_WEB_IN_BODY&&(0,r.append)(document.body,c),n.normalSize="fullscreenWeb",(0,r.addClass)(c,"art-fullscreen-web"),n.aspectRatioReset=!0,n.autoSize=!1,n.emit("resize"),n.emit("fullscreenWeb",!0),a.show=""):(l.FULLSCREEN_WEB_IN_BODY&&(0,r.append)(o,c),(0,r.removeClass)(c,"art-fullscreen-web"),n.aspectRatioReset=!0,n.autoSize=n.option.autoSize,n.emit("resize"),n.emit("fullscreenWeb",!1),a.show="")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7EnIB":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,notice:l,template:{$video:o}}=n;document.pictureInPictureEnabled?function(c){const{template:{$video:u},proxy:h,notice:f}=c;u.disablePictureInPicture=!1,(0,r.def)(c,"pip",{get:()=>document.pictureInPictureElement,set(m){m?(c.normalSize="pip",u.requestPictureInPicture().catch(_=>{throw f.show=_,_})):document.exitPictureInPicture().catch(_=>{throw f.show=_,_})}}),h(u,"enterpictureinpicture",()=>{c.emit("pip",!0)}),h(u,"leavepictureinpicture",()=>{c.emit("pip",!1)})}(n):o.webkitSupportsPresentationMode?function(c){const{$video:u}=c.template;u.webkitSetPresentationMode("inline"),(0,r.def)(c,"pip",{get:()=>u.webkitPresentationMode==="picture-in-picture",set(h){h?(c.normalSize="pip",u.webkitSetPresentationMode("picture-in-picture"),c.emit("pip",!0)):(u.webkitSetPresentationMode("inline"),c.emit("pip",!1))}})}(n):(0,r.def)(n,"pip",{get:()=>!1,set(){l.show=a.get("PIP Not Supported")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3N9mP":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{$video:a}=n.template;(0,r.def)(n,"loaded",{get:()=>n.loadedTime/a.duration}),(0,r.def)(n,"loadedTime",{get:()=>a.buffered.length?a.buffered.end(a.buffered.length-1):0})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],et96R:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){(0,r.def)(n,"played",{get:()=>n.currentTime/n.duration})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9DzzM":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{$video:a}=n.template;(0,r.def)(n,"playing",{get:()=>a.currentTime>0&&!a.paused&&!a.ended&&a.readyState>2})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],i1LDY:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{$container:a,$player:l,$video:o}=n.template;(0,r.def)(n,"autoSize",{get:()=>(0,r.hasClass)(a,"art-auto-size"),set(c){if(c){const{videoWidth:u,videoHeight:h}=o,{width:f,height:m}=a.getBoundingClientRect(),_=u/h,E=f/m;if((0,r.addClass)(a,"art-auto-size"),E>_){const D=m*_/f*100;(0,r.setStyle)(l,"width",`${D}%`),(0,r.setStyle)(l,"height","100%")}else{const D=f/_/m*100;(0,r.setStyle)(l,"width","100%"),(0,r.setStyle)(l,"height",`${D}%`)}n.emit("autoSize",{width:n.width,height:n.height})}else(0,r.removeClass)(a,"art-auto-size"),(0,r.setStyle)(l,"width",null),(0,r.setStyle)(l,"height",null),n.emit("autoSize")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],IqARI:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){(0,r.def)(n,"rect",{get:()=>n.template.$player.getBoundingClientRect()});const a=["bottom","height","left","right","top","width"];for(let l=0;l<a.length;l++){const o=a[l];(0,r.def)(n,o,{get:()=>n.rect[o]})}(0,r.def)(n,"x",{get:()=>n.left+window.pageXOffset}),(0,r.def)(n,"y",{get:()=>n.top+window.pageYOffset})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7E7Vs":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{template:{$player:a},i18n:l,notice:o}=n;(0,r.def)(n,"flip",{get:()=>a.dataset.flip||"normal",set(c){c||(c="normal"),c==="normal"?delete a.dataset.flip:a.dataset.flip=c,o.show=`${l.get("Video Flip")}: ${l.get((0,r.capitalize)(c))}`,n.emit("flip",c)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gpugx:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,option:l,storage:o,proxy:c,template:{$player:u,$miniClose:h,$miniTitle:f,$miniHeader:m}}=n;let _=!1,E=0,D=0,O=0,I=0;c(m,"mousedown",x=>{_=!0,E=x.pageX,D=x.pageY,O=n.left,I=n.top}),c(document,"mousemove",x=>{if(_){(0,r.addClass)(u,"art-is-dragging");const P=I+x.pageY-D,C=O+x.pageX-E;(0,r.setStyle)(u,"top",`${P}px`),(0,r.setStyle)(u,"left",`${C}px`),o.set("top",P),o.set("left",C)}}),c(document,"mouseup",()=>{_=!1,(0,r.removeClass)(u,"art-is-dragging")}),c(h,"click",()=>{n.mini=!1,_=!1,(0,r.removeClass)(u,"art-is-dragging")}),(0,r.append)(f,l.title||a.get("Mini Player")),(0,r.def)(n,"mini",{get:()=>(0,r.hasClass)(u,"art-mini"),set(x){if(x){n.normalSize="mini",n.autoSize=!1,(0,r.addClass)(u,"art-mini");const P=o.get("top"),C=o.get("left");if(P&&C)(0,r.setStyle)(u,"top",`${P}px`),(0,r.setStyle)(u,"left",`${C}px`),(0,r.isInViewport)(m)||(o.del("top"),o.del("left"),n.mini=!0);else{const b=window.innerHeight-n.height-50,S=window.innerWidth-n.width-50;o.set("top",b),o.set("left",S),(0,r.setStyle)(u,"top",`${b}px`),(0,r.setStyle)(u,"left",`${S}px`)}n.aspectRatio=!1,n.playbackRate=!1,n.notice.show="",n.emit("mini",!0)}else(0,r.removeClass)(u,"art-mini"),(0,r.setStyle)(u,"top",null),(0,r.setStyle)(u,"left",null),n.aspectRatio=!1,n.playbackRate=!1,n.autoSize=l.autoSize,n.notice.show="",n.emit("mini",!1)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f1hVG:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){let a=[];(0,r.def)(n,"loop",{get:()=>a,set:l=>{if(Array.isArray(l)&&typeof l[0]=="number"&&typeof l[1]=="number"){const o=(0,r.clamp)(l[0],0,Math.min(l[1],n.duration)),c=(0,r.clamp)(l[1],o,n.duration);a=c-o>=1?[o,c]:[]}else a=[]}}),n.on("video:timeupdate",()=>{a.length&&(n.currentTime<a[0]||n.currentTime>a[1])&&(n.seek=a[0])})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1SuFS":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,template:{$poster:l}}=n;(0,r.def)(n,"poster",{get:()=>a.poster,set(o){a.poster=o,(0,r.setStyle)(l,"backgroundImage",`url(${o})`)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8x4te":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,template:{$container:l,$video:o}}=n,c=l.style.height;(0,r.def)(n,"autoHeight",{get:()=>(0,r.hasClass)(l,"art-auto-height"),set(u){if(u){const{clientWidth:h}=l,{videoHeight:f,videoWidth:m}=o,_=f*(h/m);(0,r.setStyle)(l,"height",_+"px"),(0,r.addClass)(l,"art-auto-height"),n.autoSize=a.autoSize,n.emit("autoHeight",_)}else(0,r.setStyle)(l,"height",c),(0,r.removeClass)(l,"art-auto-height"),n.autoSize=a.autoSize,n.emit("autoHeight")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2FqhO":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,template:{$player:l}}=n;(0,r.def)(n,"theme",{get:()=>getComputedStyle(l).getPropertyValue("--theme"),set(o){a.theme=o,l.style.setProperty("--theme",o)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7Am53":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){(0,r.def)(n,"title",{get:()=>n.option.title,set(a){n.option.title=a}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1fQQs":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){(0,r.def)(n,"type",{get:()=>n.option.type,set(a){n.option.type=a}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePkBr:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const a=["mini","pip","fullscreen","fullscreenWeb"];(0,r.def)(n,"normalSize",{get:()=>a.every(l=>!n[l]),set(l){a.filter(o=>o!==l).forEach(o=>{n[o]&&(n[o]=!1)})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6vlBV":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{clamp:a}=n.constructor.utils,{notice:l,template:o,i18n:c}=n;let u=0,h=[];n.on("subtitle:switch",()=>{h=[]}),(0,r.def)(n,"subtitleOffset",{get:()=>u,set(f){if(o.$track&&o.$track.track){const m=Array.from(o.$track.track.cues);u=a(f,-5,5);for(let _=0;_<m.length;_++){const E=m[_];h[_]||(h[_]={startTime:E.startTime,endTime:E.endTime}),E.startTime=a(h[_].startTime+u,0,n.duration),E.endTime=a(h[_].endTime+u,0,n.duration)}n.subtitle.update(),l.show=`${c.get("Subtitle Offset")}: ${f}s`,n.emit("subtitleOffset",f)}else n.emit("subtitleOffset",0)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eftqT:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,notice:l,proxy:o,template:{$video:c}}=n;let u=!0;window.WebKitPlaybackTargetAvailabilityEvent&&c.webkitShowPlaybackTargetPicker?o(c,"webkitplaybacktargetavailabilitychanged",h=>{switch(h.availability){case"available":u=!0;break;case"not-available":u=!1}}):u=!1,(0,r.def)(n,"airplay",{value(){u?(c.webkitShowPlaybackTargetPicker(),n.emit("airplay")):l.show=a.get("AirPlay Not Available")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fCWZK:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,storage:l,template:{$video:o,$poster:c}}=n;Object.keys(a.moreVideoAttr).forEach(h=>{n.attr(h,a.moreVideoAttr[h])}),a.muted&&(n.muted=a.muted),a.volume&&(o.volume=(0,r.clamp)(a.volume,0,1));const u=l.get("volume");typeof u=="number"&&(o.volume=(0,r.clamp)(u,0,1)),a.poster&&(0,r.setStyle)(c,"backgroundImage",`url(${a.poster})`),a.autoplay&&(o.autoplay=a.autoplay),a.playsInline&&(o.playsInline=!0,o["webkit-playsinline"]=!0),a.theme&&(n.theme=a.theme),n.url=a.url}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f8Lv3:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../config"),a=r.interopDefault(n),l=e("../utils");s.default=function(o){const{i18n:c,notice:u,option:h,constructor:f,proxy:m,template:{$player:_,$video:E,$poster:D}}=o;let O=0;for(let I=0;I<a.default.events.length;I++)m(E,a.default.events[I],x=>{o.emit(`video:${x.type}`,x)});o.on("video:canplay",()=>{O=0,o.loading.show=!1}),o.once("video:canplay",()=>{o.loading.show=!1,o.controls.show=!0,o.mask.show=!0,o.isReady=!0,o.emit("ready")}),o.on("video:ended",()=>{h.loop?(o.seek=0,o.play(),o.controls.show=!1,o.mask.show=!1):(o.controls.show=!0,o.mask.show=!0)}),o.on("video:error",I=>ne(this,null,function*(){O<f.RECONNECT_TIME_MAX?(yield(0,l.sleep)(f.RECONNECT_SLEEP_TIME),O+=1,o.url=h.url,u.show=`${c.get("Reconnect")}: ${O}`,o.emit("error",I,O)):(o.mask.show=!0,o.loading.show=!1,o.controls.show=!0,(0,l.addClass)(_,"art-error"),yield(0,l.sleep)(f.RECONNECT_SLEEP_TIME),u.show=c.get("Video Load Failed"),o.destroy(!1))})),o.on("video:loadedmetadata",()=>{o.autoSize=h.autoSize,l.isMobile&&(o.loading.show=!1,o.controls.show=!0,o.mask.show=!0)}),o.on("video:loadstart",()=>{o.loading.show=!0,o.mask.show=!1,o.controls.show=!0}),o.on("video:pause",()=>{o.controls.show=!0,o.mask.show=!0}),o.on("video:play",()=>{o.mask.show=!1,(0,l.setStyle)(D,"display","none")}),o.on("video:playing",()=>{o.mask.show=!1}),o.on("video:seeked",()=>{o.loading.show=!1}),o.on("video:seeking",()=>{o.loading.show=!0,o.mask.show=!1}),o.on("video:timeupdate",()=>{o.mask.show=!1}),o.on("video:waiting",()=>{o.loading.show=!0,o.mask.show=!1})}},{"../config":"lyjeQ","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8Z0Uf":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../utils"),a=e("../utils/component"),l=r.interopDefault(a),o=e("./fullscreen"),c=r.interopDefault(o),u=e("./fullscreenWeb"),h=r.interopDefault(u),f=e("./pip"),m=r.interopDefault(f),_=e("./playAndPause"),E=r.interopDefault(_),D=e("./progress"),O=r.interopDefault(D),I=e("./time"),x=r.interopDefault(I),P=e("./volume"),C=r.interopDefault(P),b=e("./setting"),S=r.interopDefault(b),L=e("./thumbnails"),A=r.interopDefault(L),U=e("./screenshot"),B=r.interopDefault(U),G=e("./quality"),Q=r.interopDefault(G),nt=e("./loop"),ot=r.interopDefault(nt),V=e("./airplay"),R=r.interopDefault(V);class N extends l.default{constructor(X){super(X),this.name="control";const{proxy:rt,constructor:lt,template:{$player:Tt}}=X;let wt=Date.now();rt(Tt,["click","mousemove","touchstart","touchmove"],()=>{this.show=!0,(0,n.removeClass)(Tt,"art-hide-cursor"),(0,n.addClass)(Tt,"art-hover"),wt=Date.now()}),X.on("video:timeupdate",()=>{!X.isInput&&X.playing&&this.show&&Date.now()-wt>=lt.CONTROL_HIDE_TIME&&(this.show=!1,(0,n.addClass)(Tt,"art-hide-cursor"),(0,n.removeClass)(Tt,"art-hover"))}),this.init()}init(){const{option:X}=this.art;X.isLive||this.add((0,O.default)({name:"progress",position:"top",index:10})),!X.thumbnails.url||X.isLive||n.isMobile||this.add((0,A.default)({name:"thumbnails",position:"top",index:20})),this.add((0,ot.default)({name:"loop",position:"top",index:30})),this.add((0,E.default)({name:"playAndPause",position:"left",index:10})),this.add((0,C.default)({name:"volume",position:"left",index:20})),X.isLive||this.add((0,x.default)({name:"time",position:"left",index:30})),X.quality.length&&this.add((0,Q.default)({name:"quality",position:"right",index:10})),X.screenshot&&!n.isMobile&&this.add((0,B.default)({name:"screenshot",position:"right",index:20})),X.setting&&this.add((0,S.default)({name:"setting",position:"right",index:30})),X.pip&&this.add((0,m.default)({name:"pip",position:"right",index:40})),X.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&this.add((0,R.default)({name:"airplay",position:"right",index:50})),X.fullscreenWeb&&this.add((0,h.default)({name:"fullscreenWeb",position:"right",index:60})),X.fullscreen&&this.add((0,c.default)({name:"fullscreen",position:"right",index:70}));for(let rt=0;rt<X.controls.length;rt++)this.add(X.controls[rt])}add(X){const rt=typeof X=="function"?X(this.art):X,{$progress:lt,$controlsLeft:Tt,$controlsRight:wt}=this.art.template;switch(rt.position){case"top":this.$parent=lt;break;case"left":this.$parent=Tt;break;case"right":this.$parent=wt;break;default:(0,n.errorHandle)(!1,"Control option.position must one of 'top', 'left', 'right'")}super.add(rt)}}s.default=N},{"../utils":"71aH7","../utils/component":"18nVI","./fullscreen":"c61Lj","./fullscreenWeb":"03jeB","./pip":"u8l8e","./playAndPause":"ebXtb","./progress":"bgoVP","./time":"ikc2j","./volume":"b8NFx","./setting":"03o9l","./thumbnails":"eCVx2","./screenshot":"4KCF5","./quality":"efgTY","./loop":"2hIff","./airplay":"4IS2d","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"18nVI":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./dom"),a=e("option-validator"),l=r.interopDefault(a),o=e("../scheme"),c=e("./property"),u=e("./error");s.default=class{constructor(h){this.id=0,this.art=h,this.add=this.add.bind(this)}get show(){return(0,n.hasClass)(this.art.template.$player,`art-${this.name}-show`)}set show(h){const{$player:f}=this.art.template,m=`art-${this.name}-show`;h?(0,n.addClass)(f,m):(0,n.removeClass)(f,m),this.art.emit(this.name,h)}set toggle(h){h&&(this.show=!this.show)}add(h){const f=typeof h=="function"?h(this.art):h;if(f.html=f.html||"",(0,l.default)(f,o.ComponentOption),!this.$parent||!this.name||f.disable)return;const m=f.name||`${this.name}${this.id}`;(0,u.errorHandle)(!(0,c.has)(this,m),`Cannot add an existing name [${m}] to the [${this.name}]`),this.id+=1;const _=(0,n.createElement)("div");(0,n.addClass)(_,`art-${this.name}`),(0,n.addClass)(_,`art-${this.name}-${m}`);const E=Array.from(this.$parent.children);_.dataset.index=f.index||this.id;const D=E.find(O=>Number(O.dataset.index)>=Number(_.dataset.index));return D?D.insertAdjacentElement("beforebegin",_):(0,n.append)(this.$parent,_),f.html&&(0,n.append)(_,f.html),f.style&&(0,n.setStyles)(_,f.style),f.tooltip&&(0,n.tooltip)(_,f.tooltip),f.click&&this.art.events.proxy(_,"click",O=>{O.preventDefault(),f.click.call(this.art,this,O)}),f.selector&&["left","right"].includes(f.position)&&this.selector(f,_),f.mounted&&f.mounted.call(this.art,_),(0,c.def)(this,m,{value:_}),_}selector(h,f){const{hover:m,proxy:_}=this.art.events;(0,n.addClass)(f,"art-control-selector");const E=(0,n.createElement)("div");(0,n.addClass)(E,"art-selector-value"),(0,n.append)(E,h.html),f.innerText="",(0,n.append)(f,E);const D=h.selector.map((x,P)=>`<div class="art-selector-item ${x.default?"art-current":""}" data-index="${P}">${x.html}</div>`).join(""),O=(0,n.createElement)("div");(0,n.addClass)(O,"art-selector-list"),(0,n.append)(O,D),(0,n.append)(f,O),this.art.option.backdrop&&(0,n.addClass)(O,"art-backdrop-filter");const I=()=>{const x=(0,n.getStyle)(f,"width")/2-(0,n.getStyle)(O,"width")/2;O.style.left=`${x}px`};m(f,I),_(O,"click",x=>ne(this,null,function*(){const P=(x.composedPath()||[]).find(S=>(0,n.hasClass)(S,"art-selector-item"));if(!P)return;(0,n.inverseClass)(P,"art-current");const C=Number(P.dataset.index),b=h.selector[C]||{};if(E.innerText=P.innerText,h.onSelect){const S=yield h.onSelect.call(this.art,b,P,x);typeof S!="string"&&typeof S!="number"||(E.innerHTML=S)}I()}))}}},{"./dom":"bSNiV","option-validator":"bAWi2","../scheme":"AKEiO","./property":"5NSdr","./error":"hwmZz","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],c61Lj:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Wt(Gt({},n),{tooltip:a.i18n.get("Fullscreen"),mounted:l=>{const{proxy:o,icons:c,i18n:u}=a,h=(0,r.append)(l,c.fullscreenOn),f=(0,r.append)(l,c.fullscreenOff);(0,r.setStyle)(f,"display","none"),o(l,"click",()=>{a.fullscreen=!a.fullscreen}),a.on("fullscreen",m=>{m?((0,r.tooltip)(l,u.get("Exit Fullscreen")),(0,r.setStyle)(h,"display","none"),(0,r.setStyle)(f,"display","inline-flex")):((0,r.tooltip)(l,u.get("Fullscreen")),(0,r.setStyle)(h,"display","inline-flex"),(0,r.setStyle)(f,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03jeB":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Wt(Gt({},n),{tooltip:a.i18n.get("Web Fullscreen"),mounted:l=>{const{proxy:o,icons:c,i18n:u}=a,h=(0,r.append)(l,c.fullscreenWebOn),f=(0,r.append)(l,c.fullscreenWebOff);(0,r.setStyle)(f,"display","none"),o(l,"click",()=>{a.fullscreenWeb=!a.fullscreenWeb}),a.on("fullscreenWeb",m=>{m?((0,r.tooltip)(l,u.get("Exit Web Fullscreen")),(0,r.setStyle)(h,"display","none"),(0,r.setStyle)(f,"display","inline-flex")):((0,r.tooltip)(l,u.get("Web Fullscreen")),(0,r.setStyle)(h,"display","inline-flex"),(0,r.setStyle)(f,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],u8l8e:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Wt(Gt({},n),{tooltip:a.i18n.get("PIP Mode"),mounted:l=>{const{proxy:o,icons:c,i18n:u}=a;(0,r.append)(l,c.pip),o(l,"click",()=>{a.pip=!a.pip}),a.on("pip",h=>{(0,r.tooltip)(l,u.get(h?"Exit PIP Mode":"PIP Mode"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ebXtb:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Wt(Gt({},n),{mounted:l=>{const{proxy:o,icons:c,i18n:u}=a,h=(0,r.append)(l,c.play),f=(0,r.append)(l,c.pause);function m(){(0,r.setStyle)(h,"display","flex"),(0,r.setStyle)(f,"display","none")}function _(){(0,r.setStyle)(h,"display","none"),(0,r.setStyle)(f,"display","flex")}(0,r.tooltip)(h,u.get("Play")),(0,r.tooltip)(f,u.get("Pause")),o(h,"click",()=>{a.play()}),o(f,"click",()=>{a.pause()}),a.playing?_():m(),a.on("video:playing",()=>{_()}),a.on("video:pause",()=>{m()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bgoVP:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"getPosFromEvent",()=>a),r.export(s,"setCurrentTime",()=>l);var n=e("../utils");function a(o,c){const{$progress:u}=o.template,{left:h}=u.getBoundingClientRect(),f=n.isMobile?c.touches[0].clientX:c.pageX,m=(0,n.clamp)(f-h,0,u.clientWidth),_=m/u.clientWidth*o.duration;return{second:_,time:(0,n.secondToTime)(_),width:m,percentage:(0,n.clamp)(m/u.clientWidth,0,1)}}function l(o,c){if(o.isRotate){const u=c.touches[0].clientY/o.height,h=u*o.duration;o.emit("setBar","played",u),o.seek=h}else{const{second:u,percentage:h}=a(o,c);o.emit("setBar","played",h),o.seek=u}}s.default=function(o){return c=>{const{icons:u,option:h,proxy:f}=c;return Wt(Gt({},o),{html:'<div class="art-control-progress-inner"><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:m=>{let _=!1;const E=(0,n.query)(".art-progress-loaded",m),D=(0,n.query)(".art-progress-played",m),O=(0,n.query)(".art-progress-highlight",m),I=(0,n.query)(".art-progress-indicator",m),x=(0,n.query)(".art-progress-tip",m),{PROGRESS_HEIGHT:P,INDICATOR_SIZE:C,INDICATOR_SIZE_ICON:b,INDICATOR_SIZE_MOBILE:S,INDICATOR_SIZE_MOBILE_ICON:L}=c.constructor;(0,n.setStyle)(m,"height",`${P}px`),(0,n.setStyle)(D,"backgroundColor","var(--theme)");let A=C;function U(B,G){B==="loaded"&&(0,n.setStyle)(E,"width",100*G+"%"),B==="played"&&((0,n.setStyle)(D,"width",100*G+"%"),(0,n.setStyle)(I,"left",`calc(${100*G}% - ${A/2}px)`))}u.indicator?(A=b,(0,n.append)(I,u.indicator)):(0,n.setStyles)(I,{backgroundColor:"var(--theme)"}),n.isMobile&&(A=S,u.indicator&&(A=L)),(0,n.setStyles)(I,{left:`-${A/2}px`,width:`${A}px`,height:`${A}px`}),c.on("video:loadedmetadata",()=>{for(let B=0;B<h.highlight.length;B++){const G=h.highlight[B],Q=(0,n.clamp)(G.time,0,c.duration)/c.duration*100;(0,n.append)(O,`<span data-text="${G.text}" data-time="${G.time}" style="left: ${Q}%"></span>`)}}),U("loaded",c.loaded),c.on("setBar",(B,G)=>{U(B,G)}),c.on("video:progress",()=>{U("loaded",c.loaded)}),c.on("video:timeupdate",()=>{U("played",c.played)}),c.on("video:ended",()=>{U("played",1)}),n.isMobile||(f(m,"click",B=>{B.target!==I&&l(c,B)}),f(m,"mousemove",B=>{(0,n.setStyle)(x,"display","block"),(0,n.includeFromEvent)(B,O)?function(G){const{width:Q}=a(c,G),{text:nt}=G.target.dataset;x.innerHTML=nt;const ot=x.clientWidth;Q<=ot/2?(0,n.setStyle)(x,"left",0):Q>m.clientWidth-ot/2?(0,n.setStyle)(x,"left",m.clientWidth-ot+"px"):(0,n.setStyle)(x,"left",Q-ot/2+"px")}(B):function(G){const{width:Q,time:nt}=a(c,G);x.innerHTML=nt;const ot=x.clientWidth;Q<=ot/2?(0,n.setStyle)(x,"left",0):Q>m.clientWidth-ot/2?(0,n.setStyle)(x,"left",m.clientWidth-ot+"px"):(0,n.setStyle)(x,"left",Q-ot/2+"px")}(B)}),f(m,"mouseleave",()=>{(0,n.setStyle)(x,"display","none")}),f(m,"mousedown",()=>{_=!0}),f(document,"mousemove",B=>{if(_){const{second:G,percentage:Q}=a(c,B);U("played",Q),c.seek=G}}),f(document,"mouseup",()=>{_&&(_=!1)}))}})}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ikc2j:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Wt(Gt({},n),{style:{cursor:"auto",marginLeft:"10px"},mounted:l=>{function o(){const u=`${(0,r.secondToTime)(a.currentTime)} / ${(0,r.secondToTime)(a.duration)}`;u!==l.innerText&&(l.innerText=u)}o();const c=["video:loadedmetadata","video:timeupdate","video:progress"];for(let u=0;u<c.length;u++)a.on(c[u],o)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],b8NFx:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Wt(Gt({},n),{mounted:l=>{const{proxy:o,icons:c,i18n:u}=a;let h=!1;const f=a.constructor.VOLUME_PANEL_WIDTH,m=a.constructor.VOLUME_HANDLE_WIDTH,_=(0,r.append)(l,c.volume),E=(0,r.append)(l,c.volumeClose),D=(0,r.append)(l,'<div class="art-volume-panel"></div>'),O=(0,r.append)(D,'<div class="art-volume-slider-handle"></div>');function I(P){const{left:C}=D.getBoundingClientRect();return(0,r.clamp)(P.pageX-C-m/2,0,f-m/2)/(f-m)}function x(P=.7){if(a.muted||P===0)(0,r.setStyle)(_,"display","none"),(0,r.setStyle)(E,"display","flex"),(0,r.setStyle)(O,"left","0");else{const C=(f-m)*P;(0,r.setStyle)(_,"display","flex"),(0,r.setStyle)(E,"display","none"),(0,r.setStyle)(O,"left",`${C}px`)}}(0,r.tooltip)(_,u.get("Mute")),(0,r.setStyle)(E,"display","none"),r.isMobile&&(0,r.setStyle)(D,"display","none"),x(a.volume),a.on("video:volumechange",()=>{x(a.volume)}),o(_,"click",()=>{a.muted=!0}),o(E,"click",()=>{a.muted=!1}),o(D,"click",P=>{a.muted=!1,a.volume=I(P)}),o(O,"mousedown",()=>{h=!0}),o(l,"mousemove",P=>{h&&(a.muted=!1,a.volume=I(P))}),o(document,"mouseup",()=>{h&&(h=!1)})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03o9l":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Wt(Gt({},n),{tooltip:a.i18n.get("Show Setting"),mounted:l=>{const{proxy:o,icons:c,i18n:u}=a;(0,r.append)(l,c.setting),o(l,"click",()=>{a.setting.toggle=!0,a.setting.updateStyle()}),a.on("setting",h=>{(0,r.tooltip)(l,u.get(h?"Hide Setting":"Show Setting"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eCVx2:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils"),n=e("./progress");s.default=function(a){return l=>Wt(Gt({},a),{mounted:o=>{const{option:c,template:{$progress:u,$video:h},events:{proxy:f,loadImg:m}}=l;let _=null,E=!1,D=!1;f(u,"mousemove",O=>ne(this,null,function*(){E||(E=!0,_=yield m(c.thumbnails.url),D=!0),D&&((0,r.setStyle)(o,"display","block"),function(I){const{width:x}=(0,n.getPosFromEvent)(l,I),{url:P,number:C,column:b,width:S,height:L}=c.thumbnails,A=S||_.naturalWidth/b,U=L||A/(h.videoWidth/h.videoHeight),B=u.clientWidth/C,G=Math.floor(x/B),Q=Math.ceil(G/b)-1,nt=G%b||b-1;(0,r.setStyle)(o,"backgroundImage",`url(${P})`),(0,r.setStyle)(o,"height",`${U}px`),(0,r.setStyle)(o,"width",`${A}px`),(0,r.setStyle)(o,"backgroundPosition",`-${nt*A}px -${Q*U}px`),x<=A/2?(0,r.setStyle)(o,"left",0):x>u.clientWidth-A/2?(0,r.setStyle)(o,"left",u.clientWidth-A+"px"):(0,r.setStyle)(o,"left",x-A/2+"px")}(O))})),f(u,"mouseleave",()=>{(0,r.setStyle)(o,"display","none")}),l.on("hover",O=>{O||(0,r.setStyle)(o,"display","none")})}})}},{"../utils":"71aH7","./progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4KCF5":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Wt(Gt({},n),{tooltip:a.i18n.get("Screenshot"),mounted:l=>{const{proxy:o,icons:c}=a;(0,r.append)(l,c.screenshot),o(l,"click",()=>{a.screenshot()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],efgTY:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r){return n=>{const a=n.option.quality,l=a.find(o=>o.default)||a[0];return Wt(Gt({},r),{style:{marginRight:"10px"},html:l?l.html:"",selector:a,onSelect(o){n.switchQuality(o.url,o.html)}})}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2hIff":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Wt(Gt({},n),{mounted:l=>{const o=(0,r.append)(l,'<span class="art-loop-point"></span>'),c=(0,r.append)(l,'<span class="art-loop-point"></span>');a.on("loop",u=>{u&&u.length?((0,r.setStyle)(l,"display","block"),(0,r.setStyle)(o,"left",`calc(${u[0]/a.duration*100}% - ${o.clientWidth}px)`),(0,r.setStyle)(c,"left",u[1]/a.duration*100+"%")):(0,r.setStyle)(l,"display","none")})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4IS2d":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Wt(Gt({},n),{tooltip:a.i18n.get("AirPlay"),mounted:l=>{const{proxy:o,icons:c}=a;(0,r.append)(l,c.airplay),o(l,"click",()=>a.airplay())}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2KYsr":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../utils"),a=e("../utils/component"),l=r.interopDefault(a),o=e("./playbackRate"),c=r.interopDefault(o),u=e("./aspectRatio"),h=r.interopDefault(u),f=e("./flip"),m=r.interopDefault(f),_=e("./info"),E=r.interopDefault(_),D=e("./version"),O=r.interopDefault(D),I=e("./close"),x=r.interopDefault(I);class P extends l.default{constructor(b){super(b),this.name="contextmenu",this.$parent=b.template.$contextmenu,n.isMobile||this.init()}init(){const{option:b,proxy:S,template:{$player:L,$contextmenu:A}}=this.art;b.playbackRate&&this.add((0,c.default)({name:"playbackRate",index:10})),b.aspectRatio&&this.add((0,h.default)({name:"aspectRatio",index:20})),b.flip&&this.add((0,m.default)({name:"flip",index:30})),this.add((0,E.default)({name:"info",index:40})),this.add((0,O.default)({name:"version",index:50})),this.add((0,x.default)({name:"close",index:60}));for(let U=0;U<b.contextmenu.length;U++)this.add(b.contextmenu[U]);S(L,"contextmenu",U=>{if(U.preventDefault(),!this.art.constructor.CONTEXTMENU)return;this.show=!0;const B=U.clientX,G=U.clientY,{height:Q,width:nt,left:ot,top:V}=L.getBoundingClientRect(),{height:R,width:N}=A.getBoundingClientRect();let j=B-ot,X=G-V;B+N>ot+nt&&(j=nt-N),G+R>V+Q&&(X=Q-R),(0,n.setStyles)(A,{top:`${X}px`,left:`${j}px`})}),S(L,"click",U=>{(0,n.includeFromEvent)(U,A)||(this.show=!1)}),this.art.on("blur",()=>{this.show=!1})}}s.default=P},{"../utils":"71aH7","../utils/component":"18nVI","./playbackRate":"69eLi","./aspectRatio":"lUefg","./flip":"kysiM","./info":"gqIgJ","./version":"kRU7C","./close":"jQ8Pm","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"69eLi":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>{const{i18n:l,constructor:{PLAYBACK_RATE:o}}=a;return Wt(Gt({},n),{html:`${l.get("Play Speed")}:
                ${o.map(c=>`<span data-value="${c}">${c===1?l.get("Normal"):c}</span>`).join("")}
            `,click:(c,u)=>{const{value:h}=u.target.dataset;h&&(a.playbackRate=Number(h),c.show=!1)},mounted:c=>{const u=(0,r.query)('[data-value="1"]',c);u&&(0,r.inverseClass)(u,"art-current"),a.on("video:ratechange",()=>{const h=(0,r.queryAll)("span",c).find(f=>Number(f.dataset.value)===a.playbackRate);h&&(0,r.inverseClass)(h,"art-current")})}})}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lUefg:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>{const{i18n:l,constructor:{ASPECT_RATIO:o}}=a;return Wt(Gt({},n),{html:`${l.get("Aspect Ratio")}:
                ${o.map(c=>`<span data-value="${c}">${c==="default"?l.get("Default"):c}</span>`).join("")}
            `,click:(c,u)=>{const{value:h}=u.target.dataset;h&&(a.aspectRatio=h,c.show=!1)},mounted:c=>{const u=(0,r.query)('[data-value="default"]',c);u&&(0,r.inverseClass)(u,"art-current"),a.on("aspectRatio",h=>{const f=(0,r.queryAll)("span",c).find(m=>m.dataset.value===h);f&&(0,r.inverseClass)(f,"art-current")})}})}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kysiM:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>{const{i18n:l,constructor:{FLIP:o}}=a;return Wt(Gt({},n),{html:`${l.get("Video Flip")}:
                ${o.map(c=>`<span data-value="${c}">${l.get((0,r.capitalize)(c))}</span>`).join("")}
            `,click:(c,u)=>{const{value:h}=u.target.dataset;h&&(a.flip=h.toLowerCase(),c.show=!1)},mounted:c=>{const u=(0,r.query)('[data-value="normal"]',c);u&&(0,r.inverseClass)(u,"art-current"),a.on("flip",h=>{const f=(0,r.queryAll)("span",c).find(m=>m.dataset.value===h);f&&(0,r.inverseClass)(f,"art-current")})}})}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gqIgJ:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r){return n=>Wt(Gt({},r),{html:n.i18n.get("Video Info"),click:a=>{n.info.show=!0,a.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kRU7C:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r){return Wt(Gt({},r),{html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 4.6.2</a>'})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jQ8Pm:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r){return n=>Wt(Gt({},r),{html:n.i18n.get("Close"),click:a=>{a.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"02ajl":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./utils"),a=e("./utils/component"),l=r.interopDefault(a);class o extends l.default{constructor(u){super(u),this.name="info",n.isMobile||this.init()}init(){const{proxy:u,constructor:h,template:{$infoPanel:f,$infoClose:m,$video:_}}=this.art;u(m,"click",()=>{this.show=!1});let E=null;const D=(0,n.queryAll)("[data-video]",f)||[];this.art.on("destroy",()=>{clearTimeout(E)}),function O(){for(let I=0;I<D.length;I++){const x=D[I],P=_[x.dataset.video],C=typeof P=="number"?P.toFixed(2):P;x.innerText!==C&&(x.innerText=C)}E=setTimeout(O,h.INFO_LOOP_TIME)}()}}s.default=o},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eSWto:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./utils"),a=e("./utils/component"),l=r.interopDefault(a),o=e("option-validator"),c=r.interopDefault(o),u=e("./scheme"),h=r.interopDefault(u);class f extends l.default{constructor(_){super(_),this.name="subtitle",this.eventDestroy=()=>null,this.init(_.option.subtitle);let E=!1;_.on("video:timeupdate",()=>{if(!this.url)return;const D=this.art.template.$video.webkitDisplayingFullscreen;typeof D=="boolean"&&D!==E&&(E=D,this.createTrack(D?"subtitles":"metadata",this.url))})}get url(){return this.art.template.$track.src}set url(_){this.switch(_)}get textTrack(){return this.art.template.$video.textTracks[0]}get activeCue(){return this.textTrack.activeCues[0]}style(_,E){const{$subtitle:D}=this.art.template;return typeof _=="object"?(0,n.setStyles)(D,_):(0,n.setStyle)(D,_,E)}update(){const{$subtitle:_}=this.art.template;_.innerHTML="",this.activeCue&&(this.art.option.subtitle.escape?_.innerHTML=this.activeCue.text.split(/\r?\n/).map(E=>`<p>${(0,n.escape)(E)}</p>`).join(""):_.innerHTML=this.activeCue.text,this.art.emit("subtitleUpdate",this.activeCue.text))}switch(D){return ne(this,arguments,function*(_,E={}){const{i18n:O,notice:I,option:x}=this.art,P=Wt(Gt(Gt({},x.subtitle),E),{url:_}),C=yield this.init(P);return E.name&&(I.show=`${O.get("Switch Subtitle")}: ${E.name}`),C})}createTrack(_,E){const{template:D,proxy:O}=this.art,{$video:I,$track:x}=D,P=(0,n.createElement)("track");P.default=!0,P.kind=_,P.src=E,P.track.mode="hidden",this.eventDestroy(),(0,n.remove)(x),(0,n.append)(I,P),D.$track=P,this.eventDestroy=O(this.textTrack,"cuechange",()=>this.update())}init(_){return ne(this,null,function*(){const{notice:E,template:{$subtitle:D}}=this.art;if((0,c.default)(_,h.default.subtitle),_.url)return this.style(_.style),fetch(_.url).then(O=>O.arrayBuffer()).then(O=>{const I=new TextDecoder(_.encoding).decode(O);switch(this.art.emit("subtitleLoad",_.url),_.type||(0,n.getExt)(_.url)){case"srt":return(0,n.vttToBlob)((0,n.srtToVtt)(I));case"ass":return(0,n.vttToBlob)((0,n.assToVtt)(I));case"vtt":return(0,n.vttToBlob)(I);default:return _.url}}).then(O=>(D.innerHTML="",this.url===O||(URL.revokeObjectURL(this.url),this.createTrack("metadata",O),this.art.emit("subtitleSwitch",O)),O)).catch(O=>{throw E.show=O,O})})}}s.default=f},{"./utils":"71aH7","./utils/component":"18nVI","option-validator":"bAWi2","./scheme":"AKEiO","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jo4S1:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../utils/error"),a=e("./clickInit"),l=r.interopDefault(a),o=e("./hoverInit"),c=r.interopDefault(o),u=e("./mousemoveInit"),h=r.interopDefault(u),f=e("./resizeInit"),m=r.interopDefault(f),_=e("./gestureInit"),E=r.interopDefault(_),D=e("./viewInit"),O=r.interopDefault(D);s.default=class{constructor(I){this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),I.whitelist.state&&((0,l.default)(I,this),(0,c.default)(I,this),(0,h.default)(I,this),(0,m.default)(I,this),(0,E.default)(I,this),(0,O.default)(I,this))}proxy(I,x,P,C={}){if(Array.isArray(x))return x.map(S=>this.proxy(I,S,P,C));I.addEventListener(x,P,C);const b=()=>I.removeEventListener(x,P,C);return this.destroyEvents.push(b),b}hover(I,x,P){x&&this.proxy(I,"mouseenter",x),P&&this.proxy(I,"mouseleave",P)}loadImg(I){return new Promise((x,P)=>{let C;if(I instanceof HTMLImageElement)C=I;else{if(typeof I!="string")return P(new n.ArtPlayerError("Unable to get Image"));C=new Image,C.src=I}if(C.complete)return x(C);this.proxy(C,"load",()=>x(C)),this.proxy(C,"error",()=>P(new n.ArtPlayerError(`Failed to load Image: ${C.src}`)))})}destroy(){for(let I=0;I<this.destroyEvents.length;I++)this.destroyEvents[I]()}}},{"../utils/error":"hwmZz","./clickInit":"6UrCm","./hoverInit":"4jWHi","./mousemoveInit":"bMF9b","./resizeInit":"eDXPO","./gestureInit":"95GtS","./viewInit":"InUBx","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6UrCm":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n,a){const{constructor:l,template:{$player:o,$video:c}}=n;a.proxy(document,["click","contextmenu"],h=>{(0,r.includeFromEvent)(h,o)?(n.isInput=h.target.tagName==="INPUT",n.isFocus=!0,n.emit("focus")):(n.isInput=!1,n.isFocus=!1,n.emit("blur"))});let u=0;a.proxy(c,"click",()=>{const h=Date.now();h-u<=l.DB_CLICE_TIME?(n.emit("dblclick"),r.isMobile?n.isLock||n.toggle():n.fullscreen=!n.fullscreen):(n.emit("click"),r.isMobile||n.toggle()),u=h})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4jWHi":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n,a){const{$player:l}=n.template;a.hover(l,o=>{(0,r.addClass)(l,"art-hover"),n.emit("hover",!0,o)},o=>{(0,r.removeClass)(l,"art-hover"),n.emit("hover",!1,o)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bMF9b:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r,n){const{$player:a}=r.template;n.proxy(a,"mousemove",l=>{r.emit("mousemove",l)})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eDXPO:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n,a){const{option:l}=n,o=(0,r.throttle)(()=>{n.normalSize&&(n.autoSize=l.autoSize),n.aspectRatioReset=!0,n.notice.show="",n.emit("resize")},n.constructor.RESIZE_TIME);a.proxy(window,["orientationchange","resize"],()=>{o()}),screen&&screen.orientation&&screen.orientation.onchange&&a.proxy(screen.orientation,"change",()=>{o()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"95GtS":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils"),n=e("../control/progress");s.default=function(a,l){if(r.isMobile&&!a.option.isLive){const{$video:o,$progress:c}=a.template;let u=null,h=!1,f=0,m=0,_=0;const E=I=>{if(I.touches.length===1&&!a.isLock){u===c&&(0,n.setCurrentTime)(a,I),h=!0;const{clientX:x,clientY:P}=I.touches[0];f=x,m=P,_=a.currentTime}},D=I=>{if(I.touches.length===1&&h&&a.duration){const{clientX:x,clientY:P}=I.touches[0],C=(0,r.clamp)((x-f)/a.width,-1,1),b=(0,r.clamp)((P-m)/a.height,-1,1),S=a.isRotate?b:C,L=u===o?a.constructor.TOUCH_MOVE_RATIO:1,A=(0,r.clamp)(_+a.duration*S*L,0,a.duration);a.seek=A,a.emit("setBar","played",(0,r.clamp)(A/a.duration,0,1)),a.notice.show=`${(0,r.secondToTime)(A)} / ${(0,r.secondToTime)(a.duration)}`}},O=()=>{h&&(f=0,m=0,_=0,h=!1,u=null)};l.proxy(c,"touchstart",I=>{u=c,E(I)}),l.proxy(o,"touchstart",I=>{u=o,E(I)}),l.proxy(o,"touchmove",D),l.proxy(c,"touchmove",D),l.proxy(document,"touchend",O)}}},{"../utils":"71aH7","../control/progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],InUBx:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n,a){const{option:l,constructor:o,template:{$container:c}}=n,u=(0,r.throttle)(()=>{n.emit("view",(0,r.isInViewport)(c,o.SCROLL_GAP))},o.SCROLL_TIME);a.proxy(window,"scroll",()=>{u()}),n.on("view",h=>{l.autoMini&&(n.mini=!h)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6NoFy":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("./utils");s.default=class{constructor(n){this.art=n,this.keys={},n.option.hotkey&&!r.isMobile&&this.init()}init(){const{proxy:n,constructor:a}=this.art;this.add(27,()=>{this.art.fullscreenWeb&&(this.art.fullscreenWeb=!1)}),this.add(32,()=>{this.art.toggle()}),this.add(37,()=>{this.art.backward=a.SEEK_STEP}),this.add(38,()=>{this.art.volume+=a.VOLUME_STEP}),this.add(39,()=>{this.art.forward=a.SEEK_STEP}),this.add(40,()=>{this.art.volume-=a.VOLUME_STEP}),n(window,"keydown",l=>{if(this.art.isFocus){const o=document.activeElement.tagName.toUpperCase(),c=document.activeElement.getAttribute("contenteditable");if(o!=="INPUT"&&o!=="TEXTAREA"&&c!==""&&c!=="true"){const u=this.keys[l.keyCode];if(u){l.preventDefault();for(let h=0;h<u.length;h++)u[h].call(this.art,l);this.art.emit("hotkey",l)}}}})}add(n,a){return this.keys[n]?this.keys[n].push(a):this.keys[n]=[a],this}remove(n,a){if(this.keys[n]){const l=this.keys[n].indexOf(a);l!==-1&&this.keys[n].splice(l,1)}return this}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6G6hZ":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./utils/component"),a=r.interopDefault(n);class l extends a.default{constructor(c){super(c);const{option:u,template:{$layer:h}}=c;this.name="layer",this.$parent=h;for(let f=0;f<u.layers.length;f++)this.add(u.layers[f])}}s.default=l},{"./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3dsEe":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./utils"),a=e("./utils/component"),l=r.interopDefault(a);class o extends l.default{constructor(u){super(u),this.name="loading",(0,n.append)(u.template.$loading,u.icons.loading)}}s.default=o},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],dWGTw:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("./utils");s.default=class{constructor(n){this.art=n,this.timer=null}set show(n){const{constructor:a,template:{$player:l,$noticeInner:o}}=this.art;n?(o.innerText=n instanceof Error?n.message.trim():n,(0,r.addClass)(l,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(()=>{o.innerText="",(0,r.removeClass)(l,"art-notice-show")},a.NOTICE_TIME)):(0,r.removeClass)(l,"art-notice-show")}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5POkG":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./utils"),a=e("./utils/component"),l=r.interopDefault(a);class o extends l.default{constructor(u){super(u),this.name="mask";const{template:h,icons:f,events:m}=u,_=(0,n.append)(h.$state,f.state),E=(0,n.append)(h.$state,f.error);(0,n.setStyle)(E,"display","none"),u.on("destroy",()=>{(0,n.setStyle)(_,"display","none"),(0,n.setStyle)(E,"display",null)}),m.proxy(h.$state,"click",()=>u.play())}}s.default=o},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6OeNg":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../utils"),a=e("bundle-text:./loading.svg"),l=r.interopDefault(a),o=e("bundle-text:./state.svg"),c=r.interopDefault(o),u=e("bundle-text:./check.svg"),h=r.interopDefault(u),f=e("bundle-text:./play.svg"),m=r.interopDefault(f),_=e("bundle-text:./pause.svg"),E=r.interopDefault(_),D=e("bundle-text:./volume.svg"),O=r.interopDefault(D),I=e("bundle-text:./volume-close.svg"),x=r.interopDefault(I),P=e("bundle-text:./screenshot.svg"),C=r.interopDefault(P),b=e("bundle-text:./setting.svg"),S=r.interopDefault(b),L=e("bundle-text:./arrow-left.svg"),A=r.interopDefault(L),U=e("bundle-text:./arrow-right.svg"),B=r.interopDefault(U),G=e("bundle-text:./playback-rate.svg"),Q=r.interopDefault(G),nt=e("bundle-text:./aspect-ratio.svg"),ot=r.interopDefault(nt),V=e("bundle-text:./config.svg"),R=r.interopDefault(V),N=e("bundle-text:./pip.svg"),j=r.interopDefault(N),X=e("bundle-text:./lock.svg"),rt=r.interopDefault(X),lt=e("bundle-text:./unlock.svg"),Tt=r.interopDefault(lt),wt=e("bundle-text:./fullscreen-off.svg"),Rt=r.interopDefault(wt),tt=e("bundle-text:./fullscreen-on.svg"),at=r.interopDefault(tt),ft=e("bundle-text:./fullscreen-web-off.svg"),ut=r.interopDefault(ft),yt=e("bundle-text:./fullscreen-web-on.svg"),At=r.interopDefault(yt),jt=e("bundle-text:./switch-on.svg"),qt=r.interopDefault(jt),re=e("bundle-text:./switch-off.svg"),Xt=r.interopDefault(re),ke=e("bundle-text:./flip.svg"),Me=r.interopDefault(ke),Pe=e("bundle-text:./error.svg"),pe=r.interopDefault(Pe),vt=e("bundle-text:./close.svg"),Oe=r.interopDefault(vt),Ne=e("bundle-text:./airplay.svg"),Le=r.interopDefault(Ne);s.default=class{constructor(Xe){const ye=Gt({loading:l.default,state:c.default,play:m.default,pause:E.default,check:h.default,volume:O.default,volumeClose:x.default,screenshot:C.default,setting:S.default,pip:j.default,arrowLeft:A.default,arrowRight:B.default,playbackRate:Q.default,aspectRatio:ot.default,config:R.default,lock:rt.default,flip:Me.default,unlock:Tt.default,fullscreenOff:Rt.default,fullscreenOn:at.default,fullscreenWebOff:ut.default,fullscreenWebOn:At.default,switchOn:qt.default,switchOff:Xt.default,error:pe.default,close:Oe.default,airplay:Le.default},Xe.option.icons);Object.keys(ye).forEach(fe=>{(0,n.def)(this,fe,{get:()=>{const Ie=(0,n.createElement)("i");return(0,n.addClass)(Ie,"art-icon"),(0,n.addClass)(Ie,`art-icon-${fe}`),(0,n.append)(Ie,ye[fe]),Ie}})})}}},{"../utils":"71aH7","bundle-text:./loading.svg":"7tDub","bundle-text:./state.svg":"1ElZc","bundle-text:./check.svg":"lmgoP","bundle-text:./play.svg":"lVWoQ","bundle-text:./pause.svg":"5Mnax","bundle-text:./volume.svg":"w3eIa","bundle-text:./volume-close.svg":"rHjo1","bundle-text:./screenshot.svg":"2KcqM","bundle-text:./setting.svg":"8rQMV","bundle-text:./arrow-left.svg":"kqGBE","bundle-text:./arrow-right.svg":"aFjpC","bundle-text:./playback-rate.svg":"lx7ZM","bundle-text:./aspect-ratio.svg":"2sEjf","bundle-text:./config.svg":"fQTgE","bundle-text:./pip.svg":"2CaxO","bundle-text:./lock.svg":"aCGnW","bundle-text:./unlock.svg":"bTrAV","bundle-text:./fullscreen-off.svg":"bA3p0","bundle-text:./fullscreen-on.svg":"fTuY8","bundle-text:./fullscreen-web-off.svg":"tvKf4","bundle-text:./fullscreen-web-on.svg":"1F1oB","bundle-text:./switch-on.svg":"7qNHs","bundle-text:./switch-off.svg":"28aV8","bundle-text:./flip.svg":"1uXI6","bundle-text:./error.svg":"9f4dh","bundle-text:./close.svg":"4nTtS","bundle-text:./airplay.svg":"cDPXC","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7tDub":[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><path fill="none" class="bk" d="M0 0h100v100H0z"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(30 105.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(60 75.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(90 65 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(120 58.66 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(150 54.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(180 50 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-150 45.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-120 41.34 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-90 35 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-60 24.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-30 -5.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>'},{}],"1ElZc":[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="60" width="60" style="filter:drop-shadow(0 1px 1px #000)" viewBox="0 0 24 24"><path d="M20 2H4C1.8 2 0 3.8 0 6v12c0 2.2 1.8 4 4 4h16c2.2 0 4-1.8 4-4V6c0-2.2-1.8-4-4-4zm-4.4 10.8L10.5 16c-.6.5-1.5 0-1.5-.8V8.8c0-.8.9-1.3 1.5-.8l5.1 3.2c.7.3.7 1.3 0 1.6z"/></svg>'},{}],lmgoP:[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:100%;height:100%"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff"/></svg>'},{}],lVWoQ:[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M17.982 9.275 8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"/></svg>'},{}],"5Mnax":[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zm8 0a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"/></svg>'},{}],w3eIa:[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M10.188 4.65 6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zm4.258-.872a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"/><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"/></svg>'},{}],rHjo1:[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"/><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zm5.195 13.195-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"/></svg>'},{}],"2KcqM":[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50"><path d="M19.402 6a5 5 0 0 0-4.902 4.012L14.098 12H9a5 5 0 0 0-5 5v21a5 5 0 0 0 5 5h32a5 5 0 0 0 5-5V17a5 5 0 0 0-5-5h-5.098l-.402-1.988A5 5 0 0 0 30.598 6ZM25 17c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10Zm0 2c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8Z"/></svg>'},{}],"8rQMV":[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><circle cx="11" cy="11" r="2"/><path d="M19.164 8.861 17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>'},{}],kqGBE:[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m19.41 20.09-4.58-4.59 4.58-4.59L18 9.5l-6 6 6 6z" fill="#fff"/></svg>'},{}],aFjpC:[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m12.59 20.34 4.58-4.59-4.58-4.59L14 9.75l6 6-6 6z" fill="#fff"/></svg>'},{}],lx7ZM:[function(e,i,s){i.exports='<svg height="24" width="24"><path d="M10 8v8l6-4-6-4zM6.3 5l-.6-.8C7.2 3 9 2.2 11 2l.1 1c-1.8.2-3.4.9-4.8 2zM5 6.3l-.8-.6C3 7.2 2.2 9 2 11l1 .1c.2-1.8.9-3.4 2-4.8zm0 11.4c-1.1-1.4-1.8-3.1-2-4.8L2 13c.2 2 1 3.8 2.2 5.4l.8-.7zm6.1 3.3c-1.8-.2-3.4-.9-4.8-2l-.6.8C7.2 21 9 21.8 11 22l.1-1zM22 12c0-5.2-3.9-9.4-9-10l-.1 1c4.6.5 8.1 4.3 8.1 9s-3.5 8.5-8.1 9l.1 1c5.2-.5 9-4.8 9-10z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2sEjf":[function(e,i,s){i.exports=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" style="width:100%;height:100%;transform:translate(0,0)"><defs><clipPath id="__lottie_element_216"><path d="M0 0h88v88H0z"/></clipPath></defs><g style="display:block" clip-path="url('#__lottie_element_216')"><path fill="#FFF" d="m12.438-12.702-2.82 2.82c-.79.79-.79 2.05 0 2.83l7.07 7.07-7.07 7.07c-.79.79-.79 2.05 0 2.83l2.82 2.83c.79.78 2.05.78 2.83 0l11.32-11.31c.78-.78.78-2.05 0-2.83l-11.32-11.31c-.78-.79-2.04-.79-2.83 0zm-24.88 0c-.74-.74-1.92-.78-2.7-.12l-.13.12-11.31 11.31a2 2 0 0 0-.12 2.7l.12.13 11.31 11.31a2 2 0 0 0 2.7.12l.13-.12 2.83-2.83c.74-.74.78-1.91.11-2.7l-.11-.13-7.07-7.07 7.07-7.07c.74-.74.78-1.91.11-2.7l-.11-.13-2.83-2.82zM28-28c4.42 0 8 3.58 8 8v40c0 4.42-3.58 8-8 8h-56c-4.42 0-8-3.58-8-8v-40c0-4.42 3.58-8 8-8h56z" style="--darkreader-inline-fill:#a8a6a4" transform="translate(44 44)"/></g></svg>`},{}],fQTgE:[function(e,i,s){i.exports='<svg height="24" width="24"><path d="M15 17h6v1h-6v-1zm-4 0H3v1h8v2h1v-5h-1v2zm3-9h1V3h-1v2H3v1h11v2zm4-3v1h3V5h-3zM6 14h1V9H6v2H3v1h3v2zm4-2h11v-1H10v1z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2CaxO":[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25 17h-8v6h8v-6Zm4 8V10.98C29 9.88 28.1 9 27 9H9c-1.1 0-2 .88-2 1.98V25c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2Zm-2 .02H9V10.97h18v14.05Z"/></svg>'},{}],aCGnW:[function(e,i,s){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M298.667 426.667v-85.334a213.333 213.333 0 1 1 426.666 0v85.334H768A85.333 85.333 0 0 1 853.333 512v256A85.333 85.333 0 0 1 768 853.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667zM512 213.333a128 128 0 0 0-128 128v85.334h256v-85.334a128 128 0 0 0-128-128z" fill="#fff"/></svg>'},{}],bTrAV:[function(e,i,s){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="m666.752 194.517-49.365 74.112A128 128 0 0 0 384 341.333l.043 85.334h384A85.333 85.333 0 0 1 853.376 512v256a85.333 85.333 0 0 1-85.333 85.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667v-85.334a213.333 213.333 0 0 1 368.085-146.816z" fill="#fff"/></svg>'},{}],bA3p0:[function(e,i,s){i.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M768 298.667h170.667V384h-256V128H768v170.667zM341.333 384h-256v-85.333H256V128h85.333v256zM768 725.333V896h-85.333V640h256v85.333H768zM341.333 640v256H256V725.333H85.333V640h256z"/></svg>'},{}],fTuY8:[function(e,i,s){i.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M625.778 256H768v142.222h113.778v-256h-256V256zM256 398.222V256h142.222V142.222h-256v256H256zm512 227.556V768H625.778v113.778h256v-256H768zM398.222 768H256V625.778H142.222v256h256V768z"/></svg>'},{}],tvKf4:[function(e,i,s){i.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zM896 512a64 64 0 0 1 7.488 127.552L896 640H768v128a64 64 0 0 1-56.512 63.552L704 832a64 64 0 0 1-63.552-56.512L640 768V582.592c0-34.496 25.024-66.112 61.632-70.208l8-.384H896zm-640 0a64 64 0 0 1-7.488-127.552L256 384h128V256a64 64 0 0 1 56.512-63.552L448 192a64 64 0 0 1 63.552 56.512L512 256v185.408c0 34.432-25.024 66.112-61.632 70.144l-8 .448H256z"/></svg>'},{}],"1F1oB":[function(e,i,s){i.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zm-576 64a64 64 0 0 1 7.488 127.552L448 320H320v128a64 64 0 0 1-56.512 63.552L256 512a64 64 0 0 1-63.552-56.512L192 448V262.592c0-34.432 25.024-66.112 61.632-70.144l8-.448H448zm256 640a64 64 0 0 1-7.488-127.552L704 704h128V576a64 64 0 0 1 56.512-63.552L896 512a64 64 0 0 1 63.552 56.512L960 576v185.408c0 34.496-25.024 66.112-61.632 70.208l-8 .384H704z"/></svg>'},{}],"7qNHs":[function(e,i,s){i.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1664 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#648FFC" d="M1152 0H512a512 512 0 0 0 0 1024h640a512 512 0 0 0 0-1024zm0 960a448 448 0 1 1 448-448 448 448 0 0 1-448 448z"/></svg>'},{}],"28aV8":[function(e,i,s){i.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M511.898 1024h670.515c282.419-.41 511.18-229.478 511.18-511.898 0-282.419-228.761-511.488-511.18-511.897H511.898C229.478.615.717 229.683.717 512.102c0 282.42 228.761 511.488 511.18 511.898zm-.564-975.36A464.589 464.589 0 1 1 48.026 513.024 463.872 463.872 0 0 1 511.334 48.435v.205z"/></svg>'},{}],"1uXI6":[function(e,i,s){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M554.667 810.667V896h-85.334v-85.333h85.334zm-384-632.662a42.667 42.667 0 0 1 34.986 18.219l203.904 291.328a42.667 42.667 0 0 1 0 48.896L205.611 827.776A42.667 42.667 0 0 1 128 803.328V220.672a42.667 42.667 0 0 1 42.667-42.667zm682.666 0a42.667 42.667 0 0 1 42.368 37.718l.299 4.949v582.656a42.667 42.667 0 0 1-74.24 28.63l-3.413-4.182-203.904-291.328a42.667 42.667 0 0 1-3.03-43.861l3.03-5.035 203.946-291.328a42.667 42.667 0 0 1 34.944-18.219zM554.667 640v85.333h-85.334V640h85.334zm-358.4-320.896V716.8L335.957 512 196.31 319.104zm358.4 150.23v85.333h-85.334v-85.334h85.334zm0-170.667V384h-85.334v-85.333h85.334zm0-170.667v85.333h-85.334V128h85.334z" fill="#fff"/></svg>'},{}],"9f4dh":[function(e,i,s){i.exports='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="50" height="50"><path d="M593.818 168.55 949.82 763.76c26.153 43.746 10.732 99.738-34.447 125.052-14.397 8.069-30.72 12.308-47.37 12.308H155.976c-52.224 0-94.536-40.96-94.536-91.505 0-16.097 4.383-31.928 12.718-45.875l356.004-595.19c26.173-43.724 84.009-58.654 129.208-33.341a93.082 93.082 0 0 1 34.448 33.341zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88zm0-512a72.315 72.315 0 0 0-71.762 81.306l25.723 205.721a46.408 46.408 0 0 0 92.078 0l25.723-205.742A72.315 72.315 0 0 0 512 307.2z"/></svg>'},{}],"4nTtS":[function(e,i,s){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="m571.733 512 268.8-268.8c17.067-17.067 17.067-42.667 0-59.733-17.066-17.067-42.666-17.067-59.733 0L512 452.267l-268.8-268.8c-17.067-17.067-42.667-17.067-59.733 0-17.067 17.066-17.067 42.666 0 59.733l268.8 268.8-268.8 268.8c-17.067 17.067-17.067 42.667 0 59.733 8.533 8.534 19.2 12.8 29.866 12.8s21.334-4.266 29.867-12.8l268.8-268.8 268.8 268.8c8.533 8.534 19.2 12.8 29.867 12.8s21.333-4.266 29.866-12.8c17.067-17.066 17.067-42.666 0-59.733L571.733 512z"/></svg>'},{}],cDPXC:[function(e,i,s){i.exports='<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z"/><path d="M4 17h10l-5-6z"/></g></svg>'},{}],"3eYNH":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./flip"),a=r.interopDefault(n),l=e("./aspectRatio"),o=r.interopDefault(l),c=e("./playbackRate"),u=r.interopDefault(c),h=e("./subtitleOffset"),f=r.interopDefault(h),m=e("../utils/component"),_=r.interopDefault(m),E=e("../utils");class D extends _.default{constructor(I){super(I);const{option:x,proxy:P,template:{$setting:C,$player:b}}=I;if(this.name="setting",this.$parent=C,this.option=[],this.events=[],this.cache=new Map,x.setting){x.playbackRate&&this.option.push((0,u.default)(I)),x.aspectRatio&&this.option.push((0,o.default)(I)),x.flip&&this.option.push((0,a.default)(I)),x.subtitleOffset&&this.option.push((0,f.default)(I));for(let S=0;S<x.settings.length;S++)this.option.push(x.settings[S]);this.update(),I.on("blur",()=>{this.show&&(this.show=!1,this.init(this.option))}),P(b,"click",S=>{!this.show||(0,E.includeFromEvent)(S,I.controls.setting)||(0,E.includeFromEvent)(S,this.$parent)||(this.show=!1,this.init(this.option))})}}static makeRecursion(I,x,P){for(let C=0;C<I.length;C++){const b=I[C];b.$parentItem=x,b.$parentList=P,b.selector&&D.makeRecursion(b.selector,b,I)}return I}update(){return this.cache=new Map,this.events.forEach(I=>I()),this.events=[],this.$parent.innerHTML="",this.option=D.makeRecursion(this.option),this.init(this.option),this.option}add(I){return this.option.push(I),this.update(),I}creatHeader(I){const{icons:x,proxy:P}=this.art,C=(0,E.createElement)("div");(0,E.addClass)(C,"art-setting-item"),(0,E.addClass)(C,"art-setting-item-back");const b=(0,E.append)(C,'<div class="art-setting-item-left"></div>'),S=(0,E.createElement)("div");(0,E.addClass)(S,"art-setting-item-left-icon"),(0,E.append)(S,x.arrowLeft),(0,E.append)(b,S),(0,E.append)(b,I.$parentItem.html);const L=P(C,"click",()=>this.init(I.$parentList));return this.events.push(L),C}creatItem(I,x){const{icons:P,proxy:C}=this.art,b=(0,E.createElement)("div");(0,E.addClass)(b,"art-setting-item"),(0,E.isStringOrNumber)(x.name)&&(b.dataset.name=x.name),(0,E.isStringOrNumber)(x.value)&&(b.dataset.value=x.value);const S=(0,E.append)(b,'<div class="art-setting-item-left"></div>'),L=(0,E.append)(b,'<div class="art-setting-item-right"></div>'),A=(0,E.createElement)("div");switch((0,E.addClass)(A,"art-setting-item-left-icon"),I){case"switch":case"range":(0,E.append)(A,(0,E.isStringOrNumber)(x.icon)||x.icon instanceof Element?x.icon:P.config);break;case"selector":x.selector&&x.selector.length?(0,E.append)(A,(0,E.isStringOrNumber)(x.icon)||x.icon instanceof Element?x.icon:P.config):(0,E.append)(A,P.check)}(0,E.append)(S,A),x.$icon=A,(0,E.def)(x,"icon",{configurable:!0,get:()=>A.innerHTML,set(G){(0,E.isStringOrNumber)(G)&&(A.innerHTML=G)}});const U=(0,E.createElement)("div");(0,E.addClass)(U,"art-setting-item-left-text"),(0,E.append)(U,x.html||""),(0,E.append)(S,U),x.$html=U,(0,E.def)(x,"html",{configurable:!0,get:()=>U.innerHTML,set(G){(0,E.isStringOrNumber)(G)&&(U.innerHTML=G)}});const B=(0,E.createElement)("div");switch((0,E.addClass)(B,"art-setting-item-right-tooltip"),(0,E.append)(B,x.tooltip||""),(0,E.append)(L,B),x.$tooltip=B,(0,E.def)(x,"tooltip",{configurable:!0,get:()=>B.innerHTML,set(G){(0,E.isStringOrNumber)(G)&&(B.innerHTML=G)}}),I){case"switch":{const G=(0,E.createElement)("div");(0,E.addClass)(G,"art-setting-item-right-icon");const Q=(0,E.append)(G,P.switchOn),nt=(0,E.append)(G,P.switchOff);(0,E.setStyle)(x.switch?nt:Q,"display","none"),(0,E.append)(L,G),x.$switch=x.switch,(0,E.def)(x,"switch",{configurable:!0,get:()=>x.$switch,set(ot){x.$switch=ot,ot?((0,E.setStyle)(nt,"display","none"),(0,E.setStyle)(Q,"display",null)):((0,E.setStyle)(nt,"display",null),(0,E.setStyle)(Q,"display","none"))}});break}case"range":{const G=(0,E.createElement)("div");(0,E.addClass)(G,"art-setting-item-right-icon");const Q=(0,E.append)(G,'<input type="range">');Q.value=x.range[0]||0,Q.min=x.range[1]||0,Q.max=x.range[2]||10,Q.step=x.range[3]||1,(0,E.addClass)(Q,"art-setting-range"),(0,E.append)(L,G),x.$range=Q,(0,E.def)(x,"range",{configurable:!0,get:()=>Q.valueAsNumber,set(nt){Q.value=Number(nt)}})}break;case"selector":if(x.selector&&x.selector.length){const G=(0,E.createElement)("div");(0,E.addClass)(G,"art-setting-item-right-icon"),(0,E.append)(G,P.arrowRight),(0,E.append)(L,G)}}switch(I){case"switch":if(x.onSwitch){const G=C(b,"click",Q=>ne(this,null,function*(){x.switch=yield x.onSwitch.call(this.art,x,b,Q)}));this.events.push(G)}break;case"range":if(x.$range){if(x.onRange){const G=C(x.$range,"change",Q=>ne(this,null,function*(){x.tooltip=yield x.onRange.call(this.art,x,b,Q)}));this.events.push(G)}if(x.onChange){const G=C(x.$range,"input",Q=>ne(this,null,function*(){x.tooltip=yield x.onChange.call(this.art,x,b,Q)}));this.events.push(G)}}break;case"selector":{const G=C(b,"click",Q=>ne(this,null,function*(){if(x.selector&&x.selector.length)this.init(x.selector,x.width);else{(0,E.inverseClass)(b,"art-current");for(let nt=0;nt<x.$parentItem.selector.length;nt++){const ot=x.$parentItem.selector[nt];ot.default=ot===x}if(x.$parentList&&this.init(x.$parentList),x.$parentItem&&x.$parentItem.onSelect){const nt=yield x.$parentItem.onSelect.call(this.art,x,b,Q);x.$parentItem.$tooltip&&(0,E.isStringOrNumber)(nt)&&(x.$parentItem.$tooltip.innerHTML=nt)}}}));this.events.push(G),x.default&&(0,E.addClass)(b,"art-current")}}return b}updateStyle(I){const{controls:x,constructor:P,template:{$player:C,$setting:b}}=this.art;if(x.setting){const S=I||P.SETTING_WIDTH,{left:L,width:A}=x.setting.getBoundingClientRect(),{left:U,width:B}=C.getBoundingClientRect(),G=L-U+A/2-S/2;G+S>B?((0,E.setStyle)(b,"left","auto"),(0,E.setStyle)(b,"right","10px")):((0,E.setStyle)(b,"left",`${G}px`),(0,E.setStyle)(b,"right","auto"))}else(0,E.setStyle)(b,"left","auto"),(0,E.setStyle)(b,"right","10px")}init(I,x){const{constructor:P}=this.art;if(this.cache.has(I)){const C=this.cache.get(I);(0,E.inverseClass)(C,"art-current"),(0,E.setStyle)(this.$parent,"width",`${C.dataset.width}px`),(0,E.setStyle)(this.$parent,"height",`${C.dataset.height}px`),this.updateStyle(Number(C.dataset.width))}else{const C=(0,E.createElement)("div");(0,E.addClass)(C,"art-setting-panel"),C.dataset.width=x||P.SETTING_WIDTH,C.dataset.height=I.length*P.SETTING_ITEM_HEIGHT,I[0]&&I[0].$parentItem&&((0,E.append)(C,this.creatHeader(I[0])),C.dataset.height=Number(C.dataset.height)+P.SETTING_ITEM_HEIGHT);for(let b=0;b<I.length;b++){const S=I[b];(0,E.has)(S,"switch")?(0,E.append)(C,this.creatItem("switch",S)):(0,E.has)(S,"range")?(0,E.append)(C,this.creatItem("range",S)):(0,E.append)(C,this.creatItem("selector",S))}(0,E.append)(this.$parent,C),this.cache.set(I,C),(0,E.inverseClass)(C,"art-current"),(0,E.setStyle)(this.$parent,"width",`${C.dataset.width}px`),(0,E.setStyle)(this.$parent,"height",`${C.dataset.height}px`),this.updateStyle(Number(C.dataset.width)),I[0]&&I[0].$parentItem&&I[0].$parentItem.mounted&&I[0].$parentItem.mounted.call(this.art,C,I[0].$parentItem)}}}s.default=D},{"./flip":"kONUB","./aspectRatio":"84NBV","./playbackRate":"aetWt","./subtitleOffset":"fIBkO","../utils/component":"18nVI","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kONUB:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,icons:l,constructor:{SETTING_ITEM_WIDTH:o,FLIP:c}}=n;function u(h,f,m){f&&(f.innerText=a.get((0,r.capitalize)(m)));const _=(0,r.queryAll)(".art-setting-item",h).find(E=>E.dataset.value===m);_&&(0,r.inverseClass)(_,"art-current")}return{width:o,html:a.get("Video Flip"),tooltip:a.get((0,r.capitalize)(n.flip)),icon:l.flip,selector:c.map(h=>({value:h,default:h===n.flip,html:a.get((0,r.capitalize)(h))})),onSelect:h=>(n.flip=h.value,h.value),mounted:(h,f)=>{u(h,f.$tooltip,n.flip),n.on("flip",()=>{u(h,f.$tooltip,n.flip)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"84NBV":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,icons:l,constructor:{SETTING_ITEM_WIDTH:o,ASPECT_RATIO:c}}=n;function u(f){return f==="default"?a.get("Default"):f}function h(f,m,_){m&&(m.innerText=u(_));const E=(0,r.queryAll)(".art-setting-item",f).find(D=>D.dataset.value===_);E&&(0,r.inverseClass)(E,"art-current")}return{width:o,html:a.get("Aspect Ratio"),icon:l.aspectRatio,tooltip:u(n.aspectRatio),selector:c.map(f=>({value:f,default:f===n.aspectRatio,html:u(f)})),onSelect:f=>(n.aspectRatio=f.value,f.value),mounted:(f,m)=>{h(f,m.$tooltip,n.aspectRatio),n.on("aspectRatio",()=>{h(f,m.$tooltip,n.aspectRatio)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],aetWt:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,icons:l,constructor:{SETTING_ITEM_WIDTH:o,PLAYBACK_RATE:c}}=n;function u(f){return f===1?a.get("Normal"):f}function h(f,m,_){m&&(m.innerText=u(_));const E=(0,r.queryAll)(".art-setting-item",f).find(D=>Number(D.dataset.value)===_);E&&(0,r.inverseClass)(E,"art-current")}return{width:o,html:a.get("Play Speed"),tooltip:u(n.playbackRate),icon:l.playbackRate,selector:c.map(f=>({value:f,default:f===n.playbackRate,html:u(f)})),onSelect:f=>(n.playbackRate=f.value,f.value),mounted:(f,m)=>{h(f,m.$tooltip,n.playbackRate),n.on("video:ratechange",()=>{h(f,m.$tooltip,n.playbackRate)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fIBkO:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r){const{i18n:n,icons:a,constructor:l}=r;return{width:l.SETTING_ITEM_WIDTH,html:n.get("Subtitle Offset"),icon:a.subtitle,tooltip:"0s",range:[0,-5,5,.1],onChange:o=>(r.subtitleOffset=o.range,o.range+"s")}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2aaJe":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=class{constructor(){this.name="artplayer_settings",this.settings={}}get(r){try{const n=JSON.parse(window.localStorage.getItem(this.name))||{};return r?n[r]:n}catch(n){return r?this.settings[r]:this.settings}}set(r,n){try{const a=Object.assign({},this.get(),{[r]:n});window.localStorage.setItem(this.name,JSON.stringify(a))}catch(a){this.settings[r]=n}}del(r){try{const n=this.get();delete n[r],window.localStorage.setItem(this.name,JSON.stringify(n))}catch(n){delete this.settings[r]}}clear(){try{window.localStorage.removeItem(this.name)}catch(r){this.settings={}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8MTUM":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../utils"),a=e("./miniProgressBar"),l=r.interopDefault(a),o=e("./autoOrientation"),c=r.interopDefault(o),u=e("./autoPlayback"),h=r.interopDefault(u),f=e("./fastForward"),m=r.interopDefault(f),_=e("./lock"),E=r.interopDefault(_);s.default=class{constructor(D){this.art=D,this.id=0;const{option:O}=D;O.miniProgressBar&&!O.isLive&&this.add(l.default),O.lock&&n.isMobile&&this.add(E.default),O.autoPlayback&&!O.isLive&&this.add(h.default),O.autoOrientation&&n.isMobile&&this.add(c.default),O.fastForward&&n.isMobile&&!O.isLive&&this.add(m.default);for(let I=0;I<O.plugins.length;I++)this.add(O.plugins[I])}add(D){this.id+=1;const O=D.call(this.art,this.art),I=O&&O.name||D.name||`plugin${this.id}`;return(0,n.errorHandle)(!(0,n.has)(this,I),`Cannot add a plugin that already has the same name: ${I}`),(0,n.def)(this,I,{value:O}),this}}},{"../utils":"71aH7","./miniProgressBar":"87pSL","./autoOrientation":"ePEg5","./autoPlayback":"cVO99","./fastForward":"hFDwt","./lock":"1hsTH","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"87pSL":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r){return r.on("ready",()=>{r.layers.add({name:"miniProgressBar",mounted(n){r.on("destroy",()=>{n.style.display="none"}),r.on("video:timeupdate",()=>{n.style.width=100*r.played+"%"}),r.on("setBar",(a,l)=>{a==="played"&&(n.style.width=100*l+"%")})}})}),{name:"miniProgressBar"}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePEg5:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,constructor:l,template:{$player:o,$video:c}}=n;return n.on("fullscreenWeb",u=>{if(u){const{videoWidth:h,videoHeight:f}=c,{clientWidth:m,clientHeight:_}=document.documentElement;(h>f&&m<_||h<f&&m>_)&&setTimeout(()=>{(0,r.setStyle)(o,"width",`${_}px`),(0,r.setStyle)(o,"height",`${m}px`),(0,r.setStyle)(o,"transform-origin","0 0"),(0,r.setStyle)(o,"transform",`rotate(90deg) translate(0, -${m}px)`),(0,r.addClass)(o,"art-auto-orientation"),n.isRotate=!0,n.emit("resize")},l.MOBILE_AUTO_ORIENTATION_TIME)}else(0,r.hasClass)(o,"art-auto-orientation")&&((0,r.setStyle)(o,"width",null),(0,r.setStyle)(o,"height",null),(0,r.setStyle)(o,"transform",null),(0,r.setStyle)(o,"transform-origin",null),(0,r.removeClass)(o,"art-auto-orientation"),n.isRotate=!1,n.aspectRatioReset=!0,n.autoSize=a.autoSize,n.notice.show="",n.emit("resize"))}),n.on("fullscreen",u=>ne(this,null,function*(){const h=screen.orientation.type;if(u){const{videoWidth:f,videoHeight:m}=c,{clientWidth:_,clientHeight:E}=document.documentElement;if(f>m&&_<E||f<m&&_>E){const D=h.startsWith("portrait")?"landscape":"portrait";yield screen.orientation.lock(D),(0,r.addClass)(o,"art-auto-orientation-fullscreen")}}else(0,r.hasClass)(o,"art-auto-orientation-fullscreen")&&(yield screen.orientation.lock(h),(0,r.removeClass)(o,"art-auto-orientation-fullscreen"))})),{name:"autoOrientation",get state(){return(0,r.hasClass)(o,"art-auto-orientation")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cVO99:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,icons:l,storage:o,constructor:c,proxy:u,template:{$poster:h}}=n,f=n.layers.add({name:"autoPlayback",html:'<div class="art-autoPlayback-close"></div><div class="art-autoPlayback-last"></div><div class="art-autoPlayback-jump"></div>'}),m=(0,r.query)(".art-autoPlayback-last",f),_=(0,r.query)(".art-autoPlayback-jump",f),E=(0,r.query)(".art-autoPlayback-close",f);return n.on("video:timeupdate",()=>{const D=o.get("times")||{},O=Object.keys(D);O.length>c.AUTO_PLAYBACK_MAX&&delete D[O[0]],D[n.option.id||n.option.url]=n.currentTime,o.set("times",D)}),n.on("ready",()=>{const D=(o.get("times")||{})[n.option.id||n.option.url];D&&D>=c.AUTO_PLAYBACK_MIN&&((0,r.append)(E,l.close),(0,r.setStyle)(f,"display","flex"),m.innerText=`${a.get("Last Seen")} ${(0,r.secondToTime)(D)}`,_.innerText=a.get("Jump Play"),u(E,"click",()=>{(0,r.setStyle)(f,"display","none")}),u(_,"click",()=>{n.seek=D,n.play(),(0,r.setStyle)(h,"display","none"),(0,r.setStyle)(f,"display","none")}),n.once("video:timeupdate",()=>{setTimeout(()=>{(0,r.setStyle)(f,"display","none")},c.AUTO_PLAYBACK_TIMEOUT)}))}),{name:"autoPlayback",get times(){return o.get("times")||{}},clear:()=>o.del("times"),delete(D){const O=o.get("times")||{};return delete O[D],o.set("times",O),O}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hFDwt:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{constructor:a,proxy:l,template:{$player:o,$video:c}}=n;let u=null,h=!1,f=1;const m=()=>{clearTimeout(u),h&&(h=!1,n.playbackRate=f,(0,r.removeClass)(o,"art-fast-forward"))};return l(c,"touchstart",_=>{_.touches.length===1&&n.playing&&!n.isLock&&(u=setTimeout(()=>{h=!0,f=n.playbackRate,n.playbackRate=a.FAST_FORWARD_VALUE,(0,r.addClass)(o,"art-fast-forward")},a.FAST_FORWARD_TIME))}),l(document,"touchmove",m),l(document,"touchend",m),{name:"fastForward",get state(){return(0,r.hasClass)(o,"art-fast-forward")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1hsTH":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{layers:a,icons:l,template:{$player:o}}=n;return a.add({name:"lock",mounted(c){const u=(0,r.append)(c,l.lock),h=(0,r.append)(c,l.unlock);(0,r.setStyle)(u,"display","none"),n.on("lock",f=>{f?((0,r.setStyle)(u,"display","inline-flex"),(0,r.setStyle)(h,"display","none")):((0,r.setStyle)(u,"display","none"),(0,r.setStyle)(h,"display","inline-flex"))})},click(){(0,r.hasClass)(o,"art-lock")?((0,r.removeClass)(o,"art-lock"),this.isLock=!1):((0,r.addClass)(o,"art-lock"),this.isLock=!0)}}),{name:"lock",get state(){return(0,r.hasClass)(o,"art-lock")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7mil2":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./config"),a=r.interopDefault(n),l=e("./utils");s.default=class{constructor(o){const{option:c,proxy:u,template:{$video:h}}=o;for(let _=0;_<a.default.events.length;_++)u(h,a.default.events[_],E=>{o.emit(`video:${E.type}`,E)});Object.keys(c.moreVideoAttr).forEach(_=>{h[_]=c.moreVideoAttr[_]}),h.controls=!0,c.muted&&(h.muted=c.muted),c.volume&&(h.volume=(0,l.clamp)(c.volume,0,1)),c.poster&&(h.poster=c.poster),c.autoplay&&(h.autoplay=c.autoplay),c.playsInline&&(h.playsInline=!0,h["webkit-playsinline"]=!0);const f=c.type||(0,l.getExt)(c.url),m=c.customType[f];f&&m?m(h,c.url,o):(h.src=c.url,o.emit("url",h.src))}}},{"./config":"lyjeQ","./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}]},["5lTcX"],"5lTcX","parcelRequire4dc0")})(an);var Ba=nn(an.exports);const Ua={style:{transform:"scale(-1,1)"},height:"25",width:"25",viewBox:"0 0 22 22",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},ja=zt("path",{d:"M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"},null,-1),Ga=[ja];function Va(d,t){return fi(),pi("svg",Ua,Ga)}var $a={name:"custom-prev",render:Va};const za={height:"25",width:"25",viewBox:"0 0 22 22",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},Ha=zt("path",{d:"M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"},null,-1),Ya=[Ha];function Ka(d,t){return fi(),pi("svg",za,Ya)}var Wa={name:"custom-next",render:Ka},on={exports:{}};(function(d,t){(function(e,i){d.exports=i()})(window,function(){return function(e){var i={};function s(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=i,s.d=function(r,n,a){s.o(r,n)||Object.defineProperty(r,n,{enumerable:!0,get:a})},s.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},s.t=function(r,n){if(1&n&&(r=s(r)),8&n||4&n&&typeof r=="object"&&r&&r.__esModule)return r;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:r}),2&n&&typeof r!="string")for(var l in r)s.d(a,l,function(o){return r[o]}.bind(null,l));return a},s.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return s.d(n,"a",n),n},s.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},s.p="",s(s.s=14)}([function(e,i,s){var r=s(6),n=s.n(r),a=function(){function l(){}return l.e=function(o,c){o&&!l.FORCE_GLOBAL_TAG||(o=l.GLOBAL_TAG);var u="["+o+"] > "+c;l.ENABLE_CALLBACK&&l.emitter.emit("log","error",u),l.ENABLE_ERROR&&(console.error?console.error(u):console.warn?console.warn(u):console.log(u))},l.i=function(o,c){o&&!l.FORCE_GLOBAL_TAG||(o=l.GLOBAL_TAG);var u="["+o+"] > "+c;l.ENABLE_CALLBACK&&l.emitter.emit("log","info",u),l.ENABLE_INFO&&(console.info?console.info(u):console.log(u))},l.w=function(o,c){o&&!l.FORCE_GLOBAL_TAG||(o=l.GLOBAL_TAG);var u="["+o+"] > "+c;l.ENABLE_CALLBACK&&l.emitter.emit("log","warn",u),l.ENABLE_WARN&&(console.warn?console.warn(u):console.log(u))},l.d=function(o,c){o&&!l.FORCE_GLOBAL_TAG||(o=l.GLOBAL_TAG);var u="["+o+"] > "+c;l.ENABLE_CALLBACK&&l.emitter.emit("log","debug",u),l.ENABLE_DEBUG&&(console.debug?console.debug(u):console.log(u))},l.v=function(o,c){o&&!l.FORCE_GLOBAL_TAG||(o=l.GLOBAL_TAG);var u="["+o+"] > "+c;l.ENABLE_CALLBACK&&l.emitter.emit("log","verbose",u),l.ENABLE_VERBOSE&&console.log(u)},l}();a.GLOBAL_TAG="mpegts.js",a.FORCE_GLOBAL_TAG=!1,a.ENABLE_ERROR=!0,a.ENABLE_INFO=!0,a.ENABLE_WARN=!0,a.ENABLE_DEBUG=!0,a.ENABLE_VERBOSE=!0,a.ENABLE_CALLBACK=!1,a.emitter=new n.a,i.a=a},function(e,i,s){i.a={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},function(e,i,s){s.d(i,"c",function(){return n}),s.d(i,"b",function(){return a}),s.d(i,"a",function(){return l});var r=s(3),n={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},a={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},l=function(){function o(c){this._type=c||"undefined",this._status=n.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return o.prototype.destroy=function(){this._status=n.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},o.prototype.isWorking=function(){return this._status===n.kConnecting||this._status===n.kBuffering},Object.defineProperty(o.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(c){this._onContentLengthKnown=c},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(c){this._onURLRedirect=c},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(c){this._onDataArrival=c},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onError",{get:function(){return this._onError},set:function(c){this._onError=c},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onComplete",{get:function(){return this._onComplete},set:function(c){this._onComplete=c},enumerable:!1,configurable:!0}),o.prototype.open=function(c,u){throw new r.c("Unimplemented abstract function!")},o.prototype.abort=function(){throw new r.c("Unimplemented abstract function!")},o}()},function(e,i,s){s.d(i,"d",function(){return a}),s.d(i,"a",function(){return l}),s.d(i,"b",function(){return o}),s.d(i,"c",function(){return c});var r,n=(r=function(u,h){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,m){f.__proto__=m}||function(f,m){for(var _ in m)m.hasOwnProperty(_)&&(f[_]=m[_])})(u,h)},function(u,h){function f(){this.constructor=u}r(u,h),u.prototype=h===null?Object.create(h):(f.prototype=h.prototype,new f)}),a=function(){function u(h){this._message=h}return Object.defineProperty(u.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),u.prototype.toString=function(){return this.name+": "+this.message},u}(),l=function(u){function h(f){return u.call(this,f)||this}return n(h,u),Object.defineProperty(h.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),h}(a),o=function(u){function h(f){return u.call(this,f)||this}return n(h,u),Object.defineProperty(h.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),h}(a),c=function(u){function h(f){return u.call(this,f)||this}return n(h,u),Object.defineProperty(h.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),h}(a)},function(e,i,s){var r={};(function(){var n=self.navigator.userAgent.toLowerCase(),a=/(edge)\/([\w.]+)/.exec(n)||/(opr)[\/]([\w.]+)/.exec(n)||/(chrome)[ \/]([\w.]+)/.exec(n)||/(iemobile)[\/]([\w.]+)/.exec(n)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(n)||[],l=/(ipad)/.exec(n)||/(ipod)/.exec(n)||/(windows phone)/.exec(n)||/(iphone)/.exec(n)||/(kindle)/.exec(n)||/(android)/.exec(n)||/(windows)/.exec(n)||/(mac)/.exec(n)||/(linux)/.exec(n)||/(cros)/.exec(n)||[],o={browser:a[5]||a[3]||a[1]||"",version:a[2]||a[4]||"0",majorVersion:a[4]||a[2]||"0",platform:l[0]||""},c={};if(o.browser){c[o.browser]=!0;var u=o.majorVersion.split(".");c.version={major:parseInt(o.majorVersion,10),string:o.version},u.length>1&&(c.version.minor=parseInt(u[1],10)),u.length>2&&(c.version.build=parseInt(u[2],10))}o.platform&&(c[o.platform]=!0),(c.chrome||c.opr||c.safari)&&(c.webkit=!0),(c.rv||c.iemobile)&&(c.rv&&delete c.rv,o.browser="msie",c.msie=!0),c.edge&&(delete c.edge,o.browser="msedge",c.msedge=!0),c.opr&&(o.browser="opera",c.opera=!0),c.safari&&c.android&&(o.browser="android",c.android=!0);for(var h in c.name=o.browser,c.platform=o.platform,r)r.hasOwnProperty(h)&&delete r[h];Object.assign(r,c)})(),i.a=r},function(e,i,s){i.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(e,i,s){var r,n=typeof Reflect=="object"?Reflect:null,a=n&&typeof n.apply=="function"?n.apply:function(x,P,C){return Function.prototype.apply.call(x,P,C)};r=n&&typeof n.ownKeys=="function"?n.ownKeys:Object.getOwnPropertySymbols?function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:function(x){return Object.getOwnPropertyNames(x)};var l=Number.isNaN||function(x){return x!=x};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(x,P){return new Promise(function(C,b){function S(A){x.removeListener(P,L),b(A)}function L(){typeof x.removeListener=="function"&&x.removeListener("error",S),C([].slice.call(arguments))}I(x,P,L,{once:!0}),P!=="error"&&function(A,U,B){typeof A.on=="function"&&I(A,"error",U,B)}(x,S,{once:!0})})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function u(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}function h(x){return x._maxListeners===void 0?o.defaultMaxListeners:x._maxListeners}function f(x,P,C,b){var S,L,A,U;if(u(C),(L=x._events)===void 0?(L=x._events=Object.create(null),x._eventsCount=0):(L.newListener!==void 0&&(x.emit("newListener",P,C.listener?C.listener:C),L=x._events),A=L[P]),A===void 0)A=L[P]=C,++x._eventsCount;else if(typeof A=="function"?A=L[P]=b?[C,A]:[A,C]:b?A.unshift(C):A.push(C),(S=h(x))>0&&A.length>S&&!A.warned){A.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+A.length+" "+String(P)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.emitter=x,B.type=P,B.count=A.length,U=B,console&&console.warn&&console.warn(U)}return x}function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _(x,P,C){var b={fired:!1,wrapFn:void 0,target:x,type:P,listener:C},S=m.bind(b);return S.listener=C,b.wrapFn=S,S}function E(x,P,C){var b=x._events;if(b===void 0)return[];var S=b[P];return S===void 0?[]:typeof S=="function"?C?[S.listener||S]:[S]:C?function(L){for(var A=new Array(L.length),U=0;U<A.length;++U)A[U]=L[U].listener||L[U];return A}(S):O(S,S.length)}function D(x){var P=this._events;if(P!==void 0){var C=P[x];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}function O(x,P){for(var C=new Array(P),b=0;b<P;++b)C[b]=x[b];return C}function I(x,P,C,b){if(typeof x.on=="function")b.once?x.once(P,C):x.on(P,C);else{if(typeof x.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x);x.addEventListener(P,function S(L){b.once&&x.removeEventListener(P,S),C(L)})}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(x){if(typeof x!="number"||x<0||l(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");c=x}}),o.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||l(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this},o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(x){for(var P=[],C=1;C<arguments.length;C++)P.push(arguments[C]);var b=x==="error",S=this._events;if(S!==void 0)b=b&&S.error===void 0;else if(!b)return!1;if(b){var L;if(P.length>0&&(L=P[0]),L instanceof Error)throw L;var A=new Error("Unhandled error."+(L?" ("+L.message+")":""));throw A.context=L,A}var U=S[x];if(U===void 0)return!1;if(typeof U=="function")a(U,this,P);else{var B=U.length,G=O(U,B);for(C=0;C<B;++C)a(G[C],this,P)}return!0},o.prototype.addListener=function(x,P){return f(this,x,P,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(x,P){return f(this,x,P,!0)},o.prototype.once=function(x,P){return u(P),this.on(x,_(this,x,P)),this},o.prototype.prependOnceListener=function(x,P){return u(P),this.prependListener(x,_(this,x,P)),this},o.prototype.removeListener=function(x,P){var C,b,S,L,A;if(u(P),(b=this._events)===void 0)return this;if((C=b[x])===void 0)return this;if(C===P||C.listener===P)--this._eventsCount==0?this._events=Object.create(null):(delete b[x],b.removeListener&&this.emit("removeListener",x,C.listener||P));else if(typeof C!="function"){for(S=-1,L=C.length-1;L>=0;L--)if(C[L]===P||C[L].listener===P){A=C[L].listener,S=L;break}if(S<0)return this;S===0?C.shift():function(U,B){for(;B+1<U.length;B++)U[B]=U[B+1];U.pop()}(C,S),C.length===1&&(b[x]=C[0]),b.removeListener!==void 0&&this.emit("removeListener",x,A||P)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(x){var P,C,b;if((C=this._events)===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[x]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete C[x]),this;if(arguments.length===0){var S,L=Object.keys(C);for(b=0;b<L.length;++b)(S=L[b])!=="removeListener"&&this.removeAllListeners(S);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(P=C[x])=="function")this.removeListener(x,P);else if(P!==void 0)for(b=P.length-1;b>=0;b--)this.removeListener(x,P[b]);return this},o.prototype.listeners=function(x){return E(this,x,!0)},o.prototype.rawListeners=function(x){return E(this,x,!1)},o.listenerCount=function(x,P){return typeof x.listenerCount=="function"?x.listenerCount(P):D.call(x,P)},o.prototype.listenerCount=D,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,i,s){s.d(i,"d",function(){return r}),s.d(i,"b",function(){return n}),s.d(i,"a",function(){return a}),s.d(i,"c",function(){return l});var r=function(o,c,u,h,f){this.dts=o,this.pts=c,this.duration=u,this.originalDts=h,this.isSyncPoint=f,this.fileposition=null},n=function(){function o(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return o.prototype.appendSyncPoint=function(c){c.isSyncPoint=!0,this.syncPoints.push(c)},o}(),a=function(){function o(){this._list=[]}return o.prototype.clear=function(){this._list=[]},o.prototype.appendArray=function(c){var u=this._list;c.length!==0&&(u.length>0&&c[0].originalDts<u[u.length-1].originalDts&&this.clear(),Array.prototype.push.apply(u,c))},o.prototype.getLastSyncPointBeforeDts=function(c){if(this._list.length==0)return null;var u=this._list,h=0,f=u.length-1,m=0,_=0,E=f;for(c<u[0].dts&&(h=0,_=E+1);_<=E;){if((m=_+Math.floor((E-_)/2))===f||c>=u[m].dts&&c<u[m+1].dts){h=m;break}u[m].dts<c?_=m+1:E=m-1}return this._list[h]},o}(),l=function(){function o(c){this._type=c,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(o.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),o.prototype.isEmpty=function(){return this._list.length===0},o.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},o.prototype._searchNearestSegmentBefore=function(c){var u=this._list;if(u.length===0)return-2;var h=u.length-1,f=0,m=0,_=h,E=0;if(c<u[0].originalBeginDts)return E=-1;for(;m<=_;){if((f=m+Math.floor((_-m)/2))===h||c>u[f].lastSample.originalDts&&c<u[f+1].originalBeginDts){E=f;break}u[f].originalBeginDts<c?m=f+1:_=f-1}return E},o.prototype._searchNearestSegmentAfter=function(c){return this._searchNearestSegmentBefore(c)+1},o.prototype.append=function(c){var u=this._list,h=c,f=this._lastAppendLocation,m=0;f!==-1&&f<u.length&&h.originalBeginDts>=u[f].lastSample.originalDts&&(f===u.length-1||f<u.length-1&&h.originalBeginDts<u[f+1].originalBeginDts)?m=f+1:u.length>0&&(m=this._searchNearestSegmentBefore(h.originalBeginDts)+1),this._lastAppendLocation=m,this._list.splice(m,0,h)},o.prototype.getLastSegmentBefore=function(c){var u=this._searchNearestSegmentBefore(c);return u>=0?this._list[u]:null},o.prototype.getLastSampleBefore=function(c){var u=this.getLastSegmentBefore(c);return u!=null?u.lastSample:null},o.prototype.getLastSyncPointBefore=function(c){for(var u=this._searchNearestSegmentBefore(c),h=this._list[u].syncPoints;h.length===0&&u>0;)u--,h=this._list[u].syncPoints;return h.length>0?h[h.length-1]:null},o}()},function(e,i,s){var r=function(){function n(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return n.prototype.isComplete=function(){var a=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,l=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&a&&l},n.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},n.prototype.getNearestKeyframe=function(a){if(this.keyframesIndex==null)return null;var l=this.keyframesIndex,o=this._search(l.times,a);return{index:o,milliseconds:l.times[o],fileposition:l.filepositions[o]}},n.prototype._search=function(a,l){var o=0,c=a.length-1,u=0,h=0,f=c;for(l<a[0]&&(o=0,h=f+1);h<=f;){if((u=h+Math.floor((f-h)/2))===c||l>=a[u]&&l<a[u+1]){o=u;break}a[u]<l?h=u+1:f=u-1}return o},n}();i.a=r},function(e,i,s){var r=s(6),n=s.n(r),a=s(0),l=function(){function o(){}return Object.defineProperty(o,"forceGlobalTag",{get:function(){return a.a.FORCE_GLOBAL_TAG},set:function(c){a.a.FORCE_GLOBAL_TAG=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"globalTag",{get:function(){return a.a.GLOBAL_TAG},set:function(c){a.a.GLOBAL_TAG=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"enableAll",{get:function(){return a.a.ENABLE_VERBOSE&&a.a.ENABLE_DEBUG&&a.a.ENABLE_INFO&&a.a.ENABLE_WARN&&a.a.ENABLE_ERROR},set:function(c){a.a.ENABLE_VERBOSE=c,a.a.ENABLE_DEBUG=c,a.a.ENABLE_INFO=c,a.a.ENABLE_WARN=c,a.a.ENABLE_ERROR=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"enableDebug",{get:function(){return a.a.ENABLE_DEBUG},set:function(c){a.a.ENABLE_DEBUG=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"enableVerbose",{get:function(){return a.a.ENABLE_VERBOSE},set:function(c){a.a.ENABLE_VERBOSE=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"enableInfo",{get:function(){return a.a.ENABLE_INFO},set:function(c){a.a.ENABLE_INFO=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"enableWarn",{get:function(){return a.a.ENABLE_WARN},set:function(c){a.a.ENABLE_WARN=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"enableError",{get:function(){return a.a.ENABLE_ERROR},set:function(c){a.a.ENABLE_ERROR=c,o._notifyChange()},enumerable:!1,configurable:!0}),o.getConfig=function(){return{globalTag:a.a.GLOBAL_TAG,forceGlobalTag:a.a.FORCE_GLOBAL_TAG,enableVerbose:a.a.ENABLE_VERBOSE,enableDebug:a.a.ENABLE_DEBUG,enableInfo:a.a.ENABLE_INFO,enableWarn:a.a.ENABLE_WARN,enableError:a.a.ENABLE_ERROR,enableCallback:a.a.ENABLE_CALLBACK}},o.applyConfig=function(c){a.a.GLOBAL_TAG=c.globalTag,a.a.FORCE_GLOBAL_TAG=c.forceGlobalTag,a.a.ENABLE_VERBOSE=c.enableVerbose,a.a.ENABLE_DEBUG=c.enableDebug,a.a.ENABLE_INFO=c.enableInfo,a.a.ENABLE_WARN=c.enableWarn,a.a.ENABLE_ERROR=c.enableError,a.a.ENABLE_CALLBACK=c.enableCallback},o._notifyChange=function(){var c=o.emitter;if(c.listenerCount("change")>0){var u=o.getConfig();c.emit("change",u)}},o.registerListener=function(c){o.emitter.addListener("change",c)},o.removeListener=function(c){o.emitter.removeListener("change",c)},o.addLogListener=function(c){a.a.emitter.addListener("log",c),a.a.emitter.listenerCount("log")>0&&(a.a.ENABLE_CALLBACK=!0,o._notifyChange())},o.removeLogListener=function(c){a.a.emitter.removeListener("log",c),a.a.emitter.listenerCount("log")===0&&(a.a.ENABLE_CALLBACK=!1,o._notifyChange())},o}();l.emitter=new n.a,i.a=l},function(e,i,s){var r=s(6),n=s.n(r),a=s(0),l=s(4),o=s(8);function c(v,g,y){var p=v;if(g+y<p.length){for(;y--;)if((192&p[++g])!=128)return!1;return!0}return!1}var u,h=function(v){for(var g=[],y=v,p=0,T=v.length;p<T;)if(y[p]<128)g.push(String.fromCharCode(y[p])),++p;else{if(!(y[p]<192)){if(y[p]<224){if(c(y,p,1)&&(M=(31&y[p])<<6|63&y[p+1])>=128){g.push(String.fromCharCode(65535&M)),p+=2;continue}}else if(y[p]<240){if(c(y,p,2)&&(M=(15&y[p])<<12|(63&y[p+1])<<6|63&y[p+2])>=2048&&(63488&M)!=55296){g.push(String.fromCharCode(65535&M)),p+=3;continue}}else if(y[p]<248){var M;if(c(y,p,3)&&(M=(7&y[p])<<18|(63&y[p+1])<<12|(63&y[p+2])<<6|63&y[p+3])>65536&&M<1114112){M-=65536,g.push(String.fromCharCode(M>>>10|55296)),g.push(String.fromCharCode(1023&M|56320)),p+=4;continue}}}g.push(String.fromCharCode(65533)),++p}return g.join("")},f=s(3),m=(u=new ArrayBuffer(2),new DataView(u).setInt16(0,256,!0),new Int16Array(u)[0]===256),_=function(){function v(){}return v.parseScriptData=function(g,y,p){var T={};try{var M=v.parseValue(g,y,p),k=v.parseValue(g,y+M.size,p-M.size);T[M.data]=k.data}catch(F){a.a.e("AMF",F.toString())}return T},v.parseObject=function(g,y,p){if(p<3)throw new f.a("Data not enough when parse ScriptDataObject");var T=v.parseString(g,y,p),M=v.parseValue(g,y+T.size,p-T.size),k=M.objectEnd;return{data:{name:T.data,value:M.data},size:T.size+M.size,objectEnd:k}},v.parseVariable=function(g,y,p){return v.parseObject(g,y,p)},v.parseString=function(g,y,p){if(p<2)throw new f.a("Data not enough when parse String");var T=new DataView(g,y,p).getUint16(0,!m);return{data:T>0?h(new Uint8Array(g,y+2,T)):"",size:2+T}},v.parseLongString=function(g,y,p){if(p<4)throw new f.a("Data not enough when parse LongString");var T=new DataView(g,y,p).getUint32(0,!m);return{data:T>0?h(new Uint8Array(g,y+4,T)):"",size:4+T}},v.parseDate=function(g,y,p){if(p<10)throw new f.a("Data size invalid when parse Date");var T=new DataView(g,y,p),M=T.getFloat64(0,!m),k=T.getInt16(8,!m);return{data:new Date(M+=60*k*1e3),size:10}},v.parseValue=function(g,y,p){if(p<1)throw new f.a("Data not enough when parse Value");var T,M=new DataView(g,y,p),k=1,F=M.getUint8(0),H=!1;try{switch(F){case 0:T=M.getFloat64(1,!m),k+=8;break;case 1:T=!!M.getUint8(1),k+=1;break;case 2:var z=v.parseString(g,y+1,p-1);T=z.data,k+=z.size;break;case 3:T={};var K=0;for((16777215&M.getUint32(p-4,!m))==9&&(K=3);k<p-4;){var Z=v.parseObject(g,y+k,p-k-K);if(Z.objectEnd)break;T[Z.data.name]=Z.data.value,k+=Z.size}k<=p-3&&(16777215&M.getUint32(k-1,!m))===9&&(k+=3);break;case 8:for(T={},k+=4,K=0,(16777215&M.getUint32(p-4,!m))==9&&(K=3);k<p-8;){var Y=v.parseVariable(g,y+k,p-k-K);if(Y.objectEnd)break;T[Y.data.name]=Y.data.value,k+=Y.size}k<=p-3&&(16777215&M.getUint32(k-1,!m))===9&&(k+=3);break;case 9:T=void 0,k=1,H=!0;break;case 10:T=[];var q=M.getUint32(1,!m);k+=4;for(var et=0;et<q;et++){var dt=v.parseValue(g,y+k,p-k);T.push(dt.data),k+=dt.size}break;case 11:var st=v.parseDate(g,y+1,p-1);T=st.data,k+=st.size;break;case 12:var mt=v.parseString(g,y+1,p-1);T=mt.data,k+=mt.size;break;default:k=p,a.a.w("AMF","Unsupported AMF value type "+F)}}catch(gt){a.a.e("AMF",gt.toString())}return{data:T,size:k,objectEnd:H}},v}(),E=function(){function v(g){this.TAG="ExpGolomb",this._buffer=g,this._buffer_index=0,this._total_bytes=g.byteLength,this._total_bits=8*g.byteLength,this._current_word=0,this._current_word_bits_left=0}return v.prototype.destroy=function(){this._buffer=null},v.prototype._fillCurrentWord=function(){var g=this._total_bytes-this._buffer_index;if(g<=0)throw new f.a("ExpGolomb: _fillCurrentWord() but no bytes available");var y=Math.min(4,g),p=new Uint8Array(4);p.set(this._buffer.subarray(this._buffer_index,this._buffer_index+y)),this._current_word=new DataView(p.buffer).getUint32(0,!1),this._buffer_index+=y,this._current_word_bits_left=8*y},v.prototype.readBits=function(g){if(g>32)throw new f.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(g<=this._current_word_bits_left){var y=this._current_word>>>32-g;return this._current_word<<=g,this._current_word_bits_left-=g,y}var p=this._current_word_bits_left?this._current_word:0;p>>>=32-this._current_word_bits_left;var T=g-this._current_word_bits_left;this._fillCurrentWord();var M=Math.min(T,this._current_word_bits_left),k=this._current_word>>>32-M;return this._current_word<<=M,this._current_word_bits_left-=M,p=p<<M|k},v.prototype.readBool=function(){return this.readBits(1)===1},v.prototype.readByte=function(){return this.readBits(8)},v.prototype._skipLeadingZero=function(){var g;for(g=0;g<this._current_word_bits_left;g++)if((this._current_word&2147483648>>>g)!=0)return this._current_word<<=g,this._current_word_bits_left-=g,g;return this._fillCurrentWord(),g+this._skipLeadingZero()},v.prototype.readUEG=function(){var g=this._skipLeadingZero();return this.readBits(g+1)-1},v.prototype.readSEG=function(){var g=this.readUEG();return 1&g?g+1>>>1:-1*(g>>>1)},v}(),D=function(){function v(){}return v._ebsp2rbsp=function(g){for(var y=g,p=y.byteLength,T=new Uint8Array(p),M=0,k=0;k<p;k++)k>=2&&y[k]===3&&y[k-1]===0&&y[k-2]===0||(T[M]=y[k],M++);return new Uint8Array(T.buffer,0,M)},v.parseSPS=function(g){for(var y=g.subarray(1,4),p="avc1.",T=0;T<3;T++){var M=y[T].toString(16);M.length<2&&(M="0"+M),p+=M}var k=v._ebsp2rbsp(g),F=new E(k);F.readByte();var H=F.readByte();F.readByte();var z=F.readByte();F.readUEG();var K=v.getProfileString(H),Z=v.getLevelString(z),Y=1,q=420,et=8,dt=8;if((H===100||H===110||H===122||H===244||H===44||H===83||H===86||H===118||H===128||H===138||H===144)&&((Y=F.readUEG())===3&&F.readBits(1),Y<=3&&(q=[0,420,422,444][Y]),et=F.readUEG()+8,dt=F.readUEG()+8,F.readBits(1),F.readBool()))for(var st=Y!==3?8:12,mt=0;mt<st;mt++)F.readBool()&&(mt<6?v._skipScalingList(F,16):v._skipScalingList(F,64));F.readUEG();var gt=F.readUEG();if(gt===0)F.readUEG();else if(gt===1){F.readBits(1),F.readSEG(),F.readSEG();var ht=F.readUEG();for(mt=0;mt<ht;mt++)F.readSEG()}var It=F.readUEG();F.readBits(1);var pt=F.readUEG(),ct=F.readUEG(),St=F.readBits(1);St===0&&F.readBits(1),F.readBits(1);var kt=0,Yt=0,Dt=0,Nt=0;F.readBool()&&(kt=F.readUEG(),Yt=F.readUEG(),Dt=F.readUEG(),Nt=F.readUEG());var Bt=1,Lt=1,Ot=0,Kt=!0,se=0,ze=0;if(F.readBool()){if(F.readBool()){var ve=F.readByte();ve>0&&ve<16?(Bt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][ve-1],Lt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][ve-1]):ve===255&&(Bt=F.readByte()<<8|F.readByte(),Lt=F.readByte()<<8|F.readByte())}if(F.readBool()&&F.readBool(),F.readBool()&&(F.readBits(4),F.readBool()&&F.readBits(24)),F.readBool()&&(F.readUEG(),F.readUEG()),F.readBool()){var Vt=F.readBits(32),ri=F.readBits(32);Kt=F.readBool(),Ot=(se=ri)/(ze=2*Vt)}}var He=1;Bt===1&&Lt===1||(He=Bt/Lt);var oe=0,te=0;Y===0?(oe=1,te=2-St):(oe=Y===3?1:2,te=(Y===1?2:1)*(2-St));var Ye=16*(pt+1),Be=16*(ct+1)*(2-St);Ye-=(kt+Yt)*oe,Be-=(Dt+Nt)*te;var Ze=Math.ceil(Ye*He);return F.destroy(),F=null,{codec_mimetype:p,profile_idc:H,level_idc:z,profile_string:K,level_string:Z,chroma_format_idc:Y,bit_depth:et,bit_depth_luma:et,bit_depth_chroma:dt,ref_frames:It,chroma_format:q,chroma_format_string:v.getChromaFormatString(q),frame_rate:{fixed:Kt,fps:Ot,fps_den:ze,fps_num:se},sar_ratio:{width:Bt,height:Lt},codec_size:{width:Ye,height:Be},present_size:{width:Ze,height:Be}}},v._skipScalingList=function(g,y){for(var p=8,T=8,M=0;M<y;M++)T!==0&&(T=(p+g.readSEG()+256)%256),p=T===0?p:T},v.getProfileString=function(g){switch(g){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},v.getLevelString=function(g){return(g/10).toFixed(1)},v.getChromaFormatString=function(g){switch(g){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},v}(),O=s(5),I=function(){function v(){}return v._ebsp2rbsp=function(g){for(var y=g,p=y.byteLength,T=new Uint8Array(p),M=0,k=0;k<p;k++)k>=2&&y[k]===3&&y[k-1]===0&&y[k-2]===0||(T[M]=y[k],M++);return new Uint8Array(T.buffer,0,M)},v.parseVPS=function(g){var y=v._ebsp2rbsp(g),p=new E(y);return p.readByte(),p.readByte(),p.readBits(4),p.readBits(2),p.readBits(6),{num_temporal_layers:p.readBits(3)+1,temporal_id_nested:p.readBool()}},v.parseSPS=function(g){var y=v._ebsp2rbsp(g),p=new E(y);p.readByte(),p.readByte(),p.readBits(4);for(var T=p.readBits(3),M=(p.readBool(),p.readBits(2)),k=p.readBool(),F=p.readBits(5),H=p.readByte(),z=p.readByte(),K=p.readByte(),Z=p.readByte(),Y=p.readByte(),q=p.readByte(),et=p.readByte(),dt=p.readByte(),st=p.readByte(),mt=p.readByte(),gt=p.readByte(),ht=[],It=[],pt=0;pt<T;pt++)ht.push(p.readBool()),It.push(p.readBool());if(T>0)for(pt=T;pt<8;pt++)p.readBits(2);for(pt=0;pt<T;pt++)ht[pt]&&(p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte()),It[pt]&&p.readByte();p.readUEG();var ct=p.readUEG();ct==3&&p.readBits(1);var St=p.readUEG(),kt=p.readUEG();p.readBool()&&(p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG());var Yt=p.readUEG(),Dt=p.readUEG(),Nt=p.readUEG();for(pt=p.readBool()?0:T;pt<=T;pt++)p.readUEG(),p.readUEG(),p.readUEG();if(p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG(),p.readBool()&&p.readBool())for(var Bt=0;Bt<4;Bt++)for(var Lt=0;Lt<(Bt===3?2:6);Lt++)if(p.readBool()){var Ot=Math.min(64,1<<4+(Bt<<1));for(Bt>1&&p.readSEG(),pt=0;pt<Ot;pt++)p.readSEG()}else p.readUEG();p.readBool(),p.readBool(),p.readBool()&&(p.readByte(),p.readUEG(),p.readUEG(),p.readBool());var Kt=p.readUEG(),se=0;for(pt=0;pt<Kt;pt++){var ze=!1;if(pt!==0&&(ze=p.readBool()),ze){pt===Kt&&p.readUEG(),p.readBool(),p.readUEG();for(var ve=0,Vt=0;Vt<=se;Vt++){var ri=p.readBool(),He=!1;ri||(He=p.readBool()),(ri||He)&&ve++}se=ve}else{var oe=p.readUEG(),te=p.readUEG();for(se=oe+te,Vt=0;Vt<oe;Vt++)p.readUEG(),p.readBool();for(Vt=0;Vt<te;Vt++)p.readUEG(),p.readBool()}}if(p.readBool()){var Ye=p.readUEG();for(pt=0;pt<Ye;pt++){for(Vt=0;Vt<Nt+4;Vt++)p.readBits(1);p.readBits(1)}}var Be=0,Ze=1,di=1,qr=!1,Ki=1,Wi=1;if(p.readBool(),p.readBool(),p.readBool()){if(p.readBool()){var ui=p.readByte();ui>0&&ui<16?(Ze=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][ui-1],di=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][ui-1]):ui===255&&(Ze=p.readBits(16),di=p.readBits(16))}if(p.readBool()&&p.readBool(),p.readBool()&&(p.readBits(3),p.readBool(),p.readBool()&&(p.readByte(),p.readByte(),p.readByte())),p.readBool()&&(p.readUEG(),p.readUEG()),p.readBool(),p.readBool(),p.readBool(),p.readBool()&&(p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG()),p.readBool()&&(Ki=p.readBits(32),Wi=p.readBits(32),p.readBool()&&(p.readUEG(),p.readBool()))){var qi=!1,Qi=!1,Ti=!1;for(qi=p.readBool(),Qi=p.readBool(),(qi||Qi)&&((Ti=p.readBool())&&(p.readByte(),p.readBits(5),p.readBool(),p.readBits(5)),p.readBits(4),p.readBits(4),Ti&&p.readBits(4),p.readBits(5),p.readBits(5),p.readBits(5)),pt=0;pt<=T;pt++){var Qr=p.readBool();qr=Qr;var Xr=!1,Xi=1;Qr||(Xr=p.readBool());var Zr=!1;if(Xr?p.readSEG():Zr=p.readBool(),Zr||(Xi=p.readUEG()+1),qi)for(Vt=0;Vt<Xi;Vt++)p.readUEG(),p.readUEG(),Ti&&(p.readUEG(),p.readUEG());if(Qi)for(Vt=0;Vt<Xi;Vt++)p.readUEG(),p.readUEG(),Ti&&(p.readUEG(),p.readUEG())}}p.readBool()&&(p.readBool(),p.readBool(),p.readBool(),Be=p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG())}p.readBool();var la="hvc1."+F+".1.L"+gt+".B0",Jr=St,ts=kt,es=1;return Ze!==1&&di!==1&&(es=Ze/di),p.destroy(),p=null,{codec_mimetype:la,level_string:v.getLevelString(gt),profile_idc:F,bit_depth:Yt+8,ref_frames:1,chroma_format:ct,chroma_format_string:v.getChromaFormatString(ct),general_level_idc:gt,general_profile_space:M,general_tier_flag:k,general_profile_idc:F,general_profile_compatibility_flags_1:H,general_profile_compatibility_flags_2:z,general_profile_compatibility_flags_3:K,general_profile_compatibility_flags_4:Z,general_constraint_indicator_flags_1:Y,general_constraint_indicator_flags_2:q,general_constraint_indicator_flags_3:et,general_constraint_indicator_flags_4:dt,general_constraint_indicator_flags_5:st,general_constraint_indicator_flags_6:mt,min_spatial_segmentation_idc:Be,constant_frame_rate:0,chroma_format_idc:ct,bit_depth_luma_minus8:Yt,bit_depth_chroma_minus8:Dt,frame_rate:{fixed:qr,fps:Wi/Ki,fps_den:Ki,fps_num:Wi},sar_ratio:{width:Ze,height:di},codec_size:{width:Jr,height:ts},present_size:{width:Jr*es,height:ts}}},v.parsePPS=function(g){var y=v._ebsp2rbsp(g),p=new E(y);p.readByte(),p.readByte(),p.readUEG(),p.readUEG(),p.readBool(),p.readBool(),p.readBits(3),p.readBool(),p.readBool(),p.readUEG(),p.readUEG(),p.readSEG(),p.readBool(),p.readBool(),p.readBool()&&p.readUEG(),p.readSEG(),p.readSEG(),p.readBool(),p.readBool(),p.readBool(),p.readBool();var T=p.readBool(),M=p.readBool(),k=1;return M&&T?k=0:M?k=3:T&&(k=2),{parallelismType:k}},v.getChromaFormatString=function(g){switch(g){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},v.getProfileString=function(g){switch(g){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},v.getLevelString=function(g){return(g/30).toFixed(1)},v}();function x(v){return v.byteOffset%2==0&&v.byteLength%2==0}function P(v){return v.byteOffset%4==0&&v.byteLength%4==0}function C(v,g){for(var y=0;y<v.length;y++)if(v[y]!==g[y])return!1;return!0}var b=function(v,g){return v.byteLength===g.byteLength&&(P(v)&&P(g)?function(y,p){return C(new Uint32Array(y.buffer,y.byteOffset,y.byteLength/4),new Uint32Array(p.buffer,p.byteOffset,p.byteLength/4))}(v,g):x(v)&&x(g)?function(y,p){return C(new Uint16Array(y.buffer,y.byteOffset,y.byteLength/2),new Uint16Array(p.buffer,p.byteOffset,p.byteLength/2))}(v,g):function(y,p){return C(y,p)}(v,g))},S,L=function(){function v(g,y){this.TAG="FLVDemuxer",this._config=y,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=g.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=g.hasAudioTrack,this._hasVideo=g.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new o.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var p=new ArrayBuffer(2);return new DataView(p).setInt16(0,256,!0),new Int16Array(p)[0]===256}()}return v.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},v.probe=function(g){var y=new Uint8Array(g);if(y.byteLength<9)return{needMoreData:!0};var p={match:!1};if(y[0]!==70||y[1]!==76||y[2]!==86||y[3]!==1)return p;var T,M,k=(4&y[4])>>>2!=0,F=(1&y[4])!=0,H=(T=y)[M=5]<<24|T[M+1]<<16|T[M+2]<<8|T[M+3];return H<9?p:{match:!0,consumed:H,dataOffset:H,hasAudioTrack:k,hasVideoTrack:F}},v.prototype.bindDataSource=function(g){return g.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(v.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(g){this._onTrackMetadata=g},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(g){this._onMediaInfo=g},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(g){this._onMetaDataArrived=g},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(g){this._onScriptDataArrived=g},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onError",{get:function(){return this._onError},set:function(g){this._onError=g},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(g){this._onDataAvailable=g},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(g){this._timestampBase=g},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"overridedDuration",{get:function(){return this._duration},set:function(g){this._durationOverrided=!0,this._duration=g,this._mediaInfo.duration=g},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"overridedHasAudio",{set:function(g){this._hasAudioFlagOverrided=!0,this._hasAudio=g,this._mediaInfo.hasAudio=g},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"overridedHasVideo",{set:function(g){this._hasVideoFlagOverrided=!0,this._hasVideo=g,this._mediaInfo.hasVideo=g},enumerable:!1,configurable:!0}),v.prototype.resetMediaInfo=function(){this._mediaInfo=new o.a},v.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},v.prototype.parseChunks=function(g,y){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new f.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var p=0,T=this._littleEndian;if(y===0){if(!(g.byteLength>13))return 0;p=v.probe(g).dataOffset}for(this._firstParse&&(this._firstParse=!1,y+p!==this._dataOffset&&a.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),(M=new DataView(g,p)).getUint32(0,!T)!==0&&a.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),p+=4);p<g.byteLength;){this._dispatch=!0;var M=new DataView(g,p);if(p+11+4>g.byteLength)break;var k=M.getUint8(0),F=16777215&M.getUint32(0,!T);if(p+11+F+4>g.byteLength)break;if(k===8||k===9||k===18){var H=M.getUint8(4),z=M.getUint8(5),K=M.getUint8(6)|z<<8|H<<16|M.getUint8(7)<<24;(16777215&M.getUint32(7,!T))!==0&&a.a.w(this.TAG,"Meet tag which has StreamID != 0!");var Z=p+11;switch(k){case 8:this._parseAudioData(g,Z,F,K);break;case 9:this._parseVideoData(g,Z,F,K,y+p);break;case 18:this._parseScriptData(g,Z,F)}var Y=M.getUint32(11+F,!T);Y!==11+F&&a.a.w(this.TAG,"Invalid PrevTagSize "+Y),p+=11+F+4}else a.a.w(this.TAG,"Unsupported tag type "+k+", skipped"),p+=11+F+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),p},v.prototype._parseScriptData=function(g,y,p){var T=_.parseScriptData(g,y,p);if(T.hasOwnProperty("onMetaData")){if(T.onMetaData==null||typeof T.onMetaData!="object")return void a.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&a.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=T;var M=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},M)),typeof M.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=M.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof M.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=M.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof M.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=M.audiodatarate),typeof M.videodatarate=="number"&&(this._mediaInfo.videoDataRate=M.videodatarate),typeof M.width=="number"&&(this._mediaInfo.width=M.width),typeof M.height=="number"&&(this._mediaInfo.height=M.height),typeof M.duration=="number"){if(!this._durationOverrided){var k=Math.floor(M.duration*this._timescale);this._duration=k,this._mediaInfo.duration=k}}else this._mediaInfo.duration=0;if(typeof M.framerate=="number"){var F=Math.floor(1e3*M.framerate);if(F>0){var H=F/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=H,this._referenceFrameRate.fps_num=F,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=H}}if(typeof M.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var z=M.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(z),M.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=M,a.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(T).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},T))},v.prototype._parseKeyframesIndex=function(g){for(var y=[],p=[],T=1;T<g.times.length;T++){var M=this._timestampBase+Math.floor(1e3*g.times[T]);y.push(M),p.push(g.filepositions[T])}return{times:y,filepositions:p}},v.prototype._parseAudioData=function(g,y,p,T){if(p<=1)a.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(this._hasAudioFlagOverrided!==!0||this._hasAudio!==!1){this._littleEndian;var M=new DataView(g,y,p).getUint8(0),k=M>>>4;if(k===2||k===10){var F=0,H=(12&M)>>>2;if(H>=0&&H<=4){F=this._flvSoundRateTable[H];var z=1&M,K=this._audioMetadata,Z=this._audioTrack;if(K||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(K=this._audioMetadata={}).type="audio",K.id=Z.id,K.timescale=this._timescale,K.duration=this._duration,K.audioSampleRate=F,K.channelCount=z===0?1:2),k===10){var Y=this._parseAACAudioData(g,y+1,p-1);if(Y==null)return;if(Y.packetType===0){if(K.config){if(b(Y.data.config,K.config))return;a.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var q=Y.data;K.audioSampleRate=q.samplingRate,K.channelCount=q.channelCount,K.codec=q.codec,K.originalCodec=q.originalCodec,K.config=q.config,K.refSampleDuration=1024/K.audioSampleRate*K.timescale,a.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",K),(st=this._mediaInfo).audioCodec=K.originalCodec,st.audioSampleRate=K.audioSampleRate,st.audioChannelCount=K.channelCount,st.hasVideo?st.videoCodec!=null&&(st.mimeType='video/x-flv; codecs="'+st.videoCodec+","+st.audioCodec+'"'):st.mimeType='video/x-flv; codecs="'+st.audioCodec+'"',st.isComplete()&&this._onMediaInfo(st)}else if(Y.packetType===1){var et=this._timestampBase+T,dt={unit:Y.data,length:Y.data.byteLength,dts:et,pts:et};Z.samples.push(dt),Z.length+=Y.data.length}else a.a.e(this.TAG,"Flv: Unsupported AAC data type "+Y.packetType)}else if(k===2){if(!K.codec){var st;if((q=this._parseMP3AudioData(g,y+1,p-1,!0))==null)return;K.audioSampleRate=q.samplingRate,K.channelCount=q.channelCount,K.codec=q.codec,K.originalCodec=q.originalCodec,K.refSampleDuration=1152/K.audioSampleRate*K.timescale,a.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",K),(st=this._mediaInfo).audioCodec=K.codec,st.audioSampleRate=K.audioSampleRate,st.audioChannelCount=K.channelCount,st.audioDataRate=q.bitRate,st.hasVideo?st.videoCodec!=null&&(st.mimeType='video/x-flv; codecs="'+st.videoCodec+","+st.audioCodec+'"'):st.mimeType='video/x-flv; codecs="'+st.audioCodec+'"',st.isComplete()&&this._onMediaInfo(st)}var mt=this._parseMP3AudioData(g,y+1,p-1,!1);if(mt==null)return;et=this._timestampBase+T;var gt={unit:mt,length:mt.byteLength,dts:et,pts:et};Z.samples.push(gt),Z.length+=mt.length}}else this._onError(O.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+H)}else this._onError(O.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+k)}},v.prototype._parseAACAudioData=function(g,y,p){if(!(p<=1)){var T={},M=new Uint8Array(g,y,p);return T.packetType=M[0],M[0]===0?T.data=this._parseAACAudioSpecificConfig(g,y+1,p-1):T.data=M.subarray(1),T}a.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},v.prototype._parseAACAudioSpecificConfig=function(g,y,p){var T,M,k=new Uint8Array(g,y,p),F=null,H=0,z=null;if(H=T=k[0]>>>3,(M=(7&k[0])<<1|k[1]>>>7)<0||M>=this._mpegSamplingRates.length)this._onError(O.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var K=this._mpegSamplingRates[M],Z=(120&k[1])>>>3;if(!(Z<0||Z>=8)){H===5&&(z=(7&k[1])<<1|k[2]>>>7,(124&k[2])>>>2);var Y=self.navigator.userAgent.toLowerCase();return Y.indexOf("firefox")!==-1?M>=6?(H=5,F=new Array(4),z=M-3):(H=2,F=new Array(2),z=M):Y.indexOf("android")!==-1?(H=2,F=new Array(2),z=M):(H=5,z=M,F=new Array(4),M>=6?z=M-3:Z===1&&(H=2,F=new Array(2),z=M)),F[0]=H<<3,F[0]|=(15&M)>>>1,F[1]=(15&M)<<7,F[1]|=(15&Z)<<3,H===5&&(F[1]|=(15&z)>>>1,F[2]=(1&z)<<7,F[2]|=8,F[3]=0),{config:F,samplingRate:K,channelCount:Z,codec:"mp4a.40."+H,originalCodec:"mp4a.40."+T}}this._onError(O.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},v.prototype._parseMP3AudioData=function(g,y,p,T){if(!(p<4)){this._littleEndian;var M=new Uint8Array(g,y,p),k=null;if(T){if(M[0]!==255)return;var F=M[1]>>>3&3,H=(6&M[1])>>1,z=(240&M[2])>>>4,K=(12&M[2])>>>2,Z=(M[3]>>>6&3)!==3?2:1,Y=0,q=0;switch(F){case 0:Y=this._mpegAudioV25SampleRateTable[K];break;case 2:Y=this._mpegAudioV20SampleRateTable[K];break;case 3:Y=this._mpegAudioV10SampleRateTable[K]}switch(H){case 1:z<this._mpegAudioL3BitRateTable.length&&(q=this._mpegAudioL3BitRateTable[z]);break;case 2:z<this._mpegAudioL2BitRateTable.length&&(q=this._mpegAudioL2BitRateTable[z]);break;case 3:z<this._mpegAudioL1BitRateTable.length&&(q=this._mpegAudioL1BitRateTable[z])}k={bitRate:q,samplingRate:Y,channelCount:Z,codec:"mp3",originalCodec:"mp3"}}else k=M;return k}a.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},v.prototype._parseVideoData=function(g,y,p,T,M){if(p<=1)a.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(this._hasVideoFlagOverrided!==!0||this._hasVideo!==!1){var k=new Uint8Array(g,y,p)[0],F=(240&k)>>>4,H=15&k;if(H===7)this._parseAVCVideoPacket(g,y+1,p-1,T,M,F);else{if(H!==12)return void this._onError(O.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+H);this._parseHEVCVideoPacket(g,y+1,p-1,T,M,F)}}},v.prototype._parseAVCVideoPacket=function(g,y,p,T,M,k){if(p<4)a.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var F=this._littleEndian,H=new DataView(g,y,p),z=H.getUint8(0),K=(16777215&H.getUint32(0,!F))<<8>>8;if(z===0)this._parseAVCDecoderConfigurationRecord(g,y+4,p-4);else if(z===1)this._parseAVCVideoData(g,y+4,p-4,T,M,k,K);else if(z!==2)return void this._onError(O.a.FORMAT_ERROR,"Flv: Invalid video packet type "+z)}},v.prototype._parseHEVCVideoPacket=function(g,y,p,T,M,k){if(p<4)a.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var F=this._littleEndian,H=new DataView(g,y,p),z=H.getUint8(0),K=(16777215&H.getUint32(0,!F))<<8>>8;if(z===0)this._parseHEVCDecoderConfigurationRecord(g,y+4,p-4);else if(z===1)this._parseHEVCVideoData(g,y+4,p-4,T,M,k,K);else if(z!==2)return void this._onError(O.a.FORMAT_ERROR,"Flv: Invalid video packet type "+z)}},v.prototype._parseAVCDecoderConfigurationRecord=function(g,y,p){if(p<7)a.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var T=this._videoMetadata,M=this._videoTrack,k=this._littleEndian,F=new DataView(g,y,p);if(T){if(T.avcc!==void 0){var H=new Uint8Array(g,y,p);if(b(H,T.avcc))return;a.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(T=this._videoMetadata={}).type="video",T.id=M.id,T.timescale=this._timescale,T.duration=this._duration;var z=F.getUint8(0),K=F.getUint8(1);if(F.getUint8(2),F.getUint8(3),z===1&&K!==0)if(this._naluLengthSize=1+(3&F.getUint8(4)),this._naluLengthSize===3||this._naluLengthSize===4){var Z=31&F.getUint8(5);if(Z!==0){Z>1&&a.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+Z);for(var Y=6,q=0;q<Z;q++){var et=F.getUint16(Y,!k);if(Y+=2,et!==0){var dt=new Uint8Array(g,y+Y,et);Y+=et;var st=D.parseSPS(dt);if(q===0){T.codecWidth=st.codec_size.width,T.codecHeight=st.codec_size.height,T.presentWidth=st.present_size.width,T.presentHeight=st.present_size.height,T.profile=st.profile_string,T.level=st.level_string,T.bitDepth=st.bit_depth,T.chromaFormat=st.chroma_format,T.sarRatio=st.sar_ratio,T.frameRate=st.frame_rate,st.frame_rate.fixed!==!1&&st.frame_rate.fps_num!==0&&st.frame_rate.fps_den!==0||(T.frameRate=this._referenceFrameRate);var mt=T.frameRate.fps_den,gt=T.frameRate.fps_num;T.refSampleDuration=T.timescale*(mt/gt);for(var ht=dt.subarray(1,4),It="avc1.",pt=0;pt<3;pt++){var ct=ht[pt].toString(16);ct.length<2&&(ct="0"+ct),It+=ct}T.codec=It;var St=this._mediaInfo;St.width=T.codecWidth,St.height=T.codecHeight,St.fps=T.frameRate.fps,St.profile=T.profile,St.level=T.level,St.refFrames=st.ref_frames,St.chromaFormat=st.chroma_format_string,St.sarNum=T.sarRatio.width,St.sarDen=T.sarRatio.height,St.videoCodec=It,St.hasAudio?St.audioCodec!=null&&(St.mimeType='video/x-flv; codecs="'+St.videoCodec+","+St.audioCodec+'"'):St.mimeType='video/x-flv; codecs="'+St.videoCodec+'"',St.isComplete()&&this._onMediaInfo(St)}}}var kt=F.getUint8(Y);if(kt!==0){for(kt>1&&a.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+kt),Y++,q=0;q<kt;q++)et=F.getUint16(Y,!k),Y+=2,et!==0&&(Y+=et);T.avcc=new Uint8Array(p),T.avcc.set(new Uint8Array(g,y,p),0),a.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",T)}else this._onError(O.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(O.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(O.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(O.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},v.prototype._parseHEVCDecoderConfigurationRecord=function(g,y,p){if(p<22)a.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var T=this._videoMetadata,M=this._videoTrack,k=this._littleEndian,F=new DataView(g,y,p);if(T){if(T.hvcc!==void 0){var H=new Uint8Array(g,y,p);if(b(H,T.hvcc))return;a.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(T=this._videoMetadata={}).type="video",T.id=M.id,T.timescale=this._timescale,T.duration=this._duration;var z=F.getUint8(0),K=31&F.getUint8(1);if(z===1&&K!==0)if(this._naluLengthSize=1+(3&F.getUint8(21)),this._naluLengthSize===3||this._naluLengthSize===4){for(var Z=F.getUint8(22),Y=0,q=23;Y<Z;Y++){var et=63&F.getUint8(q+0),dt=F.getUint16(q+1,!k);q+=3;for(var st=0;st<dt;st++){var mt=F.getUint16(q+0,!k);if(st===0)if(et===33){q+=2;var gt=new Uint8Array(g,y+q,mt),ht=I.parseSPS(gt);T.codecWidth=ht.codec_size.width,T.codecHeight=ht.codec_size.height,T.presentWidth=ht.present_size.width,T.presentHeight=ht.present_size.height,T.profile=ht.profile_string,T.level=ht.level_string,T.bitDepth=ht.bit_depth,T.chromaFormat=ht.chroma_format,T.sarRatio=ht.sar_ratio,T.frameRate=ht.frame_rate,ht.frame_rate.fixed!==!1&&ht.frame_rate.fps_num!==0&&ht.frame_rate.fps_den!==0||(T.frameRate=this._referenceFrameRate);var It=T.frameRate.fps_den,pt=T.frameRate.fps_num;T.refSampleDuration=T.timescale*(It/pt),T.codec=ht.codec_mimetype;var ct=this._mediaInfo;ct.width=T.codecWidth,ct.height=T.codecHeight,ct.fps=T.frameRate.fps,ct.profile=T.profile,ct.level=T.level,ct.refFrames=ht.ref_frames,ct.chromaFormat=ht.chroma_format_string,ct.sarNum=T.sarRatio.width,ct.sarDen=T.sarRatio.height,ct.videoCodec=ht.codec_mimetype,ct.hasAudio?ct.audioCodec!=null&&(ct.mimeType='video/x-flv; codecs="'+ct.videoCodec+","+ct.audioCodec+'"'):ct.mimeType='video/x-flv; codecs="'+ct.videoCodec+'"',ct.isComplete()&&this._onMediaInfo(ct),q+=mt}else q+=2+mt;else q+=2+mt}}T.hvcc=new Uint8Array(p),T.hvcc.set(new Uint8Array(g,y,p),0),a.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",T)}else this._onError(O.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(O.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord")}},v.prototype._parseAVCVideoData=function(g,y,p,T,M,k,F){for(var H=this._littleEndian,z=new DataView(g,y,p),K=[],Z=0,Y=0,q=this._naluLengthSize,et=this._timestampBase+T,dt=k===1;Y<p;){if(Y+4>=p){a.a.w(this.TAG,"Malformed Nalu near timestamp "+et+", offset = "+Y+", dataSize = "+p);break}var st=z.getUint32(Y,!H);if(q===3&&(st>>>=8),st>p-q)return void a.a.w(this.TAG,"Malformed Nalus near timestamp "+et+", NaluSize > DataSize!");var mt=31&z.getUint8(Y+q);mt===5&&(dt=!0);var gt=new Uint8Array(g,y+Y,q+st),ht={type:mt,data:gt};K.push(ht),Z+=gt.byteLength,Y+=q+st}if(K.length){var It=this._videoTrack,pt={units:K,length:Z,isKeyframe:dt,dts:et,cts:F,pts:et+F};dt&&(pt.fileposition=M),It.samples.push(pt),It.length+=Z}},v.prototype._parseHEVCVideoData=function(g,y,p,T,M,k,F){for(var H=this._littleEndian,z=new DataView(g,y,p),K=[],Z=0,Y=0,q=this._naluLengthSize,et=this._timestampBase+T,dt=k===1;Y<p;){if(Y+4>=p){a.a.w(this.TAG,"Malformed Nalu near timestamp "+et+", offset = "+Y+", dataSize = "+p);break}var st=z.getUint32(Y,!H);if(q===3&&(st>>>=8),st>p-q)return void a.a.w(this.TAG,"Malformed Nalus near timestamp "+et+", NaluSize > DataSize!");var mt=31&z.getUint8(Y+q);mt!==19&&mt!==20||(dt=!0);var gt=new Uint8Array(g,y+Y,q+st),ht={type:mt,data:gt};K.push(ht),Z+=gt.byteLength,Y+=q+st}if(K.length){var It=this._videoTrack,pt={units:K,length:Z,isKeyframe:dt,dts:et,cts:F,pts:et+F};dt&&(pt.fileposition=M),It.samples.push(pt),It.length+=Z}},v}(),A=function(){function v(){}return v.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},v}(),U=function(){this.program_pmt_pid={}};(function(v){v[v.kMPEG1Audio=3]="kMPEG1Audio",v[v.kMPEG2Audio=4]="kMPEG2Audio",v[v.kPESPrivateData=6]="kPESPrivateData",v[v.kADTSAAC=15]="kADTSAAC",v[v.kID3=21]="kID3",v[v.kSCTE35=134]="kSCTE35",v[v.kH264=27]="kH264",v[v.kH265=36]="kH265"})(S||(S={}));var B,G=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,adts_aac:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.scte_35_pids={},this.smpte2038_pids={}},Q=function(){},nt=function(){},ot=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};(function(v){v[v.kUnspecified=0]="kUnspecified",v[v.kSliceNonIDR=1]="kSliceNonIDR",v[v.kSliceDPA=2]="kSliceDPA",v[v.kSliceDPB=3]="kSliceDPB",v[v.kSliceDPC=4]="kSliceDPC",v[v.kSliceIDR=5]="kSliceIDR",v[v.kSliceSEI=6]="kSliceSEI",v[v.kSliceSPS=7]="kSliceSPS",v[v.kSlicePPS=8]="kSlicePPS",v[v.kSliceAUD=9]="kSliceAUD",v[v.kEndOfSequence=10]="kEndOfSequence",v[v.kEndOfStream=11]="kEndOfStream",v[v.kFiller=12]="kFiller",v[v.kSPSExt=13]="kSPSExt",v[v.kReserved0=14]="kReserved0"})(B||(B={}));var V,R,N=function(){},j=function(v){var g=v.data.byteLength;this.type=v.type,this.data=new Uint8Array(4+g),new DataView(this.data.buffer).setUint32(0,g),this.data.set(v.data,4)},X=function(){function v(g){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=g,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&a.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return v.prototype.findNextStartCodeOffset=function(g){for(var y=g,p=this.data_;;){if(y+3>=p.byteLength)return this.eof_flag_=!0,p.byteLength;var T=p[y+0]<<24|p[y+1]<<16|p[y+2]<<8|p[y+3],M=p[y+0]<<16|p[y+1]<<8|p[y+2];if(T===1||M===1)return y;y++}},v.prototype.readNextNaluPayload=function(){for(var g=this.data_,y=null;y==null&&!this.eof_flag_;){var p=this.current_startcode_offset_,T=31&g[p+=(g[p]<<24|g[p+1]<<16|g[p+2]<<8|g[p+3])===1?4:3],M=(128&g[p])>>>7,k=this.findNextStartCodeOffset(p);if(this.current_startcode_offset_=k,!(T>=B.kReserved0)&&M===0){var F=g.subarray(p,k);(y=new N).type=T,y.data=F}}return y},v}(),rt=function(){function v(g,y,p){var T=8+g.byteLength+1+2+y.byteLength,M=!1;g[3]!==66&&g[3]!==77&&g[3]!==88&&(M=!0,T+=4);var k=this.data=new Uint8Array(T);k[0]=1,k[1]=g[1],k[2]=g[2],k[3]=g[3],k[4]=255,k[5]=225;var F=g.byteLength;k[6]=F>>>8,k[7]=255&F;var H=8;k.set(g,8),k[H+=F]=1;var z=y.byteLength;k[H+1]=z>>>8,k[H+2]=255&z,k.set(y,H+3),H+=3+z,M&&(k[H]=252|p.chroma_format_idc,k[H+1]=248|p.bit_depth_luma-8,k[H+2]=248|p.bit_depth_chroma-8,k[H+3]=0,H+=4)}return v.prototype.getData=function(){return this.data},v}();(function(v){v[v.kNull=0]="kNull",v[v.kAACMain=1]="kAACMain",v[v.kAAC_LC=2]="kAAC_LC",v[v.kAAC_SSR=3]="kAAC_SSR",v[v.kAAC_LTP=4]="kAAC_LTP",v[v.kAAC_SBR=5]="kAAC_SBR",v[v.kAAC_Scalable=6]="kAAC_Scalable",v[v.kLayer1=32]="kLayer1",v[v.kLayer2=33]="kLayer2",v[v.kLayer3=34]="kLayer3"})(V||(V={})),function(v){v[v.k96000Hz=0]="k96000Hz",v[v.k88200Hz=1]="k88200Hz",v[v.k64000Hz=2]="k64000Hz",v[v.k48000Hz=3]="k48000Hz",v[v.k44100Hz=4]="k44100Hz",v[v.k32000Hz=5]="k32000Hz",v[v.k24000Hz=6]="k24000Hz",v[v.k22050Hz=7]="k22050Hz",v[v.k16000Hz=8]="k16000Hz",v[v.k12000Hz=9]="k12000Hz",v[v.k11025Hz=10]="k11025Hz",v[v.k8000Hz=11]="k8000Hz",v[v.k7350Hz=12]="k7350Hz"}(R||(R={}));var lt,Tt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],wt=function(){},Rt=function(){function v(g){this.TAG="AACADTSParser",this.data_=g,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&a.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return v.prototype.findNextSyncwordOffset=function(g){for(var y=g,p=this.data_;;){if(y+7>=p.byteLength)return this.eof_flag_=!0,p.byteLength;if((p[y+0]<<8|p[y+1])>>>4===4095)return y;y++}},v.prototype.readNextAACFrame=function(){for(var g=this.data_,y=null;y==null&&!this.eof_flag_;){var p=this.current_syncword_offset_,T=(8&g[p+1])>>>3,M=(6&g[p+1])>>>1,k=1&g[p+1],F=(192&g[p+2])>>>6,H=(60&g[p+2])>>>2,z=(1&g[p+2])<<2|(192&g[p+3])>>>6,K=(3&g[p+3])<<11|g[p+4]<<3|(224&g[p+5])>>>5;if(g[p+6],p+K>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var Z=k===1?7:9,Y=K-Z;p+=Z;var q=this.findNextSyncwordOffset(p+Y);if(this.current_syncword_offset_=q,(T===0||T===1)&&M===0){var et=g.subarray(p,p+Y);(y=new wt).audio_object_type=F+1,y.sampling_freq_index=H,y.sampling_frequency=Tt[H],y.channel_config=z,y.data=et}}return y},v.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},v.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},v}(),tt=function(v){var g=null,y=v.audio_object_type,p=v.audio_object_type,T=v.sampling_freq_index,M=v.channel_config,k=0,F=navigator.userAgent.toLowerCase();F.indexOf("firefox")!==-1?T>=6?(p=5,g=new Array(4),k=T-3):(p=2,g=new Array(2),k=T):F.indexOf("android")!==-1?(p=2,g=new Array(2),k=T):(p=5,k=T,g=new Array(4),T>=6?k=T-3:M===1&&(p=2,g=new Array(2),k=T)),g[0]=p<<3,g[0]|=(15&T)>>>1,g[1]=(15&T)<<7,g[1]|=(15&M)<<3,p===5&&(g[1]|=(15&k)>>>1,g[2]=(1&k)<<7,g[2]|=8,g[3]=0),this.config=g,this.sampling_rate=Tt[T],this.channel_count=M,this.codec_mimetype="mp4a.40."+p,this.original_codec_mimetype="mp4a.40."+y},at=function(){},ft=function(){};(function(v){v[v.kSpliceNull=0]="kSpliceNull",v[v.kSpliceSchedule=4]="kSpliceSchedule",v[v.kSpliceInsert=5]="kSpliceInsert",v[v.kTimeSignal=6]="kTimeSignal",v[v.kBandwidthReservation=7]="kBandwidthReservation",v[v.kPrivateCommand=255]="kPrivateCommand"})(lt||(lt={}));var ut,yt=function(v){var g=v.readBool();return g?(v.readBits(6),{time_specified_flag:g,pts_time:4*v.readBits(31)+v.readBits(2)}):(v.readBits(7),{time_specified_flag:g})},At=function(v){var g=v.readBool();return v.readBits(6),{auto_return:g,duration:4*v.readBits(31)+v.readBits(2)}},jt=function(v,g){var y=g.readBits(8);return v?{component_tag:y}:{component_tag:y,splice_time:yt(g)}},qt=function(v){return{component_tag:v.readBits(8),utc_splice_time:v.readBits(32)}},re=function(v){var g=v.readBits(32),y=v.readBool();v.readBits(7);var p={splice_event_id:g,splice_event_cancel_indicator:y};if(y)return p;if(p.out_of_network_indicator=v.readBool(),p.program_splice_flag=v.readBool(),p.duration_flag=v.readBool(),v.readBits(5),p.program_splice_flag)p.utc_splice_time=v.readBits(32);else{p.component_count=v.readBits(8),p.components=[];for(var T=0;T<p.component_count;T++)p.components.push(qt(v))}return p.duration_flag&&(p.break_duration=At(v)),p.unique_program_id=v.readBits(16),p.avail_num=v.readBits(8),p.avails_expected=v.readBits(8),p},Xt=function(v,g,y,p){return{descriptor_tag:v,descriptor_length:g,identifier:y,provider_avail_id:p.readBits(32)}},ke=function(v,g,y,p){var T=p.readBits(8),M=p.readBits(3);p.readBits(5);for(var k="",F=0;F<M;F++)k+=String.fromCharCode(p.readBits(8));return{descriptor_tag:v,descriptor_length:g,identifier:y,preroll:T,dtmf_count:M,DTMF_char:k}},Me=function(v){var g=v.readBits(8);return v.readBits(7),{component_tag:g,pts_offset:4*v.readBits(31)+v.readBits(2)}},Pe=function(v,g,y,p){var T=p.readBits(32),M=p.readBool();p.readBits(7);var k={descriptor_tag:v,descriptor_length:g,identifier:y,segmentation_event_id:T,segmentation_event_cancel_indicator:M};if(M)return k;if(k.program_segmentation_flag=p.readBool(),k.segmentation_duration_flag=p.readBool(),k.delivery_not_restricted_flag=p.readBool(),k.delivery_not_restricted_flag?p.readBits(5):(k.web_delivery_allowed_flag=p.readBool(),k.no_regional_blackout_flag=p.readBool(),k.archive_allowed_flag=p.readBool(),k.device_restrictions=p.readBits(2)),!k.program_segmentation_flag){k.component_count=p.readBits(8),k.components=[];for(var F=0;F<k.component_count;F++)k.components.push(Me(p))}k.segmentation_duration_flag&&(k.segmentation_duration=p.readBits(40)),k.segmentation_upid_type=p.readBits(8),k.segmentation_upid_length=p.readBits(8);var H=new Uint8Array(k.segmentation_upid_length);for(F=0;F<k.segmentation_upid_length;F++)H[F]=p.readBits(8);return k.segmentation_upid=H.buffer,k.segmentation_type_id=p.readBits(8),k.segment_num=p.readBits(8),k.segments_expected=p.readBits(8),k.segmentation_type_id!==52&&k.segmentation_type_id!==54&&k.segmentation_type_id!==56&&k.segmentation_type_id!==58||(k.sub_segment_num=p.readBits(8),k.sub_segments_expected=p.readBits(8)),k},pe=function(v,g,y,p){return{descriptor_tag:v,descriptor_length:g,identifier:y,TAI_seconds:p.readBits(48),TAI_ns:p.readBits(32),UTC_offset:p.readBits(16)}},vt=function(v){return{component_tag:v.readBits(8),ISO_code:String.fromCharCode(v.readBits(8),v.readBits(8),v.readBits(8)),Bit_Stream_Mode:v.readBits(3),Num_Channels:v.readBits(4),Full_Srvc_Audio:v.readBool()}},Oe=function(v,g,y,p){for(var T=p.readBits(4),M=[],k=0;k<T;k++)M.push(vt(p));return{descriptor_tag:v,descriptor_length:g,identifier:y,audio_count:T,components:M}},Ne=function(v){var g=new E(v),y=g.readBits(8),p=g.readBool(),T=g.readBool();g.readBits(2);var M=g.readBits(12),k=g.readBits(8),F=g.readBool(),H=g.readBits(6),z=4*g.readBits(31)+g.readBits(2),K=g.readBits(8),Z=g.readBits(12),Y=g.readBits(12),q=g.readBits(8),et=null;q===lt.kSpliceNull?et={}:q===lt.kSpliceSchedule?et=function(Dt){for(var Nt=Dt.readBits(8),Bt=[],Lt=0;Lt<Nt;Lt++)Bt.push(re(Dt));return{splice_count:Nt,events:Bt}}(g):q===lt.kSpliceInsert?et=function(Dt){var Nt=Dt.readBits(32),Bt=Dt.readBool();Dt.readBits(7);var Lt={splice_event_id:Nt,splice_event_cancel_indicator:Bt};if(Bt)return Lt;if(Lt.out_of_network_indicator=Dt.readBool(),Lt.program_splice_flag=Dt.readBool(),Lt.duration_flag=Dt.readBool(),Lt.splice_immediate_flag=Dt.readBool(),Dt.readBits(4),Lt.program_splice_flag&&!Lt.splice_immediate_flag&&(Lt.splice_time=yt(Dt)),!Lt.program_splice_flag){Lt.component_count=Dt.readBits(8),Lt.components=[];for(var Ot=0;Ot<Lt.component_count;Ot++)Lt.components.push(jt(Lt.splice_immediate_flag,Dt))}return Lt.duration_flag&&(Lt.break_duration=At(Dt)),Lt.unique_program_id=Dt.readBits(16),Lt.avail_num=Dt.readBits(8),Lt.avails_expected=Dt.readBits(8),Lt}(g):q===lt.kTimeSignal?et=function(Dt){return{splice_time:yt(Dt)}}(g):q===lt.kBandwidthReservation?et={}:q===lt.kPrivateCommand?et=function(Dt,Nt){for(var Bt=String.fromCharCode(Nt.readBits(8),Nt.readBits(8),Nt.readBits(8),Nt.readBits(8)),Lt=new Uint8Array(Dt-4),Ot=0;Ot<Dt-4;Ot++)Lt[Ot]=Nt.readBits(8);return{identifier:Bt,private_data:Lt.buffer}}(Y,g):g.readBits(8*Y);for(var dt=[],st=g.readBits(16),mt=0;mt<st;){var gt=g.readBits(8),ht=g.readBits(8),It=String.fromCharCode(g.readBits(8),g.readBits(8),g.readBits(8),g.readBits(8));gt===0?dt.push(Xt(gt,ht,It,g)):gt===1?dt.push(ke(gt,ht,It,g)):gt===2?dt.push(Pe(gt,ht,It,g)):gt===3?dt.push(pe(gt,ht,It,g)):gt===4?dt.push(Oe(gt,ht,It,g)):g.readBits(8*(ht-4)),mt+=2+ht}var pt={table_id:y,section_syntax_indicator:p,private_indicator:T,section_length:M,protocol_version:k,encrypted_packet:F,encryption_algorithm:H,pts_adjustment:z,cw_index:K,tier:Z,splice_command_length:Y,splice_command_type:q,splice_command:et,descriptor_loop_length:st,splice_descriptors:dt,E_CRC32:F?g.readBits(32):void 0,CRC32:g.readBits(32)};if(q===lt.kSpliceInsert){var ct=et;if(ct.splice_event_cancel_indicator)return{splice_command_type:q,detail:pt,data:v};if(ct.program_splice_flag&&!ct.splice_immediate_flag){var St=ct.duration_flag?ct.break_duration.auto_return:void 0,kt=ct.duration_flag?ct.break_duration.duration/90:void 0;return ct.splice_time.time_specified_flag?{splice_command_type:q,pts:(z+ct.splice_time.pts_time)%Math.pow(2,33),auto_return:St,duraiton:kt,detail:pt,data:v}:{splice_command_type:q,auto_return:St,duraiton:kt,detail:pt,data:v}}return{splice_command_type:q,auto_return:St=ct.duration_flag?ct.break_duration.auto_return:void 0,duraiton:kt=ct.duration_flag?ct.break_duration.duration/90:void 0,detail:pt,data:v}}if(q===lt.kTimeSignal){var Yt=et;return Yt.splice_time.time_specified_flag?{splice_command_type:q,pts:(z+Yt.splice_time.pts_time)%Math.pow(2,33),detail:pt,data:v}:{splice_command_type:q,detail:pt,data:v}}return{splice_command_type:q,detail:pt,data:v}};(function(v){v[v.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",v[v.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",v[v.kSliceCRA_NUT=21]="kSliceCRA_NUT",v[v.kSliceVPS=32]="kSliceVPS",v[v.kSliceSPS=33]="kSliceSPS",v[v.kSlicePPS=34]="kSlicePPS",v[v.kSliceAUD=35]="kSliceAUD"})(ut||(ut={}));var Le,Xe=function(){},ye=function(v){var g=v.data.byteLength;this.type=v.type,this.data=new Uint8Array(4+g),new DataView(this.data.buffer).setUint32(0,g),this.data.set(v.data,4)},fe=function(){function v(g){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=g,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&a.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return v.prototype.findNextStartCodeOffset=function(g){for(var y=g,p=this.data_;;){if(y+3>=p.byteLength)return this.eof_flag_=!0,p.byteLength;var T=p[y+0]<<24|p[y+1]<<16|p[y+2]<<8|p[y+3],M=p[y+0]<<16|p[y+1]<<8|p[y+2];if(T===1||M===1)return y;y++}},v.prototype.readNextNaluPayload=function(){for(var g=this.data_,y=null;y==null&&!this.eof_flag_;){var p=this.current_startcode_offset_,T=g[p+=(g[p]<<24|g[p+1]<<16|g[p+2]<<8|g[p+3])===1?4:3]>>1&63,M=(128&g[p])>>>7,k=this.findNextStartCodeOffset(p);if(this.current_startcode_offset_=k,M===0){var F=g.subarray(p,k);(y=new Xe).type=T,y.data=F}}return y},v}(),Ie=function(){function v(g,y,p,T){var M=23+(5+g.byteLength)+(5+y.byteLength)+(5+p.byteLength),k=this.data=new Uint8Array(M);k[0]=1,k[1]=(3&T.general_profile_space)<<6|(T.general_tier_flag?1:0)<<5|31&T.general_profile_idc,k[2]=T.general_profile_compatibility_flags_1,k[3]=T.general_profile_compatibility_flags_2,k[4]=T.general_profile_compatibility_flags_3,k[5]=T.general_profile_compatibility_flags_4,k[6]=T.general_constraint_indicator_flags_1,k[7]=T.general_constraint_indicator_flags_2,k[8]=T.general_constraint_indicator_flags_3,k[9]=T.general_constraint_indicator_flags_4,k[10]=T.general_constraint_indicator_flags_5,k[11]=T.general_constraint_indicator_flags_6,k[12]=60,k[13]=240|(3840&T.min_spatial_segmentation_idc)>>8,k[14]=255&T.min_spatial_segmentation_idc,k[15]=252|3&T.parallelismType,k[16]=252|3&T.chroma_format_idc,k[17]=248|7&T.bit_depth_luma_minus8,k[18]=248|7&T.bit_depth_chroma_minus8,k[19]=0,k[20]=0,k[21]=(3&T.constant_frame_rate)<<6|(7&T.num_temporal_layers)<<3|(T.temporal_id_nested?1:0)<<2|3,k[22]=3,k[23]=128|ut.kSliceVPS,k[24]=0,k[25]=1,k[26]=(65280&g.byteLength)>>8,k[27]=(255&g.byteLength)>>0,k.set(g,28),k[23+(5+g.byteLength)+0]=128|ut.kSliceSPS,k[23+(5+g.byteLength)+1]=0,k[23+(5+g.byteLength)+2]=1,k[23+(5+g.byteLength)+3]=(65280&y.byteLength)>>8,k[23+(5+g.byteLength)+4]=(255&y.byteLength)>>0,k.set(y,23+(5+g.byteLength)+5),k[23+(5+g.byteLength+5+y.byteLength)+0]=128|ut.kSlicePPS,k[23+(5+g.byteLength+5+y.byteLength)+1]=0,k[23+(5+g.byteLength+5+y.byteLength)+2]=1,k[23+(5+g.byteLength+5+y.byteLength)+3]=(65280&p.byteLength)>>8,k[23+(5+g.byteLength+5+y.byteLength)+4]=(255&p.byteLength)>>0,k.set(p,23+(5+g.byteLength+5+y.byteLength)+5)}return v.prototype.getData=function(){return this.data},v}(),zi=function(){},Hi=function(){},Yi=(Le=function(v,g){return(Le=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,p){y.__proto__=p}||function(y,p){for(var T in p)p.hasOwnProperty(T)&&(y[T]=p[T])})(v,g)},function(v,g){function y(){this.constructor=v}Le(v,g),v.prototype=g===null?Object.create(g):(y.prototype=g.prototype,new y)}),Fe=function(){return(Fe=Object.assign||function(v){for(var g,y=1,p=arguments.length;y<p;y++)for(var T in g=arguments[y])Object.prototype.hasOwnProperty.call(g,T)&&(v[T]=g[T]);return v}).apply(this,arguments)},Ei=function(v){function g(y,p){var T=v.call(this)||this;return T.TAG="TSDemuxer",T.first_parse_=!0,T.media_info_=new o.a,T.timescale_=90,T.duration_=0,T.current_pmt_pid_=-1,T.program_pmt_map_={},T.pes_slice_queues_={},T.section_slice_queues_={},T.video_metadata_={vps:void 0,sps:void 0,pps:void 0,details:void 0},T.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},T.aac_last_sample_pts_=void 0,T.aac_last_incomplete_data_=null,T.has_video_=!1,T.has_audio_=!1,T.video_init_segment_dispatched_=!1,T.audio_init_segment_dispatched_=!1,T.video_metadata_changed_=!1,T.audio_metadata_changed_=!1,T.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},T.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},T.ts_packet_size_=y.ts_packet_size,T.sync_offset_=y.sync_offset,T.config_=p,T}return Yi(g,v),g.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,v.prototype.destroy.call(this)},g.probe=function(y){var p=new Uint8Array(y),T=-1,M=188;if(p.byteLength<=3*M)return{needMoreData:!0};for(;T===-1;){for(var k=Math.min(1e3,p.byteLength-3*M),F=0;F<k;){if(p[F]===71&&p[F+M]===71&&p[F+2*M]===71){T=F;break}F++}if(T===-1)if(M===188)M=192;else{if(M!==192)break;M=204}}return T===-1?{match:!1}:(M===192&&T>=4?(a.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),T-=4):M===204&&a.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:M,sync_offset:T})},g.prototype.bindDataSource=function(y){return y.onDataArrival=this.parseChunks.bind(this),this},g.prototype.resetMediaInfo=function(){this.media_info_=new o.a},g.prototype.parseChunks=function(y,p){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new f.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var T=0;for(this.first_parse_&&(this.first_parse_=!1,T=this.sync_offset_);T+this.ts_packet_size_<=y.byteLength;){var M=p+T;this.ts_packet_size_===192&&(T+=4);var k=new Uint8Array(y,T,188),F=k[0];if(F!==71){a.a.e(this.TAG,"sync_byte = "+F+", not 0x47");break}var H=(64&k[1])>>>6,z=(k[1],(31&k[1])<<8|k[2]),K=(48&k[3])>>>4,Z=15&k[3],Y={},q=4;if(K==2||K==3){var et=k[4];if(5+et===188){T+=188,this.ts_packet_size_===204&&(T+=16);continue}et>0&&(Y=this.parseAdaptationField(y,T+4,1+et)),q=5+et}if(K==1||K==3){if(z===0||z===this.current_pmt_pid_||this.pmt_!=null&&this.pmt_.pid_stream_type[z]===S.kSCTE35){var dt=188-q;this.handleSectionSlice(y,T+q,dt,{pid:z,file_position:M,payload_unit_start_indicator:H,continuity_conunter:Z,random_access_indicator:Y.random_access_indicator})}else if(this.pmt_!=null&&this.pmt_.pid_stream_type[z]!=null){dt=188-q;var st=this.pmt_.pid_stream_type[z];z!==this.pmt_.common_pids.h264&&z!==this.pmt_.common_pids.h265&&z!==this.pmt_.common_pids.adts_aac&&z!==this.pmt_.common_pids.mp3&&this.pmt_.pes_private_data_pids[z]!==!0&&this.pmt_.timed_id3_pids[z]!==!0||this.handlePESSlice(y,T+q,dt,{pid:z,stream_type:st,file_position:M,payload_unit_start_indicator:H,continuity_conunter:Z,random_access_indicator:Y.random_access_indicator})}}T+=188,this.ts_packet_size_===204&&(T+=16)}return this.dispatchAudioVideoMediaSegment(),T},g.prototype.parseAdaptationField=function(y,p,T){var M=new Uint8Array(y,p,T),k=M[0];return k>0?k>183?(a.a.w(this.TAG,"Illegal adaptation_field_length: "+k),{}):{discontinuity_indicator:(128&M[1])>>>7,random_access_indicator:(64&M[1])>>>6,elementary_stream_priority_indicator:(32&M[1])>>>5}:{}},g.prototype.handleSectionSlice=function(y,p,T,M){var k=new Uint8Array(y,p,T),F=this.section_slice_queues_[M.pid];if(M.payload_unit_start_indicator){var H=k[0];if(F!=null&&F.total_length!==0){var z=new Uint8Array(y,p+1,Math.min(T,H));F.slices.push(z),F.total_length+=z.byteLength,F.total_length===F.expected_length?this.emitSectionSlices(F,M):this.clearSlices(F,M)}for(var K=1+H;K<k.byteLength&&k[K+0]!==255;){var Z=(15&k[K+1])<<8|k[K+2];this.section_slice_queues_[M.pid]=new ot,(F=this.section_slice_queues_[M.pid]).expected_length=Z+3,F.file_position=M.file_position,F.random_access_indicator=M.random_access_indicator,z=new Uint8Array(y,p+K,Math.min(T-K,F.expected_length-F.total_length)),F.slices.push(z),F.total_length+=z.byteLength,F.total_length===F.expected_length?this.emitSectionSlices(F,M):F.total_length>=F.expected_length&&this.clearSlices(F,M),K+=z.byteLength}}else F!=null&&F.total_length!==0&&(z=new Uint8Array(y,p,Math.min(T,F.expected_length-F.total_length)),F.slices.push(z),F.total_length+=z.byteLength,F.total_length===F.expected_length?this.emitSectionSlices(F,M):F.total_length>=F.expected_length&&this.clearSlices(F,M))},g.prototype.handlePESSlice=function(y,p,T,M){var k=new Uint8Array(y,p,T),F=k[0]<<16|k[1]<<8|k[2],H=(k[3],k[4]<<8|k[5]);if(M.payload_unit_start_indicator){if(F!==1)return void a.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value "+F);var z=this.pes_slice_queues_[M.pid];z&&(z.expected_length===0||z.expected_length===z.total_length?this.emitPESSlices(z,M):this.clearSlices(z,M)),this.pes_slice_queues_[M.pid]=new ot,this.pes_slice_queues_[M.pid].file_position=M.file_position,this.pes_slice_queues_[M.pid].random_access_indicator=M.random_access_indicator}if(this.pes_slice_queues_[M.pid]!=null){var K=this.pes_slice_queues_[M.pid];K.slices.push(k),M.payload_unit_start_indicator&&(K.expected_length=H===0?0:H+6),K.total_length+=k.byteLength,K.expected_length>0&&K.expected_length===K.total_length?this.emitPESSlices(K,M):K.expected_length>0&&K.expected_length<K.total_length&&this.clearSlices(K,M)}},g.prototype.emitSectionSlices=function(y,p){for(var T=new Uint8Array(y.total_length),M=0,k=0;M<y.slices.length;M++){var F=y.slices[M];T.set(F,k),k+=F.byteLength}y.slices=[],y.expected_length=-1,y.total_length=0;var H=new nt;H.pid=p.pid,H.data=T,H.file_position=y.file_position,H.random_access_indicator=y.random_access_indicator,this.parseSection(H)},g.prototype.emitPESSlices=function(y,p){for(var T=new Uint8Array(y.total_length),M=0,k=0;M<y.slices.length;M++){var F=y.slices[M];T.set(F,k),k+=F.byteLength}y.slices=[],y.expected_length=-1,y.total_length=0;var H=new Q;H.pid=p.pid,H.data=T,H.stream_type=p.stream_type,H.file_position=y.file_position,H.random_access_indicator=y.random_access_indicator,this.parsePES(H)},g.prototype.clearSlices=function(y,p){y.slices=[],y.expected_length=-1,y.total_length=0},g.prototype.parseSection=function(y){var p=y.data,T=y.pid;T===0?this.parsePAT(p):T===this.current_pmt_pid_?this.parsePMT(p):this.pmt_!=null&&this.pmt_.scte_35_pids[T]&&this.parseSCTE35(p)},g.prototype.parsePES=function(y){var p=y.data,T=p[0]<<16|p[1]<<8|p[2],M=p[3],k=p[4]<<8|p[5];if(T===1)if(M!==188&&M!==190&&M!==191&&M!==240&&M!==241&&M!==255&&M!==242&&M!==248){p[6];var F=(192&p[7])>>>6,H=p[8],z=void 0,K=void 0;F!==2&&F!==3||(z=536870912*(14&p[9])+4194304*(255&p[10])+16384*(254&p[11])+128*(255&p[12])+(254&p[13])/2,K=F===3?536870912*(14&p[14])+4194304*(255&p[15])+16384*(254&p[16])+128*(255&p[17])+(254&p[18])/2:z);var Z=9+H,Y=void 0;if(k!==0){if(k<3+H)return void a.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");Y=k-3-H}else Y=p.byteLength-Z;var q=p.subarray(Z,Z+Y);switch(y.stream_type){case S.kMPEG1Audio:case S.kMPEG2Audio:this.parseMP3Payload(q,z);break;case S.kPESPrivateData:this.pmt_.smpte2038_pids[y.pid]?this.parseSMPTE2038MetadataPayload(q,z,K,y.pid,M):this.parsePESPrivateDataPayload(q,z,K,y.pid,M);break;case S.kADTSAAC:this.parseAACPayload(q,z);break;case S.kID3:this.parseTimedID3MetadataPayload(q,z,K,y.pid,M);break;case S.kH264:this.parseH264Payload(q,z,K,y.file_position,y.random_access_indicator);break;case S.kH265:this.parseH265Payload(q,z,K,y.file_position,y.random_access_indicator)}}else(M===188||M===191||M===240||M===241||M===255||M===242||M===248)&&y.stream_type===S.kPESPrivateData&&(Z=6,Y=void 0,Y=k!==0?k:p.byteLength-Z,q=p.subarray(Z,Z+Y),this.parsePESPrivateDataPayload(q,void 0,void 0,y.pid,M));else a.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value "+T)},g.prototype.parsePAT=function(y){var p=y[0];if(p===0){var T=(15&y[1])<<8|y[2],M=(y[3],y[4],(62&y[5])>>>1),k=1&y[5],F=y[6],H=(y[7],null);if(k===1&&F===0)(H=new U).version_number=M;else if((H=this.pat_)==null)return;for(var z=T-5-4,K=-1,Z=-1,Y=8;Y<8+z;Y+=4){var q=y[Y]<<8|y[Y+1],et=(31&y[Y+2])<<8|y[Y+3];q===0?H.network_pid=et:(H.program_pmt_pid[q]=et,K===-1&&(K=q),Z===-1&&(Z=et))}k===1&&F===0&&(this.pat_==null&&a.a.v(this.TAG,"Parsed first PAT: "+JSON.stringify(H)),this.pat_=H,this.current_program_=K,this.current_pmt_pid_=Z)}else a.a.e(this.TAG,"parsePAT: table_id "+p+" is not corresponded to PAT!")},g.prototype.parsePMT=function(y){var p=y[0];if(p===2){var T=(15&y[1])<<8|y[2],M=y[3]<<8|y[4],k=(62&y[5])>>>1,F=1&y[5],H=y[6],z=(y[7],null);if(F===1&&H===0)(z=new G).program_number=M,z.version_number=k,this.program_pmt_map_[M]=z;else if((z=this.program_pmt_map_[M])==null)return;y[8],y[9];for(var K=(15&y[10])<<8|y[11],Z=12+K,Y=T-9-K-4,q=Z;q<Z+Y;){var et=y[q],dt=(31&y[q+1])<<8|y[q+2],st=(15&y[q+3])<<8|y[q+4];if(z.pid_stream_type[dt]=et,et!==S.kH264||z.common_pids.h264||z.common_pids.h265)if(et!==S.kH265||z.common_pids.h264||z.common_pids.h265)if(et!==S.kADTSAAC||z.common_pids.adts_aac)if(et!==S.kMPEG1Audio&&et!==S.kMPEG2Audio||z.common_pids.mp3)if(et===S.kPESPrivateData){if(z.pes_private_data_pids[dt]=!0,st>0){for(var mt=q+5;mt<q+5+st;){var gt=y[mt+0],ht=y[mt+1];gt===5&&String.fromCharCode.apply(String,Array.from(y.subarray(mt+2,mt+2+ht)))==="VANC"&&(z.smpte2038_pids[dt]=!0),mt+=2+ht}var It=y.subarray(q+5,q+5+st);this.dispatchPESPrivateDataDescriptor(dt,et,It)}}else et===S.kID3?z.timed_id3_pids[dt]=!0:et===S.kSCTE35&&(z.scte_35_pids[dt]=!0);else z.common_pids.mp3=dt;else z.common_pids.adts_aac=dt;else z.common_pids.h265=dt;else z.common_pids.h264=dt;q+=5+st}M===this.current_program_&&(this.pmt_==null&&a.a.v(this.TAG,"Parsed first PMT: "+JSON.stringify(z)),this.pmt_=z,(z.common_pids.h264||z.common_pids.h265)&&(this.has_video_=!0),(z.common_pids.adts_aac||z.common_pids.mp3)&&(this.has_audio_=!0))}else a.a.e(this.TAG,"parsePMT: table_id "+p+" is not corresponded to PMT!")},g.prototype.parseSCTE35=function(y){var p=Ne(y);if(p.pts!=null){var T=Math.floor(p.pts/this.timescale_);p.pts=T}else p.nearest_pts=this.aac_last_sample_pts_;this.onSCTE35Metadata&&this.onSCTE35Metadata(p)},g.prototype.parseH264Payload=function(y,p,T,M,k){for(var F=new X(y),H=null,z=[],K=0,Z=!1;(H=F.readNextNaluPayload())!=null;){var Y=new j(H);if(Y.type===B.kSliceSPS){var q=D.parseSPS(H.data);this.video_init_segment_dispatched_?this.detectVideoMetadataChange(Y,q)===!0&&(a.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:Y,pps:void 0,details:q}):(this.video_metadata_.sps=Y,this.video_metadata_.details=q)}else Y.type===B.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=Y,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(Y.type===B.kSliceIDR||Y.type===B.kSliceNonIDR&&k===1)&&(Z=!0);this.video_init_segment_dispatched_&&(z.push(Y),K+=Y.data.byteLength)}var et=Math.floor(p/this.timescale_),dt=Math.floor(T/this.timescale_);if(z.length){var st=this.video_track_,mt={units:z,length:K,isKeyframe:Z,dts:dt,pts:et,cts:et-dt,file_position:M};st.samples.push(mt),st.length+=K}},g.prototype.parseH265Payload=function(y,p,T,M,k){for(var F=new fe(y),H=null,z=[],K=0,Z=!1;(H=F.readNextNaluPayload())!=null;){var Y=new ye(H);if(Y.type===ut.kSliceVPS){if(!this.video_init_segment_dispatched_){var q=I.parseVPS(H.data);this.video_metadata_.vps=Y,this.video_metadata_.details=Fe(Fe({},this.video_metadata_.details),q)}}else Y.type===ut.kSliceSPS?(q=I.parseSPS(H.data),this.video_init_segment_dispatched_?this.detectVideoMetadataChange(Y,q)===!0&&(a.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:Y,pps:void 0,details:q}):(this.video_metadata_.sps=Y,this.video_metadata_.details=Fe(Fe({},this.video_metadata_.details),q))):Y.type===ut.kSlicePPS?(!this.video_init_segment_dispatched_||this.video_metadata_changed_)&&(q=I.parsePPS(H.data),this.video_metadata_.pps=Y,this.video_metadata_.details=Fe(Fe({},this.video_metadata_.details),q),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):Y.type!==ut.kSliceIDR_W_RADL&&Y.type!==ut.kSliceIDR_N_LP&&Y.type!==ut.kSliceCRA_NUT||(Z=!0);this.video_init_segment_dispatched_&&(z.push(Y),K+=Y.data.byteLength)}var et=Math.floor(p/this.timescale_),dt=Math.floor(T/this.timescale_);if(z.length){var st=this.video_track_,mt={units:z,length:K,isKeyframe:Z,dts:dt,pts:et,cts:et-dt,file_position:M};st.samples.push(mt),st.length+=K}},g.prototype.detectVideoMetadataChange=function(y,p){if(p.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return a.a.v(this.TAG,"Video: Codec mimeType changed from "+this.video_metadata_.details.codec_mimetype+" to "+p.codec_mimetype),!0;if(p.codec_size.width!==this.video_metadata_.details.codec_size.width||p.codec_size.height!==this.video_metadata_.details.codec_size.height){var T=this.video_metadata_.details.codec_size,M=p.codec_size;return a.a.v(this.TAG,"Video: Coded Resolution changed from "+T.width+"x"+T.height+" to "+M.width+"x"+M.height),!0}return p.present_size.width!==this.video_metadata_.details.present_size.width&&(a.a.v(this.TAG,"Video: Present resolution width changed from "+this.video_metadata_.details.present_size.width+" to "+p.present_size.width),!0)},g.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},g.prototype.dispatchVideoInitSegment=function(){var y=this.video_metadata_.details,p={type:"video"};p.id=this.video_track_.id,p.timescale=1e3,p.duration=this.duration_,p.codecWidth=y.codec_size.width,p.codecHeight=y.codec_size.height,p.presentWidth=y.present_size.width,p.presentHeight=y.present_size.height,p.profile=y.profile_string,p.level=y.level_string,p.bitDepth=y.bit_depth,p.chromaFormat=y.chroma_format,p.sarRatio=y.sar_ratio,p.frameRate=y.frame_rate;var T=p.frameRate.fps_den,M=p.frameRate.fps_num;if(p.refSampleDuration=T/M*1e3,p.codec=y.codec_mimetype,this.video_metadata_.vps){var k=this.video_metadata_.vps.data.subarray(4),F=this.video_metadata_.sps.data.subarray(4),H=this.video_metadata_.pps.data.subarray(4),z=new Ie(k,F,H,y);p.hvcc=z.getData(),this.video_init_segment_dispatched_==0&&a.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: "+p.codec)}else{F=this.video_metadata_.sps.data.subarray(4),H=this.video_metadata_.pps.data.subarray(4);var K=new rt(F,H,y);p.avcc=K.getData(),this.video_init_segment_dispatched_==0&&a.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: "+p.codec)}this.onTrackMetadata("video",p),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var Z=this.media_info_;Z.hasVideo=!0,Z.width=p.codecWidth,Z.height=p.codecHeight,Z.fps=p.frameRate.fps,Z.profile=p.profile,Z.level=p.level,Z.refFrames=y.ref_frames,Z.chromaFormat=y.chroma_format_string,Z.sarNum=p.sarRatio.width,Z.sarDen=p.sarRatio.height,Z.videoCodec=p.codec,Z.hasAudio&&Z.audioCodec?Z.mimeType='video/mp2t; codecs="'+Z.videoCodec+","+Z.audioCodec+'"':Z.mimeType='video/mp2t; codecs="'+Z.videoCodec+'"',Z.isComplete()&&this.onMediaInfo(Z)},g.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},g.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},g.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},g.prototype.parseAACPayload=function(y,p){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var T=new Uint8Array(y.byteLength+this.aac_last_incomplete_data_.byteLength);T.set(this.aac_last_incomplete_data_,0),T.set(y,this.aac_last_incomplete_data_.byteLength),y=T}var M,k;if(p!=null&&(k=p/this.timescale_),this.audio_metadata_.codec==="aac"){if(p==null&&this.aac_last_sample_pts_!=null)M=1024/this.audio_metadata_.sampling_frequency*1e3,k=this.aac_last_sample_pts_+M;else if(p==null)return void a.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.aac_last_sample_pts_){M=1024/this.audio_metadata_.sampling_frequency*1e3;var F=this.aac_last_sample_pts_+M;Math.abs(F-k)>1&&(a.a.w(this.TAG,"AAC: Detected pts overlapped, expected: "+F+"ms, PES pts: "+k+"ms"),k=F)}}for(var H,z=new Rt(y),K=null,Z=k;(K=z.readNextAACFrame())!=null;){M=1024/K.sampling_frequency*1e3;var Y={codec:"aac",data:K};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:K.audio_object_type,sampling_freq_index:K.sampling_freq_index,sampling_frequency:K.sampling_frequency,channel_config:K.channel_config},this.dispatchAudioInitSegment(Y)):this.detectAudioMetadataChange(Y)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(Y)),H=Z;var q=Math.floor(Z),et={unit:K.data,length:K.data.byteLength,pts:q,dts:q};this.audio_track_.samples.push(et),this.audio_track_.length+=K.data.byteLength,Z+=M}z.hasIncompleteData()&&(this.aac_last_incomplete_data_=z.getIncompleteData()),H&&(this.aac_last_sample_pts_=H)}},g.prototype.parseMP3Payload=function(y,p){if(!this.has_video_||this.video_init_segment_dispatched_){var T=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],M=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],k=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],F=y[1]>>>3&3,H=(6&y[1])>>1,z=(240&y[2])>>>4,K=(12&y[2])>>>2,Z=(y[3]>>>6&3)!==3?2:1,Y=0,q=34;switch(F){case 0:Y=[11025,12e3,8e3,0][K];break;case 2:Y=[22050,24e3,16e3,0][K];break;case 3:Y=[44100,48e3,32e3,0][K]}switch(H){case 1:q=34,z<k.length&&k[z];break;case 2:q=33,z<M.length&&M[z];break;case 3:q=32,z<T.length&&T[z]}var et=new Hi;et.object_type=q,et.sample_rate=Y,et.channel_count=Z,et.data=y;var dt={codec:"mp3",data:et};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"mp3",object_type:q,sample_rate:Y,channel_count:Z},this.dispatchAudioInitSegment(dt)):this.detectAudioMetadataChange(dt)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(dt));var st={unit:y,length:y.byteLength,pts:p/this.timescale_,dts:p/this.timescale_};this.audio_track_.samples.push(st),this.audio_track_.length+=y.byteLength}},g.prototype.detectAudioMetadataChange=function(y){if(y.codec!==this.audio_metadata_.codec)return a.a.v(this.TAG,"Audio: Audio Codecs changed from "+this.audio_metadata_.codec+" to "+y.codec),!0;if(y.codec==="aac"&&this.audio_metadata_.codec==="aac"){var p=y.data;if(p.audio_object_type!==this.audio_metadata_.audio_object_type)return a.a.v(this.TAG,"AAC: AudioObjectType changed from "+this.audio_metadata_.audio_object_type+" to "+p.audio_object_type),!0;if(p.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return a.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+this.audio_metadata_.sampling_freq_index+" to "+p.sampling_freq_index),!0;if(p.channel_config!==this.audio_metadata_.channel_config)return a.a.v(this.TAG,"AAC: Channel configuration changed from "+this.audio_metadata_.channel_config+" to "+p.channel_config),!0}else if(y.codec==="mp3"&&this.audio_metadata_.codec==="mp3"){var T=y.data;if(T.object_type!==this.audio_metadata_.object_type)return a.a.v(this.TAG,"MP3: AudioObjectType changed from "+this.audio_metadata_.object_type+" to "+T.object_type),!0;if(T.sample_rate!==this.audio_metadata_.sample_rate)return a.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+this.audio_metadata_.sample_rate+" to "+T.sample_rate),!0;if(T.channel_count!==this.audio_metadata_.channel_count)return a.a.v(this.TAG,"MP3: Channel count changed from "+this.audio_metadata_.channel_count+" to "+T.channel_count),!0}return!1},g.prototype.dispatchAudioInitSegment=function(y){var p={type:"audio"};if(p.id=this.audio_track_.id,p.timescale=1e3,p.duration=this.duration_,this.audio_metadata_.codec==="aac"){var T=y.data,M=new tt(T);p.audioSampleRate=M.sampling_rate,p.channelCount=M.channel_count,p.codec=M.codec_mimetype,p.originalCodec=M.original_codec_mimetype,p.config=M.config}else this.audio_metadata_.codec==="mp3"&&(p.audioSampleRate=this.audio_metadata_.sample_rate,p.channelCount=this.audio_metadata_.channel_count,p.codec="mp3",p.originalCodec="mp3",p.config=void 0);p.refSampleDuration=1024/p.audioSampleRate*p.timescale,this.audio_init_segment_dispatched_==0&&a.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: "+p.codec),this.onTrackMetadata("audio",p),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var k=this.media_info_;k.hasAudio=!0,k.audioCodec=p.originalCodec,k.audioSampleRate=p.audioSampleRate,k.audioChannelCount=p.channelCount,k.hasVideo&&k.videoCodec?k.mimeType='video/mp2t; codecs="'+k.videoCodec+","+k.audioCodec+'"':k.mimeType='video/mp2t; codecs="'+k.audioCodec+'"',k.isComplete()&&this.onMediaInfo(k)},g.prototype.dispatchPESPrivateDataDescriptor=function(y,p,T){var M=new ft;M.pid=y,M.stream_type=p,M.descriptor=T,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(M)},g.prototype.parsePESPrivateDataPayload=function(y,p,T,M,k){var F=new at;if(F.pid=M,F.stream_id=k,F.len=y.byteLength,F.data=y,p!=null){var H=Math.floor(p/this.timescale_);F.pts=H}else F.nearest_pts=this.aac_last_sample_pts_;if(T!=null){var z=Math.floor(T/this.timescale_);F.dts=z}this.onPESPrivateData&&this.onPESPrivateData(F)},g.prototype.parseTimedID3MetadataPayload=function(y,p,T,M,k){var F=new at;if(F.pid=M,F.stream_id=k,F.len=y.byteLength,F.data=y,p!=null){var H=Math.floor(p/this.timescale_);F.pts=H}if(T!=null){var z=Math.floor(T/this.timescale_);F.dts=z}this.onTimedID3Metadata&&this.onTimedID3Metadata(F)},g.prototype.parseSMPTE2038MetadataPayload=function(y,p,T,M,k){var F=new zi;if(F.pid=M,F.stream_id=k,F.len=y.byteLength,F.data=y,p!=null){var H=Math.floor(p/this.timescale_);F.pts=H}if(F.nearest_pts=this.aac_last_sample_pts_,T!=null){var z=Math.floor(T/this.timescale_);F.dts=z}F.ancillaries=function(K){for(var Z=new E(K),Y=0,q=[];Y+=6,Z.readBits(6)===0;){var et=Z.readBool();Y+=1;var dt=Z.readBits(11);Y+=11;var st=Z.readBits(12);Y+=12;var mt=255&Z.readBits(10);Y+=10;var gt=255&Z.readBits(10);Y+=10;var ht=255&Z.readBits(10);Y+=10;for(var It=new Uint8Array(ht),pt=0;pt<ht;pt++){var ct=255&Z.readBits(10);Y+=10,It[pt]=ct}Z.readBits(10),Y+=10;var St="User Defined";mt===65?gt===7&&(St="SCTE-104"):mt===95?gt===220?St="ARIB STD-B37 (1SEG)":gt===221?St="ARIB STD-B37 (ANALOG)":gt===222?St="ARIB STD-B37 (SD)":gt===223&&(St="ARIB STD-B37 (HD)"):mt===97&&(gt===1?St="EIA-708":gt===2&&(St="EIA-608")),q.push({yc_indicator:et,line_number:dt,horizontal_offset:st,did:mt,sdid:gt,user_data:It,description:St,information:{}}),Z.readBits(8-(Y-Math.floor(Y/8))%8),Y+=(8-(Y-Math.floor(Y/8)))%8}return Z.destroy(),Z=null,q}(y),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(F)},g}(A),xi=function(){function v(){}return v.init=function(){for(var g in v.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]},v.types)v.types.hasOwnProperty(g)&&(v.types[g]=[g.charCodeAt(0),g.charCodeAt(1),g.charCodeAt(2),g.charCodeAt(3)]);var y=v.constants={};y.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),y.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),y.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),y.STSC=y.STCO=y.STTS,y.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),y.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),y.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),y.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),y.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),y.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},v.box=function(g){for(var y=8,p=null,T=Array.prototype.slice.call(arguments,1),M=T.length,k=0;k<M;k++)y+=T[k].byteLength;(p=new Uint8Array(y))[0]=y>>>24&255,p[1]=y>>>16&255,p[2]=y>>>8&255,p[3]=255&y,p.set(g,4);var F=8;for(k=0;k<M;k++)p.set(T[k],F),F+=T[k].byteLength;return p},v.generateInitSegment=function(g){var y=v.box(v.types.ftyp,v.constants.FTYP),p=v.moov(g),T=new Uint8Array(y.byteLength+p.byteLength);return T.set(y,0),T.set(p,y.byteLength),T},v.moov=function(g){var y=v.mvhd(g.timescale,g.duration),p=v.trak(g),T=v.mvex(g);return v.box(v.types.moov,y,p,T)},v.mvhd=function(g,y){return v.box(v.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,g>>>24&255,g>>>16&255,g>>>8&255,255&g,y>>>24&255,y>>>16&255,y>>>8&255,255&y,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},v.trak=function(g){return v.box(v.types.trak,v.tkhd(g),v.mdia(g))},v.tkhd=function(g){var y=g.id,p=g.duration,T=g.presentWidth,M=g.presentHeight;return v.box(v.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,255&y,0,0,0,0,p>>>24&255,p>>>16&255,p>>>8&255,255&p,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,T>>>8&255,255&T,0,0,M>>>8&255,255&M,0,0]))},v.mdia=function(g){return v.box(v.types.mdia,v.mdhd(g),v.hdlr(g),v.minf(g))},v.mdhd=function(g){var y=g.timescale,p=g.duration;return v.box(v.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,255&y,p>>>24&255,p>>>16&255,p>>>8&255,255&p,85,196,0,0]))},v.hdlr=function(g){var y=null;return y=g.type==="audio"?v.constants.HDLR_AUDIO:v.constants.HDLR_VIDEO,v.box(v.types.hdlr,y)},v.minf=function(g){var y=null;return y=g.type==="audio"?v.box(v.types.smhd,v.constants.SMHD):v.box(v.types.vmhd,v.constants.VMHD),v.box(v.types.minf,y,v.dinf(),v.stbl(g))},v.dinf=function(){return v.box(v.types.dinf,v.box(v.types.dref,v.constants.DREF))},v.stbl=function(g){return v.box(v.types.stbl,v.stsd(g),v.box(v.types.stts,v.constants.STTS),v.box(v.types.stsc,v.constants.STSC),v.box(v.types.stsz,v.constants.STSZ),v.box(v.types.stco,v.constants.STCO))},v.stsd=function(g){return g.type==="audio"?g.codec==="mp3"?v.box(v.types.stsd,v.constants.STSD_PREFIX,v.mp3(g)):v.box(v.types.stsd,v.constants.STSD_PREFIX,v.mp4a(g)):g.type==="video"&&g.codec.startsWith("hvc1")?v.box(v.types.stsd,v.constants.STSD_PREFIX,v.hvc1(g)):v.box(v.types.stsd,v.constants.STSD_PREFIX,v.avc1(g))},v.mp3=function(g){var y=g.channelCount,p=g.audioSampleRate,T=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,y,0,16,0,0,0,0,p>>>8&255,255&p,0,0]);return v.box(v.types[".mp3"],T)},v.mp4a=function(g){var y=g.channelCount,p=g.audioSampleRate,T=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,y,0,16,0,0,0,0,p>>>8&255,255&p,0,0]);return v.box(v.types.mp4a,T,v.esds(g))},v.esds=function(g){var y=g.config||[],p=y.length,T=new Uint8Array([0,0,0,0,3,23+p,0,1,0,4,15+p,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([p]).concat(y).concat([6,1,2]));return v.box(v.types.esds,T)},v.avc1=function(g){var y=g.avcc,p=g.codecWidth,T=g.codecHeight,M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>>8&255,255&p,T>>>8&255,255&T,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return v.box(v.types.avc1,M,v.box(v.types.avcC,y))},v.hvc1=function(g){var y=g.hvcc,p=g.codecWidth,T=g.codecHeight,M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>>8&255,255&p,T>>>8&255,255&T,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return v.box(v.types.hvc1,M,v.box(v.types.hvcC,y))},v.mvex=function(g){return v.box(v.types.mvex,v.trex(g))},v.trex=function(g){var y=g.id,p=new Uint8Array([0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,255&y,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return v.box(v.types.trex,p)},v.moof=function(g,y){return v.box(v.types.moof,v.mfhd(g.sequenceNumber),v.traf(g,y))},v.mfhd=function(g){var y=new Uint8Array([0,0,0,0,g>>>24&255,g>>>16&255,g>>>8&255,255&g]);return v.box(v.types.mfhd,y)},v.traf=function(g,y){var p=g.id,T=v.box(v.types.tfhd,new Uint8Array([0,0,0,0,p>>>24&255,p>>>16&255,p>>>8&255,255&p])),M=v.box(v.types.tfdt,new Uint8Array([0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,255&y])),k=v.sdtp(g),F=v.trun(g,k.byteLength+16+16+8+16+8+8);return v.box(v.types.traf,T,M,F,k)},v.sdtp=function(g){for(var y=g.samples||[],p=y.length,T=new Uint8Array(4+p),M=0;M<p;M++){var k=y[M].flags;T[M+4]=k.isLeading<<6|k.dependsOn<<4|k.isDependedOn<<2|k.hasRedundancy}return v.box(v.types.sdtp,T)},v.trun=function(g,y){var p=g.samples||[],T=p.length,M=12+16*T,k=new Uint8Array(M);y+=8+M,k.set([0,0,15,1,T>>>24&255,T>>>16&255,T>>>8&255,255&T,y>>>24&255,y>>>16&255,y>>>8&255,255&y],0);for(var F=0;F<T;F++){var H=p[F].duration,z=p[F].size,K=p[F].flags,Z=p[F].cts;k.set([H>>>24&255,H>>>16&255,H>>>8&255,255&H,z>>>24&255,z>>>16&255,z>>>8&255,255&z,K.isLeading<<2|K.dependsOn,K.isDependedOn<<6|K.hasRedundancy<<4|K.isNonSync,0,0,Z>>>24&255,Z>>>16&255,Z>>>8&255,255&Z],12+16*F)}return v.box(v.types.trun,k)},v.mdat=function(g){return v.box(v.types.mdat,g)},v}();xi.init();var $e=xi,Si=function(){function v(){}return v.getSilentFrame=function(g,y){if(g==="mp4a.40.2"){if(y===1)return new Uint8Array([0,200,0,128,35,128]);if(y===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(y===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(y===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(y===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(y===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(y===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(y===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(y===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},v}(),_e=s(7),Ct=function(){function v(g){this.TAG="MP4Remuxer",this._config=g,this._isLive=g.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new _e.c("audio"),this._videoSegmentInfoList=new _e.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!l.a.chrome||!(l.a.version.major<50||l.a.version.major===50&&l.a.version.build<2661)),this._fillSilentAfterSeek=l.a.msedge||l.a.msie,this._mp3UseMpegAudio=!l.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return v.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},v.prototype.bindDataSource=function(g){return g.onDataAvailable=this.remux.bind(this),g.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(v.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(g){this._onInitSegment=g},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(g){this._onMediaSegment=g},enumerable:!1,configurable:!0}),v.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},v.prototype.seek=function(g){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},v.prototype.remux=function(g,y){if(!this._onMediaSegment)throw new f.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(g,y),y&&this._remuxVideo(y),g&&this._remuxAudio(g)},v.prototype._onTrackMetadataReceived=function(g,y){var p=null,T="mp4",M=y.codec;if(g==="audio")this._audioMeta=y,y.codec==="mp3"&&this._mp3UseMpegAudio?(T="mpeg",M="",p=new Uint8Array):p=$e.generateInitSegment(y);else{if(g!=="video")return;this._videoMeta=y,p=$e.generateInitSegment(y)}if(!this._onInitSegment)throw new f.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(g,{type:g,data:p.buffer,codec:M,container:g+"/"+T,mediaDuration:y.duration})},v.prototype._calculateDtsBase=function(g,y){this._dtsBaseInited||(g&&g.samples&&g.samples.length&&(this._audioDtsBase=g.samples[0].dts),y&&y.samples&&y.samples.length&&(this._videoDtsBase=y.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},v.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},v.prototype.flushStashedSamples=function(){var g=this._videoStashedLastSample,y=this._audioStashedLastSample,p={type:"video",id:1,sequenceNumber:0,samples:[],length:0};g!=null&&(p.samples.push(g),p.length=g.length);var T={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};y!=null&&(T.samples.push(y),T.length=y.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(p,!0),this._remuxAudio(T,!0)},v.prototype._remuxAudio=function(g,y){if(this._audioMeta!=null){var p,T=g,M=T.samples,k=void 0,F=-1,H=this._audioMeta.refSampleDuration,z=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,K=this._dtsBaseInited&&this._audioNextDts===void 0,Z=!1;if(M&&M.length!==0&&(M.length!==1||y)){var Y=0,q=null,et=0;z?(Y=0,et=T.length):(Y=8,et=8+T.length);var dt=null;if(M.length>1&&(et-=(dt=M.pop()).length),this._audioStashedLastSample!=null){var st=this._audioStashedLastSample;this._audioStashedLastSample=null,M.unshift(st),et+=st.length}dt!=null&&(this._audioStashedLastSample=dt);var mt=M[0].dts-this._dtsBase;if(this._audioNextDts)k=mt-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())k=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(Z=!0);else{var gt=this._audioSegmentInfoList.getLastSampleBefore(mt);if(gt!=null){var ht=mt-(gt.originalDts+gt.duration);ht<=3&&(ht=0),k=mt-(gt.dts+gt.duration+ht)}else k=0}if(Z){var It=mt-k,pt=this._videoSegmentInfoList.getLastSegmentBefore(mt);if(pt!=null&&pt.beginDts<It){if(se=Si.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var ct=pt.beginDts,St=It-pt.beginDts;a.a.v(this.TAG,"InsertPrefixSilentAudio: dts: "+ct+", duration: "+St),M.unshift({unit:se,dts:ct,pts:ct}),et+=se.byteLength}}else Z=!1}for(var kt=[],Yt=0;Yt<M.length;Yt++){var Dt=(st=M[Yt]).unit,Nt=st.dts-this._dtsBase,Bt=(ct=Nt,!1),Lt=null,Ot=0;if(!(Nt<-.001)){if(this._audioMeta.codec!=="mp3"){var Kt=Nt;if(this._audioNextDts&&(Kt=this._audioNextDts),(k=Nt-Kt)<=-3*H){a.a.w(this.TAG,"Dropping 1 audio frame (originalDts: "+Nt+" ms ,curRefDts: "+Kt+" ms)  due to dtsCorrection: "+k+" ms overlap.");continue}if(k>=3*H&&this._fillAudioTimestampGap&&!l.a.safari){Bt=!0;var se,ze=Math.floor(k/H);a.a.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
originalDts: `+Nt+" ms, curRefDts: "+Kt+" ms, dtsCorrection: "+Math.round(k)+" ms, generate: "+ze+" frames"),ct=Math.floor(Kt),Ot=Math.floor(Kt+H)-ct,(se=Si.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))==null&&(a.a.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),se=Dt),Lt=[];for(var ve=0;ve<ze;ve++){Kt+=H;var Vt=Math.floor(Kt),ri=Math.floor(Kt+H)-Vt,He={dts:Vt,pts:Vt,cts:0,unit:se,size:se.byteLength,duration:ri,originalDts:Nt,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};Lt.push(He),et+=He.size}this._audioNextDts=Kt+H}else ct=Math.floor(Kt),Ot=Math.floor(Kt+H)-ct,this._audioNextDts=Kt+H}else ct=Nt-k,Yt!==M.length-1?Ot=M[Yt+1].dts-this._dtsBase-k-ct:dt!=null?Ot=dt.dts-this._dtsBase-k-ct:Ot=kt.length>=1?kt[kt.length-1].duration:Math.floor(H),this._audioNextDts=ct+Ot;F===-1&&(F=ct),kt.push({dts:ct,pts:ct,cts:0,unit:st.unit,size:st.unit.byteLength,duration:Ot,originalDts:Nt,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Bt&&kt.push.apply(kt,Lt)}}if(kt.length===0)return T.samples=[],void(T.length=0);for(z?q=new Uint8Array(et):((q=new Uint8Array(et))[0]=et>>>24&255,q[1]=et>>>16&255,q[2]=et>>>8&255,q[3]=255&et,q.set($e.types.mdat,4)),Yt=0;Yt<kt.length;Yt++)Dt=kt[Yt].unit,q.set(Dt,Y),Y+=Dt.byteLength;var oe=kt[kt.length-1];p=oe.dts+oe.duration;var te=new _e.b;te.beginDts=F,te.endDts=p,te.beginPts=F,te.endPts=p,te.originalBeginDts=kt[0].originalDts,te.originalEndDts=oe.originalDts+oe.duration,te.firstSample=new _e.d(kt[0].dts,kt[0].pts,kt[0].duration,kt[0].originalDts,!1),te.lastSample=new _e.d(oe.dts,oe.pts,oe.duration,oe.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(te),T.samples=kt,T.sequenceNumber++;var Ye=null;Ye=z?new Uint8Array:$e.moof(T,F),T.samples=[],T.length=0;var Be={type:"audio",data:this._mergeBoxes(Ye,q).buffer,sampleCount:kt.length,info:te};z&&K&&(Be.timestampOffset=F),this._onMediaSegment("audio",Be)}}},v.prototype._remuxVideo=function(g,y){if(this._videoMeta!=null){var p,T,M=g,k=M.samples,F=void 0,H=-1,z=-1;if(k&&k.length!==0&&(k.length!==1||y)){var K=8,Z=null,Y=8+g.length,q=null;if(k.length>1&&(Y-=(q=k.pop()).length),this._videoStashedLastSample!=null){var et=this._videoStashedLastSample;this._videoStashedLastSample=null,k.unshift(et),Y+=et.length}q!=null&&(this._videoStashedLastSample=q);var dt=k[0].dts-this._dtsBase;if(this._videoNextDts)F=dt-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())F=0;else{var st=this._videoSegmentInfoList.getLastSampleBefore(dt);if(st!=null){var mt=dt-(st.originalDts+st.duration);mt<=3&&(mt=0),F=dt-(st.dts+st.duration+mt)}else F=0}for(var gt=new _e.b,ht=[],It=0;It<k.length;It++){var pt=(et=k[It]).dts-this._dtsBase,ct=et.isKeyframe,St=pt-F,kt=et.cts,Yt=St+kt;H===-1&&(H=St,z=Yt);var Dt=0;if(It!==k.length-1?Dt=k[It+1].dts-this._dtsBase-F-St:q!=null?Dt=q.dts-this._dtsBase-F-St:Dt=ht.length>=1?ht[ht.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),ct){var Nt=new _e.d(St,Yt,Dt,et.dts,!0);Nt.fileposition=et.fileposition,gt.appendSyncPoint(Nt)}ht.push({dts:St,pts:Yt,cts:kt,units:et.units,size:et.length,isKeyframe:ct,duration:Dt,originalDts:pt,flags:{isLeading:0,dependsOn:ct?2:1,isDependedOn:ct?1:0,hasRedundancy:0,isNonSync:ct?0:1}})}for((Z=new Uint8Array(Y))[0]=Y>>>24&255,Z[1]=Y>>>16&255,Z[2]=Y>>>8&255,Z[3]=255&Y,Z.set($e.types.mdat,4),It=0;It<ht.length;It++)for(var Bt=ht[It].units;Bt.length;){var Lt=Bt.shift().data;Z.set(Lt,K),K+=Lt.byteLength}var Ot=ht[ht.length-1];if(p=Ot.dts+Ot.duration,T=Ot.pts+Ot.duration,this._videoNextDts=p,gt.beginDts=H,gt.endDts=p,gt.beginPts=z,gt.endPts=T,gt.originalBeginDts=ht[0].originalDts,gt.originalEndDts=Ot.originalDts+Ot.duration,gt.firstSample=new _e.d(ht[0].dts,ht[0].pts,ht[0].duration,ht[0].originalDts,ht[0].isKeyframe),gt.lastSample=new _e.d(Ot.dts,Ot.pts,Ot.duration,Ot.originalDts,Ot.isKeyframe),this._isLive||this._videoSegmentInfoList.append(gt),M.samples=ht,M.sequenceNumber++,this._forceFirstIDR){var Kt=ht[0].flags;Kt.dependsOn=2,Kt.isNonSync=0}var se=$e.moof(M,H);M.samples=[],M.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(se,Z).buffer,sampleCount:ht.length,info:gt})}}},v.prototype._mergeBoxes=function(g,y){var p=new Uint8Array(g.byteLength+y.byteLength);return p.set(g,0),p.set(y,g.byteLength),p},v}(),aa=s(11),Jt=s(1),oa=function(){function v(g,y){this.TAG="TransmuxingController",this._emitter=new n.a,this._config=y,g.segments||(g.segments=[{duration:g.duration,filesize:g.filesize,url:g.url}]),typeof g.cors!="boolean"&&(g.cors=!0),typeof g.withCredentials!="boolean"&&(g.withCredentials=!1),this._mediaDataSource=g,this._currentSegmentIndex=0;var p=0;this._mediaDataSource.segments.forEach(function(T){T.timestampBase=p,p+=T.duration,T.cors=g.cors,T.withCredentials=g.withCredentials,y.referrerPolicy&&(T.referrerPolicy=y.referrerPolicy)}),isNaN(p)||this._mediaDataSource.duration===p||(this._mediaDataSource.duration=p),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return v.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},v.prototype.on=function(g,y){this._emitter.addListener(g,y)},v.prototype.off=function(g,y){this._emitter.removeListener(g,y)},v.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},v.prototype._loadSegment=function(g,y){this._currentSegmentIndex=g;var p=this._mediaDataSource.segments[g],T=this._ioctl=new aa.a(p,this._config,g);T.onError=this._onIOException.bind(this),T.onSeeked=this._onIOSeeked.bind(this),T.onComplete=this._onIOComplete.bind(this),T.onRedirect=this._onIORedirect.bind(this),T.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),y?this._demuxer.bindDataSource(this._ioctl):T.onDataArrival=this._onInitChunkArrival.bind(this),T.open(y)},v.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},v.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},v.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},v.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},v.prototype.seek=function(g){if(this._mediaInfo!=null&&this._mediaInfo.isSeekable()){var y=this._searchSegmentIndexContains(g);if(y===this._currentSegmentIndex){var p=this._mediaInfo.segments[y];if(p==null)this._pendingSeekTime=g;else{var T=p.getNearestKeyframe(g);this._remuxer.seek(T.milliseconds),this._ioctl.seek(T.fileposition),this._pendingResolveSeekPoint=T.milliseconds}}else{var M=this._mediaInfo.segments[y];M==null?(this._pendingSeekTime=g,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(y)):(T=M.getNearestKeyframe(g),this._internalAbort(),this._remuxer.seek(g),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[y].timestampBase,this._loadSegment(y,T.fileposition),this._pendingResolveSeekPoint=T.milliseconds,this._reportSegmentMediaInfo(y))}this._enableStatisticsReporter()}},v.prototype._searchSegmentIndexContains=function(g){for(var y=this._mediaDataSource.segments,p=y.length-1,T=0;T<y.length;T++)if(g<y[T].timestampBase){p=T-1;break}return p},v.prototype._onInitChunkArrival=function(g,y){var p=this,T=0;if(y>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,T=this._demuxer.parseChunks(g,y);else{var M=null;(M=L.probe(g)).match&&(this._setupFLVDemuxerRemuxer(M),T=this._demuxer.parseChunks(g,y)),M.match||M.needMoreData||(M=Ei.probe(g)).match&&(this._setupTSDemuxerRemuxer(M),T=this._demuxer.parseChunks(g,y)),M.match||M.needMoreData||(M=null,a.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then(function(){p._internalAbort()}),this._emitter.emit(Jt.a.DEMUX_ERROR,O.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return T},v.prototype._setupFLVDemuxerRemuxer=function(g){this._demuxer=new L(g,this._config),this._remuxer||(this._remuxer=new Ct(this._config));var y=this._mediaDataSource;y.duration==null||isNaN(y.duration)||(this._demuxer.overridedDuration=y.duration),typeof y.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=y.hasAudio),typeof y.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=y.hasVideo),this._demuxer.timestampBase=y.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},v.prototype._setupTSDemuxerRemuxer=function(g){var y=this._demuxer=new Ei(g,this._config);this._remuxer||(this._remuxer=new Ct(this._config)),y.onError=this._onDemuxException.bind(this),y.onMediaInfo=this._onMediaInfo.bind(this),y.onMetaDataArrived=this._onMetaDataArrived.bind(this),y.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),y.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),y.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),y.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),y.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},v.prototype._onMediaInfo=function(g){var y=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},g),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,o.a.prototype));var p=Object.assign({},g);Object.setPrototypeOf(p,o.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=p,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var T=y._pendingSeekTime;y._pendingSeekTime=null,y.seek(T)})},v.prototype._onMetaDataArrived=function(g){this._emitter.emit(Jt.a.METADATA_ARRIVED,g)},v.prototype._onScriptDataArrived=function(g){this._emitter.emit(Jt.a.SCRIPTDATA_ARRIVED,g)},v.prototype._onTimedID3Metadata=function(g){var y=this._remuxer.getTimestampBase();y!=null&&(g.pts!=null&&(g.pts-=y),g.dts!=null&&(g.dts-=y),this._emitter.emit(Jt.a.TIMED_ID3_METADATA_ARRIVED,g))},v.prototype._onSMPTE2038Metadata=function(g){var y=this._remuxer.getTimestampBase();y!=null&&(g.pts!=null&&(g.pts-=y),g.dts!=null&&(g.dts-=y),g.nearest_pts!=null&&(g.nearest_pts-=y),this._emitter.emit(Jt.a.SMPTE2038_METADATA_ARRIVED,g))},v.prototype._onSCTE35Metadata=function(g){var y=this._remuxer.getTimestampBase();y!=null&&(g.pts!=null&&(g.pts-=y),g.nearest_pts!=null&&(g.nearest_pts-=y),this._emitter.emit(Jt.a.SCTE35_METADATA_ARRIVED,g))},v.prototype._onPESPrivateDataDescriptor=function(g){this._emitter.emit(Jt.a.PES_PRIVATE_DATA_DESCRIPTOR,g)},v.prototype._onPESPrivateData=function(g){var y=this._remuxer.getTimestampBase();y!=null&&(g.pts!=null&&(g.pts-=y),g.nearest_pts!=null&&(g.nearest_pts-=y),g.dts!=null&&(g.dts-=y),this._emitter.emit(Jt.a.PES_PRIVATE_DATA_ARRIVED,g))},v.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},v.prototype._onIOComplete=function(g){var y=g+1;y<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(y)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(Jt.a.LOADING_COMPLETE),this._disableStatisticsReporter())},v.prototype._onIORedirect=function(g){var y=this._ioctl.extraData;this._mediaDataSource.segments[y].redirectedURL=g},v.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(Jt.a.RECOVERED_EARLY_EOF)},v.prototype._onIOException=function(g,y){a.a.e(this.TAG,"IOException: type = "+g+", code = "+y.code+", msg = "+y.msg),this._emitter.emit(Jt.a.IO_ERROR,g,y),this._disableStatisticsReporter()},v.prototype._onDemuxException=function(g,y){a.a.e(this.TAG,"DemuxException: type = "+g+", info = "+y),this._emitter.emit(Jt.a.DEMUX_ERROR,g,y)},v.prototype._onRemuxerInitSegmentArrival=function(g,y){this._emitter.emit(Jt.a.INIT_SEGMENT,g,y)},v.prototype._onRemuxerMediaSegmentArrival=function(g,y){if(this._pendingSeekTime==null&&(this._emitter.emit(Jt.a.MEDIA_SEGMENT,g,y),this._pendingResolveSeekPoint!=null&&g==="video")){var p=y.info.syncPoints,T=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,l.a.safari&&p.length>0&&p[0].originalDts===T&&(T=p[0].pts),this._emitter.emit(Jt.a.RECOMMEND_SEEKPOINT,T)}},v.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},v.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},v.prototype._reportSegmentMediaInfo=function(g){var y=this._mediaInfo.segments[g],p=Object.assign({},y);p.duration=this._mediaInfo.duration,p.segmentCount=this._mediaInfo.segmentCount,delete p.segments,delete p.keyframesIndex,this._emitter.emit(Jt.a.MEDIA_INFO,p)},v.prototype._reportStatisticsInfo=function(){var g={};g.url=this._ioctl.currentURL,g.hasRedirect=this._ioctl.hasRedirect,g.hasRedirect&&(g.redirectedURL=this._ioctl.currentRedirectedURL),g.speed=this._ioctl.currentSpeed,g.loaderType=this._ioctl.loaderType,g.currentSegmentIndex=this._currentSegmentIndex,g.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(Jt.a.STATISTICS_INFO,g)},v}();i.a=oa},function(e,i,s){var r,n=s(0),a=function(){function C(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return C.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},C.prototype.addBytes=function(b){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=b,this._totalBytes+=b):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=b,this._totalBytes+=b):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=b,this._totalBytes+=b,this._lastCheckpoint=this._now())},Object.defineProperty(C.prototype,"currentKBps",{get:function(){this.addBytes(0);var b=(this._now()-this._lastCheckpoint)/1e3;return b==0&&(b=1),this._intervalBytes/b/1024},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"averageKBps",{get:function(){var b=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/b/1024},enumerable:!1,configurable:!0}),C}(),l=s(2),o=s(4),c=s(3),u=(r=function(C,b){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,L){S.__proto__=L}||function(S,L){for(var A in L)L.hasOwnProperty(A)&&(S[A]=L[A])})(C,b)},function(C,b){function S(){this.constructor=C}r(C,b),C.prototype=b===null?Object.create(b):(S.prototype=b.prototype,new S)}),h=function(C){function b(S,L){var A=C.call(this,"fetch-stream-loader")||this;return A.TAG="FetchStreamLoader",A._seekHandler=S,A._config=L,A._needStash=!0,A._requestAbort=!1,A._abortController=null,A._contentLength=null,A._receivedLength=0,A}return u(b,C),b.isSupported=function(){try{var S=o.a.msedge&&o.a.version.minor>=15048,L=!o.a.msedge||S;return self.fetch&&self.ReadableStream&&L}catch(A){return!1}},b.prototype.destroy=function(){this.isWorking()&&this.abort(),C.prototype.destroy.call(this)},b.prototype.open=function(S,L){var A=this;this._dataSource=S,this._range=L;var U=S.url;this._config.reuseRedirectedURL&&S.redirectedURL!=null&&(U=S.redirectedURL);var B=this._seekHandler.getConfig(U,L),G=new self.Headers;if(typeof B.headers=="object"){var Q=B.headers;for(var nt in Q)Q.hasOwnProperty(nt)&&G.append(nt,Q[nt])}var ot={method:"GET",headers:G,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var nt in this._config.headers)G.append(nt,this._config.headers[nt]);S.cors===!1&&(ot.mode="same-origin"),S.withCredentials&&(ot.credentials="include"),S.referrerPolicy&&(ot.referrerPolicy=S.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,ot.signal=this._abortController.signal),this._status=l.c.kConnecting,self.fetch(B.url,ot).then(function(V){if(A._requestAbort)return A._status=l.c.kIdle,void V.body.cancel();if(V.ok&&V.status>=200&&V.status<=299){if(V.url!==B.url&&A._onURLRedirect){var R=A._seekHandler.removeURLParameters(V.url);A._onURLRedirect(R)}var N=V.headers.get("Content-Length");return N!=null&&(A._contentLength=parseInt(N),A._contentLength!==0&&A._onContentLengthKnown&&A._onContentLengthKnown(A._contentLength)),A._pump.call(A,V.body.getReader())}if(A._status=l.c.kError,!A._onError)throw new c.d("FetchStreamLoader: Http code invalid, "+V.status+" "+V.statusText);A._onError(l.b.HTTP_STATUS_CODE_INVALID,{code:V.status,msg:V.statusText})}).catch(function(V){if(!A._abortController||!A._abortController.signal.aborted){if(A._status=l.c.kError,!A._onError)throw V;A._onError(l.b.EXCEPTION,{code:-1,msg:V.message})}})},b.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==l.c.kBuffering||!o.a.chrome)&&this._abortController)try{this._abortController.abort()}catch(S){}},b.prototype._pump=function(S){var L=this;return S.read().then(function(A){if(A.done)if(L._contentLength!==null&&L._receivedLength<L._contentLength){L._status=l.c.kError;var U=l.b.EARLY_EOF,B={code:-1,msg:"Fetch stream meet Early-EOF"};if(!L._onError)throw new c.d(B.msg);L._onError(U,B)}else L._status=l.c.kComplete,L._onComplete&&L._onComplete(L._range.from,L._range.from+L._receivedLength-1);else{if(L._abortController&&L._abortController.signal.aborted)return void(L._status=l.c.kComplete);if(L._requestAbort===!0)return L._status=l.c.kComplete,S.cancel();L._status=l.c.kBuffering;var G=A.value.buffer,Q=L._range.from+L._receivedLength;L._receivedLength+=G.byteLength,L._onDataArrival&&L._onDataArrival(G,Q,L._receivedLength),L._pump(S)}}).catch(function(A){if(L._abortController&&L._abortController.signal.aborted)L._status=l.c.kComplete;else if(A.code!==11||!o.a.msedge){L._status=l.c.kError;var U=0,B=null;if(A.code!==19&&A.message!=="network error"||!(L._contentLength===null||L._contentLength!==null&&L._receivedLength<L._contentLength)?(U=l.b.EXCEPTION,B={code:A.code,msg:A.message}):(U=l.b.EARLY_EOF,B={code:A.code,msg:"Fetch stream meet Early-EOF"}),!L._onError)throw new c.d(B.msg);L._onError(U,B)}})},b}(l.a),f=function(){var C=function(b,S){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,A){L.__proto__=A}||function(L,A){for(var U in A)A.hasOwnProperty(U)&&(L[U]=A[U])})(b,S)};return function(b,S){function L(){this.constructor=b}C(b,S),b.prototype=S===null?Object.create(S):(L.prototype=S.prototype,new L)}}(),m=function(C){function b(S,L){var A=C.call(this,"xhr-moz-chunked-loader")||this;return A.TAG="MozChunkedLoader",A._seekHandler=S,A._config=L,A._needStash=!0,A._xhr=null,A._requestAbort=!1,A._contentLength=null,A._receivedLength=0,A}return f(b,C),b.isSupported=function(){try{var S=new XMLHttpRequest;return S.open("GET","https://example.com",!0),S.responseType="moz-chunked-arraybuffer",S.responseType==="moz-chunked-arraybuffer"}catch(L){return n.a.w("MozChunkedLoader",L.message),!1}},b.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),C.prototype.destroy.call(this)},b.prototype.open=function(S,L){this._dataSource=S,this._range=L;var A=S.url;this._config.reuseRedirectedURL&&S.redirectedURL!=null&&(A=S.redirectedURL);var U=this._seekHandler.getConfig(A,L);this._requestURL=U.url;var B=this._xhr=new XMLHttpRequest;if(B.open("GET",U.url,!0),B.responseType="moz-chunked-arraybuffer",B.onreadystatechange=this._onReadyStateChange.bind(this),B.onprogress=this._onProgress.bind(this),B.onloadend=this._onLoadEnd.bind(this),B.onerror=this._onXhrError.bind(this),S.withCredentials&&(B.withCredentials=!0),typeof U.headers=="object"){var G=U.headers;for(var Q in G)G.hasOwnProperty(Q)&&B.setRequestHeader(Q,G[Q])}if(typeof this._config.headers=="object"){G=this._config.headers;for(var Q in G)G.hasOwnProperty(Q)&&B.setRequestHeader(Q,G[Q])}this._status=l.c.kConnecting,B.send()},b.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=l.c.kComplete},b.prototype._onReadyStateChange=function(S){var L=S.target;if(L.readyState===2){if(L.responseURL!=null&&L.responseURL!==this._requestURL&&this._onURLRedirect){var A=this._seekHandler.removeURLParameters(L.responseURL);this._onURLRedirect(A)}if(L.status!==0&&(L.status<200||L.status>299)){if(this._status=l.c.kError,!this._onError)throw new c.d("MozChunkedLoader: Http code invalid, "+L.status+" "+L.statusText);this._onError(l.b.HTTP_STATUS_CODE_INVALID,{code:L.status,msg:L.statusText})}else this._status=l.c.kBuffering}},b.prototype._onProgress=function(S){if(this._status!==l.c.kError){this._contentLength===null&&S.total!==null&&S.total!==0&&(this._contentLength=S.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var L=S.target.response,A=this._range.from+this._receivedLength;this._receivedLength+=L.byteLength,this._onDataArrival&&this._onDataArrival(L,A,this._receivedLength)}},b.prototype._onLoadEnd=function(S){this._requestAbort!==!0?this._status!==l.c.kError&&(this._status=l.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},b.prototype._onXhrError=function(S){this._status=l.c.kError;var L=0,A=null;if(this._contentLength&&S.loaded<this._contentLength?(L=l.b.EARLY_EOF,A={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(L=l.b.EXCEPTION,A={code:-1,msg:S.constructor.name+" "+S.type}),!this._onError)throw new c.d(A.msg);this._onError(L,A)},b}(l.a),_=function(){var C=function(b,S){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,A){L.__proto__=A}||function(L,A){for(var U in A)A.hasOwnProperty(U)&&(L[U]=A[U])})(b,S)};return function(b,S){function L(){this.constructor=b}C(b,S),b.prototype=S===null?Object.create(S):(L.prototype=S.prototype,new L)}}(),E=function(C){function b(S,L){var A=C.call(this,"xhr-range-loader")||this;return A.TAG="RangeLoader",A._seekHandler=S,A._config=L,A._needStash=!1,A._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],A._currentChunkSizeKB=384,A._currentSpeedNormalized=0,A._zeroSpeedChunkCount=0,A._xhr=null,A._speedSampler=new a,A._requestAbort=!1,A._waitForTotalLength=!1,A._totalLengthReceived=!1,A._currentRequestURL=null,A._currentRedirectedURL=null,A._currentRequestRange=null,A._totalLength=null,A._contentLength=null,A._receivedLength=0,A._lastTimeLoaded=0,A}return _(b,C),b.isSupported=function(){try{var S=new XMLHttpRequest;return S.open("GET","https://example.com",!0),S.responseType="arraybuffer",S.responseType==="arraybuffer"}catch(L){return n.a.w("RangeLoader",L.message),!1}},b.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),C.prototype.destroy.call(this)},Object.defineProperty(b.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),b.prototype.open=function(S,L){this._dataSource=S,this._range=L,this._status=l.c.kConnecting;var A=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(A=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||A?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},b.prototype._openSubRange=function(){var S=1024*this._currentChunkSizeKB,L=this._range.from+this._receivedLength,A=L+S;this._contentLength!=null&&A-this._range.from>=this._contentLength&&(A=this._range.from+this._contentLength-1),this._currentRequestRange={from:L,to:A},this._internalOpen(this._dataSource,this._currentRequestRange)},b.prototype._internalOpen=function(S,L){this._lastTimeLoaded=0;var A=S.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?A=this._currentRedirectedURL:S.redirectedURL!=null&&(A=S.redirectedURL));var U=this._seekHandler.getConfig(A,L);this._currentRequestURL=U.url;var B=this._xhr=new XMLHttpRequest;if(B.open("GET",U.url,!0),B.responseType="arraybuffer",B.onreadystatechange=this._onReadyStateChange.bind(this),B.onprogress=this._onProgress.bind(this),B.onload=this._onLoad.bind(this),B.onerror=this._onXhrError.bind(this),S.withCredentials&&(B.withCredentials=!0),typeof U.headers=="object"){var G=U.headers;for(var Q in G)G.hasOwnProperty(Q)&&B.setRequestHeader(Q,G[Q])}if(typeof this._config.headers=="object"){G=this._config.headers;for(var Q in G)G.hasOwnProperty(Q)&&B.setRequestHeader(Q,G[Q])}B.send()},b.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=l.c.kComplete},b.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},b.prototype._onReadyStateChange=function(S){var L=S.target;if(L.readyState===2){if(L.responseURL!=null){var A=this._seekHandler.removeURLParameters(L.responseURL);L.responseURL!==this._currentRequestURL&&A!==this._currentRedirectedURL&&(this._currentRedirectedURL=A,this._onURLRedirect&&this._onURLRedirect(A))}if(L.status>=200&&L.status<=299){if(this._waitForTotalLength)return;this._status=l.c.kBuffering}else{if(this._status=l.c.kError,!this._onError)throw new c.d("RangeLoader: Http code invalid, "+L.status+" "+L.statusText);this._onError(l.b.HTTP_STATUS_CODE_INVALID,{code:L.status,msg:L.statusText})}}},b.prototype._onProgress=function(S){if(this._status!==l.c.kError){if(this._contentLength===null){var L=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,L=!0;var A=S.total;this._internalAbort(),A!=null&A!==0&&(this._totalLength=A)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,L)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var U=S.loaded-this._lastTimeLoaded;this._lastTimeLoaded=S.loaded,this._speedSampler.addBytes(U)}},b.prototype._normalizeSpeed=function(S){var L=this._chunkSizeKBList,A=L.length-1,U=0,B=0,G=A;if(S<L[0])return L[0];for(;B<=G;){if((U=B+Math.floor((G-B)/2))===A||S>=L[U]&&S<L[U+1])return L[U];L[U]<S?B=U+1:G=U-1}},b.prototype._onLoad=function(S){if(this._status!==l.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var L=this._speedSampler.lastSecondKBps;if(L===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(L=this._speedSampler.currentKBps)),L!==0){var A=this._normalizeSpeed(L);this._currentSpeedNormalized!==A&&(this._currentSpeedNormalized=A,this._currentChunkSizeKB=A)}var U=S.target.response,B=this._range.from+this._receivedLength;this._receivedLength+=U.byteLength;var G=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():G=!0,this._onDataArrival&&this._onDataArrival(U,B,this._receivedLength),G&&(this._status=l.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},b.prototype._onXhrError=function(S){this._status=l.c.kError;var L=0,A=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(L=l.b.EARLY_EOF,A={code:-1,msg:"RangeLoader meet Early-Eof"}):(L=l.b.EXCEPTION,A={code:-1,msg:S.constructor.name+" "+S.type}),!this._onError)throw new c.d(A.msg);this._onError(L,A)},b}(l.a),D=function(){var C=function(b,S){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,A){L.__proto__=A}||function(L,A){for(var U in A)A.hasOwnProperty(U)&&(L[U]=A[U])})(b,S)};return function(b,S){function L(){this.constructor=b}C(b,S),b.prototype=S===null?Object.create(S):(L.prototype=S.prototype,new L)}}(),O=function(C){function b(){var S=C.call(this,"websocket-loader")||this;return S.TAG="WebSocketLoader",S._needStash=!0,S._ws=null,S._requestAbort=!1,S._receivedLength=0,S}return D(b,C),b.isSupported=function(){try{return self.WebSocket!==void 0}catch(S){return!1}},b.prototype.destroy=function(){this._ws&&this.abort(),C.prototype.destroy.call(this)},b.prototype.open=function(S){try{var L=this._ws=new self.WebSocket(S.url);L.binaryType="arraybuffer",L.onopen=this._onWebSocketOpen.bind(this),L.onclose=this._onWebSocketClose.bind(this),L.onmessage=this._onWebSocketMessage.bind(this),L.onerror=this._onWebSocketError.bind(this),this._status=l.c.kConnecting}catch(U){this._status=l.c.kError;var A={code:U.code,msg:U.message};if(!this._onError)throw new c.d(A.msg);this._onError(l.b.EXCEPTION,A)}},b.prototype.abort=function(){var S=this._ws;!S||S.readyState!==0&&S.readyState!==1||(this._requestAbort=!0,S.close()),this._ws=null,this._status=l.c.kComplete},b.prototype._onWebSocketOpen=function(S){this._status=l.c.kBuffering},b.prototype._onWebSocketClose=function(S){this._requestAbort!==!0?(this._status=l.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},b.prototype._onWebSocketMessage=function(S){var L=this;if(S.data instanceof ArrayBuffer)this._dispatchArrayBuffer(S.data);else if(S.data instanceof Blob){var A=new FileReader;A.onload=function(){L._dispatchArrayBuffer(A.result)},A.readAsArrayBuffer(S.data)}else{this._status=l.c.kError;var U={code:-1,msg:"Unsupported WebSocket message type: "+S.data.constructor.name};if(!this._onError)throw new c.d(U.msg);this._onError(l.b.EXCEPTION,U)}},b.prototype._dispatchArrayBuffer=function(S){var L=S,A=this._receivedLength;this._receivedLength+=L.byteLength,this._onDataArrival&&this._onDataArrival(L,A,this._receivedLength)},b.prototype._onWebSocketError=function(S){this._status=l.c.kError;var L={code:S.code,msg:S.message};if(!this._onError)throw new c.d(L.msg);this._onError(l.b.EXCEPTION,L)},b}(l.a),I=function(){function C(b){this._zeroStart=b||!1}return C.prototype.getConfig=function(b,S){var L={};if(S.from!==0||S.to!==-1){var A=void 0;A=S.to!==-1?"bytes="+S.from.toString()+"-"+S.to.toString():"bytes="+S.from.toString()+"-",L.Range=A}else this._zeroStart&&(L.Range="bytes=0-");return{url:b,headers:L}},C.prototype.removeURLParameters=function(b){return b},C}(),x=function(){function C(b,S){this._startName=b,this._endName=S}return C.prototype.getConfig=function(b,S){var L=b;if(S.from!==0||S.to!==-1){var A=!0;L.indexOf("?")===-1&&(L+="?",A=!1),A&&(L+="&"),L+=this._startName+"="+S.from.toString(),S.to!==-1&&(L+="&"+this._endName+"="+S.to.toString())}return{url:L,headers:{}}},C.prototype.removeURLParameters=function(b){var S=b.split("?")[0],L=void 0,A=b.indexOf("?");A!==-1&&(L=b.substring(A+1));var U="";if(L!=null&&L.length>0)for(var B=L.split("&"),G=0;G<B.length;G++){var Q=B[G].split("="),nt=G>0;Q[0]!==this._startName&&Q[0]!==this._endName&&(nt&&(U+="&"),U+=B[G])}return U.length===0?S:S+"?"+U},C}(),P=function(){function C(b,S,L){this.TAG="IOController",this._config=S,this._extraData=L,this._stashInitialSize=65536,S.stashInitialSize!=null&&S.stashInitialSize>0&&(this._stashInitialSize=S.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,S.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=b,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(b.url),this._refTotalLength=b.filesize?b.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new a,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return C.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},C.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},C.prototype.isPaused=function(){return this._paused},Object.defineProperty(C.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"extraData",{get:function(){return this._extraData},set:function(b){this._extraData=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(b){this._onDataArrival=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(b){this._onSeeked=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onError",{get:function(){return this._onError},set:function(b){this._onError=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onComplete",{get:function(){return this._onComplete},set:function(b){this._onComplete=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(b){this._onRedirect=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(b){this._onRecoveredEarlyEof=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"currentSpeed",{get:function(){return this._loaderClass===E?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),C.prototype._selectSeekHandler=function(){var b=this._config;if(b.seekType==="range")this._seekHandler=new I(this._config.rangeLoadZeroStart);else if(b.seekType==="param"){var S=b.seekParamStart||"bstart",L=b.seekParamEnd||"bend";this._seekHandler=new x(S,L)}else{if(b.seekType!=="custom")throw new c.b("Invalid seekType in config: "+b.seekType);if(typeof b.customSeekHandler!="function")throw new c.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new b.customSeekHandler}},C.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=O;else if(h.isSupported())this._loaderClass=h;else if(m.isSupported())this._loaderClass=m;else{if(!E.isSupported())throw new c.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=E}},C.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},C.prototype.open=function(b){this._currentRange={from:0,to:-1},b&&(this._currentRange.from=b),this._speedSampler.reset(),b||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},C.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},C.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},C.prototype.resume=function(){if(this._paused){this._paused=!1;var b=this._resumeFrom;this._resumeFrom=0,this._internalSeek(b,!0)}},C.prototype.seek=function(b){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(b,!0)},C.prototype._internalSeek=function(b,S){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(S),this._loader.destroy(),this._loader=null;var L={from:b,to:-1};this._currentRange={from:L.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,L),this._onSeeked&&this._onSeeked()},C.prototype.updateUrl=function(b){if(!b||typeof b!="string"||b.length===0)throw new c.b("Url must be a non-empty string!");this._dataSource.url=b},C.prototype._expandBuffer=function(b){for(var S=this._stashSize;S+1048576<b;)S*=2;if((S+=1048576)!==this._bufferSize){var L=new ArrayBuffer(S);if(this._stashUsed>0){var A=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(L,0,S).set(A,0)}this._stashBuffer=L,this._bufferSize=S}},C.prototype._normalizeSpeed=function(b){var S=this._speedNormalizeList,L=S.length-1,A=0,U=0,B=L;if(b<S[0])return S[0];for(;U<=B;){if((A=U+Math.floor((B-U)/2))===L||b>=S[A]&&b<S[A+1])return S[A];S[A]<b?U=A+1:B=A-1}},C.prototype._adjustStashSize=function(b){var S=0;(S=this._config.isLive?b/8:b<512?b:b>=512&&b<=1024?Math.floor(1.5*b):2*b)>8192&&(S=8192);var L=1024*S+1048576;this._bufferSize<L&&this._expandBuffer(L),this._stashSize=1024*S},C.prototype._dispatchChunks=function(b,S){return this._currentRange.to=S+b.byteLength-1,this._onDataArrival(b,S)},C.prototype._onURLRedirect=function(b){this._redirectedURL=b,this._onRedirect&&this._onRedirect(b)},C.prototype._onContentLengthKnown=function(b){b&&this._fullRequestFlag&&(this._totalLength=b,this._fullRequestFlag=!1)},C.prototype._onLoaderChunkArrival=function(b,S,L){if(!this._onDataArrival)throw new c.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(b.byteLength);var A=this._speedSampler.lastSecondKBps;if(A!==0){var U=this._normalizeSpeed(A);this._speedNormalized!==U&&(this._speedNormalized=U,this._adjustStashSize(U))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=S),this._stashUsed+b.byteLength<=this._stashSize)(Q=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(b),this._stashUsed),this._stashUsed+=b.byteLength;else if(Q=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var B=this._stashBuffer.slice(0,this._stashUsed);(nt=this._dispatchChunks(B,this._stashByteStart))<B.byteLength?nt>0&&(ot=new Uint8Array(B,nt),Q.set(ot,0),this._stashUsed=ot.byteLength,this._stashByteStart+=nt):(this._stashUsed=0,this._stashByteStart+=nt),this._stashUsed+b.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+b.byteLength),Q=new Uint8Array(this._stashBuffer,0,this._bufferSize)),Q.set(new Uint8Array(b),this._stashUsed),this._stashUsed+=b.byteLength}else(nt=this._dispatchChunks(b,S))<b.byteLength&&((G=b.byteLength-nt)>this._bufferSize&&(this._expandBuffer(G),Q=new Uint8Array(this._stashBuffer,0,this._bufferSize)),Q.set(new Uint8Array(b,nt),0),this._stashUsed+=G,this._stashByteStart=S+nt);else if(this._stashUsed===0){var G;(nt=this._dispatchChunks(b,S))<b.byteLength&&((G=b.byteLength-nt)>this._bufferSize&&this._expandBuffer(G),(Q=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(b,nt),0),this._stashUsed+=G,this._stashByteStart=S+nt)}else{var Q,nt;if(this._stashUsed+b.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+b.byteLength),(Q=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(b),this._stashUsed),this._stashUsed+=b.byteLength,(nt=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&nt>0){var ot=new Uint8Array(this._stashBuffer,nt);Q.set(ot,0)}this._stashUsed-=nt,this._stashByteStart+=nt}}},C.prototype._flushStashBuffer=function(b){if(this._stashUsed>0){var S=this._stashBuffer.slice(0,this._stashUsed),L=this._dispatchChunks(S,this._stashByteStart),A=S.byteLength-L;if(L<S.byteLength){if(!b){if(L>0){var U=new Uint8Array(this._stashBuffer,0,this._bufferSize),B=new Uint8Array(S,L);U.set(B,0),this._stashUsed=B.byteLength,this._stashByteStart+=L}return 0}n.a.w(this.TAG,A+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,A}return 0},C.prototype._onLoaderComplete=function(b,S){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},C.prototype._onLoaderError=function(b,S){switch(n.a.e(this.TAG,"Loader error, code = "+S.code+", msg = "+S.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,b=l.b.UNRECOVERABLE_EARLY_EOF),b){case l.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var L=this._currentRange.to+1;return void(L<this._totalLength&&(n.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(L,!1)))}b=l.b.UNRECOVERABLE_EARLY_EOF;break;case l.b.UNRECOVERABLE_EARLY_EOF:case l.b.CONNECTING_TIMEOUT:case l.b.HTTP_STATUS_CODE_INVALID:case l.b.EXCEPTION:}if(!this._onError)throw new c.d("IOException: "+S.msg);this._onError(b,S)},C}();i.a=P},function(e,i,s){var r=function(){function n(){}return n.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(a,l){return a.__proto__=l,a},Object.assign=Object.assign||function(a){if(a==null)throw new TypeError("Cannot convert undefined or null to object");for(var l=Object(a),o=1;o<arguments.length;o++){var c=arguments[o];if(c!=null)for(var u in c)c.hasOwnProperty(u)&&(l[u]=c[u])}return l},typeof self.Promise!="function"&&s(15).polyfill()},n}();r.install(),i.a=r},function(e,i,s){function r(o){var c={};function u(f){if(c[f])return c[f].exports;var m=c[f]={i:f,l:!1,exports:{}};return o[f].call(m.exports,m,m.exports,u),m.l=!0,m.exports}u.m=o,u.c=c,u.i=function(f){return f},u.d=function(f,m,_){u.o(f,m)||Object.defineProperty(f,m,{configurable:!1,enumerable:!0,get:_})},u.r=function(f){Object.defineProperty(f,"__esModule",{value:!0})},u.n=function(f){var m=f&&f.__esModule?function(){return f.default}:function(){return f};return u.d(m,"a",m),m},u.o=function(f,m){return Object.prototype.hasOwnProperty.call(f,m)},u.p="/",u.oe=function(f){throw console.error(f),f};var h=u(u.s=ENTRY_MODULE);return h.default||h}function n(o){return(o+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(o,c,u){var h={};h[u]=[];var f=c.toString(),m=f.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!m)return h;for(var _,E=m[1],D=new RegExp("(\\\\n|\\W)"+n(E)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");_=D.exec(f);)_[3]!=="dll-reference"&&h[u].push(_[3]);for(D=new RegExp("\\("+n(E)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");_=D.exec(f);)o[_[2]]||(h[u].push(_[1]),o[_[2]]=s(_[1]).m),h[_[2]]=h[_[2]]||[],h[_[2]].push(_[4]);for(var O,I=Object.keys(h),x=0;x<I.length;x++)for(var P=0;P<h[I[x]].length;P++)O=h[I[x]][P],isNaN(1*O)||(h[I[x]][P]=1*h[I[x]][P]);return h}function l(o){return Object.keys(o).reduce(function(c,u){return c||o[u].length>0},!1)}e.exports=function(o,c){c=c||{};var u={main:s.m},h=c.all?{main:Object.keys(u.main)}:function(D,O){for(var I={main:[O]},x={main:[]},P={main:{}};l(I);)for(var C=Object.keys(I),b=0;b<C.length;b++){var S=C[b],L=I[S].pop();if(P[S]=P[S]||{},!P[S][L]&&D[S][L]){P[S][L]=!0,x[S]=x[S]||[],x[S].push(L);for(var A=a(D,D[S][L],S),U=Object.keys(A),B=0;B<U.length;B++)I[U[B]]=I[U[B]]||[],I[U[B]]=I[U[B]].concat(A[U[B]])}}return x}(u,o),f="";Object.keys(h).filter(function(D){return D!=="main"}).forEach(function(D){for(var O=0;h[D][O];)O++;h[D].push(O),u[D][O]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",f=f+"var "+D+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(O))+")({"+h[D].map(function(I){return JSON.stringify(I)+": "+u[D][I].toString()}).join(",")+`});
`}),f=f+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+h.main.map(function(D){return JSON.stringify(D)+": "+u.main[D].toString()}).join(",")+"}))(self);";var m=new window.Blob([f],{type:"text/javascript"});if(c.bare)return m;var _=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(m),E=new window.Worker(_);return E.objectURL=_,E}},function(e,i,s){e.exports=s(19).default},function(e,i,s){(function(r,n){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var a;a=function(){function l(tt){return typeof tt=="function"}var o=Array.isArray?Array.isArray:function(tt){return Object.prototype.toString.call(tt)==="[object Array]"},c=0,u=void 0,h=void 0,f=function(tt,at){x[c]=tt,x[c+1]=at,(c+=2)===2&&(h?h(P):A())},m=typeof window!="undefined"?window:void 0,_=m||{},E=_.MutationObserver||_.WebKitMutationObserver,D=typeof self=="undefined"&&r!==void 0&&{}.toString.call(r)==="[object process]",O=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined";function I(){var tt=setTimeout;return function(){return tt(P,1)}}var x=new Array(1e3);function P(){for(var tt=0;tt<c;tt+=2)(0,x[tt])(x[tt+1]),x[tt]=void 0,x[tt+1]=void 0;c=0}var C,b,S,L,A=void 0;function U(tt,at){var ft=this,ut=new this.constructor(Q);ut[G]===void 0&&Tt(ut);var yt=ft._state;if(yt){var At=arguments[yt-1];f(function(){return rt(yt,ut,At,ft._result)})}else j(ft,ut,tt,at);return ut}function B(tt){if(tt&&typeof tt=="object"&&tt.constructor===this)return tt;var at=new this(Q);return ot(at,tt),at}D?A=function(){return r.nextTick(P)}:E?(b=0,S=new E(P),L=document.createTextNode(""),S.observe(L,{characterData:!0}),A=function(){L.data=b=++b%2}):O?((C=new MessageChannel).port1.onmessage=P,A=function(){return C.port2.postMessage(0)}):A=m===void 0?function(){try{var tt=Function("return this")().require("vertx");return(u=tt.runOnLoop||tt.runOnContext)!==void 0?function(){u(P)}:I()}catch(at){return I()}}():I();var G=Math.random().toString(36).substring(2);function Q(){}function nt(tt,at,ft){at.constructor===tt.constructor&&ft===U&&at.constructor.resolve===B?function(ut,yt){yt._state===1?R(ut,yt._result):yt._state===2?N(ut,yt._result):j(yt,void 0,function(At){return ot(ut,At)},function(At){return N(ut,At)})}(tt,at):ft===void 0?R(tt,at):l(ft)?function(ut,yt,At){f(function(jt){var qt=!1,re=function(Xt,ke,Me,Pe){try{Xt.call(ke,Me,Pe)}catch(pe){return pe}}(At,yt,function(Xt){qt||(qt=!0,yt!==Xt?ot(jt,Xt):R(jt,Xt))},function(Xt){qt||(qt=!0,N(jt,Xt))},jt._label);!qt&&re&&(qt=!0,N(jt,re))},ut)}(tt,at,ft):R(tt,at)}function ot(tt,at){if(tt===at)N(tt,new TypeError("You cannot resolve a promise with itself"));else if(yt=typeof(ut=at),ut===null||yt!=="object"&&yt!=="function")R(tt,at);else{var ft=void 0;try{ft=at.then}catch(At){return void N(tt,At)}nt(tt,at,ft)}var ut,yt}function V(tt){tt._onerror&&tt._onerror(tt._result),X(tt)}function R(tt,at){tt._state===void 0&&(tt._result=at,tt._state=1,tt._subscribers.length!==0&&f(X,tt))}function N(tt,at){tt._state===void 0&&(tt._state=2,tt._result=at,f(V,tt))}function j(tt,at,ft,ut){var yt=tt._subscribers,At=yt.length;tt._onerror=null,yt[At]=at,yt[At+1]=ft,yt[At+2]=ut,At===0&&tt._state&&f(X,tt)}function X(tt){var at=tt._subscribers,ft=tt._state;if(at.length!==0){for(var ut=void 0,yt=void 0,At=tt._result,jt=0;jt<at.length;jt+=3)ut=at[jt],yt=at[jt+ft],ut?rt(ft,ut,yt,At):yt(At);tt._subscribers.length=0}}function rt(tt,at,ft,ut){var yt=l(ft),At=void 0,jt=void 0,qt=!0;if(yt){try{At=ft(ut)}catch(re){qt=!1,jt=re}if(at===At)return void N(at,new TypeError("A promises callback cannot return that same promise."))}else At=ut;at._state!==void 0||(yt&&qt?ot(at,At):qt===!1?N(at,jt):tt===1?R(at,At):tt===2&&N(at,At))}var lt=0;function Tt(tt){tt[G]=lt++,tt._state=void 0,tt._result=void 0,tt._subscribers=[]}var wt=function(){function tt(at,ft){this._instanceConstructor=at,this.promise=new at(Q),this.promise[G]||Tt(this.promise),o(ft)?(this.length=ft.length,this._remaining=ft.length,this._result=new Array(this.length),this.length===0?R(this.promise,this._result):(this.length=this.length||0,this._enumerate(ft),this._remaining===0&&R(this.promise,this._result))):N(this.promise,new Error("Array Methods must be provided an Array"))}return tt.prototype._enumerate=function(at){for(var ft=0;this._state===void 0&&ft<at.length;ft++)this._eachEntry(at[ft],ft)},tt.prototype._eachEntry=function(at,ft){var ut=this._instanceConstructor,yt=ut.resolve;if(yt===B){var At=void 0,jt=void 0,qt=!1;try{At=at.then}catch(Xt){qt=!0,jt=Xt}if(At===U&&at._state!==void 0)this._settledAt(at._state,ft,at._result);else if(typeof At!="function")this._remaining--,this._result[ft]=at;else if(ut===Rt){var re=new ut(Q);qt?N(re,jt):nt(re,at,At),this._willSettleAt(re,ft)}else this._willSettleAt(new ut(function(Xt){return Xt(at)}),ft)}else this._willSettleAt(yt(at),ft)},tt.prototype._settledAt=function(at,ft,ut){var yt=this.promise;yt._state===void 0&&(this._remaining--,at===2?N(yt,ut):this._result[ft]=ut),this._remaining===0&&R(yt,this._result)},tt.prototype._willSettleAt=function(at,ft){var ut=this;j(at,void 0,function(yt){return ut._settledAt(1,ft,yt)},function(yt){return ut._settledAt(2,ft,yt)})},tt}(),Rt=function(){function tt(at){this[G]=lt++,this._result=this._state=void 0,this._subscribers=[],Q!==at&&(typeof at!="function"&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof tt?function(ft,ut){try{ut(function(yt){ot(ft,yt)},function(yt){N(ft,yt)})}catch(yt){N(ft,yt)}}(this,at):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return tt.prototype.catch=function(at){return this.then(null,at)},tt.prototype.finally=function(at){var ft=this.constructor;return l(at)?this.then(function(ut){return ft.resolve(at()).then(function(){return ut})},function(ut){return ft.resolve(at()).then(function(){throw ut})}):this.then(at,at)},tt}();return Rt.prototype.then=U,Rt.all=function(tt){return new wt(this,tt).promise},Rt.race=function(tt){var at=this;return o(tt)?new at(function(ft,ut){for(var yt=tt.length,At=0;At<yt;At++)at.resolve(tt[At]).then(ft,ut)}):new at(function(ft,ut){return ut(new TypeError("You must pass an array to race."))})},Rt.resolve=B,Rt.reject=function(tt){var at=new this(Q);return N(at,tt),at},Rt._setScheduler=function(tt){h=tt},Rt._setAsap=function(tt){f=tt},Rt._asap=f,Rt.polyfill=function(){var tt=void 0;if(n!==void 0)tt=n;else if(typeof self!="undefined")tt=self;else try{tt=Function("return this")()}catch(ut){throw new Error("polyfill failed because global object is unavailable in this environment")}var at=tt.Promise;if(at){var ft=null;try{ft=Object.prototype.toString.call(at.resolve())}catch(ut){}if(ft==="[object Promise]"&&!at.cast)return}tt.Promise=Rt},Rt.Promise=Rt,Rt},e.exports=a()}).call(this,s(16),s(17))},function(e,i){var s,r,n=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function o(O){if(s===setTimeout)return setTimeout(O,0);if((s===a||!s)&&setTimeout)return s=setTimeout,setTimeout(O,0);try{return s(O,0)}catch(I){try{return s.call(null,O,0)}catch(x){return s.call(this,O,0)}}}(function(){try{s=typeof setTimeout=="function"?setTimeout:a}catch(O){s=a}try{r=typeof clearTimeout=="function"?clearTimeout:l}catch(O){r=l}})();var c,u=[],h=!1,f=-1;function m(){h&&c&&(h=!1,c.length?u=c.concat(u):f=-1,u.length&&_())}function _(){if(!h){var O=o(m);h=!0;for(var I=u.length;I;){for(c=u,u=[];++f<I;)c&&c[f].run();f=-1,I=u.length}c=null,h=!1,function(x){if(r===clearTimeout)return clearTimeout(x);if((r===l||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(x);try{r(x)}catch(P){try{return r.call(null,x)}catch(C){return r.call(this,x)}}}(O)}}function E(O,I){this.fun=O,this.array=I}function D(){}n.nextTick=function(O){var I=new Array(arguments.length-1);if(arguments.length>1)for(var x=1;x<arguments.length;x++)I[x-1]=arguments[x];u.push(new E(O,I)),u.length!==1||h||o(_)},E.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=D,n.addListener=D,n.once=D,n.off=D,n.removeListener=D,n.removeAllListeners=D,n.emit=D,n.prependListener=D,n.prependOnceListener=D,n.listeners=function(O){return[]},n.binding=function(O){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(O){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,i){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(r){typeof window=="object"&&(s=window)}e.exports=s},function(e,i,s){s.r(i);var r=s(9),n=s(12),a=s(10),l=s(1);i.default=function(o){var c=null,u=function(B,G){o.postMessage({msg:"logcat_callback",data:{type:B,logcat:G}})}.bind(this);function h(B,G){var Q={msg:l.a.INIT_SEGMENT,data:{type:B,data:G}};o.postMessage(Q,[G.data])}function f(B,G){var Q={msg:l.a.MEDIA_SEGMENT,data:{type:B,data:G}};o.postMessage(Q,[G.data])}function m(){var B={msg:l.a.LOADING_COMPLETE};o.postMessage(B)}function _(){var B={msg:l.a.RECOVERED_EARLY_EOF};o.postMessage(B)}function E(B){var G={msg:l.a.MEDIA_INFO,data:B};o.postMessage(G)}function D(B){var G={msg:l.a.METADATA_ARRIVED,data:B};o.postMessage(G)}function O(B){var G={msg:l.a.SCRIPTDATA_ARRIVED,data:B};o.postMessage(G)}function I(B){var G={msg:l.a.TIMED_ID3_METADATA_ARRIVED,data:B};o.postMessage(G)}function x(B){var G={msg:l.a.SMPTE2038_METADATA_ARRIVED,data:B};o.postMessage(G)}function P(B){var G={msg:l.a.SCTE35_METADATA_ARRIVED,data:B};o.postMessage(G)}function C(B){var G={msg:l.a.PES_PRIVATE_DATA_DESCRIPTOR,data:B};o.postMessage(G)}function b(B){var G={msg:l.a.PES_PRIVATE_DATA_ARRIVED,data:B};o.postMessage(G)}function S(B){var G={msg:l.a.STATISTICS_INFO,data:B};o.postMessage(G)}function L(B,G){o.postMessage({msg:l.a.IO_ERROR,data:{type:B,info:G}})}function A(B,G){o.postMessage({msg:l.a.DEMUX_ERROR,data:{type:B,info:G}})}function U(B){o.postMessage({msg:l.a.RECOMMEND_SEEKPOINT,data:B})}n.a.install(),o.addEventListener("message",function(B){switch(B.data.cmd){case"init":(c=new a.a(B.data.param[0],B.data.param[1])).on(l.a.IO_ERROR,L.bind(this)),c.on(l.a.DEMUX_ERROR,A.bind(this)),c.on(l.a.INIT_SEGMENT,h.bind(this)),c.on(l.a.MEDIA_SEGMENT,f.bind(this)),c.on(l.a.LOADING_COMPLETE,m.bind(this)),c.on(l.a.RECOVERED_EARLY_EOF,_.bind(this)),c.on(l.a.MEDIA_INFO,E.bind(this)),c.on(l.a.METADATA_ARRIVED,D.bind(this)),c.on(l.a.SCRIPTDATA_ARRIVED,O.bind(this)),c.on(l.a.TIMED_ID3_METADATA_ARRIVED,I.bind(this)),c.on(l.a.SMPTE2038_METADATA_ARRIVED,x.bind(this)),c.on(l.a.SCTE35_METADATA_ARRIVED,P.bind(this)),c.on(l.a.PES_PRIVATE_DATA_DESCRIPTOR,C.bind(this)),c.on(l.a.PES_PRIVATE_DATA_ARRIVED,b.bind(this)),c.on(l.a.STATISTICS_INFO,S.bind(this)),c.on(l.a.RECOMMEND_SEEKPOINT,U.bind(this));break;case"destroy":c&&(c.destroy(),c=null),o.postMessage({msg:"destroyed"});break;case"start":c.start();break;case"stop":c.stop();break;case"seek":c.seek(B.data.param);break;case"pause":c.pause();break;case"resume":c.resume();break;case"logging_config":var G=B.data.param;r.a.applyConfig(G),G.enableCallback===!0?r.a.addLogListener(u):r.a.removeLogListener(u)}})}},function(e,i,s){s.r(i);var r=s(12),n=s(11),a={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function l(){return Object.assign({},a)}var o=function(){function V(){}return V.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},V.supportMSEH265Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"')},V.supportNetworkStreamIO=function(){var R=new n.a({},l()),N=R.loaderType;return R.destroy(),N=="fetch-stream-loader"||N=="xhr-moz-chunked-loader"},V.getNetworkLoaderTypeName=function(){var R=new n.a({},l()),N=R.loaderType;return R.destroy(),N},V.supportNativeMediaPlayback=function(R){V.videoElement==null&&(V.videoElement=window.document.createElement("video"));var N=V.videoElement.canPlayType(R);return N==="probably"||N=="maybe"},V.getFeatureList=function(){var R={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return R.msePlayback=V.supportMSEH264Playback(),R.networkStreamIO=V.supportNetworkStreamIO(),R.networkLoaderName=V.getNetworkLoaderTypeName(),R.mseLivePlayback=R.msePlayback&&R.networkStreamIO,R.mseH265Playback=V.supportMSEH265Playback(),R.nativeMP4H264Playback=V.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),R.nativeMP4H265Playback=V.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),R.nativeWebmVP8Playback=V.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),R.nativeWebmVP9Playback=V.supportNativeMediaPlayback('video/webm; codecs="vp9"'),R},V}(),c=s(2),u=s(6),h=s.n(u),f=s(0),m=s(4),_={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info"},E=s(13),D=s.n(E),O=s(9),I=s(10),x=s(1),P=s(8),C=function(){function V(R,N){if(this.TAG="Transmuxer",this._emitter=new h.a,N.enableWorker&&typeof Worker!="undefined")try{this._worker=D()(18),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[R,N]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},O.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:O.a.getConfig()})}catch(X){f.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new I.a(R,N)}else this._controller=new I.a(R,N);if(this._controller){var j=this._controller;j.on(x.a.IO_ERROR,this._onIOError.bind(this)),j.on(x.a.DEMUX_ERROR,this._onDemuxError.bind(this)),j.on(x.a.INIT_SEGMENT,this._onInitSegment.bind(this)),j.on(x.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),j.on(x.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),j.on(x.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),j.on(x.a.MEDIA_INFO,this._onMediaInfo.bind(this)),j.on(x.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),j.on(x.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),j.on(x.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),j.on(x.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),j.on(x.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),j.on(x.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),j.on(x.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),j.on(x.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),j.on(x.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return V.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),O.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},V.prototype.on=function(R,N){this._emitter.addListener(R,N)},V.prototype.off=function(R,N){this._emitter.removeListener(R,N)},V.prototype.hasWorker=function(){return this._worker!=null},V.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},V.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},V.prototype.seek=function(R){this._worker?this._worker.postMessage({cmd:"seek",param:R}):this._controller.seek(R)},V.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},V.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},V.prototype._onInitSegment=function(R,N){var j=this;Promise.resolve().then(function(){j._emitter.emit(x.a.INIT_SEGMENT,R,N)})},V.prototype._onMediaSegment=function(R,N){var j=this;Promise.resolve().then(function(){j._emitter.emit(x.a.MEDIA_SEGMENT,R,N)})},V.prototype._onLoadingComplete=function(){var R=this;Promise.resolve().then(function(){R._emitter.emit(x.a.LOADING_COMPLETE)})},V.prototype._onRecoveredEarlyEof=function(){var R=this;Promise.resolve().then(function(){R._emitter.emit(x.a.RECOVERED_EARLY_EOF)})},V.prototype._onMediaInfo=function(R){var N=this;Promise.resolve().then(function(){N._emitter.emit(x.a.MEDIA_INFO,R)})},V.prototype._onMetaDataArrived=function(R){var N=this;Promise.resolve().then(function(){N._emitter.emit(x.a.METADATA_ARRIVED,R)})},V.prototype._onScriptDataArrived=function(R){var N=this;Promise.resolve().then(function(){N._emitter.emit(x.a.SCRIPTDATA_ARRIVED,R)})},V.prototype._onTimedID3MetadataArrived=function(R){var N=this;Promise.resolve().then(function(){N._emitter.emit(x.a.TIMED_ID3_METADATA_ARRIVED,R)})},V.prototype._onSMPTE2038MetadataArrived=function(R){var N=this;Promise.resolve().then(function(){N._emitter.emit(x.a.SMPTE2038_METADATA_ARRIVED,R)})},V.prototype._onSCTE35MetadataArrived=function(R){var N=this;Promise.resolve().then(function(){N._emitter.emit(x.a.SCTE35_METADATA_ARRIVED,R)})},V.prototype._onPESPrivateDataDescriptor=function(R){var N=this;Promise.resolve().then(function(){N._emitter.emit(x.a.PES_PRIVATE_DATA_DESCRIPTOR,R)})},V.prototype._onPESPrivateDataArrived=function(R){var N=this;Promise.resolve().then(function(){N._emitter.emit(x.a.PES_PRIVATE_DATA_ARRIVED,R)})},V.prototype._onStatisticsInfo=function(R){var N=this;Promise.resolve().then(function(){N._emitter.emit(x.a.STATISTICS_INFO,R)})},V.prototype._onIOError=function(R,N){var j=this;Promise.resolve().then(function(){j._emitter.emit(x.a.IO_ERROR,R,N)})},V.prototype._onDemuxError=function(R,N){var j=this;Promise.resolve().then(function(){j._emitter.emit(x.a.DEMUX_ERROR,R,N)})},V.prototype._onRecommendSeekpoint=function(R){var N=this;Promise.resolve().then(function(){N._emitter.emit(x.a.RECOMMEND_SEEKPOINT,R)})},V.prototype._onLoggingConfigChanged=function(R){this._worker&&this._worker.postMessage({cmd:"logging_config",param:R})},V.prototype._onWorkerMessage=function(R){var N=R.data,j=N.data;if(N.msg==="destroyed"||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(N.msg){case x.a.INIT_SEGMENT:case x.a.MEDIA_SEGMENT:this._emitter.emit(N.msg,j.type,j.data);break;case x.a.LOADING_COMPLETE:case x.a.RECOVERED_EARLY_EOF:this._emitter.emit(N.msg);break;case x.a.MEDIA_INFO:Object.setPrototypeOf(j,P.a.prototype),this._emitter.emit(N.msg,j);break;case x.a.METADATA_ARRIVED:case x.a.SCRIPTDATA_ARRIVED:case x.a.TIMED_ID3_METADATA_ARRIVED:case x.a.SMPTE2038_METADATA_ARRIVED:case x.a.SCTE35_METADATA_ARRIVED:case x.a.PES_PRIVATE_DATA_DESCRIPTOR:case x.a.PES_PRIVATE_DATA_ARRIVED:case x.a.STATISTICS_INFO:this._emitter.emit(N.msg,j);break;case x.a.IO_ERROR:case x.a.DEMUX_ERROR:this._emitter.emit(N.msg,j.type,j.info);break;case x.a.RECOMMEND_SEEKPOINT:this._emitter.emit(N.msg,j);break;case"logcat_callback":f.a.emitter.emit("log",j.type,j.logcat)}},V}(),b={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"},S=s(7),L=s(3),A=function(){function V(R){this.TAG="MSEController",this._config=R,this._emitter=new h.a,this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new S.a}return V.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},V.prototype.on=function(R,N){this._emitter.addListener(R,N)},V.prototype.off=function(R,N){this._emitter.removeListener(R,N)},V.prototype.attachMediaElement=function(R){if(this._mediaSource)throw new L.a("MediaSource has been attached to an HTMLMediaElement!");var N=this._mediaSource=new window.MediaSource;N.addEventListener("sourceopen",this.e.onSourceOpen),N.addEventListener("sourceended",this.e.onSourceEnded),N.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=R,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),R.src=this._mediaSourceObjectURL},V.prototype.detachMediaElement=function(){if(this._mediaSource){var R=this._mediaSource;for(var N in this._sourceBuffers){var j=this._pendingSegments[N];j.splice(0,j.length),this._pendingSegments[N]=null,this._pendingRemoveRanges[N]=null,this._lastInitSegments[N]=null;var X=this._sourceBuffers[N];if(X){if(R.readyState!=="closed"){try{R.removeSourceBuffer(X)}catch(rt){f.a.e(this.TAG,rt.message)}X.removeEventListener("error",this.e.onSourceBufferError),X.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[N]=null,this._sourceBuffers[N]=null}}if(R.readyState==="open")try{R.endOfStream()}catch(rt){f.a.e(this.TAG,rt.message)}R.removeEventListener("sourceopen",this.e.onSourceOpen),R.removeEventListener("sourceended",this.e.onSourceEnded),R.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},V.prototype.appendInitSegment=function(R,N){if(!this._mediaSource||this._mediaSource.readyState!=="open")return this._pendingSourceBufferInit.push(R),void this._pendingSegments[R.type].push(R);var j=R,X=""+j.container;j.codec&&j.codec.length>0&&(X+=";codecs="+j.codec);var rt=!1;if(f.a.v(this.TAG,"Received Initialization Segment, mimeType: "+X),this._lastInitSegments[j.type]=j,X!==this._mimeTypes[j.type]){if(this._mimeTypes[j.type])f.a.v(this.TAG,"Notice: "+j.type+" mimeType changed, origin: "+this._mimeTypes[j.type]+", target: "+X);else{rt=!0;try{var lt=this._sourceBuffers[j.type]=this._mediaSource.addSourceBuffer(X);lt.addEventListener("error",this.e.onSourceBufferError),lt.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(Tt){return f.a.e(this.TAG,Tt.message),void this._emitter.emit(b.ERROR,{code:Tt.code,msg:Tt.message})}}this._mimeTypes[j.type]=X}N||this._pendingSegments[j.type].push(j),rt||this._sourceBuffers[j.type]&&!this._sourceBuffers[j.type].updating&&this._doAppendSegments(),m.a.safari&&j.container==="audio/mpeg"&&j.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=j.mediaDuration/1e3,this._updateMediaSourceDuration())},V.prototype.appendMediaSegment=function(R){var N=R;this._pendingSegments[N.type].push(N),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var j=this._sourceBuffers[N.type];!j||j.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},V.prototype.seek=function(R){for(var N in this._sourceBuffers)if(this._sourceBuffers[N]){var j=this._sourceBuffers[N];if(this._mediaSource.readyState==="open")try{j.abort()}catch(Rt){f.a.e(this.TAG,Rt.message)}this._idrList.clear();var X=this._pendingSegments[N];if(X.splice(0,X.length),this._mediaSource.readyState!=="closed"){for(var rt=0;rt<j.buffered.length;rt++){var lt=j.buffered.start(rt),Tt=j.buffered.end(rt);this._pendingRemoveRanges[N].push({start:lt,end:Tt})}if(j.updating||this._doRemoveRanges(),m.a.safari){var wt=this._lastInitSegments[N];wt&&(this._pendingSegments[N].push(wt),j.updating||this._doAppendSegments())}}}},V.prototype.endOfStream=function(){var R=this._mediaSource,N=this._sourceBuffers;R&&R.readyState==="open"?N.video&&N.video.updating||N.audio&&N.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,R.endOfStream()):R&&R.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},V.prototype.getNearestKeyframe=function(R){return this._idrList.getLastSyncPointBeforeDts(R)},V.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var R=this._mediaElement.currentTime;for(var N in this._sourceBuffers){var j=this._sourceBuffers[N];if(j){var X=j.buffered;if(X.length>=1&&R-X.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},V.prototype._doCleanupSourceBuffer=function(){var R=this._mediaElement.currentTime;for(var N in this._sourceBuffers){var j=this._sourceBuffers[N];if(j){for(var X=j.buffered,rt=!1,lt=0;lt<X.length;lt++){var Tt=X.start(lt),wt=X.end(lt);if(Tt<=R&&R<wt+3){if(R-Tt>=this._config.autoCleanupMaxBackwardDuration){rt=!0;var Rt=R-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[N].push({start:Tt,end:Rt})}}else wt<R&&(rt=!0,this._pendingRemoveRanges[N].push({start:Tt,end:wt}))}rt&&!j.updating&&this._doRemoveRanges()}}},V.prototype._updateMediaSourceDuration=function(){var R=this._sourceBuffers;if(this._mediaElement.readyState!==0&&this._mediaSource.readyState==="open"&&!(R.video&&R.video.updating||R.audio&&R.audio.updating)){var N=this._mediaSource.duration,j=this._pendingMediaDuration;j>0&&(isNaN(N)||j>N)&&(f.a.v(this.TAG,"Update MediaSource duration from "+N+" to "+j),this._mediaSource.duration=j),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},V.prototype._doRemoveRanges=function(){for(var R in this._pendingRemoveRanges)if(this._sourceBuffers[R]&&!this._sourceBuffers[R].updating)for(var N=this._sourceBuffers[R],j=this._pendingRemoveRanges[R];j.length&&!N.updating;){var X=j.shift();N.remove(X.start,X.end)}},V.prototype._doAppendSegments=function(){var R=this._pendingSegments;for(var N in R)if(this._sourceBuffers[N]&&!this._sourceBuffers[N].updating&&R[N].length>0){var j=R[N].shift();if(j.timestampOffset){var X=this._sourceBuffers[N].timestampOffset,rt=j.timestampOffset/1e3;Math.abs(X-rt)>.1&&(f.a.v(this.TAG,"Update MPEG audio timestampOffset from "+X+" to "+rt),this._sourceBuffers[N].timestampOffset=rt),delete j.timestampOffset}if(!j.data||j.data.byteLength===0)continue;try{this._sourceBuffers[N].appendBuffer(j.data),this._isBufferFull=!1,N==="video"&&j.hasOwnProperty("info")&&this._idrList.appendArray(j.info.syncPoints)}catch(lt){this._pendingSegments[N].unshift(j),lt.code===22?(this._isBufferFull||this._emitter.emit(b.BUFFER_FULL),this._isBufferFull=!0):(f.a.e(this.TAG,lt.message),this._emitter.emit(b.ERROR,{code:lt.code,msg:lt.message}))}}},V.prototype._onSourceOpen=function(){if(f.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var R=this._pendingSourceBufferInit;R.length;){var N=R.shift();this.appendInitSegment(N,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(b.SOURCE_OPEN)},V.prototype._onSourceEnded=function(){f.a.v(this.TAG,"MediaSource onSourceEnded")},V.prototype._onSourceClose=function(){f.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},V.prototype._hasPendingSegments=function(){var R=this._pendingSegments;return R.video.length>0||R.audio.length>0},V.prototype._hasPendingRemoveRanges=function(){var R=this._pendingRemoveRanges;return R.video.length>0||R.audio.length>0},V.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(b.UPDATE_END)},V.prototype._onSourceBufferError=function(R){f.a.e(this.TAG,"SourceBuffer Error: "+R)},V}(),U=s(5),B={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},G={NETWORK_EXCEPTION:c.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:c.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:c.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:c.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:U.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:U.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:U.a.CODEC_UNSUPPORTED},Q=function(){function V(R,N){this.TAG="MSEPlayer",this._type="MSEPlayer",this._emitter=new h.a,this._config=l(),typeof N=="object"&&Object.assign(this._config,N);var j=R.type.toLowerCase();if(j!=="mse"&&j!=="mpegts"&&j!=="m2ts"&&j!=="flv")throw new L.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");R.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=R,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var X=m.a.chrome&&(m.a.version.major<50||m.a.version.major===50&&m.a.version.build<2661);this._alwaysSeekKeyframe=!!(X||m.a.msedge||m.a.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return V.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},V.prototype.on=function(R,N){var j=this;R===_.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){j._emitter.emit(_.MEDIA_INFO,j.mediaInfo)}):R===_.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){j._emitter.emit(_.STATISTICS_INFO,j.statisticsInfo)}),this._emitter.addListener(R,N)},V.prototype.off=function(R,N){this._emitter.removeListener(R,N)},V.prototype.attachMediaElement=function(R){var N=this;if(this._mediaElement=R,R.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),R.addEventListener("seeking",this.e.onvSeeking),R.addEventListener("canplay",this.e.onvCanPlay),R.addEventListener("stalled",this.e.onvStalled),R.addEventListener("progress",this.e.onvProgress),this._msectl=new A(this._config),this._msectl.on(b.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(b.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(b.SOURCE_OPEN,function(){N._mseSourceOpened=!0,N._hasPendingLoad&&(N._hasPendingLoad=!1,N.load())}),this._msectl.on(b.ERROR,function(j){N._emitter.emit(_.ERROR,B.MEDIA_ERROR,G.MEDIA_MSE_ERROR,j)}),this._msectl.attachMediaElement(R),this._pendingSeekTime!=null)try{R.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(j){}},V.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},V.prototype.load=function(){var R=this;if(!this._mediaElement)throw new L.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new L.a("MSEPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new C(this._mediaDataSource,this._config),this._transmuxer.on(x.a.INIT_SEGMENT,function(N,j){R._msectl.appendInitSegment(j)}),this._transmuxer.on(x.a.MEDIA_SEGMENT,function(N,j){if(R._msectl.appendMediaSegment(j),R._config.lazyLoad&&!R._config.isLive){var X=R._mediaElement.currentTime;j.info.endDts>=1e3*(X+R._config.lazyLoadMaxDuration)&&R._progressChecker==null&&(f.a.v(R.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),R._suspendTransmuxer())}}),this._transmuxer.on(x.a.LOADING_COMPLETE,function(){R._msectl.endOfStream(),R._emitter.emit(_.LOADING_COMPLETE)}),this._transmuxer.on(x.a.RECOVERED_EARLY_EOF,function(){R._emitter.emit(_.RECOVERED_EARLY_EOF)}),this._transmuxer.on(x.a.IO_ERROR,function(N,j){R._emitter.emit(_.ERROR,B.NETWORK_ERROR,N,j)}),this._transmuxer.on(x.a.DEMUX_ERROR,function(N,j){R._emitter.emit(_.ERROR,B.MEDIA_ERROR,N,{code:-1,msg:j})}),this._transmuxer.on(x.a.MEDIA_INFO,function(N){R._mediaInfo=N,R._emitter.emit(_.MEDIA_INFO,Object.assign({},N))}),this._transmuxer.on(x.a.METADATA_ARRIVED,function(N){R._emitter.emit(_.METADATA_ARRIVED,N)}),this._transmuxer.on(x.a.SCRIPTDATA_ARRIVED,function(N){R._emitter.emit(_.SCRIPTDATA_ARRIVED,N)}),this._transmuxer.on(x.a.TIMED_ID3_METADATA_ARRIVED,function(N){R._emitter.emit(_.TIMED_ID3_METADATA_ARRIVED,N)}),this._transmuxer.on(x.a.SMPTE2038_METADATA_ARRIVED,function(N){R._emitter.emit(_.SMPTE2038_METADATA_ARRIVED,N)}),this._transmuxer.on(x.a.SCTE35_METADATA_ARRIVED,function(N){R._emitter.emit(_.SCTE35_METADATA_ARRIVED,N)}),this._transmuxer.on(x.a.PES_PRIVATE_DATA_DESCRIPTOR,function(N){R._emitter.emit(_.PES_PRIVATE_DATA_DESCRIPTOR,N)}),this._transmuxer.on(x.a.PES_PRIVATE_DATA_ARRIVED,function(N){R._emitter.emit(_.PES_PRIVATE_DATA_ARRIVED,N)}),this._transmuxer.on(x.a.STATISTICS_INFO,function(N){R._statisticsInfo=R._fillStatisticsInfo(N),R._emitter.emit(_.STATISTICS_INFO,Object.assign({},R._statisticsInfo))}),this._transmuxer.on(x.a.RECOMMEND_SEEKPOINT,function(N){R._mediaElement&&!R._config.accurateSeek&&(R._requestSetTime=!0,R._mediaElement.currentTime=N/1e3)}),this._transmuxer.open()))},V.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},V.prototype.play=function(){return this._mediaElement.play()},V.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(V.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(R){this._mediaElement.volume=R},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(R){this._mediaElement.muted=R},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(R){this._mediaElement?this._internalSeek(R):this._pendingSeekTime=R},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),V.prototype._fillStatisticsInfo=function(R){if(R.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return R;var N=!0,j=0,X=0;if(this._mediaElement.getVideoPlaybackQuality){var rt=this._mediaElement.getVideoPlaybackQuality();j=rt.totalVideoFrames,X=rt.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(j=this._mediaElement.webkitDecodedFrameCount,X=this._mediaElement.webkitDroppedFrameCount):N=!1;return N&&(R.decodedFrames=j,R.droppedFrames=X),R},V.prototype._onmseUpdateEnd=function(){var R=this._mediaElement.buffered,N=this._mediaElement.currentTime;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&R.length>0&&!this._mediaElement.paused){var j=R.end(R.length-1);if(j>this._config.liveBufferLatencyMaxLatency&&j-N>this._config.liveBufferLatencyMaxLatency){var X=j-this._config.liveBufferLatencyMinRemain;this.currentTime=X}}if(this._config.lazyLoad&&!this._config.isLive){for(var rt=0,lt=0;lt<R.length;lt++){var Tt=R.start(lt),wt=R.end(lt);if(Tt<=N&&N<wt){rt=wt;break}}rt>=N+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(f.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},V.prototype._onmseBufferFull=function(){f.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},V.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},V.prototype._checkProgressAndResume=function(){for(var R=this._mediaElement.currentTime,N=this._mediaElement.buffered,j=!1,X=0;X<N.length;X++){var rt=N.start(X),lt=N.end(X);if(R>=rt&&R<lt){R>=lt-this._config.lazyLoadRecoverDuration&&(j=!0);break}}j&&(window.clearInterval(this._progressChecker),this._progressChecker=null,j&&(f.a.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},V.prototype._isTimepointBuffered=function(R){for(var N=this._mediaElement.buffered,j=0;j<N.length;j++){var X=N.start(j),rt=N.end(j);if(R>=X&&R<rt)return!0}return!1},V.prototype._internalSeek=function(R){var N=this._isTimepointBuffered(R),j=!1,X=0;if(R<1&&this._mediaElement.buffered.length>0){var rt=this._mediaElement.buffered.start(0);(rt<1&&R<rt||m.a.safari)&&(j=!0,X=m.a.safari?.1:rt)}if(j)this._requestSetTime=!0,this._mediaElement.currentTime=X;else if(N){if(this._alwaysSeekKeyframe){var lt=this._msectl.getNearestKeyframe(Math.floor(1e3*R));this._requestSetTime=!0,this._mediaElement.currentTime=lt!=null?lt.dts/1e3:R}else this._requestSetTime=!0,this._mediaElement.currentTime=R;this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(R),this._transmuxer.seek(Math.floor(1e3*R)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=R)},V.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var R=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(R)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(R),this._transmuxer.seek(Math.floor(1e3*R)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=R))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},V.prototype._checkAndResumeStuckPlayback=function(R){var N=this._mediaElement;if(R||!this._receivedCanPlay||N.readyState<2){var j=N.buffered;j.length>0&&N.currentTime<j.start(0)&&(f.a.w(this.TAG,"Playback seems stuck at "+N.currentTime+", seek to "+j.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=j.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},V.prototype._onvLoadedMetadata=function(R){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},V.prototype._onvSeeking=function(R){var N=this._mediaElement.currentTime,j=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(N<1&&j.length>0){var X=j.start(0);if(X<1&&N<X||m.a.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=m.a.safari?.1:X)}if(this._isTimepointBuffered(N)){if(this._alwaysSeekKeyframe){var rt=this._msectl.getNearestKeyframe(Math.floor(1e3*N));rt!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=rt.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:N,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},V.prototype._onvCanPlay=function(R){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},V.prototype._onvStalled=function(R){this._checkAndResumeStuckPlayback(!0)},V.prototype._onvProgress=function(R){this._checkAndResumeStuckPlayback()},V}(),nt=function(){function V(R,N){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new h.a,this._config=l(),typeof N=="object"&&Object.assign(this._config,N);var j=R.type.toLowerCase();if(j==="mse"||j==="mpegts"||j==="m2ts"||j==="flv")throw new L.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(R.hasOwnProperty("segments"))throw new L.b("NativePlayer("+R.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=R,this._mediaElement=null}return V.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},V.prototype.on=function(R,N){var j=this;R===_.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){j._emitter.emit(_.MEDIA_INFO,j.mediaInfo)}):R===_.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){j._emitter.emit(_.STATISTICS_INFO,j.statisticsInfo)}),this._emitter.addListener(R,N)},V.prototype.off=function(R,N){this._emitter.removeListener(R,N)},V.prototype.attachMediaElement=function(R){if(this._mediaElement=R,R.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{R.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(N){}},V.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},V.prototype.load=function(){if(!this._mediaElement)throw new L.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},V.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},V.prototype.play=function(){return this._mediaElement.play()},V.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(V.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(R){this._mediaElement.volume=R},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(R){this._mediaElement.muted=R},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(R){this._mediaElement?this._mediaElement.currentTime=R:this._pendingSeekTime=R},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"mediaInfo",{get:function(){var R={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(R.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(R.width=this._mediaElement.videoWidth,R.height=this._mediaElement.videoHeight)),R},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"statisticsInfo",{get:function(){var R={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return R;var N=!0,j=0,X=0;if(this._mediaElement.getVideoPlaybackQuality){var rt=this._mediaElement.getVideoPlaybackQuality();j=rt.totalVideoFrames,X=rt.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(j=this._mediaElement.webkitDecodedFrameCount,X=this._mediaElement.webkitDroppedFrameCount):N=!1;return N&&(R.decodedFrames=j,R.droppedFrames=X),R},enumerable:!1,configurable:!0}),V.prototype._onvLoadedMetadata=function(R){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(_.MEDIA_INFO,this.mediaInfo)},V.prototype._reportStatisticsInfo=function(){this._emitter.emit(_.STATISTICS_INFO,this.statisticsInfo)},V}();r.a.install();var ot={createPlayer:function(V,R){var N=V;if(N==null||typeof N!="object")throw new L.b("MediaDataSource must be an javascript object!");if(!N.hasOwnProperty("type"))throw new L.b("MediaDataSource must has type field to indicate video file type!");switch(N.type){case"mse":case"mpegts":case"m2ts":case"flv":return new Q(N,R);default:return new nt(N,R)}},isSupported:function(){return o.supportMSEH264Playback()},getFeatureList:function(){return o.getFeatureList()}};ot.BaseLoader=c.a,ot.LoaderStatus=c.c,ot.LoaderErrors=c.b,ot.Events=_,ot.ErrorTypes=B,ot.ErrorDetails=G,ot.MSEPlayer=Q,ot.NativePlayer=nt,ot.LoggingControl=O.a,Object.defineProperty(ot,"version",{enumerable:!0,get:function(){return"1.7.2"}}),i.default=ot}])})})(on);var cs=nn(on.exports);function qa(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var ln={exports:{}};(function(d,t){(function(e){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,o,c){if(c=c||{},l=l.trim(),o=o.trim(),!o){if(!c.alwaysNormalize)return l;var u=a.parseURL(l);if(!u)throw new Error("Error trying to parse base URL.");return u.path=a.normalizePath(u.path),a.buildURLFromParts(u)}var h=a.parseURL(o);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return c.alwaysNormalize?(h.path=a.normalizePath(h.path),a.buildURLFromParts(h)):o;var f=a.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var m=s.exec(f.path);f.netLoc=m[1],f.path=m[2]}f.netLoc&&!f.path&&(f.path="/");var _={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(_.netLoc=f.netLoc,h.path[0]!=="/"))if(!h.path)_.path=f.path,h.params||(_.params=f.params,h.query||(_.query=f.query));else{var E=f.path,D=E.substring(0,E.lastIndexOf("/")+1)+h.path;_.path=a.normalizePath(D)}return _.path===null&&(_.path=c.alwaysNormalize?a.normalizePath(h.path):h.path),a.buildURLFromParts(_)},parseURL:function(l){var o=i.exec(l);return o?{scheme:o[1]||"",netLoc:o[2]||"",path:o[3]||"",params:o[4]||"",query:o[5]||"",fragment:o[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(r,"");l.length!==(l=l.replace(n,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};d.exports=a})()})(ln);var Mr=ln.exports;function ds(d,t){var e=Object.keys(d);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(d);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(d,s).enumerable})),e.push.apply(e,i)}return e}function he(d){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?ds(Object(e),!0).forEach(function(i){Qa(d,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(e)):ds(Object(e)).forEach(function(i){Object.defineProperty(d,i,Object.getOwnPropertyDescriptor(e,i))})}return d}function Qa(d,t,e){return t=Za(t),t in d?Object.defineProperty(d,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):d[t]=e,d}function Zt(){return Zt=Object.assign?Object.assign.bind():function(d){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(d[i]=e[i])}return d},Zt.apply(this,arguments)}function Xa(d,t){if(typeof d!="object"||d===null)return d;var e=d[Symbol.toPrimitive];if(e!==void 0){var i=e.call(d,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(d)}function Za(d){var t=Xa(d,"string");return typeof t=="symbol"?t:String(t)}const _t=Number.isFinite||function(d){return typeof d=="number"&&isFinite(d)};let w=function(d){return d.MEDIA_ATTACHING="hlsMediaAttaching",d.MEDIA_ATTACHED="hlsMediaAttached",d.MEDIA_DETACHING="hlsMediaDetaching",d.MEDIA_DETACHED="hlsMediaDetached",d.BUFFER_RESET="hlsBufferReset",d.BUFFER_CODECS="hlsBufferCodecs",d.BUFFER_CREATED="hlsBufferCreated",d.BUFFER_APPENDING="hlsBufferAppending",d.BUFFER_APPENDED="hlsBufferAppended",d.BUFFER_EOS="hlsBufferEos",d.BUFFER_FLUSHING="hlsBufferFlushing",d.BUFFER_FLUSHED="hlsBufferFlushed",d.MANIFEST_LOADING="hlsManifestLoading",d.MANIFEST_LOADED="hlsManifestLoaded",d.MANIFEST_PARSED="hlsManifestParsed",d.LEVEL_SWITCHING="hlsLevelSwitching",d.LEVEL_SWITCHED="hlsLevelSwitched",d.LEVEL_LOADING="hlsLevelLoading",d.LEVEL_LOADED="hlsLevelLoaded",d.LEVEL_UPDATED="hlsLevelUpdated",d.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",d.LEVELS_UPDATED="hlsLevelsUpdated",d.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",d.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",d.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",d.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",d.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",d.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",d.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",d.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",d.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",d.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",d.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",d.CUES_PARSED="hlsCuesParsed",d.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",d.INIT_PTS_FOUND="hlsInitPtsFound",d.FRAG_LOADING="hlsFragLoading",d.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",d.FRAG_LOADED="hlsFragLoaded",d.FRAG_DECRYPTED="hlsFragDecrypted",d.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",d.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",d.FRAG_PARSING_METADATA="hlsFragParsingMetadata",d.FRAG_PARSED="hlsFragParsed",d.FRAG_BUFFERED="hlsFragBuffered",d.FRAG_CHANGED="hlsFragChanged",d.FPS_DROP="hlsFpsDrop",d.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",d.ERROR="hlsError",d.DESTROYING="hlsDestroying",d.KEY_LOADING="hlsKeyLoading",d.KEY_LOADED="hlsKeyLoaded",d.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",d.BACK_BUFFER_REACHED="hlsBackBufferReached",d}({}),Et=function(d){return d.NETWORK_ERROR="networkError",d.MEDIA_ERROR="mediaError",d.KEY_SYSTEM_ERROR="keySystemError",d.MUX_ERROR="muxError",d.OTHER_ERROR="otherError",d}({}),J=function(d){return d.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",d.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",d.KEY_SYSTEM_NO_SESSION="keySystemNoSession",d.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",d.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",d.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",d.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",d.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",d.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",d.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",d.MANIFEST_LOAD_ERROR="manifestLoadError",d.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",d.MANIFEST_PARSING_ERROR="manifestParsingError",d.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",d.LEVEL_EMPTY_ERROR="levelEmptyError",d.LEVEL_LOAD_ERROR="levelLoadError",d.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",d.LEVEL_PARSING_ERROR="levelParsingError",d.LEVEL_SWITCH_ERROR="levelSwitchError",d.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",d.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",d.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",d.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",d.FRAG_LOAD_ERROR="fragLoadError",d.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",d.FRAG_DECRYPT_ERROR="fragDecryptError",d.FRAG_PARSING_ERROR="fragParsingError",d.FRAG_GAP="fragGap",d.REMUX_ALLOC_ERROR="remuxAllocError",d.KEY_LOAD_ERROR="keyLoadError",d.KEY_LOAD_TIMEOUT="keyLoadTimeOut",d.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",d.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",d.BUFFER_APPEND_ERROR="bufferAppendError",d.BUFFER_APPENDING_ERROR="bufferAppendingError",d.BUFFER_STALLED_ERROR="bufferStalledError",d.BUFFER_FULL_ERROR="bufferFullError",d.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",d.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",d.INTERNAL_EXCEPTION="internalException",d.INTERNAL_ABORTED="aborted",d.UNKNOWN="unknown",d}({});const ti=function(){},Tr={trace:ti,debug:ti,log:ti,warn:ti,info:ti,error:ti};let mi=Tr;function Ja(d){const t=self.console[d];return t?t.bind(self.console,`[${d}] >`):ti}function to(d,...t){t.forEach(function(e){mi[e]=d[e]?d[e].bind(d):Ja(e)})}function eo(d,t){if(self.console&&d===!0||typeof d=="object"){to(d,"debug","log","info","warn","error");try{mi.log(`Debug logs enabled for "${t}" in hls.js version 1.4.4`)}catch(e){mi=Tr}}else mi=Tr}const $=mi,io=/^(\d+)x(\d+)$/,us=/(.+?)=(".*?"|.*?)(?:,|$)/g;class $t{constructor(t){typeof t=="string"&&(t=$t.parseAttrList(t));for(const e in t)t.hasOwnProperty(e)&&(e.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(e)),this[e]=t[e])}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(e.length&1?"0":"")+e;const i=new Uint8Array(e.length/2);for(let s=0;s<e.length/2;s++)i[s]=parseInt(e.slice(s*2,s*2+2),16);return i}else return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const i=this[t];return i?parseFloat(i):e}enumeratedString(t){return this[t]}bool(t){return this[t]==="YES"}decimalResolution(t){const e=io.exec(this[t]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(t){let e;const i={},s='"';for(us.lastIndex=0;(e=us.exec(t))!==null;){let r=e[2];r.indexOf(s)===0&&r.lastIndexOf(s)===r.length-1&&(r=r.slice(1,-1));const n=e[1].trim();i[n]=r}return i}}function ro(d){return d!=="ID"&&d!=="CLASS"&&d!=="START-DATE"&&d!=="DURATION"&&d!=="END-DATE"&&d!=="END-ON-NEXT"}function so(d){return d==="SCTE35-OUT"||d==="SCTE35-IN"}class cn{constructor(t,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){const i=e.attr;for(const s in i)if(Object.prototype.hasOwnProperty.call(t,s)&&t[s]!==i[s]){$.warn(`DATERANGE tag attribute: "${s}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=s;break}t=Zt(new $t({}),i,t)}if(this.attr=t,this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const i=new Date(this.attr["END-DATE"]);_t(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const t=this.duration;return t!==null?new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(_t(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&_t(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class Gi{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ft={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class dn{constructor(t){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[Ft.AUDIO]:null,[Ft.VIDEO]:null,[Ft.AUDIOVIDEO]:null},this.baseurl=t}setByteRange(t,e){const i=t.split("@",2),s=[];i.length===1?s[0]=e?e.byteRangeEndOffset:0:s[0]=parseInt(i[1]),s[1]=parseInt(i[0])+s[0],this._byteRange=s}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Mr.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}}class Ji extends dn{constructor(t,e){super(e),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new Gi,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=t}get decryptdata(){const{levelkeys:t}=this;if(!t&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!_t(this.programDateTime))return null;const t=_t(this.duration)?this.duration:0;return this.programDateTime+t*1e3}get encrypted(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),i=e.length;if(i>1||i===1&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(t){if(this.levelkeys){const e=this.levelkeys[t];e&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}}abortRequests(){var t,e;(t=this.loader)==null||t.abort(),(e=this.keyLoader)==null||e.abort()}setElementaryStreamInfo(t,e,i,s,r,n=!1){const{elementaryStreams:a}=this,l=a[t];if(!l){a[t]={startPTS:e,endPTS:i,startDTS:s,endDTS:r,partial:n};return}l.startPTS=Math.min(l.startPTS,e),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,r)}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t[Ft.AUDIO]=null,t[Ft.VIDEO]=null,t[Ft.AUDIOVIDEO]=null}}class no extends dn{constructor(t,e,i,s,r){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new Gi,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=s;const n=t.enumeratedString("BYTERANGE");n&&this.setByteRange(n,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}const ao=10;class oo{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t){this.advanced=!0,this.updated=!0;return}const e=this.lastPartSn-t.lastPartSn,i=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!i||!!e,this.advanced=this.endSN>t.endSN||e>0||e===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(t.misses*.6):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?_t(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||ao}get drift(){const t=this.driftEndTime-this.driftStartTime;return t>0?(this.driftEnd-this.driftStart)*1e3/t:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var t;return(t=this.fragments)!=null&&t.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function Pr(d){return Uint8Array.from(atob(d),t=>t.charCodeAt(0))}function lo(d){const t=un(d).subarray(0,16),e=new Uint8Array(16);return e.set(t,16-t.length),e}function co(d){const t=function(i,s,r){const n=i[s];i[s]=i[r],i[r]=n};t(d,0,3),t(d,1,2),t(d,4,5),t(d,6,7)}function uo(d){const t=d.split(":");let e=null;if(t[0]==="data"&&t.length===2){const i=t[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){const r=s[0]==="base64",n=s[1];r?(i.splice(-1,1),e=Pr(n)):e=lo(n)}}return e}function un(d){return Uint8Array.from(unescape(encodeURIComponent(d)),t=>t.charCodeAt(0))}var Ht={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ue={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function hs(d){switch(d){case ue.FAIRPLAY:return Ht.FAIRPLAY;case ue.PLAYREADY:return Ht.PLAYREADY;case ue.WIDEVINE:return Ht.WIDEVINE;case ue.CLEARKEY:return Ht.CLEARKEY}}var hn={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function ho(d){if(d===hn.WIDEVINE)return Ht.WIDEVINE}function fs(d){switch(d){case Ht.FAIRPLAY:return ue.FAIRPLAY;case Ht.PLAYREADY:return ue.PLAYREADY;case Ht.WIDEVINE:return ue.WIDEVINE;case Ht.CLEARKEY:return ue.CLEARKEY}}function tr(d){const{drmSystems:t,widevineLicenseUrl:e}=d,i=t?[Ht.FAIRPLAY,Ht.WIDEVINE,Ht.PLAYREADY,Ht.CLEARKEY].filter(s=>!!t[s]):[];return!i[Ht.WIDEVINE]&&e&&i.push(Ht.WIDEVINE),i}const fn=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function fo(d,t,e,i){let s;switch(d){case Ht.FAIRPLAY:s=["cenc","sinf"];break;case Ht.WIDEVINE:case Ht.PLAYREADY:s=["cenc"];break;case Ht.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${d}`)}return po(s,t,e,i)}function po(d,t,e,i){return[{initDataTypes:d,persistentState:i.persistentState||"not-allowed",distinctiveIdentifier:i.distinctiveIdentifier||"not-allowed",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map(r=>({contentType:`audio/mp4; codecs="${r}"`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:e.map(r=>({contentType:`video/mp4; codecs="${r}"`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function ei(d,t,e){return Uint8Array.prototype.slice?d.slice(t,e):new Uint8Array(Array.prototype.slice.call(d,t,e))}const Or=(d,t)=>t+10<=d.length&&d[t]===73&&d[t+1]===68&&d[t+2]===51&&d[t+3]<255&&d[t+4]<255&&d[t+6]<128&&d[t+7]<128&&d[t+8]<128&&d[t+9]<128,pn=(d,t)=>t+10<=d.length&&d[t]===51&&d[t+1]===68&&d[t+2]===73&&d[t+3]<255&&d[t+4]<255&&d[t+6]<128&&d[t+7]<128&&d[t+8]<128&&d[t+9]<128,Oi=(d,t)=>{const e=t;let i=0;for(;Or(d,t);)i+=10,i+=Vi(d,t+6),pn(d,t+10)&&(i+=10),t+=i;if(i>0)return d.subarray(e,e+i)},Vi=(d,t)=>{let e=0;return e=(d[t]&127)<<21,e|=(d[t+1]&127)<<14,e|=(d[t+2]&127)<<7,e|=d[t+3]&127,e},mo=(d,t)=>Or(d,t)&&Vi(d,t+6)+10<=d.length-t,go=d=>{const t=gn(d);for(let e=0;e<t.length;e++){const i=t[e];if(mn(i))return So(i)}},mn=d=>d&&d.key==="PRIV"&&d.info==="com.apple.streaming.transportStreamTimestamp",yo=d=>{const t=String.fromCharCode(d[0],d[1],d[2],d[3]),e=Vi(d,4),i=10;return{type:t,size:e,data:d.subarray(i,i+e)}},gn=d=>{let t=0;const e=[];for(;Or(d,t);){const i=Vi(d,t+6);t+=10;const s=t+i;for(;t+8<s;){const r=yo(d.subarray(t)),n=_o(r);n&&e.push(n),t+=r.size+10}pn(d,t)&&(t+=10)}return e},_o=d=>d.type==="PRIV"?vo(d):d.type[0]==="W"?xo(d):Eo(d),vo=d=>{if(d.size<2)return;const t=De(d.data,!0),e=new Uint8Array(d.data.subarray(t.length+1));return{key:d.type,info:t,data:e.buffer}},Eo=d=>{if(d.size<2)return;if(d.type==="TXXX"){let e=1;const i=De(d.data.subarray(e),!0);e+=i.length+1;const s=De(d.data.subarray(e));return{key:d.type,info:i,data:s}}const t=De(d.data.subarray(1));return{key:d.type,data:t}},xo=d=>{if(d.type==="WXXX"){if(d.size<2)return;let e=1;const i=De(d.data.subarray(e),!0);e+=i.length+1;const s=De(d.data.subarray(e));return{key:d.type,info:i,data:s}}const t=De(d.data);return{key:d.type,data:t}},So=d=>{if(d.data.byteLength===8){const t=new Uint8Array(d.data),e=t[3]&1;let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,e&&(i+=4772185884e-2),Math.round(i)}},De=(d,t=!1)=>{const e=To();if(e){const o=e.decode(d);if(t){const c=o.indexOf("\0");return c!==-1?o.substring(0,c):o}return o.replace(/\0/g,"")}const i=d.length;let s,r,n,a="",l=0;for(;l<i;){if(s=d[l++],s===0&&t)return a;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(s);break;case 12:case 13:r=d[l++],a+=String.fromCharCode((s&31)<<6|r&63);break;case 14:r=d[l++],n=d[l++],a+=String.fromCharCode((s&15)<<12|(r&63)<<6|(n&63)<<0);break}}return a};let er;function To(){return!er&&typeof self.TextDecoder!="undefined"&&(er=new self.TextDecoder("utf-8")),er}const we={hexDump:function(d){let t="";for(let e=0;e<d.length;e++){let i=d[e].toString(16);i.length<2&&(i="0"+i),t+=i}return t}},Ni=Math.pow(2,32)-1,bo=[].push,yn={video:1,audio:2,id3:3,text:4};function ee(d){return String.fromCharCode.apply(null,d)}function _n(d,t){const e=d[t]<<8|d[t+1];return e<0?65536+e:e}function bt(d,t){const e=vn(d,t);return e<0?4294967296+e:e}function vn(d,t){return d[t]<<24|d[t+1]<<16|d[t+2]<<8|d[t+3]}function ir(d,t,e){d[t]=e>>24,d[t+1]=e>>16&255,d[t+2]=e>>8&255,d[t+3]=e&255}function Mt(d,t){const e=[];if(!t.length)return e;const i=d.byteLength;for(let s=0;s<i;){const r=bt(d,s),n=ee(d.subarray(s+4,s+8)),a=r>1?s+r:i;if(n===t[0])if(t.length===1)e.push(d.subarray(s+8,a));else{const l=Mt(d.subarray(s+8,a),t.slice(1));l.length&&bo.apply(e,l)}s=a}return e}function Ao(d){const t=[],e=d[0];let i=8;const s=bt(d,i);i+=4;const r=0,n=0;e===0?i+=8:i+=16,i+=2;let a=d.length+n;const l=_n(d,i);i+=2;for(let o=0;o<l;o++){let c=i;const u=bt(d,c);c+=4;const h=u&2147483647;if((u&2147483648)>>>31===1)return $.warn("SIDX has hierarchical references (not supported)"),null;const m=bt(d,c);c+=4,t.push({referenceSize:h,subsegmentDuration:m,info:{duration:m/s,start:a,end:a+h-1}}),a+=h,c+=4,i=c}return{earliestPresentationTime:r,timescale:s,version:e,referencesCount:l,references:t}}function En(d){const t=[],e=Mt(d,["moov","trak"]);for(let s=0;s<e.length;s++){const r=e[s],n=Mt(r,["tkhd"])[0];if(n){let a=n[0],l=a===0?12:20;const o=bt(n,l),c=Mt(r,["mdia","mdhd"])[0];if(c){a=c[0],l=a===0?12:20;const u=bt(c,l),h=Mt(r,["mdia","hdlr"])[0];if(h){const f=ee(h.subarray(8,12)),m={soun:Ft.AUDIO,vide:Ft.VIDEO}[f];if(m){const _=Mt(r,["mdia","minf","stbl","stsd"])[0];let E;_&&(E=ee(_.subarray(12,16))),t[o]={timescale:u,type:m},t[m]={timescale:u,id:o,codec:E}}}}}}return Mt(d,["moov","mvex","trex"]).forEach(s=>{const r=bt(s,4),n=t[r];n&&(n.default={duration:bt(s,12),flags:bt(s,20)})}),t}function Lo(d,t){if(!d||!t)return d;const e=t.keyId;return e&&t.isCommonEncryption&&Mt(d,["moov","trak"]).forEach(s=>{const n=Mt(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=Mt(n,["enca"]);const l=a.length>0;l||(a=Mt(n,["encv"])),a.forEach(o=>{const c=l?o.subarray(28):o.subarray(78);Mt(c,["sinf"]).forEach(h=>{const f=xn(h);if(f){const m=f.subarray(8,24);m.some(_=>_!==0)||($.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${we.hexDump(m)} -> ${we.hexDump(e)}`),f.set(e,8))}})})}),d}function xn(d){const t=Mt(d,["schm"])[0];if(t){const e=ee(t.subarray(4,8));if(e==="cbcs"||e==="cenc")return Mt(d,["schi","tenc"])[0]}return $.error("[eme] missing 'schm' box"),null}function Io(d,t){return Mt(t,["moof","traf"]).reduce((e,i)=>{const s=Mt(i,["tfdt"])[0],r=s[0],n=Mt(i,["tfhd"]).reduce((a,l)=>{const o=bt(l,4),c=d[o];if(c){let u=bt(s,4);if(r===1){if(u===Ni)return $.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),a;u*=Ni+1,u+=bt(s,8)}const h=c.timescale||9e4,f=u/h;if(isFinite(f)&&(a===null||f<a))return f}return a},null);return n!==null&&isFinite(n)&&(e===null||n<e)?n:e},null)}function wo(d,t){let e=0,i=0,s=0;const r=Mt(d,["moof","traf"]);for(let n=0;n<r.length;n++){const a=r[n],l=Mt(a,["tfhd"])[0],o=bt(l,4),c=t[o];if(!c)continue;const u=c.default,h=bt(l,0)|(u==null?void 0:u.flags);let f=u==null?void 0:u.duration;h&8&&(h&2?f=bt(l,12):f=bt(l,8));const m=c.timescale||9e4,_=Mt(a,["trun"]);for(let E=0;E<_.length;E++){if(e=Ro(_[E]),!e&&f){const D=bt(_[E],4);e=f*D}c.type===Ft.VIDEO?i+=e/m:c.type===Ft.AUDIO&&(s+=e/m)}}if(i===0&&s===0){let n=0;const a=Mt(d,["sidx"]);for(let l=0;l<a.length;l++){const o=Ao(a[l]);o!=null&&o.references&&(n+=o.references.reduce((c,u)=>c+u.info.duration||0,0))}return n}return i||s}function Ro(d){const t=bt(d,0);let e=8;t&1&&(e+=4),t&4&&(e+=4);let i=0;const s=bt(d,4);for(let r=0;r<s;r++)t&256&&(i+=bt(d,e),e+=4),t&512&&(e+=4),t&1024&&(e+=4),t&2048&&(e+=4);return i}function Do(d,t,e){Mt(t,["moof","traf"]).forEach(i=>{Mt(i,["tfhd"]).forEach(s=>{const r=bt(s,4),n=d[r];if(!n)return;const a=n.timescale||9e4;Mt(i,["tfdt"]).forEach(l=>{const o=l[0];let c=bt(l,4);if(o===0)c-=e*a,c=Math.max(c,0),ir(l,4,c);else{c*=Math.pow(2,32),c+=bt(l,8),c-=e*a,c=Math.max(c,0);const u=Math.floor(c/(Ni+1)),h=Math.floor(c%(Ni+1));ir(l,4,u),ir(l,8,h)}})})})}function Co(d){const t={valid:null,remainder:null},e=Mt(d,["moof"]);if(e){if(e.length<2)return t.remainder=d,t}else return t;const i=e[e.length-1];return t.valid=ei(d,0,i.byteOffset-8),t.remainder=ei(d,i.byteOffset-8),t}function ii(d,t){const e=new Uint8Array(d.length+t.length);return e.set(d),e.set(t,d.length),e}function ps(d,t){const e=[],i=t.samples,s=t.timescale,r=t.id;let n=!1;return Mt(i,["moof"]).map(l=>{const o=l.byteOffset-8;Mt(l,["traf"]).map(u=>{const h=Mt(u,["tfdt"]).map(f=>{const m=f[0];let _=bt(f,4);return m===1&&(_*=Math.pow(2,32),_+=bt(f,8)),_/s})[0];return h!==void 0&&(d=h),Mt(u,["tfhd"]).map(f=>{const m=bt(f,4),_=bt(f,0)&16777215,E=(_&1)!==0,D=(_&2)!==0,O=(_&8)!==0;let I=0;const x=(_&16)!==0;let P=0;const C=(_&32)!==0;let b=8;m===r&&(E&&(b+=8),D&&(b+=4),O&&(I=bt(f,b),b+=4),x&&(P=bt(f,b),b+=4),C&&(b+=4),t.type==="video"&&(n=ko(t.codec)),Mt(u,["trun"]).map(S=>{const L=S[0],A=bt(S,0)&16777215,U=(A&1)!==0;let B=0;const G=(A&4)!==0,Q=(A&256)!==0;let nt=0;const ot=(A&512)!==0;let V=0;const R=(A&1024)!==0,N=(A&2048)!==0;let j=0;const X=bt(S,4);let rt=8;U&&(B=bt(S,rt),rt+=4),G&&(rt+=4);let lt=B+o;for(let Tt=0;Tt<X;Tt++){if(Q?(nt=bt(S,rt),rt+=4):nt=I,ot?(V=bt(S,rt),rt+=4):V=P,R&&(rt+=4),N&&(L===0?j=bt(S,rt):j=vn(S,rt),rt+=4),t.type===Ft.VIDEO){let wt=0;for(;wt<V;){const Rt=bt(i,lt);if(lt+=4,Mo(n,i[lt])){const tt=i.subarray(lt,lt+Rt);Sn(tt,n?2:1,d+j/s,e)}lt+=Rt,wt+=Rt+4}}d+=nt/s}}))})})}),e}function ko(d){if(!d)return!1;const t=d.indexOf("."),e=t<0?d:d.substring(0,t);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Mo(d,t){if(d){const e=t>>1&63;return e===39||e===40}else return(t&31)===6}function Sn(d,t,e,i){const s=Tn(d);let r=0;r+=t;let n=0,a=0,l=!1,o=0;for(;r<s.length;){n=0;do{if(r>=s.length)break;o=s[r++],n+=o}while(o===255);a=0;do{if(r>=s.length)break;o=s[r++],a+=o}while(o===255);const c=s.length-r;if(!l&&n===4&&r<s.length){if(l=!0,s[r++]===181){const h=_n(s,r);if(r+=2,h===49){const f=bt(s,r);if(r+=4,f===1195456820){const m=s[r++];if(m===3){const _=s[r++],E=31&_,D=64&_,O=D?2+E*3:0,I=new Uint8Array(O);if(D){I[0]=_;for(let x=1;x<O;x++)I[x]=s[r++]}i.push({type:m,payloadType:n,pts:e,bytes:I})}}}}}else if(n===5&&a<c){if(l=!0,a>16){const u=[];for(let m=0;m<16;m++){const _=s[r++].toString(16);u.push(_.length==1?"0"+_:_),(m===3||m===5||m===7||m===9)&&u.push("-")}const h=a-16,f=new Uint8Array(h);for(let m=0;m<h;m++)f[m]=s[r++];i.push({payloadType:n,pts:e,uuid:u.join(""),userData:De(f),userDataBytes:f})}}else if(a<c)r+=a;else if(a>c)break}}function Tn(d){const t=d.byteLength,e=[];let i=1;for(;i<t-2;)d[i]===0&&d[i+1]===0&&d[i+2]===3?(e.push(i+2),i+=2):i++;if(e.length===0)return d;const s=t-e.length,r=new Uint8Array(s);let n=0;for(i=0;i<s;n++,i++)n===e[0]&&(n++,e.shift()),r[i]=d[n];return r}function Po(d){const t=d[0];let e="",i="",s=0,r=0,n=0,a=0,l=0,o=0;if(t===0){for(;ee(d.subarray(o,o+1))!=="\0";)e+=ee(d.subarray(o,o+1)),o+=1;for(e+=ee(d.subarray(o,o+1)),o+=1;ee(d.subarray(o,o+1))!=="\0";)i+=ee(d.subarray(o,o+1)),o+=1;i+=ee(d.subarray(o,o+1)),o+=1,s=bt(d,12),r=bt(d,16),a=bt(d,20),l=bt(d,24),o=28}else if(t===1){o+=4,s=bt(d,o),o+=4;const u=bt(d,o);o+=4;const h=bt(d,o);for(o+=4,n=ss(2,32)*u+h,Number.isSafeInteger(n)||(n=Number.MAX_SAFE_INTEGER,$.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=bt(d,o),o+=4,l=bt(d,o),o+=4;ee(d.subarray(o,o+1))!=="\0";)e+=ee(d.subarray(o,o+1)),o+=1;for(e+=ee(d.subarray(o,o+1)),o+=1;ee(d.subarray(o,o+1))!=="\0";)i+=ee(d.subarray(o,o+1)),o+=1;i+=ee(d.subarray(o,o+1)),o+=1}const c=d.subarray(o,d.byteLength);return{schemeIdUri:e,value:i,timeScale:s,presentationTime:n,presentationTimeDelta:r,eventDuration:a,id:l,payload:c}}function Oo(d,...t){const e=t.length;let i=8,s=e;for(;s--;)i+=t[s].byteLength;const r=new Uint8Array(i);for(r[0]=i>>24&255,r[1]=i>>16&255,r[2]=i>>8&255,r[3]=i&255,r.set(d,4),s=0,i=8;s<e;s++)r.set(t[s],i),i+=t[s].byteLength;return r}function No(d,t,e){if(d.byteLength!==16)throw new RangeError("Invalid system id");let i,s;if(t){i=1,s=new Uint8Array(t.length*16);for(let a=0;a<t.length;a++){const l=t[a];if(l.byteLength!==16)throw new RangeError("Invalid key");s.set(l,a*16)}}else i=0,s=new Uint8Array;let r;i>0?(r=new Uint8Array(4),t.length>0&&new DataView(r.buffer).setUint32(0,t.length,!1)):r=new Uint8Array;const n=new Uint8Array(4);return e&&e.byteLength>0&&new DataView(n.buffer).setUint32(0,e.byteLength,!1),Oo([112,115,115,104],new Uint8Array([i,0,0,0]),d,r,s,n,e||new Uint8Array)}function Fo(d){if(!(d instanceof ArrayBuffer)||d.byteLength<32)return null;const t={version:0,systemId:"",kids:null,data:null},e=new DataView(d),i=e.getUint32(0);if(d.byteLength!==i&&i>44||e.getUint32(4)!==1886614376||(t.version=e.getUint32(8)>>>24,t.version>1))return null;t.systemId=we.hexDump(new Uint8Array(d,12,16));const r=e.getUint32(28);if(t.version===0){if(i-32<r)return null;t.data=new Uint8Array(d,32,r)}else if(t.version===1){t.kids=[];for(let n=0;n<r;n++)t.kids.push(new Uint8Array(d,32+n*16,16))}return t}let bi={};class yi{static clearKeyUriToKeyIdMap(){bi={}}constructor(t,e,i,s=[1],r=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=i,this.keyFormatVersions=s,this.iv=r,this.encrypted=t?t!=="NONE":!1,this.isCommonEncryption=this.encrypted&&t!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ue.FAIRPLAY:case ue.WIDEVINE:case ue.PLAYREADY:case ue.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(t){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof t!="number"&&(this.method==="AES-128"&&!this.iv&&$.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0);const i=Bo(t);return new yi(this.method,this.uri,"identity",this.keyFormatVersions,i)}const e=uo(this.uri);if(e)switch(this.keyFormat){case ue.WIDEVINE:this.pssh=e,e.length>=22&&(this.keyId=e.subarray(e.length-22,e.length-6));break;case ue.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=No(i,null,e);const s=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),r=String.fromCharCode.apply(null,Array.from(s)),n=r.substring(r.indexOf("<"),r.length),o=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(o){const c=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(c){const u=Pr(c).subarray(0,16);co(u),this.keyId=u}}break}default:{let i=e.subarray(0,16);if(i.length!==16){const s=new Uint8Array(16);s.set(i,16-i.length),i=s}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=bi[this.uri];if(!i){const s=Object.keys(bi).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,s),bi[this.uri]=i}this.keyId=i}return this}}function Bo(d){const t=new Uint8Array(16);for(let e=12;e<16;e++)t[e]=d>>8*(15-e)&255;return t}const bn=/\{\$([a-zA-Z0-9-_]+)\}/g;function ms(d){return bn.test(d)}function ce(d,t,e){if(d.variableList!==null||d.hasVariableRefs)for(let i=e.length;i--;){const s=e[i],r=t[s];r&&(t[s]=br(d,r))}}function br(d,t){if(d.variableList!==null||d.hasVariableRefs){const e=d.variableList;return t.replace(bn,i=>{const s=i.substring(2,i.length-1),r=e==null?void 0:e[s];return r===void 0?(d.playlistParsingError||(d.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),i):r})}return t}function gs(d,t,e){let i=d.variableList;i||(d.variableList=i={});let s,r;if("QUERYPARAM"in t){s=t.QUERYPARAM;try{const n=new self.URL(e).searchParams;if(n.has(s))r=n.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${e}"`)}catch(n){d.playlistParsingError||(d.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${n.message}`))}}else s=t.NAME,r=t.VALUE;s in i?d.playlistParsingError||(d.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=r||""}function Uo(d,t,e){const i=t.IMPORT;if(e&&i in e){let s=d.variableList;s||(d.variableList=s={}),s[i]=e[i]}else d.playlistParsingError||(d.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}function $i(){if(typeof self!="undefined")return self.MediaSource||self.WebKitMediaSource}const jo={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},ys=$i();function Go(d,t){const e=jo[t];return!!e&&e[d.slice(0,4)]===!0}function rr(d,t){var e;return(e=ys==null?void 0:ys.isTypeSupported(`${t||"video"}/mp4;codecs="${d}"`))!=null?e:!1}const _s=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,vs=/#EXT-X-MEDIA:(.*)/g,Vo=/^#EXT(?:INF|-X-TARGETDURATION):/m,Es=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),$o=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Ae{static findGroup(t,e){for(let i=0;i<t.length;i++){const s=t[i];if(s.id===e)return s}}static convertAVC1ToAVCOTI(t){const e=t.split(".");if(e.length>2){let i=e.shift()+".";return i+=parseInt(e.shift()).toString(16),i+=("000"+parseInt(e.shift()).toString(16)).slice(-4),i}return t}static resolve(t,e){return Mr.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return Vo.test(t)}static parseMasterPlaylist(t,e){const i=ms(t),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},r=[];_s.lastIndex=0;let n;for(;(n=_s.exec(t))!=null;)if(n[1]){var a;const o=new $t(n[1]);ce(s,o,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const c=br(s,n[2]),u={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:Ae.resolve(c,e)},h=o.decimalResolution("RESOLUTION");h&&(u.width=h.width,u.height=h.height),zo((o.CODECS||"").split(/[ ,]+/).filter(f=>f),u),u.videoCodec&&u.videoCodec.indexOf("avc1")!==-1&&(u.videoCodec=Ae.convertAVC1ToAVCOTI(u.videoCodec)),(a=u.unknownCodecs)!=null&&a.length||r.push(u),s.levels.push(u)}else if(n[3]){const o=n[3],c=n[4];switch(o){case"SESSION-DATA":{const u=new $t(c);ce(s,u,["DATA-ID","LANGUAGE","VALUE","URI"]);const h=u["DATA-ID"];h&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[h]=u);break}case"SESSION-KEY":{const u=xs(c,e,s);u.encrypted&&u.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(u)):$.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const u=new $t(c);ce(s,u,["NAME","VALUE","QUERYPARAM"]),gs(s,u,e)}break}case"CONTENT-STEERING":{const u=new $t(c);ce(s,u,["SERVER-URI","PATHWAY-ID"]),s.contentSteering={uri:Ae.resolve(u["SERVER-URI"],e),pathwayId:u["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Ss(c);break}}}const l=r.length>0&&r.length<s.levels.length;return s.levels=l?r:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(t,e,i){let s;const r={},n=i.levels,a={AUDIO:n.map(o=>({id:o.attrs.AUDIO,audioCodec:o.audioCodec})),SUBTITLES:n.map(o=>({id:o.attrs.SUBTITLES,textCodec:o.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(vs.lastIndex=0;(s=vs.exec(t))!==null;){const o=new $t(s[1]),c=o.TYPE;if(c){const u=a[c],h=r[c]||[];r[c]=h,ce(i,o,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const f={attrs:o,bitrate:0,id:l++,groupId:o["GROUP-ID"]||"",instreamId:o["INSTREAM-ID"],name:o.NAME||o.LANGUAGE||"",type:c,default:o.bool("DEFAULT"),autoselect:o.bool("AUTOSELECT"),forced:o.bool("FORCED"),lang:o.LANGUAGE,url:o.URI?Ae.resolve(o.URI,e):""};if(u!=null&&u.length){const m=Ae.findGroup(u,f.groupId)||u[0];Ts(f,m,"audioCodec"),Ts(f,m,"textCodec")}h.push(f)}}return r}static parseLevelPlaylist(t,e,i,s,r,n){const a=new oo(e),l=a.fragments;let o=null,c=0,u=0,h=0,f=0,m=null,_=new Ji(s,e),E,D,O,I=-1,x=!1;for(Es.lastIndex=0,a.m3u8=t,a.hasVariableRefs=ms(t);(E=Es.exec(t))!==null;){x&&(x=!1,_=new Ji(s,e),_.start=h,_.sn=c,_.cc=f,_.level=i,o&&(_.initSegment=o,_.rawProgramDateTime=o.rawProgramDateTime,o.rawProgramDateTime=null));const S=E[1];if(S){_.duration=parseFloat(S);const L=(" "+E[2]).slice(1);_.title=L||null,_.tagList.push(L?["INF",S,L]:["INF",S])}else if(E[3]){if(_t(_.duration)){_.start=h,O&&Ls(_,O,a),_.sn=c,_.level=i,_.cc=f,_.urlId=r,l.push(_);const L=(" "+E[3]).slice(1);_.relurl=br(a,L),bs(_,m),m=_,h+=_.duration,c++,u=0,x=!0}}else if(E[4]){const L=(" "+E[4]).slice(1);m?_.setByteRange(L,m):_.setByteRange(L)}else if(E[5])_.rawProgramDateTime=(" "+E[5]).slice(1),_.tagList.push(["PROGRAM-DATE-TIME",_.rawProgramDateTime]),I===-1&&(I=l.length);else{if(E=E[0].match($o),!E){$.warn("No matches on slow regex match for level playlist!");continue}for(D=1;D<E.length&&typeof E[D]=="undefined";D++);const L=(" "+E[D]).slice(1),A=(" "+E[D+1]).slice(1),U=E[D+2]?(" "+E[D+2]).slice(1):"";switch(L){case"PLAYLIST-TYPE":a.type=A.toUpperCase();break;case"MEDIA-SEQUENCE":c=a.startSN=parseInt(A);break;case"SKIP":{const B=new $t(A);ce(a,B,["RECENTLY-REMOVED-DATERANGES"]);const G=B.decimalInteger("SKIPPED-SEGMENTS");if(_t(G)){a.skippedSegments=G;for(let nt=G;nt--;)l.unshift(null);c+=G}const Q=B.enumeratedString("RECENTLY-REMOVED-DATERANGES");Q&&(a.recentlyRemovedDateranges=Q.split("	"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(A),1);break;case"VERSION":a.version=parseInt(A);break;case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(A||U)&&_.tagList.push(U?[A,U]:[A]);break;case"DISCONTINUITY":f++,_.tagList.push(["DIS"]);break;case"GAP":_.gap=!0,_.tagList.push([L]);break;case"BITRATE":_.tagList.push([L,A]);break;case"DATERANGE":{const B=new $t(A);ce(a,B,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),ce(a,B,B.clientAttrs);const G=new cn(B,a.dateRanges[B.ID]);G.isValid||a.skippedSegments?a.dateRanges[G.id]=G:$.warn(`Ignoring invalid DATERANGE tag: "${A}"`),_.tagList.push(["EXT-X-DATERANGE",A]);break}case"DEFINE":{{const B=new $t(A);ce(a,B,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in B?Uo(a,B,n):gs(a,B,e)}break}case"DISCONTINUITY-SEQUENCE":f=parseInt(A);break;case"KEY":{const B=xs(A,e,a);if(B.isSupported()){if(B.method==="NONE"){O=void 0;break}O||(O={}),O[B.keyFormat]&&(O=Zt({},O)),O[B.keyFormat]=B}else $.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${A}"`);break}case"START":a.startTimeOffset=Ss(A);break;case"MAP":{const B=new $t(A);if(ce(a,B,["BYTERANGE","URI"]),_.duration){const G=new Ji(s,e);As(G,B,i,O),o=G,_.initSegment=o,o.rawProgramDateTime&&!_.rawProgramDateTime&&(_.rawProgramDateTime=o.rawProgramDateTime)}else As(_,B,i,O),o=_,x=!0;break}case"SERVER-CONTROL":{const B=new $t(A);a.canBlockReload=B.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=B.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&B.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=B.optionalFloat("PART-HOLD-BACK",0),a.holdBack=B.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const B=new $t(A);a.partTarget=B.decimalFloatingPoint("PART-TARGET");break}case"PART":{let B=a.partList;B||(B=a.partList=[]);const G=u>0?B[B.length-1]:void 0,Q=u++,nt=new $t(A);ce(a,nt,["BYTERANGE","URI"]);const ot=new no(nt,_,e,Q,G);B.push(ot),_.duration+=ot.duration;break}case"PRELOAD-HINT":{const B=new $t(A);ce(a,B,["URI"]),a.preloadHint=B;break}case"RENDITION-REPORT":{const B=new $t(A);ce(a,B,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(B);break}default:$.warn(`line parsed but not handled: ${E}`);break}}}m&&!m.relurl?(l.pop(),h-=m.duration,a.partList&&(a.fragmentHint=m)):a.partList&&(bs(_,m),_.cc=f,a.fragmentHint=_,O&&Ls(_,O,a));const P=l.length,C=l[0],b=l[P-1];if(h+=a.skippedSegments*a.targetduration,h>0&&P&&b){a.averagetargetduration=h/P;const S=b.sn;a.endSN=S!=="initSegment"?S:0,a.live||(b.endList=!0),C&&(a.startCC=C.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(h+=a.fragmentHint.duration),a.totalduration=h,a.endCC=f,I>0&&Ho(l,I),a}}function xs(d,t,e){var i,s;const r=new $t(d);ce(e,r,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const n=(i=r.METHOD)!=null?i:"",a=r.URI,l=r.hexadecimalInteger("IV"),o=r.KEYFORMATVERSIONS,c=(s=r.KEYFORMAT)!=null?s:"identity";a&&r.IV&&!l&&$.error(`Invalid IV: ${r.IV}`);const u=a?Ae.resolve(a,t):"",h=(o||"1").split("/").map(Number).filter(Number.isFinite);return new yi(n,u,c,h,l)}function Ss(d){const e=new $t(d).decimalFloatingPoint("TIME-OFFSET");return _t(e)?e:null}function zo(d,t){["video","audio","text"].forEach(e=>{const i=d.filter(s=>Go(s,e));if(i.length){const s=i.filter(r=>r.lastIndexOf("avc1",0)===0||r.lastIndexOf("mp4a",0)===0);t[`${e}Codec`]=s.length>0?s[0]:i[0],d=d.filter(r=>i.indexOf(r)===-1)}}),t.unknownCodecs=d}function Ts(d,t,e){const i=t[e];i&&(d[e]=i)}function Ho(d,t){let e=d[t];for(let i=t;i--;){const s=d[i];if(!s)return;s.programDateTime=e.programDateTime-s.duration*1e3,e=s}}function bs(d,t){d.rawProgramDateTime?d.programDateTime=Date.parse(d.rawProgramDateTime):t!=null&&t.programDateTime&&(d.programDateTime=t.endProgramDateTime),_t(d.programDateTime)||(d.programDateTime=null,d.rawProgramDateTime=null)}function As(d,t,e,i){d.relurl=t.URI,t.BYTERANGE&&d.setByteRange(t.BYTERANGE),d.level=e,d.sn="initSegment",i&&(d.levelkeys=i),d.initSegment=null}function Ls(d,t,e){d.levelkeys=t;const{encryptedFragments:i}=e;(!i.length||i[i.length-1].levelkeys!==t)&&Object.keys(t).some(s=>t[s].isCommonEncryption)&&i.push(d)}var Pt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},xt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Is(d){const{type:t}=d;switch(t){case Pt.AUDIO_TRACK:return xt.AUDIO;case Pt.SUBTITLE_TRACK:return xt.SUBTITLE;default:return xt.MAIN}}function sr(d,t){let e=d.url;return(e===void 0||e.indexOf("data:")===0)&&(e=t.url),e}class Yo{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.LEVEL_LOADING,this.onLevelLoading,this),t.on(w.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(w.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:t}=this;t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.LEVEL_LOADING,this.onLevelLoading,this),t.off(w.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(w.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(t){const e=this.hls.config,i=e.pLoader,s=e.loader,r=i||s,n=new r(e);return this.loaders[t.type]=n,n}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,e){const{url:i}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Pt.MANIFEST,url:i,deliveryDirectives:null})}onLevelLoading(t,e){const{id:i,level:s,url:r,deliveryDirectives:n}=e;this.load({id:i,level:s,responseType:"text",type:Pt.LEVEL,url:r,deliveryDirectives:n})}onAudioTrackLoading(t,e){const{id:i,groupId:s,url:r,deliveryDirectives:n}=e;this.load({id:i,groupId:s,level:null,responseType:"text",type:Pt.AUDIO_TRACK,url:r,deliveryDirectives:n})}onSubtitleTrackLoading(t,e){const{id:i,groupId:s,url:r,deliveryDirectives:n}=e;this.load({id:i,groupId:s,level:null,responseType:"text",type:Pt.SUBTITLE_TRACK,url:r,deliveryDirectives:n})}load(t){var e;const i=this.hls.config;let s=this.getInternalLoader(t);if(s){const o=s.context;if(o&&o.url===t.url){$.trace("[playlist-loader]: playlist request ongoing");return}$.log(`[playlist-loader]: aborting previous loader for type: ${t.type}`),s.abort()}let r;if(t.type===Pt.MANIFEST?r=i.manifestLoadPolicy.default:r=Zt({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(t),(e=t.deliveryDirectives)!=null&&e.part){let o;if(t.type===Pt.LEVEL&&t.level!==null?o=this.hls.levels[t.level].details:t.type===Pt.AUDIO_TRACK&&t.id!==null?o=this.hls.audioTracks[t.id].details:t.type===Pt.SUBTITLE_TRACK&&t.id!==null&&(o=this.hls.subtitleTracks[t.id].details),o){const c=o.partTarget,u=o.targetduration;if(c&&u){const h=Math.max(c*3,u*.8)*1e3;r=Zt({},r,{maxTimeToFirstByteMs:Math.min(h,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,r.maxTimeToFirstByteMs)})}}}const n=r.errorRetry||r.timeoutRetry||{},a={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0},l={onSuccess:(o,c,u,h)=>{const f=this.getInternalLoader(u);this.resetInternalLoader(u.type);const m=o.data;if(m.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(o,u,new Error("no EXTM3U delimiter"),h||null,c);return}c.parsing.start=performance.now(),Ae.isMediaPlaylist(m)?this.handleTrackOrLevelPlaylist(o,c,u,h||null,f):this.handleMasterPlaylist(o,c,u,h)},onError:(o,c,u,h)=>{this.handleNetworkError(c,u,!1,o,h)},onTimeout:(o,c,u)=>{this.handleNetworkError(c,u,!0,void 0,o)}};s.load(t,a,l)}handleMasterPlaylist(t,e,i,s){const r=this.hls,n=t.data,a=sr(t,i),l=Ae.parseMasterPlaylist(n,a);if(l.playlistParsingError){this.handleManifestParsingError(t,i,l.playlistParsingError,s,e);return}const{contentSteering:o,levels:c,sessionData:u,sessionKeys:h,startTimeOffset:f,variableList:m}=l;this.variableList=m;const{AUDIO:_=[],SUBTITLES:E,"CLOSED-CAPTIONS":D}=Ae.parseMasterPlaylistMedia(n,a,l);_.length&&!_.some(I=>!I.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&($.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),_.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new $t({}),bitrate:0,url:""})),r.trigger(w.MANIFEST_LOADED,{levels:c,audioTracks:_,subtitles:E,captions:D,contentSteering:o,url:a,stats:e,networkDetails:s,sessionData:u,sessionKeys:h,startTimeOffset:f,variableList:m})}handleTrackOrLevelPlaylist(t,e,i,s,r){const n=this.hls,{id:a,level:l,type:o}=i,c=sr(t,i),u=_t(a)?a:0,h=_t(l)?l:u,f=Is(i),m=Ae.parseLevelPlaylist(t.data,c,h,f,u,this.variableList);if(o===Pt.MANIFEST){const _={attrs:new $t({}),bitrate:0,details:m,name:"",url:c};n.trigger(w.MANIFEST_LOADED,{levels:[_],audioTracks:[],url:c,stats:e,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),i.levelDetails=m,this.handlePlaylistLoaded(m,t,e,i,s,r)}handleManifestParsingError(t,e,i,s,r){this.hls.trigger(w.ERROR,{type:Et.NETWORK_ERROR,details:J.MANIFEST_PARSING_ERROR,fatal:e.type===Pt.MANIFEST,url:t.url,err:i,error:i,reason:i.message,response:t,context:e,networkDetails:s,stats:r})}handleNetworkError(t,e,i=!1,s,r){let n=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${t.type}`;t.type===Pt.LEVEL?n+=`: ${t.level} id: ${t.id}`:(t.type===Pt.AUDIO_TRACK||t.type===Pt.SUBTITLE_TRACK)&&(n+=` id: ${t.id} group-id: "${t.groupId}"`);const a=new Error(n);$.warn(`[playlist-loader]: ${n}`);let l=J.UNKNOWN,o=!1;const c=this.getInternalLoader(t);switch(t.type){case Pt.MANIFEST:l=i?J.MANIFEST_LOAD_TIMEOUT:J.MANIFEST_LOAD_ERROR,o=!0;break;case Pt.LEVEL:l=i?J.LEVEL_LOAD_TIMEOUT:J.LEVEL_LOAD_ERROR,o=!1;break;case Pt.AUDIO_TRACK:l=i?J.AUDIO_TRACK_LOAD_TIMEOUT:J.AUDIO_TRACK_LOAD_ERROR,o=!1;break;case Pt.SUBTITLE_TRACK:l=i?J.SUBTITLE_TRACK_LOAD_TIMEOUT:J.SUBTITLE_LOAD_ERROR,o=!1;break}c&&this.resetInternalLoader(t.type);const u={type:Et.NETWORK_ERROR,details:l,fatal:o,url:t.url,loader:c,context:t,error:a,networkDetails:e,stats:r};if(s){const h=(e==null?void 0:e.url)||t.url;u.response=he({url:h,data:void 0},s)}this.hls.trigger(w.ERROR,u)}handlePlaylistLoaded(t,e,i,s,r,n){const a=this.hls,{type:l,level:o,id:c,groupId:u,deliveryDirectives:h}=s,f=sr(e,s),m=Is(s),_=typeof s.level=="number"&&m===xt.MAIN?o:void 0;if(!t.fragments.length){const D=new Error("No Segments found in Playlist");a.trigger(w.ERROR,{type:Et.NETWORK_ERROR,details:J.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:D,reason:D.message,response:e,context:s,level:_,parent:m,networkDetails:r,stats:i});return}t.targetduration||(t.playlistParsingError=new Error("Missing Target Duration"));const E=t.playlistParsingError;if(E){a.trigger(w.ERROR,{type:Et.NETWORK_ERROR,details:J.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:E,reason:E.message,response:e,context:s,level:_,parent:m,networkDetails:r,stats:i});return}switch(t.live&&n&&(n.getCacheAge&&(t.ageHeader=n.getCacheAge()||0),(!n.getCacheAge||isNaN(t.ageHeader))&&(t.ageHeader=0)),l){case Pt.MANIFEST:case Pt.LEVEL:a.trigger(w.LEVEL_LOADED,{details:t,level:_||0,id:c||0,stats:i,networkDetails:r,deliveryDirectives:h});break;case Pt.AUDIO_TRACK:a.trigger(w.AUDIO_TRACK_LOADED,{details:t,id:c||0,groupId:u||"",stats:i,networkDetails:r,deliveryDirectives:h});break;case Pt.SUBTITLE_TRACK:a.trigger(w.SUBTITLE_TRACK_LOADED,{details:t,id:c||0,groupId:u||"",stats:i,networkDetails:r,deliveryDirectives:h});break}}}function An(d,t){let e;try{e=new Event("addtrack")}catch(i){e=document.createEvent("Event"),e.initEvent("addtrack",!1,!1)}e.track=d,t.dispatchEvent(e)}function Ln(d,t){const e=d.mode;if(e==="disabled"&&(d.mode="hidden"),d.cues&&!d.cues.getCueById(t.id))try{if(d.addCue(t),!d.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(i){$.debug(`[texttrack-utils]: ${i}`);const s=new self.TextTrackCue(t.startTime,t.endTime,t.text);s.id=t.id,d.addCue(s)}e==="disabled"&&(d.mode=e)}function li(d){const t=d.mode;if(t==="disabled"&&(d.mode="hidden"),d.cues)for(let e=d.cues.length;e--;)d.removeCue(d.cues[e]);t==="disabled"&&(d.mode=t)}function Ar(d,t,e,i){const s=d.mode;if(s==="disabled"&&(d.mode="hidden"),d.cues&&d.cues.length>0){const r=Wo(d.cues,t,e);for(let n=0;n<r.length;n++)(!i||i(r[n]))&&d.removeCue(r[n])}s==="disabled"&&(d.mode=s)}function Ko(d,t){if(t<d[0].startTime)return 0;const e=d.length-1;if(t>d[e].endTime)return-1;let i=0,s=e;for(;i<=s;){const r=Math.floor((s+i)/2);if(t<d[r].startTime)s=r-1;else if(t>d[r].startTime&&i<e)i=r+1;else return r}return d[i].startTime-t<t-d[s].startTime?i:s}function Wo(d,t,e){const i=[],s=Ko(d,t);if(s>-1)for(let r=s,n=d.length;r<n;r++){const a=d[r];if(a.startTime>=t&&a.endTime<=e)i.push(a);else if(a.startTime>e)return i}return i}var be={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const qo=.25;function Lr(){if(typeof self!="undefined")return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const Ai=(()=>{const d=Lr();try{new d(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function nr(d,t){return d.getTime()/1e3-t}function Qo(d){return Uint8Array.from(d.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class Xo{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:t}=this;t.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(w.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:t}=this;t.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(w.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(t,e){this.media=e.media}onMediaDetaching(){!this.id3Track||(li(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const e=this.getID3Track(t.textTracks);return e.mode="hidden",e}getID3Track(t){if(!!this.media){for(let e=0;e<t.length;e++){const i=t[e];if(i.kind==="metadata"&&i.label==="id3")return An(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,e){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:s}}}=this;if(!i&&!s)return;const{samples:r}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const n=Lr();for(let a=0;a<r.length;a++){const l=r[a].type;if(l===be.emsg&&!i||!s)continue;const o=gn(r[a].data);if(o){const c=r[a].pts;let u=c+r[a].duration;u>Ai&&(u=Ai),u-c<=0&&(u=c+qo);for(let f=0;f<o.length;f++){const m=o[f];if(!mn(m)){this.updateId3CueEnds(c);const _=new n(c,u,"");_.value=m,l&&(_.type=l),this.id3Track.addCue(_)}}}}}updateId3CueEnds(t){var e;const i=(e=this.id3Track)==null?void 0:e.cues;if(i)for(let s=i.length;s--;){const r=i[s];r.startTime<t&&r.endTime===Ai&&(r.endTime=t)}}onBufferFlushing(t,{startOffset:e,endOffset:i,type:s}){const{id3Track:r,hls:n}=this;if(!n)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=n;if(r&&(a||l)){let o;s==="audio"?o=c=>c.type===be.audioId3&&l:s==="video"?o=c=>c.type===be.emsg&&a:o=c=>c.type===be.audioId3&&l||c.type===be.emsg&&a,Ar(r,e,i,o)}}onLevelUpdated(t,{details:e}){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:i,id3Track:s}=this,{dateRanges:r}=e,n=Object.keys(r);if(s){const c=Object.keys(i).filter(u=>!n.includes(u));for(let u=c.length;u--;){const h=c[u];Object.keys(i[h].cues).forEach(f=>{s.removeCue(i[h].cues[f])}),delete i[h]}}const a=e.fragments[e.fragments.length-1];if(n.length===0||!_t(a==null?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=a.programDateTime/1e3-a.start,o=Lr();for(let c=0;c<n.length;c++){const u=n[c],h=r[u],f=i[u],m=(f==null?void 0:f.cues)||{};let _=(f==null?void 0:f.durationKnown)||!1;const E=nr(h.startDate,l);let D=Ai;const O=h.endDate;if(O)D=nr(O,l),_=!0;else if(h.endOnNext&&!_){const x=n.reduce((P,C)=>{const b=r[C];return b.class===h.class&&b.id!==C&&b.startDate>h.startDate&&P.push(b),P},[]).sort((P,C)=>P.startDate.getTime()-C.startDate.getTime())[0];x&&(D=nr(x.startDate,l),_=!0)}const I=Object.keys(h.attr);for(let x=0;x<I.length;x++){const P=I[x];if(!ro(P))continue;let C=m[P];if(C)_&&!f.durationKnown&&(C.endTime=D);else{let b=h.attr[P];C=new o(E,D,""),so(P)&&(b=Qo(b)),C.value={key:P,data:b},C.type=be.dateRange,C.id=u,this.id3Track.addCue(C),m[P]=C}}i[u]={cues:m,dateRange:h,durationKnown:_}}}}class Zo{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=t,this.config=t.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:t,levelDetails:e}=this;return t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const{levelDetails:t}=this;if(t===null)return null;const{holdBack:e,partHoldBack:i,targetduration:s}=t,{liveSyncDuration:r,liveSyncDurationCount:n,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let o=a&&i||e;(l.liveSyncDuration||l.liveSyncDurationCount||o===0)&&(o=r!==void 0?r:n*s);const c=s,u=1;return o+Math.min(this.stallCount*u,c)}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency,i=this.levelDetails;if(t===null||e===null||i===null)return null;const s=i.edge,r=t-e-this.edgeStalled,n=s-i.totalduration,a=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(n,r),a)}get drift(){const{levelDetails:t}=this;return t===null?1:t.drift}get edgeStalled(){const{levelDetails:t}=this;if(t===null)return 0;const e=(this.config.lowLatencyMode&&t.partTarget||t.targetduration)*3;return Math.max(t.age-e,0)}get forwardBufferLength(){const{media:t,levelDetails:e}=this;if(!t||!e)return 0;const i=t.buffered.length;return(i?t.buffered.end(i-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(w.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(w.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(w.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(w.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(w.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(w.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(t,{details:e}){this.levelDetails=e,e.advanced&&this.timeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(t,e){var i;e.details===J.BUFFER_STALLED_ERROR&&(this.stallCount++,(i=this.levelDetails)!=null&&i.live&&$.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:t,levelDetails:e}=this;if(!t||!e)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:r}=this.config;if(!s||r===1)return;const n=this.targetLatency;if(n===null)return;const a=i-n,l=Math.min(this.maxLatency,n+e.targetduration),o=a<l;if(e.live&&o&&a>.05&&this.forwardBufferLength>1){const c=Math.min(2,Math.max(1,r)),u=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;t.playbackRate=Math.min(c,Math.max(1,u))}else t.playbackRate!==1&&t.playbackRate!==0&&(t.playbackRate=1)}estimateLiveEdge(){const{levelDetails:t}=this;return t===null?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return t===null?null:t-this.currentTime}}const Ir=["NONE","TYPE-0","TYPE-1",null];var gi={No:"",Yes:"YES",v2:"v2"};function Jo(d,t){const{canSkipUntil:e,canSkipDateRanges:i,endSN:s}=d,r=t!==void 0?t-s:0;return e&&r<e?i?gi.v2:gi.Yes:gi.No}class ws{constructor(t,e,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=i}addDirectives(t){const e=new self.URL(t);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class _i{constructor(t){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(e=>e).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(t){const e=t%this.url.length;this._urlId!==e&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=e)}get audioGroupId(){var t;return(t=this.audioGroupIds)==null?void 0:t[this.urlId]}get textGroupId(){var t;return(t=this.textGroupIds)==null?void 0:t[this.urlId]}addFallback(t){this.url.push(t.url),this._attrs.push(t.attrs)}}function ar(d,t){const e=t.startPTS;if(_t(e)){let i=0,s;t.sn>d.sn?(i=e-d.start,s=d):(i=d.start-e,s=t),s.duration!==i&&(s.duration=i)}else t.sn>d.sn?d.cc===t.cc&&d.minEndPTS?t.start=d.start+(d.minEndPTS-d.start):t.start=d.start+d.duration:t.start=Math.max(d.start-t.duration,0)}function In(d,t,e,i,s,r){i-e<=0&&($.warn("Fragment should have a positive duration",t),i=e+t.duration,r=s+t.duration);let a=e,l=i;const o=t.startPTS,c=t.endPTS;if(_t(o)){const E=Math.abs(o-e);_t(t.deltaPTS)?t.deltaPTS=Math.max(E,t.deltaPTS):t.deltaPTS=E,a=Math.max(e,o),e=Math.min(e,o),s=Math.min(s,t.startDTS),l=Math.min(i,c),i=Math.max(i,c),r=Math.max(r,t.endDTS)}const u=e-t.start;t.start!==0&&(t.start=e),t.duration=i-t.start,t.startPTS=e,t.maxStartPTS=a,t.startDTS=s,t.endPTS=i,t.minEndPTS=l,t.endDTS=r;const h=t.sn;if(!d||h<d.startSN||h>d.endSN)return 0;let f;const m=h-d.startSN,_=d.fragments;for(_[m]=t,f=m;f>0;f--)ar(_[f],_[f-1]);for(f=m;f<_.length-1;f++)ar(_[f],_[f+1]);return d.fragmentHint&&ar(_[_.length-1],d.fragmentHint),d.PTSKnown=d.alignedSliding=!0,u}function tl(d,t){let e=null;const i=d.fragments;for(let l=i.length-1;l>=0;l--){const o=i[l].initSegment;if(o){e=o;break}}d.fragmentHint&&delete d.fragmentHint.endPTS;let s=0,r;if(rl(d,t,(l,o)=>{l.relurl&&(s=l.cc-o.cc),_t(l.startPTS)&&_t(l.endPTS)&&(o.start=o.startPTS=l.startPTS,o.startDTS=l.startDTS,o.maxStartPTS=l.maxStartPTS,o.endPTS=l.endPTS,o.endDTS=l.endDTS,o.minEndPTS=l.minEndPTS,o.duration=l.endPTS-l.startPTS,o.duration&&(r=o),t.PTSKnown=t.alignedSliding=!0),o.elementaryStreams=l.elementaryStreams,o.loader=l.loader,o.stats=l.stats,o.urlId=l.urlId,l.initSegment&&(o.initSegment=l.initSegment,e=l.initSegment)}),e&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach(o=>{var c;(!o.initSegment||o.initSegment.relurl===((c=e)==null?void 0:c.relurl))&&(o.initSegment=e)}),t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(l=>!l),t.deltaUpdateFailed){$.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=t.skippedSegments;l--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=el(d.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));const n=t.fragments;if(s){$.warn("discontinuity sliding from playlist, take drift into account");for(let l=0;l<n.length;l++)n[l].cc+=s}t.skippedSegments&&(t.startCC=t.fragments[0].cc),il(d.partList,t.partList,(l,o)=>{o.elementaryStreams=l.elementaryStreams,o.stats=l.stats}),r?In(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):wn(d,t),n.length&&(t.totalduration=t.edge-n[0].start),t.driftStartTime=d.driftStartTime,t.driftStart=d.driftStart;const a=t.advancedDateTime;if(t.advanced&&a){const l=t.edge;t.driftStart||(t.driftStartTime=a,t.driftStart=l),t.driftEndTime=a,t.driftEnd=l}else t.driftEndTime=d.driftEndTime,t.driftEnd=d.driftEnd,t.advancedDateTime=d.advancedDateTime}function el(d,t,e){const i=Zt({},d);return e&&e.forEach(s=>{delete i[s]}),Object.keys(t).forEach(s=>{const r=new cn(t[s].attr,i[s]);r.isValid?i[s]=r:$.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[s].attr)}"`)}),i}function il(d,t,e){if(d&&t){let i=0;for(let s=0,r=d.length;s<=r;s++){const n=d[s],a=t[s+i];n&&a&&n.index===a.index&&n.fragment.sn===a.fragment.sn?e(n,a):i--}}}function rl(d,t,e){const i=t.skippedSegments,s=Math.max(d.startSN,t.startSN)-t.startSN,r=(d.fragmentHint?1:0)+(i?t.endSN:Math.min(d.endSN,t.endSN))-t.startSN,n=t.startSN-d.startSN,a=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=d.fragmentHint?d.fragments.concat(d.fragmentHint):d.fragments;for(let o=s;o<=r;o++){const c=l[n+o];let u=a[o];i&&!u&&o<i&&(u=t.fragments[o]=c),c&&u&&e(c,u)}}function wn(d,t){const e=t.startSN+t.skippedSegments-d.startSN,i=d.fragments;e<0||e>=i.length||wr(t,i[e].start)}function wr(d,t){if(t){const e=d.fragments;for(let i=d.skippedSegments;i<e.length;i++)e[i].start+=t;d.fragmentHint&&(d.fragmentHint.start+=t)}}function sl(d,t=1/0){let e=1e3*d.targetduration;if(d.updated){const i=d.fragments,s=4;if(i.length&&e*s>t){const r=i[i.length-1].duration*1e3;r<e&&(e=r)}}else e/=2;return Math.round(e)}function nl(d,t,e){if(!(d!=null&&d.details))return null;const i=d.details;let s=i.fragments[t-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===t)?s:t<i.startSN&&e&&e.sn===t?e:null}function Rs(d,t,e){var i;return d!=null&&d.details?Rn((i=d.details)==null?void 0:i.partList,t,e):null}function Rn(d,t,e){if(d)for(let i=d.length;i--;){const s=d[i];if(s.index===e&&s.fragment.sn===t)return s}return null}function Fi(d){switch(d.details){case J.FRAG_LOAD_TIMEOUT:case J.KEY_LOAD_TIMEOUT:case J.LEVEL_LOAD_TIMEOUT:case J.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ds(d,t){const e=Fi(t);return d.default[`${e?"timeout":"error"}Retry`]}function Nr(d,t){const e=d.backoff==="linear"?1:Math.pow(2,t);return Math.min(e*d.retryDelayMs,d.maxRetryDelayMs)}function Cs(d){return he(he({},d),{errorRetry:null,timeoutRetry:null})}function Bi(d,t,e,i){return!!d&&t<d.maxNumRetry&&(al(i)||!!e)}function al(d){return d===0&&navigator.onLine===!1||!!d&&(d<400||d>499)}const Dn={search:function(d,t){let e=0,i=d.length-1,s=null,r=null;for(;e<=i;){s=(e+i)/2|0,r=d[s];const n=t(r);if(n>0)e=s+1;else if(n<0)i=s-1;else return r}return null}};function ol(d,t,e){if(t===null||!Array.isArray(d)||!d.length||!_t(t))return null;const i=d[0].programDateTime;if(t<(i||0))return null;const s=d[d.length-1].endProgramDateTime;if(t>=(s||0))return null;e=e||0;for(let r=0;r<d.length;++r){const n=d[r];if(ll(t,e,n))return n}return null}function vi(d,t,e=0,i=0){let s=null;if(d?s=t[d.sn-t[0].sn+1]||null:e===0&&t[0].start===0&&(s=t[0]),s&&Rr(e,i,s)===0)return s;const r=Dn.search(t,Rr.bind(null,e,i));return r&&(r!==d||!s)?r:s}function Rr(d=0,t=0,e){if(e.start<=d&&e.start+e.duration>d)return 0;const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-i<=d?1:e.start-i>d&&e.start?-1:0}function ll(d,t,e){const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0))*1e3;return(e.endProgramDateTime||0)-i>d}function cl(d,t){return Dn.search(d,e=>e.cc<t?1:e.cc>t?-1:0)}const dl=3e5;var de={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Se={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ul{constructor(t){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=t,this.log=$.log.bind($,"[info]:"),this.warn=$.warn.bind($,"[warning]:"),this.error=$.error.bind($,"[error]:"),this.registerListeners()}registerListeners(){const t=this.hls;t.on(w.ERROR,this.onError,this),t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;!t||(t.off(w.ERROR,this.onError,this),t.off(w.ERROR,this.onErrorOut,this),t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(t){this.playlistError=0}stopLoad(){}getVariantLevelIndex(t){return(t==null?void 0:t.type)===xt.MAIN?t.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(t,e){var i;if(e.fatal)return;const s=this.hls,r=e.context;switch(e.details){case J.FRAG_LOAD_ERROR:case J.FRAG_LOAD_TIMEOUT:case J.KEY_LOAD_ERROR:case J.KEY_LOAD_TIMEOUT:e.errorAction=this.getFragRetryOrSwitchAction(e);return;case J.FRAG_GAP:case J.FRAG_PARSING_ERROR:case J.FRAG_DECRYPT_ERROR:{e.errorAction=this.getFragRetryOrSwitchAction(e),e.errorAction.action=de.SendAlternateToPenaltyBox;return}case J.LEVEL_EMPTY_ERROR:case J.LEVEL_PARSING_ERROR:{var n,a;const l=e.parent===xt.MAIN?e.level:s.loadLevel;e.details===J.LEVEL_EMPTY_ERROR&&!!((n=e.context)!=null&&(a=n.levelDetails)!=null&&a.live)?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,l):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,l))}return;case J.LEVEL_LOAD_ERROR:case J.LEVEL_LOAD_TIMEOUT:typeof(r==null?void 0:r.level)=="number"&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,r.level));return;case J.AUDIO_TRACK_LOAD_ERROR:case J.AUDIO_TRACK_LOAD_TIMEOUT:case J.SUBTITLE_LOAD_ERROR:case J.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const l=s.levels[s.loadLevel];if(l&&(r.type===Pt.AUDIO_TRACK&&r.groupId===l.audioGroupId||r.type===Pt.SUBTITLE_TRACK&&r.groupId===l.textGroupId)){e.errorAction=this.getPlaylistRetryOrSwitchAction(e,s.loadLevel),e.errorAction.action=de.SendAlternateToPenaltyBox,e.errorAction.flags=Se.MoveAllAlternatesMatchingHost;return}}return;case J.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const l=s.levels[s.loadLevel],o=l==null?void 0:l.attrs["HDCP-LEVEL"];o&&(e.errorAction={action:de.SendAlternateToPenaltyBox,flags:Se.MoveAllAlternatesMatchingHDCP,hdcpLevel:o})}return;case J.BUFFER_ADD_CODEC_ERROR:case J.REMUX_ALLOC_ERROR:e.errorAction=this.getLevelSwitchAction(e,(i=e.level)!=null?i:s.loadLevel);return;case J.INTERNAL_EXCEPTION:case J.BUFFER_APPENDING_ERROR:case J.BUFFER_APPEND_ERROR:case J.BUFFER_FULL_ERROR:case J.LEVEL_SWITCH_ERROR:case J.BUFFER_STALLED_ERROR:case J.BUFFER_SEEK_OVER_HOLE:case J.BUFFER_NUDGE_ON_STALL:e.errorAction={action:de.DoNothing,flags:Se.None};return}if(e.type===Et.KEY_SYSTEM_ERROR){const l=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,l);return}}getPlaylistRetryOrSwitchAction(t,e){var i;const s=this.hls,r=Ds(s.config.playlistLoadPolicy,t),n=this.playlistError++,a=(i=t.response)==null?void 0:i.code;if(Bi(r,n,Fi(t),a))return{action:de.RetryRequest,flags:Se.None,retryConfig:r,retryCount:n};const o=this.getLevelSwitchAction(t,e);return r&&(o.retryConfig=r,o.retryCount=n),o}getFragRetryOrSwitchAction(t){const e=this.hls,i=this.getVariantLevelIndex(t.frag),s=e.levels[i],{fragLoadPolicy:r,keyLoadPolicy:n}=e.config,a=Ds(t.details.startsWith("key")?n:r,t),l=e.levels.reduce((u,h)=>u+h.fragmentError,0);if(s){var o;t.details!==J.FRAG_GAP&&s.fragmentError++;const u=(o=t.response)==null?void 0:o.code;if(Bi(a,l,Fi(t),u))return{action:de.RetryRequest,flags:Se.None,retryConfig:a,retryCount:l}}const c=this.getLevelSwitchAction(t,i);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(t,e){const i=this.hls;e==null&&(e=i.loadLevel);const s=this.hls.levels[e];if(s&&(s.loadError++,i.autoLevelEnabled)){var r,n;let a=-1;const l=i.levels,o=(r=t.frag)==null?void 0:r.type,{type:c,groupId:u}=(n=t.context)!=null?n:{};for(let h=l.length;h--;){const f=(h+i.loadLevel)%l.length;if(f!==i.loadLevel&&l[f].loadError===0){const m=l[f];if(t.details===J.FRAG_GAP&&t.frag){const _=l[f].details;if(_){const E=vi(t.frag,_.fragments,t.frag.start);if(E!=null&&E.gap)continue}}else{if(c===Pt.AUDIO_TRACK&&u===m.audioGroupId||c===Pt.SUBTITLE_TRACK&&u===m.textGroupId)continue;if(o===xt.AUDIO&&s.audioGroupId===m.audioGroupId||o===xt.SUBTITLE&&s.textGroupId===m.textGroupId)continue}a=f;break}}if(a>-1&&i.loadLevel!==a)return t.levelRetry=!0,this.playlistError=0,{action:de.SendAlternateToPenaltyBox,flags:Se.None,nextAutoLevel:a}}return{action:de.SendAlternateToPenaltyBox,flags:Se.MoveAllAlternatesMatchingHost}}onErrorOut(t,e){var i;switch((i=e.errorAction)==null?void 0:i.action){case de.DoNothing:break;case de.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(e),!e.errorAction.resolved&&e.details!==J.FRAG_GAP&&(e.fatal=!0);break}if(e.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(t){const e=this.hls,i=t.errorAction;if(!i)return;const{flags:s,hdcpLevel:r,nextAutoLevel:n}=i;switch(s){case Se.None:this.switchLevel(t,n);break;case Se.MoveAllAlternatesMatchingHost:i.resolved||(i.resolved=this.redundantFailover(t));break;case Se.MoveAllAlternatesMatchingHDCP:r&&(e.maxHdcpLevel=Ir[Ir.indexOf(r)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${e.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(t,n)}switchLevel(t,e){e!==void 0&&t.errorAction&&(this.warn(`switching to level ${e} after ${t.details}`),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(t){const{hls:e,penalizedRenditions:i}=this,s=t.parent===xt.MAIN?t.level:e.loadLevel,r=e.levels[s],n=r.url.length,a=t.frag?t.frag.urlId:r.urlId;r.urlId===a&&(!t.frag||r.details)&&this.penalizeRendition(r,t);for(let l=1;l<n;l++){const o=(a+l)%n,c=i[o];if(!c||hl(c,t,i[a]))return this.warn(`Switching to Redundant Stream ${o+1}/${n}: "${r.url[o]}" after ${t.details}`),this.playlistError=0,e.levels.forEach(u=>{u.urlId=o}),e.nextLoadLevel=s,!0}return!1}penalizeRendition(t,e){const{penalizedRenditions:i}=this,s=i[t.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};s.lastErrorPerfMs=performance.now(),s.errors.push(e),s.details=t.details,i[t.urlId]=s}}function hl(d,t,e){if(performance.now()-d.lastErrorPerfMs>dl)return!0;const i=d.details;if(t.details===J.FRAG_GAP&&i&&t.frag){const s=t.frag.start,r=vi(null,i.fragments,s);if(r&&!r.gap)return!0}if(e&&d.errors.length<e.errors.length){const s=d.errors[d.errors.length-1];if(i&&s.frag&&t.frag&&Math.abs(s.frag.start-t.frag.start)>i.targetduration*3)return!0}return!1}class Fr{constructor(t,e){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=$.log.bind($,`${e}:`),this.warn=$.warn.bind($,`${e}:`),this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e){const i=e==null?void 0:e.renditionReports;if(i){let s=-1;for(let r=0;r<i.length;r++){const n=i[r];let a;try{a=new self.URL(n.URI,e.url).href}catch(l){$.warn(`Could not construct new URL for Rendition Report: ${l}`),a=n.URI||""}if(a===t){s=r;break}else a===t.substring(0,a.length)&&(s=r)}if(s!==-1){const r=i[s],n=parseInt(r["LAST-MSN"])||(e==null?void 0:e.lastPartSn);let a=parseInt(r["LAST-PART"])||(e==null?void 0:e.lastPartIndex);if(this.hls.config.lowLatencyMode){const l=Math.min(e.age-e.partTarget,e.targetduration);a>=0&&l>e.partTarget&&(a+=1)}return new ws(n,a>=0?a:void 0,gi.No)}}}loadPlaylist(t){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}shouldReloadPlaylist(t){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(t)}playlistLoaded(t,e,i){const{details:s,stats:r}=e,n=self.performance.now(),a=r.loading.first?Math.max(0,n-r.loading.first):0;if(s.advancedDateTime=Date.now()-a,s.live||i!=null&&i.live){if(s.reloaded(i),i&&this.log(`live playlist ${t} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:"MISSED"}`),i&&s.fragments.length>0&&tl(i,s),!this.canLoad||!s.live)return;let l,o,c;if(s.canBlockReload&&s.endSN&&s.advanced){const E=this.hls.config.lowLatencyMode,D=s.lastPartSn,O=s.endSN,I=s.lastPartIndex,x=I!==-1,P=D===O,C=E?0:I;x?(o=P?O+1:D,c=P?C:I+1):o=O+1;const b=s.age,S=b+s.ageHeader;let L=Math.min(S-s.partTarget,s.targetduration*1.5);if(L>0){if(i&&L>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${L} with playlist age: ${s.age}`),L=0;else{const A=Math.floor(L/s.targetduration);o+=A,c!==void 0&&(c+=Math.round(L%s.targetduration/s.partTarget)),this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${b.toFixed(2)}s goal: ${L} skip sn ${A} to part ${c}`)}s.tuneInGoal=L}if(l=this.getDeliveryDirectives(s,e.deliveryDirectives,o,c),E||!P){this.loadPlaylist(l);return}}else s.canBlockReload&&(l=this.getDeliveryDirectives(s,e.deliveryDirectives,o,c));const u=this.hls.mainForwardBufferInfo,h=u?u.end-u.len:0,f=(s.edge-h)*1e3,m=sl(s,f);s.updated&&n>this.requestScheduled+m&&(this.requestScheduled=r.loading.start),o!==void 0&&s.canBlockReload?this.requestScheduled=r.loading.first+m-(s.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+m<n?this.requestScheduled=n:this.requestScheduled-n<=0&&(this.requestScheduled+=m);let _=this.requestScheduled-n;_=Math.max(0,_),this.log(`reload live playlist ${t} in ${Math.round(_)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),_)}else this.clearTimer()}getDeliveryDirectives(t,e,i,s){let r=Jo(t,i);return e!=null&&e.skip&&t.deltaUpdateFailed&&(i=e.msn,s=e.part,r=gi.No),new ws(i,s,r)}checkRetry(t){const e=t.details,i=Fi(t),s=t.errorAction,{action:r,retryCount:n=0,retryConfig:a}=s||{},l=!!s&&!!a&&(r===de.RetryRequest||!s.resolved&&r===de.SendAlternateToPenaltyBox);if(l){var o;if(this.requestScheduled=-1,n>=a.maxNumRetry)return!1;if(i&&(o=t.context)!=null&&o.deliveryDirectives)this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const c=Nr(a,n);this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${e}" in ${c}ms`)}t.levelRetry=!0,s.resolved=!0}return l}}let or;class fl extends Fr{constructor(t,e){super(t,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(w.LEVEL_LOADED,this.onLevelLoaded,this),t.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(w.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(w.FRAG_LOADED,this.onFragLoaded,this),t.on(w.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(w.LEVEL_LOADED,this.onLevelLoaded,this),t.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(w.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(w.FRAG_LOADED,this.onFragLoaded,this),t.off(w.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(t,e){this.resetLevels()}onManifestLoaded(t,e){const i=[],s={};let r;e.levels.forEach(n=>{var a;const l=n.attrs;((a=n.audioCodec)==null?void 0:a.indexOf("mp4a.40.34"))!==-1&&(or||(or=/chrome|firefox/i.test(navigator.userAgent)),or&&(n.audioCodec=void 0));const{AUDIO:o,CODECS:c,"FRAME-RATE":u,"PATHWAY-ID":h,RESOLUTION:f,SUBTITLES:m}=l,E=`${`${h||"."}-`}${n.bitrate}-${f}-${u}-${c}`;r=s[E],r?r.addFallback(n):(r=new _i(n),s[E]=r,i.push(r)),Ui(r,"audio",o),Ui(r,"text",m)}),this.filterAndSortMediaOptions(i,e)}filterAndSortMediaOptions(t,e){let i=[],s=[],r=!1,n=!1,a=!1,l=t.filter(({audioCodec:f,videoCodec:m,width:_,height:E,unknownCodecs:D})=>(r||(r=!!(_&&E)),n||(n=!!m),a||(a=!!f),!(D!=null&&D.length)&&(!f||rr(f,"audio"))&&(!m||rr(m,"video"))));if((r||n)&&a&&(l=l.filter(({videoCodec:f,width:m,height:_})=>!!f||!!(m&&_))),l.length===0){Promise.resolve().then(()=>{if(this.hls){const f=new Error("no level with compatible codecs found in manifest");this.hls.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:f,reason:f.message})}});return}e.audioTracks&&(i=e.audioTracks.filter(f=>!f.audioCodec||rr(f.audioCodec,"audio")),ks(i)),e.subtitles&&(s=e.subtitles,ks(s));const o=l.slice(0);l.sort((f,m)=>f.attrs["HDCP-LEVEL"]!==m.attrs["HDCP-LEVEL"]?(f.attrs["HDCP-LEVEL"]||"")>(m.attrs["HDCP-LEVEL"]||"")?1:-1:f.bitrate!==m.bitrate?f.bitrate-m.bitrate:f.attrs["FRAME-RATE"]!==m.attrs["FRAME-RATE"]?f.attrs.decimalFloatingPoint("FRAME-RATE")-m.attrs.decimalFloatingPoint("FRAME-RATE"):f.attrs.SCORE!==m.attrs.SCORE?f.attrs.decimalFloatingPoint("SCORE")-m.attrs.decimalFloatingPoint("SCORE"):r&&f.height!==m.height?f.height-m.height:0);let c=o[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==o.length)){for(let f=0;f<o.length;f++)if(o[f].pathwayId===l[0].pathwayId){c=o[f];break}}this._levels=l;for(let f=0;f<l.length;f++)if(l[f]===c){this._firstLevel=f,this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${c.bitrate}`);break}const u=a&&!n,h={levels:l,audioTracks:i,subtitleTracks:s,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:a,video:n,altAudio:!u&&i.some(f=>!!f.url)};this.hls.trigger(w.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(e.length===0)return;if(t<0||t>=e.length){const c=new Error("invalid level idx"),u=t<0;if(this.hls.trigger(w.ERROR,{type:Et.OTHER_ERROR,details:J.LEVEL_SWITCH_ERROR,level:t,fatal:u,error:c,reason:c.message}),u)return;t=Math.min(t,e.length-1)}const i=this.currentLevelIndex,s=this.currentLevel,r=s?s.attrs["PATHWAY-ID"]:void 0,n=e[t],a=n.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=n,i===t&&n.details&&s&&r===a)return;this.log(`Switching to level ${t}${a?" with Pathway "+a:""} from level ${i}${r?" with Pathway "+r:""}`);const l=Zt({},n,{level:t,maxBitrate:n.maxBitrate,attrs:n.attrs,uri:n.uri,urlId:n.urlId});delete l._attrs,delete l._urlId,this.hls.trigger(w.LEVEL_SWITCHING,l);const o=n.details;if(!o||o.live){const c=this.switchParams(n.uri,s==null?void 0:s.details);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(this._startLevel===void 0){const t=this.hls.config.startLevel;return t!==void 0?t:this._firstLevel}else return this._startLevel}set startLevel(t){this._startLevel=t}onError(t,e){e.fatal||!e.context||e.context.type===Pt.LEVEL&&e.context.level===this.level&&this.checkRetry(e)}onFragLoaded(t,{frag:e}){if(e!==void 0&&e.type===xt.MAIN){const i=this._levels[e.level];i!==void 0&&(i.loadError=0)}}onLevelLoaded(t,e){var i;const{level:s,details:r}=e,n=this._levels[s];if(!n){var a;this.warn(`Invalid level index ${s}`),(a=e.deliveryDirectives)!=null&&a.skip&&(r.deltaUpdateFailed=!0);return}s===this.currentLevelIndex?(n.fragmentError===0&&(n.loadError=0),this.playlistLoaded(s,e,n.details)):(i=e.deliveryDirectives)!=null&&i.skip&&(r.deltaUpdateFailed=!0)}onAudioTrackSwitched(t,e){const i=this.currentLevel;if(!i)return;const s=this.hls.audioTracks[e.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==s){let r=-1;for(let n=0;n<i.audioGroupIds.length;n++)if(i.audioGroupIds[n]===s){r=n;break}r!==-1&&r!==i.urlId&&(i.urlId=r,this.canLoad&&this.startLoad())}}loadPlaylist(t){super.loadPlaylist();const e=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){const s=i.urlId;let r=i.uri;if(t)try{r=t.addDirectives(r)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}const n=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${e}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""} with${n?" Pathway "+n:""} URI ${s+1}/${i.url.length} ${r}`),this.clearTimer(),this.hls.trigger(w.LEVEL_LOADING,{url:r,level:e,id:s,deliveryDirectives:t||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}removeLevel(t,e){const i=(r,n)=>n!==e,s=this._levels.filter((r,n)=>n!==t?!0:r.url.length>1&&e!==void 0?(r.url=r.url.filter(i),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(i)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(i)),r.urlId=0,!0):(this.steering&&this.steering.removeLevel(r),!1));this.hls.trigger(w.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(t,{levels:e}){e.forEach((i,s)=>{const{details:r}=i;r!=null&&r.fragments&&r.fragments.forEach(n=>{n.level=s})}),this._levels=e}}function Ui(d,t,e){!e||(t==="audio"?(d.audioGroupIds||(d.audioGroupIds=[]),d.audioGroupIds[d.url.length-1]=e):t==="text"&&(d.textGroupIds||(d.textGroupIds=[]),d.textGroupIds[d.url.length-1]=e))}function ks(d){const t={};d.forEach(e=>{const i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++})}var ie={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class pl{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(w.BUFFER_APPENDED,this.onBufferAppended,this),t.on(w.FRAG_BUFFERED,this.onFragBuffered,this),t.on(w.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:t}=this;t.off(w.BUFFER_APPENDED,this.onBufferAppended,this),t.off(w.FRAG_BUFFERED,this.onFragBuffered,this),t.off(w.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const i=this.activePartLists[e];if(i)for(let s=i.length;s--;){const r=i[s];if(!r)break;const n=r.end;if(r.start<=t&&n!==null&&t<=n)return r}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){const{fragments:i}=this,s=Object.keys(i);for(let r=s.length;r--;){const n=i[s[r]];if((n==null?void 0:n.body.type)===e&&n.buffered){const a=n.body;if(a.start<=t&&t<=a.end)return a}}return null}detectEvictedFragments(t,e,i,s){this.timeRanges&&(this.timeRanges[t]=e);const r=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(n=>{const a=this.fragments[n];if(!a||r>=a.body.sn)return;if(!a.buffered&&!a.loaded){a.body.type===i&&this.removeFragment(a.body);return}const l=a.range[t];!l||l.time.some(o=>{const c=!this.isTimeBuffered(o.startPTS,o.endPTS,e);return c&&this.removeFragment(a.body),c})})}detectPartialFragments(t){const e=this.timeRanges,{frag:i,part:s}=t;if(!e||i.sn==="initSegment")return;const r=si(i),n=this.fragments[r];if(!n)return;const a=!i.relurl;Object.keys(e).forEach(l=>{const o=i.elementaryStreams[l];if(!o)return;const c=e[l],u=a||o.partial===!0;n.range[l]=this.getBufferedTimes(i,s,u,c)}),n.loaded=null,Object.keys(n.range).length?(n.buffered=!0,n.body.endList&&(this.endListFragments[n.body.type]=n),Li(n)||this.removeParts(i.sn-1,i.type)):this.removeFragment(n.body)}removeParts(t,e){const i=this.activePartLists[e];!i||(this.activePartLists[e]=i.filter(s=>s.fragment.sn>=t))}fragBuffered(t,e){const i=si(t);let s=this.fragments[i];!s&&e&&(s=this.fragments[i]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(t,e,i,s){const r={time:[],partial:i},n=t.start,a=t.end,l=t.minEndPTS||a,o=t.maxStartPTS||n;for(let c=0;c<s.length;c++){const u=s.start(c)-this.bufferPadding,h=s.end(c)+this.bufferPadding;if(o>=u&&l<=h){r.time.push({startPTS:Math.max(n,s.start(c)),endPTS:Math.min(a,s.end(c))});break}else if(n<h&&a>u)r.partial=!0,r.time.push({startPTS:Math.max(n,s.start(c)),endPTS:Math.min(a,s.end(c))});else if(a<=u)break}return r}getPartialFragment(t){let e=null,i,s,r,n=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(o=>{const c=l[o];!c||Li(c)&&(s=c.body.start-a,r=c.body.end+a,t>=s&&t<=r&&(i=Math.min(t-s,r-t),n<=i&&(e=c.body,n=i)))}),e}isEndListAppended(t){const e=this.endListFragments[t];return e!==void 0&&(e.buffered||Li(e))}getState(t){const e=si(t),i=this.fragments[e];return i?i.buffered?Li(i)?ie.PARTIAL:ie.OK:ie.APPENDING:ie.NOT_LOADED}isTimeBuffered(t,e,i){let s,r;for(let n=0;n<i.length;n++){if(s=i.start(n)-this.bufferPadding,r=i.end(n)+this.bufferPadding,t>=s&&e<=r)return!0;if(e<=s)return!1}return!1}onFragLoaded(t,e){const{frag:i,part:s}=e;if(i.sn==="initSegment"||i.bitrateTest)return;const r=s?null:e,n=si(i);this.fragments[n]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(t,e){const{frag:i,part:s,timeRanges:r}=e;if(i.sn==="initSegment")return;const n=i.type;if(s){let a=this.activePartLists[n];a||(this.activePartLists[n]=a=[]),a.push(s)}this.timeRanges=r,Object.keys(r).forEach(a=>{const l=r[a];this.detectEvictedFragments(a,l,n,s)})}onFragBuffered(t,e){this.detectPartialFragments(e)}hasFragment(t){const e=si(t);return!!this.fragments[e]}hasParts(t){var e;return!!((e=this.activePartLists[t])!=null&&e.length)}removeFragmentsInRange(t,e,i,s,r){s&&!this.hasGaps||Object.keys(this.fragments).forEach(n=>{const a=this.fragments[n];if(!a)return;const l=a.body;l.type!==i||s&&!l.gap||l.start<e&&l.end>t&&(a.buffered||r)&&this.removeFragment(l)})}removeFragment(t){const e=si(t);t.stats.loaded=0,t.clearElementaryStreamInfo();const i=this.activePartLists[t.type];if(i){const s=t.sn;this.activePartLists[t.type]=i.filter(r=>r.fragment.sn!==s)}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function Li(d){var t,e,i;return d.buffered&&(d.body.gap||((t=d.range.video)==null?void 0:t.partial)||((e=d.range.audio)==null?void 0:e.partial)||((i=d.range.audiovideo)==null?void 0:i.partial))}function si(d){return`${d.type}_${d.level}_${d.urlId}_${d.sn}`}const Ms=Math.pow(2,17);class ml{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const i=t.url;if(!i)return Promise.reject(new Ge({type:Et.NETWORK_ERROR,details:J.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,r=s.fLoader,n=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),t.gap){l(Os(t));return}const o=this.loader=t.loader=r?new r(s):new n(s),c=Ps(t),u=Cs(s.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:t.sn==="initSegment"?1/0:Ms};t.stats=o.stats,o.load(c,h,{onSuccess:(f,m,_,E)=>{this.resetLoader(t,o);let D=f.data;_.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(D.slice(0,16)),D=D.slice(16)),a({frag:t,part:null,payload:D,networkDetails:E})},onError:(f,m,_,E)=>{this.resetLoader(t,o),l(new Ge({type:Et.NETWORK_ERROR,details:J.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:he({url:i,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:_,stats:E}))},onAbort:(f,m,_)=>{this.resetLoader(t,o),l(new Ge({type:Et.NETWORK_ERROR,details:J.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:_,stats:f}))},onTimeout:(f,m,_)=>{this.resetLoader(t,o),l(new Ge({type:Et.NETWORK_ERROR,details:J.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:_,stats:f}))},onProgress:(f,m,_,E)=>{e&&e({frag:t,part:null,payload:_,networkDetails:E})}})})}loadPart(t,e,i){this.abort();const s=this.config,r=s.fLoader,n=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap){l(Os(t,e));return}const o=this.loader=t.loader=r?new r(s):new n(s),c=Ps(t,e),u=Cs(s.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ms};e.stats=o.stats,o.load(c,h,{onSuccess:(f,m,_,E)=>{this.resetLoader(t,o),this.updateStatsFromPart(t,e);const D={frag:t,part:e,payload:f.data,networkDetails:E};i(D),a(D)},onError:(f,m,_,E)=>{this.resetLoader(t,o),l(new Ge({type:Et.NETWORK_ERROR,details:J.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:he({url:c.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:_,stats:E}))},onAbort:(f,m,_)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,o),l(new Ge({type:Et.NETWORK_ERROR,details:J.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:_,stats:f}))},onTimeout:(f,m,_)=>{this.resetLoader(t,o),l(new Ge({type:Et.NETWORK_ERROR,details:J.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:_,stats:f}))}})})}updateStatsFromPart(t,e){const i=t.stats,s=e.stats,r=s.total;if(i.loaded+=s.loaded,r){const l=Math.round(t.duration/e.duration),o=Math.min(Math.round(i.loaded/r),l),u=(l-o)*Math.round(i.loaded/o);i.total=i.loaded+u}else i.total=Math.max(i.loaded,i.total);const n=i.loading,a=s.loading;n.start?n.first+=a.first-a.start:(n.start=a.start,n.first=a.first),n.end=a.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function Ps(d,t=null){const e=t||d,i={frag:d,part:t,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},s=e.byteRangeStartOffset,r=e.byteRangeEndOffset;if(_t(s)&&_t(r)){var n;let a=s,l=r;if(d.sn==="initSegment"&&((n=d.decryptdata)==null?void 0:n.method)==="AES-128"){const o=r-s;o%16&&(l=r+(16-o%16)),s!==0&&(i.resetIV=!0,a=s-16)}i.rangeStart=a,i.rangeEnd=l}return i}function Os(d,t){const e=new Error(`GAP ${d.gap?"tag":"attribute"} found`),i={type:Et.MEDIA_ERROR,details:J.FRAG_GAP,fatal:!1,frag:d,error:e,networkDetails:null};return t&&(i.part=t),(t||d).stats.aborted=!0,new Ge(i)}class Ge extends Error{constructor(t){super(t.error.message),this.data=void 0,this.data=t}}class gl{constructor(t){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const e in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[e].loader;if(i){if(t&&t!==i.context.frag.type)return;i.abort()}}}detach(){for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(t,e=J.KEY_LOAD_ERROR,i,s,r){return new Ge({type:Et.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:r,error:i,networkDetails:s})}loadClear(t,e){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:s}=t;for(let r=0;r<e.length;r++){const n=e[r];if(s<=n.cc&&(i==="initSegment"||n.sn==="initSegment"||i<n.sn)){this.emeController.selectKeySystemFormat(n).then(a=>{n.setKeyFormat(a)});break}}}}load(t){return!t.decryptdata&&t.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,e){var i,s;e&&t.setKeyFormat(e);const r=t.decryptdata;if(!r){const o=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(t,J.KEY_LOAD_ERROR,o))}const n=r.uri;if(!n)return Promise.reject(this.createKeyLoadError(t,J.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${n}"`)));let a=this.keyUriToKeyInfo[n];if((i=a)!=null&&i.decryptdata.key)return r.key=a.decryptdata.key,Promise.resolve({frag:t,keyInfo:a});if((s=a)!=null&&s.keyLoadPromise){var l;switch((l=a.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(o=>(r.key=o.keyInfo.decryptdata.key,{frag:t,keyInfo:a}))}}switch(a=this.keyUriToKeyInfo[n]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(a,t):this.loadKeyEME(a,t);case"AES-128":return this.loadKeyHTTP(a,t);default:return Promise.reject(this.createKeyLoadError(t,J.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(t,e){const i={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(i);if(s)return(t.keyLoadPromise=s.then(r=>(t.mediaKeySessionContext=r,i))).catch(r=>{throw t.keyLoadPromise=null,r})}return Promise.resolve(i)}loadKeyHTTP(t,e){const i=this.config,s=i.loader,r=new s(i);return e.keyLoader=t.loader=r,t.keyLoadPromise=new Promise((n,a)=>{const l={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},o=i.keyLoadPolicy.default,c={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(h,f,m,_)=>{const{frag:E,keyInfo:D,url:O}=m;if(!E.decryptdata||D!==this.keyUriToKeyInfo[O])return a(this.createKeyLoadError(E,J.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),_));D.decryptdata.key=E.decryptdata.key=new Uint8Array(h.data),E.keyLoader=null,D.loader=null,n({frag:E,keyInfo:D})},onError:(h,f,m,_)=>{this.resetLoader(f),a(this.createKeyLoadError(e,J.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),m,he({url:l.url,data:void 0},h)))},onTimeout:(h,f,m)=>{this.resetLoader(f),a(this.createKeyLoadError(e,J.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(h,f,m)=>{this.resetLoader(f),a(this.createKeyLoadError(e,J.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};r.load(l,c,u)})}resetLoader(t){const{frag:e,keyInfo:i,url:s}=t,r=i.loader;e.keyLoader===r&&(e.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[s],r&&r.destroy()}}class yl{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const _l={length:0,start:()=>0,end:()=>0};class Ut{static isBuffered(t,e){try{if(t){const i=Ut.getBuffered(t);for(let s=0;s<i.length;s++)if(e>=i.start(s)&&e<=i.end(s))return!0}}catch(i){}return!1}static bufferInfo(t,e,i){try{if(t){const s=Ut.getBuffered(t),r=[];let n;for(n=0;n<s.length;n++)r.push({start:s.start(n),end:s.end(n)});return this.bufferedInfo(r,e,i)}}catch(s){}return{len:0,start:e,end:e,nextStart:void 0}}static bufferedInfo(t,e,i){e=Math.max(0,e),t.sort(function(o,c){const u=o.start-c.start;return u||c.end-o.end});let s=[];if(i)for(let o=0;o<t.length;o++){const c=s.length;if(c){const u=s[c-1].end;t[o].start-u<i?t[o].end>u&&(s[c-1].end=t[o].end):s.push(t[o])}else s.push(t[o])}else s=t;let r=0,n,a=e,l=e;for(let o=0;o<s.length;o++){const c=s[o].start,u=s[o].end;if(e+i>=c&&e<u)a=c,l=u,r=l-e;else if(e+i<c){n=c;break}}return{len:r,start:a||0,end:l||0,nextStart:n}}static getBuffered(t){try{return t.buffered}catch(e){return $.log("failed to get media.buffered",e),_l}}}class Br{constructor(t,e,i,s=0,r=-1,n=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Ii(),this.buffering={audio:Ii(),video:Ii(),audiovideo:Ii()},this.level=t,this.sn=e,this.id=i,this.size=s,this.part=r,this.partial=n}}function Ii(){return{start:0,executeStart:0,executeEnd:0,end:0}}function Cn(d,t){let e=null;for(let i=0,s=d.length;i<s;i++){const r=d[i];if(r&&r.cc===t){e=r;break}}return e}function vl(d,t,e){return!!(t.details&&(e.endCC>e.startCC||d&&d.cc<e.startCC))}function El(d,t,e=0){const i=d.fragments,s=t.fragments;if(!s.length||!i.length){$.log("No fragments to align");return}const r=Cn(i,s[0].cc);if(!r||r&&!r.startPTS){$.log("No frag in previous level to align on");return}return r}function Ns(d,t){if(d){const e=d.start+t;d.start=d.startPTS=e,d.endPTS=e+d.duration}}function Ur(d,t){const e=t.fragments;for(let i=0,s=e.length;i<s;i++)Ns(e[i],d);t.fragmentHint&&Ns(t.fragmentHint,d),t.alignedSliding=!0}function xl(d,t,e){!t||(Sl(d,e,t),!e.alignedSliding&&t.details&&Tl(e,t.details),!e.alignedSliding&&t.details&&!e.skippedSegments&&wn(t.details,e))}function Sl(d,t,e){if(vl(d,e,t)){const i=El(e.details,t);i&&_t(i.start)&&($.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),Ur(i.start,t))}}function Tl(d,t){if(!t.fragments.length||!d.hasProgramDateTime||!t.hasProgramDateTime)return;const e=t.fragments[0].programDateTime,i=d.fragments[0].programDateTime,s=(i-e)/1e3+t.fragments[0].start;s&&_t(s)&&($.log(`Adjusting PTS using programDateTime delta ${i-e}ms, sliding:${s.toFixed(3)} ${d.url} `),Ur(s,d))}function kn(d,t){if(!d.hasProgramDateTime||!t.hasProgramDateTime)return;const e=d.fragments,i=t.fragments;if(!e.length||!i.length)return;const s=Math.round(i.length/2)-1,r=i[s],n=Cn(e,r.cc)||e[Math.round(e.length/2)-1],a=r.programDateTime,l=n.programDateTime;if(a===null||l===null)return;const o=(l-a)/1e3-(n.start-r.start);Ur(o,d)}class bl{constructor(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}decrypt(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)}}class Al{constructor(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function Ll(d){const t=d.byteLength,e=t&&new DataView(d.buffer).getUint8(t-1);return e?ei(d,0,t-e):d}class Il{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=e.getUint32(s*4);return i}initTable(){const t=this.sBox,e=this.invSBox,i=this.subMix,s=i[0],r=i[1],n=i[2],a=i[3],l=this.invSubMix,o=l[0],c=l[1],u=l[2],h=l[3],f=new Uint32Array(256);let m=0,_=0,E=0;for(E=0;E<256;E++)E<128?f[E]=E<<1:f[E]=E<<1^283;for(E=0;E<256;E++){let D=_^_<<1^_<<2^_<<3^_<<4;D=D>>>8^D&255^99,t[m]=D,e[D]=m;const O=f[m],I=f[O],x=f[I];let P=f[D]*257^D*16843008;s[m]=P<<24|P>>>8,r[m]=P<<16|P>>>16,n[m]=P<<8|P>>>24,a[m]=P,P=x*16843009^I*65537^O*257^m*16843008,o[D]=P<<24|P>>>8,c[D]=P<<16|P>>>16,u[D]=P<<8|P>>>24,h[D]=P,m?(m=O^f[f[f[x^O]]],_^=f[f[_]]):m=_=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let i=!0,s=0;for(;s<e.length&&i;)i=e[s]===this.key[s],s++;if(i)return;this.key=e;const r=this.keySize=e.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const n=this.ksRows=(r+6+1)*4;let a,l;const o=this.keySchedule=new Uint32Array(n),c=this.invKeySchedule=new Uint32Array(n),u=this.sBox,h=this.rcon,f=this.invSubMix,m=f[0],_=f[1],E=f[2],D=f[3];let O,I;for(a=0;a<n;a++){if(a<r){O=o[a]=e[a];continue}I=O,a%r===0?(I=I<<8|I>>>24,I=u[I>>>24]<<24|u[I>>>16&255]<<16|u[I>>>8&255]<<8|u[I&255],I^=h[a/r|0]<<24):r>6&&a%r===4&&(I=u[I>>>24]<<24|u[I>>>16&255]<<16|u[I>>>8&255]<<8|u[I&255]),o[a]=O=(o[a-r]^I)>>>0}for(l=0;l<n;l++)a=n-l,l&3?I=o[a]:I=o[a-4],l<4||a<=4?c[l]=I:c[l]=m[u[I>>>24]]^_[u[I>>>16&255]]^E[u[I>>>8&255]]^D[u[I&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24}decrypt(t,e,i){const s=this.keySize+6,r=this.invKeySchedule,n=this.invSBox,a=this.invSubMix,l=a[0],o=a[1],c=a[2],u=a[3],h=this.uint8ArrayToUint32Array_(i);let f=h[0],m=h[1],_=h[2],E=h[3];const D=new Int32Array(t),O=new Int32Array(D.length);let I,x,P,C,b,S,L,A,U,B,G,Q,nt,ot;const V=this.networkToHostOrderSwap;for(;e<D.length;){for(U=V(D[e]),B=V(D[e+1]),G=V(D[e+2]),Q=V(D[e+3]),b=U^r[0],S=Q^r[1],L=G^r[2],A=B^r[3],nt=4,ot=1;ot<s;ot++)I=l[b>>>24]^o[S>>16&255]^c[L>>8&255]^u[A&255]^r[nt],x=l[S>>>24]^o[L>>16&255]^c[A>>8&255]^u[b&255]^r[nt+1],P=l[L>>>24]^o[A>>16&255]^c[b>>8&255]^u[S&255]^r[nt+2],C=l[A>>>24]^o[b>>16&255]^c[S>>8&255]^u[L&255]^r[nt+3],b=I,S=x,L=P,A=C,nt=nt+4;I=n[b>>>24]<<24^n[S>>16&255]<<16^n[L>>8&255]<<8^n[A&255]^r[nt],x=n[S>>>24]<<24^n[L>>16&255]<<16^n[A>>8&255]<<8^n[b&255]^r[nt+1],P=n[L>>>24]<<24^n[A>>16&255]<<16^n[b>>8&255]<<8^n[S&255]^r[nt+2],C=n[A>>>24]<<24^n[b>>16&255]<<16^n[S>>8&255]<<8^n[L&255]^r[nt+3],O[e]=V(I^f),O[e+1]=V(C^m),O[e+2]=V(P^_),O[e+3]=V(x^E),f=U,m=B,_=G,E=Q,e=e+4}return O.buffer}}const wl=16;class jr{constructor(t,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch(i){}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const i=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?Ll(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(t,e,i){return this.useSoftware?new Promise((s,r)=>{this.softwareDecrypt(new Uint8Array(t),e,i);const n=this.flush();n?s(n.buffer):r(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,i)}softwareDecrypt(t,e,i){const{currentIV:s,currentResult:r,remainderData:n}=this;this.logOnce("JS AES decrypt"),n&&(t=ii(n,t),this.remainderData=null);const a=this.getValidChunk(t);if(!a.length)return null;s&&(i=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new Il),l.expandKey(e);const o=r;return this.currentResult=l.decrypt(a.buffer,0,i),this.currentIV=ei(a,-16).buffer,o||null}webCryptoDecrypt(t,e,i){const s=this.subtle;return(this.key!==e||!this.fastAesKey)&&(this.key=e,this.fastAesKey=new Al(s,e)),this.fastAesKey.expandKey().then(r=>s?(this.logOnce("WebCrypto AES decrypt"),new bl(s,new Uint8Array(i)).decrypt(t.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>($.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(t,e,i)))}onWebCryptoError(t,e,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,i);const s=this.flush();if(s)return s.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(t){let e=t;const i=t.length-t.length%wl;return i!==t.length&&(e=ei(t,0,i),this.remainderData=ei(t,i)),e}logOnce(t){!this.logEnabled||($.log(`[decrypter]: ${t}`),this.logEnabled=!1)}}const Rl={toString:function(d){let t="";const e=d.length;for(let i=0;i<e;i++)t+=`[${d.start(i).toFixed(3)}-${d.end(i).toFixed(3)}]`;return t}},it={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Gr extends yl{constructor(t,e,i,s,r){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=it.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=r,this.logPrefix=s,this.log=$.log.bind($,`${s}:`),this.warn=$.warn.bind($,`${s}:`),this.hls=t,this.fragmentLoader=new ml(t.config),this.keyLoader=i,this.fragmentTracker=e,this.config=t.config,this.decrypter=new jr(t.config),t.on(w.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=it.STOPPED}_streamEnded(t,e){if(e.live||t.nextStart||!t.end||!this.media)return!1;const i=e.partList;if(i!=null&&i.length){const r=i[i.length-1];return Ut.isBuffered(this.media,r.start+r.duration/2)}const s=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(s)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var t;return(t=this.levels[this.levelLastLoaded])==null?void 0:t.details}}onMediaAttached(t,e){const i=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);const s=this.config;this.levels&&s.autoStartLoad&&this.state===it.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(){const t=this.media;t!=null&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:t,fragCurrent:e,media:i,mediaBuffer:s,state:r}=this,n=i?i.currentTime:0,a=Ut.bufferInfo(s||i,n,t.maxBufferHole);if(this.log(`media seeking to ${_t(n)?n.toFixed(3):n}, state: ${r}`),this.state===it.ENDED)this.resetLoadingState();else if(e){const l=t.maxFragLookUpTolerance,o=e.start-l,c=e.start+e.duration+l;if(!a.len||c<a.start||o>a.end){const u=n>c;(n<o||u)&&(u&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(n,1/0,this.playlistType,!0),this.lastCurrentTime=n),!this.loadedmetadata&&!a.len&&(this.nextLoadPosition=this.startPosition=n),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(t,e){this.startTimeOffset=e.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=it.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,i){this._loadFragForPlayback(t,e,i)}_loadFragForPlayback(t,e,i){const s=r=>{if(this.fragContextChanged(t)){this.warn(`Fragment ${t.sn}${r.part?" p: "+r.part.index:""} of level ${t.level} was dropped during download.`),this.fragmentTracker.removeFragment(t);return}t.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(t,e,i,s).then(r=>{if(!r)return;const n=this.state;if(this.fragContextChanged(t)){(n===it.FRAG_LOADING||!this.fragCurrent&&n===it.PARSING)&&(this.fragmentTracker.removeFragment(t),this.state=it.IDLE);return}"payload"in r&&(this.log(`Loaded fragment ${t.sn} of level ${t.level}`),this.hls.trigger(w.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===it.STOPPED||this.state===it.ERROR||(this.warn(r),this.resetFragmentLoading(t))})}clearTrackerIfNeeded(t){var e;const{fragmentTracker:i}=this;if(i.getState(t)===ie.APPENDING){const r=t.type,n=this.getFwdBufferInfo(this.mediaBuffer,r),a=Math.max(t.duration,n?n.len:this.config.maxBufferLength);this.reduceMaxBufferLength(a)&&i.removeFragment(t)}else((e=this.mediaBuffer)==null?void 0:e.buffered.length)===0?i.removeAllFragments():i.hasParts(t.type)&&(i.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),i.getState(t)===ie.PARTIAL&&i.removeFragment(t))}flushMainBuffer(t,e,i=null){if(!(t-e))return;const s={startOffset:t,endOffset:e,type:i};this.hls.trigger(w.BUFFER_FLUSHING,s)}_loadInitSegment(t,e){this._doFragLoad(t,e).then(i=>{if(!i||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:s}=this,{payload:r}=i,n=t.decryptdata;if(r&&r.byteLength>0&&n&&n.key&&n.iv&&n.method==="AES-128"){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer).catch(l=>{throw s.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:t}),l}).then(l=>{const o=self.performance.now();return s.trigger(w.FRAG_DECRYPTED,{frag:t,payload:l,stats:{tstart:a,tdecrypt:o}}),i.payload=l,i})}return i}).then(i=>{const{fragCurrent:s,hls:r,levels:n}=this;if(!n)throw new Error("init load aborted, missing levels");const a=t.stats;this.state=it.IDLE,e.fragmentError=0,t.data=new Uint8Array(i.payload),a.parsing.start=a.buffering.start=self.performance.now(),a.parsing.end=a.buffering.end=self.performance.now(),i.frag===s&&r.trigger(w.FRAG_BUFFERED,{stats:a,frag:s,part:null,id:t.type}),this.tick()}).catch(i=>{this.state===it.STOPPED||this.state===it.ERROR||(this.warn(i),this.resetFragmentLoading(t))})}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId}fragBufferedComplete(t,e){var i,s,r,n;const a=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.playlistType===xt.MAIN?"level":"track"} ${t.level} (frag:[${((i=t.startPTS)!=null?i:NaN).toFixed(3)}-${((s=t.endPTS)!=null?s:NaN).toFixed(3)}] > buffer:${a?Rl.toString(Ut.getBuffered(a)):"(detached)"})`),this.state=it.IDLE,a&&(!this.loadedmetadata&&t.type==xt.MAIN&&a.buffered.length&&((r=this.fragCurrent)==null?void 0:r.sn)===((n=this.fragPrevious)==null?void 0:n.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:i,part:s,partsLoaded:r}=t,n=!r||r.length===0||r.some(l=>!l),a=new Br(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!n);e.flush(a)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e,i=null,s){var r;const n=e==null?void 0:e.details;if(!this.levels||!n)throw new Error(`frag load aborted, missing level${n?"":" detail"}s`);let a=null;if(t.encrypted&&!((r=t.decryptdata)!=null&&r.key)?(this.log(`Loading key for ${t.sn} of [${n.startSN}-${n.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${t.level}`),this.state=it.KEY_LOADING,this.fragCurrent=t,a=this.keyLoader.load(t).then(c=>{if(!this.fragContextChanged(c.frag))return this.hls.trigger(w.KEY_LOADED,c),this.state===it.KEY_LOADING&&(this.state=it.IDLE),c}),this.hls.trigger(w.KEY_LOADING,{frag:t}),this.fragCurrent===null&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!t.encrypted&&n.encryptedFragments.length&&this.keyLoader.loadClear(t,n.encryptedFragments),i=Math.max(t.start,i||0),this.config.lowLatencyMode&&t.sn!=="initSegment"){const c=n.partList;if(c&&s){i>t.end&&n.fragmentHint&&(t=n.fragmentHint);const u=this.getNextPart(c,t,i);if(u>-1){const h=c[u];this.log(`Loading part sn: ${t.sn} p: ${h.index} cc: ${t.cc} of playlist [${n.startSN}-${n.endSN}] parts [0-${u}-${c.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${t.level}, target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=h.start+h.duration,this.state=it.FRAG_LOADING;let f;return a?f=a.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(t,h,e,s)).catch(m=>this.handleFragLoadError(m)):f=this.doFragPartsLoad(t,h,e,s).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(w.FRAG_LOADING,{frag:t,part:h,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):f}else if(!t.url||this.loadedEndOfParts(c,i))return Promise.resolve(null)}}this.log(`Loading fragment ${t.sn} cc: ${t.cc} ${n?"of ["+n.startSN+"-"+n.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${t.level}, target: ${parseFloat(i.toFixed(3))}`),_t(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=it.FRAG_LOADING;const l=this.config.progressive;let o;return l&&a?o=a.then(c=>!c||this.fragContextChanged(c==null?void 0:c.frag)?null:this.fragmentLoader.load(t,s)).catch(c=>this.handleFragLoadError(c)):o=Promise.all([this.fragmentLoader.load(t,l?s:void 0),a]).then(([c])=>(!l&&c&&s&&s(c),c)).catch(c=>this.handleFragLoadError(c)),this.hls.trigger(w.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):o}doFragPartsLoad(t,e,i,s){return new Promise((r,n)=>{var a;const l=[],o=(a=i.details)==null?void 0:a.partList,c=u=>{this.fragmentLoader.loadPart(t,u,s).then(h=>{l[u.index]=h;const f=h.part;this.hls.trigger(w.FRAG_LOADED,h);const m=Rs(i,t.sn,u.index+1)||Rn(o,t.sn,u.index+1);if(m)c(m);else return r({frag:t,part:f,partsLoaded:l})}).catch(n)};c(e)})}handleFragLoadError(t){if("data"in t){const e=t.data;t.data&&e.details===J.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(w.ERROR,e)}else this.hls.trigger(w.ERROR,{type:Et.OTHER_ERROR,details:J.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||this.state!==it.PARSING){!this.fragCurrent&&this.state!==it.STOPPED&&this.state!==it.ERROR&&(this.state=it.IDLE);return}const{frag:i,part:s,level:r}=e,n=self.performance.now();i.stats.parsing.end=n,s&&(s.stats.parsing.end=n),this.updateLevelTiming(i,s,r,t.partial)}getCurrentContext(t){const{levels:e,fragCurrent:i}=this,{level:s,sn:r,part:n}=t;if(!(e!=null&&e[s]))return this.warn(`Levels object was unset while buffering fragment ${r} of level ${s}. The current chunk will not be buffered.`),null;const a=e[s],l=n>-1?Rs(a,r,n):null,o=l?l.fragment:nl(a,r,i);return o?(i&&i!==o&&(o.stats=i.stats),{frag:o,part:l,level:a}):null}bufferFragmentData(t,e,i,s){var r;if(!t||this.state!==it.PARSING)return;const{data1:n,data2:a}=t;let l=n;if(n&&a&&(l=ii(n,a)),!((r=l)!=null&&r.length))return;const o={type:t.type,frag:e,part:i,chunkMeta:s,parent:e.type,data:l};this.hls.trigger(w.BUFFER_APPENDING,o),t.dropped&&t.independent&&!i&&this.flushBufferGap(e)}flushBufferGap(t){const e=this.media;if(!e)return;if(!Ut.isBuffered(e,e.currentTime)){this.flushMainBuffer(0,t.start);return}const i=e.currentTime,s=Ut.bufferInfo(e,i,0),r=t.duration,n=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),a=Math.max(Math.min(t.start-n,s.end-n),i+n);t.start-a>n&&this.flushMainBuffer(a,t.start)}getFwdBufferInfo(t,e){const i=this.getLoadPosition();return _t(i)?this.getFwdBufferInfoAtPos(t,i,e):null}getFwdBufferInfoAtPos(t,e,i){const{config:{maxBufferHole:s}}=this,r=Ut.bufferInfo(t,e,s);if(r.len===0&&r.nextStart!==void 0){const n=this.fragmentTracker.getBufferedFrag(e,i);if(n&&r.nextStart<n.end)return Ut.bufferInfo(t,e,Math.max(r.nextStart,s))}return r}getMaxBufferLength(t){const{config:e}=this;let i;return t?i=Math.max(8*e.maxBufferSize/t,e.maxBufferLength):i=e.maxBufferLength,Math.min(i,e.maxMaxBufferLength)}reduceMaxBufferLength(t){const e=this.config,i=t||e.maxBufferLength;return e.maxMaxBufferLength>=i?(e.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${e.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(t,e=xt.MAIN){const i=this.fragmentTracker.getAppendedFrag(t,xt.MAIN);return i&&"fragment"in i?i.fragment:i}getNextFragment(t,e){const i=e.fragments,s=i.length;if(!s)return null;const{config:r}=this,n=i[0].start;let a;if(e.live){const l=r.initialLiveManifestSize;if(s<l)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${l})`),null;!e.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(a=this.getInitialLiveFragment(e,i),this.startPosition=a?this.hls.liveSyncPosition||a.start:t)}else t<=n&&(a=i[0]);if(!a){const l=r.lowLatencyMode?e.partEnd:e.fragmentEnd;a=this.getFragmentAtPosition(t,l,e)}return this.mapToInitFragWhenRequired(a)}isLoopLoading(t,e){const i=this.fragmentTracker.getState(t);return(i===ie.OK||i===ie.PARTIAL&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,i,s,r){const n=t.gap,a=this.getNextFragment(this.nextLoadPosition,e);if(a===null)return a;if(t=a,n&&t&&!t.gap&&i.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s);if(l!==null&&i.len+l.len>=r)return this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${t.sn}`),null}return t}mapToInitFragWhenRequired(t){return t!=null&&t.initSegment&&!(t!=null&&t.initSegment.data)&&!this.bitrateTest?t.initSegment:t}getNextPart(t,e,i){let s=-1,r=!1,n=!0;for(let a=0,l=t.length;a<l;a++){const o=t[a];if(n=n&&!o.independent,s>-1&&i<o.start)break;const c=o.loaded;c?s=-1:(r||o.independent||n)&&o.fragment===e&&(s=a),r=c}return s}loadedEndOfParts(t,e){const i=t[t.length-1];return i&&e>i.start&&i.loaded}getInitialLiveFragment(t,e){const i=this.fragPrevious;let s=null;if(i){if(t.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=ol(e,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const r=i.sn+1;if(r>=t.startSN&&r<=t.endSN){const n=e[r-t.startSN];i.cc===n.cc&&(s=n,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=cl(e,i.cc),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(s=this.getFragmentAtPosition(r,this.bitrateTest?t.fragmentEnd:t.edge,t))}return s}getFragmentAtPosition(t,e,i){const{config:s}=this;let{fragPrevious:r}=this,{fragments:n,endSN:a}=i;const{fragmentHint:l}=i,o=s.maxFragLookUpTolerance,c=i.partList,u=!!(s.lowLatencyMode&&c!=null&&c.length&&l);u&&l&&!this.bitrateTest&&(n=n.concat(l),a=l.sn);let h;if(t<e){const f=t>e-o?0:o;h=vi(r,n,t,f)}else h=n[n.length-1];if(h){const f=h.sn-i.startSN,m=this.fragmentTracker.getState(h);if((m===ie.OK||m===ie.PARTIAL&&h.gap)&&(r=h),r&&h.sn===r.sn&&(!u||c[0].fragment.sn>h.sn)&&r&&h.level===r.level){const E=n[f+1];h.sn<a&&this.fragmentTracker.getState(E)!==ie.OK?h=E:h=null}}return h}synchronizeToLiveEdge(t){const{config:e,media:i}=this;if(!i)return;const s=this.hls.liveSyncPosition,r=i.currentTime,n=t.fragments[0].start,a=t.edge,l=r>=n-e.maxFragLookUpTolerance&&r<=a;if(s!==null&&i.duration>s&&(r<s||!l)){const o=e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;(!l&&i.readyState<4||r<a-o)&&(this.loadedmetadata||(this.nextLoadPosition=s),i.readyState&&(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${s.toFixed(3)}`),i.currentTime=s))}}alignPlaylists(t,e){const{levels:i,levelLastLoaded:s,fragPrevious:r}=this,n=s!==null?i[s]:null,a=t.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;const l=t.fragments[0].start,o=!e,c=t.alignedSliding&&_t(l);if(o||!c&&!l){xl(r,n,t);const u=t.fragments[0].start;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${e?e.startSN:"na"}->${t.startSN} prev-sn: ${r?r.sn:"na"} fragments: ${a}`),u}return l}waitForCdnTuneIn(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,t.partTarget*3)}setStartPosition(t,e){let i=this.startPosition;if(i<e&&(i=-1),i===-1||this.lastCurrentTime===-1){const s=this.startTimeOffset!==null,r=s?this.startTimeOffset:t.startTimeOffset;r!==null&&_t(r)?(i=e+r,r<0&&(i+=t.totalduration),i=Math.min(Math.max(e,i),e+t.totalduration),this.log(`Start time offset ${r} found in ${s?"multivariant":"media"} playlist, adjust startPosition to ${i}`),this.startPosition=i):t.live?i=this.hls.liveSyncPosition||e:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i}getLoadPosition(){const{media:t}=this;let e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e}handleFragLoadAborted(t,e){this.transmuxer&&t.sn!=="initSegment"&&t.stats.aborted&&(this.warn(`Fragment ${t.sn}${e?" part "+e.index:""} of level ${t.level} was aborted`),this.resetFragmentLoading(t))}resetFragmentLoading(t){(!this.fragCurrent||!this.fragContextChanged(t)&&this.state!==it.FRAG_LOADING_WAITING_RETRY)&&(this.state=it.IDLE)}onFragmentOrKeyLoadError(t,e){if(e.chunkMeta&&!e.frag){const c=this.getCurrentContext(e.chunkMeta);c&&(e.frag=c.frag)}const i=e.frag;if(!i||i.type!==t||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const r=e.details===J.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(i,!0);const n=e.errorAction,{action:a,retryCount:l=0,retryConfig:o}=n||{};if(n&&a===de.RetryRequest&&o){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);const c=Nr(o,l);this.warn(`Fragment ${i.sn} of ${t} ${i.level} errored with ${e.details}, retrying loading ${l+1}/${o.maxNumRetry} in ${c}ms`),n.resolved=!0,this.retryDate=self.performance.now()+c,this.state=it.FRAG_LOADING_WAITING_RETRY}else o&&n?(this.resetFragmentErrors(t),l<o.maxNumRetry?r||(n.resolved=!0):$.warn(`${e.details} reached or exceeded max retry (${l})`)):this.state=it.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(t){if(this.state===it.PARSING||this.state===it.PARSED){const e=t.parent,i=this.getFwdBufferInfo(this.mediaBuffer,e),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len);const r=!s;return r&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${e} buffer`),t.frag&&(this.fragmentTracker.removeFragment(t.frag),this.nextLoadPosition=t.frag.start),this.resetLoadingState(),r}return!1}resetFragmentErrors(t){t===xt.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==it.STOPPED&&(this.state=it.IDLE)}afterBufferFlushed(t,e,i){if(!t)return;const s=Ut.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,s,i),this.state===it.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=it.IDLE}resetStartWhenNotLoaded(t){if(!this.loadedmetadata){this.startFragRequested=!1;const e=this.levels?this.levels[t].details:null;e!=null&&e.live?(this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){this.warn(`The loading context changed while buffering fragment ${t.sn} of level ${t.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(t.level),this.resetLoadingState()}removeUnbufferedFrags(t=0){this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,i,s){var r;const n=i.details;if(!n){this.warn("level.details undefined");return}if(Object.keys(t.elementaryStreams).reduce((l,o)=>{const c=t.elementaryStreams[o];if(c){const u=c.endPTS-c.startPTS;if(u<=0)return this.warn(`Could not parse fragment ${t.sn} ${o} duration reliably (${u})`),l||!1;const h=s?0:In(n,t,c.startPTS,c.endPTS,c.startDTS,c.endDTS);return this.hls.trigger(w.LEVEL_PTS_UPDATED,{details:n,level:i,drift:h,type:o,frag:t,start:c.startPTS,end:c.endPTS}),!0}return l},!1))i.fragmentError=0;else if(((r=this.transmuxer)==null?void 0:r.error)===null){const l=new Error(`Found no media in fragment ${t.sn} of level ${i.id} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:t,reason:`Found no media in msn ${t.sn} of level "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=it.PARSED,this.hls.trigger(w.FRAG_PARSED,{frag:t,part:e})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(t){t.event==="demuxerWorker"&&(this.resetTransmuxer(),this.resetLoadingState())}set state(t){const e=this._state;e!==t&&(this._state=t,this.log(`${e}->${t}`))}get state(){return this._state}}function Mn(){return self.SourceBuffer||self.WebKitSourceBuffer}function Dl(){const d=$i();if(!d)return!1;const t=Mn(),e=d&&typeof d.isTypeSupported=="function"&&d.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function";return!!e&&!!i}function Cl(){var d;const t=Mn();return typeof(t==null||(d=t.prototype)==null?void 0:d.changeType)=="function"}function kl(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Ml(){const d=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(d);return{worker:new self.Worker(t),objectURL:t}}function Pl(d){const t=new self.URL(d,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}function Re(d="",t=9e4){return{type:d,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Pn{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(t,e){return!1}appendFrame(t,e,i){}demux(t,e){this.cachedData&&(t=ii(this.cachedData,t),this.cachedData=null);let i=Oi(t,0),s=i?i.length:0,r;const n=this._audioTrack,a=this._id3Track,l=i?go(i):void 0,o=t.length;for((this.basePTS===null||this.frameIndex===0&&_t(l))&&(this.basePTS=Ol(l,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:be.audioId3,duration:Number.POSITIVE_INFINITY});s<o;){if(this.canParse(t,s)){const c=this.appendFrame(n,t,s);c?(this.frameIndex++,this.lastPTS=c.sample.pts,s+=c.length,r=s):s=o}else mo(t,s)?(i=Oi(t,s),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:be.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,r=s):s++;if(s===o&&r!==o){const c=ei(t,r);this.cachedData?this.cachedData=ii(this.cachedData,c):this.cachedData=c}}return{audioTrack:n,videoTrack:Re(),id3Track:a,textTrack:Re()}}demuxSampleAes(t,e,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Re(),id3Track:this._id3Track,textTrack:Re()}}destroy(){}}const Ol=(d,t,e)=>{if(_t(d))return d*90;const i=e?e.baseTime*9e4/e.timescale:0;return t*9e4+i};function Nl(d,t,e,i){let s,r,n,a;const l=navigator.userAgent.toLowerCase(),o=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=((t[e+2]&192)>>>6)+1;const u=(t[e+2]&60)>>>2;if(u>c.length-1){d.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${u}`});return}return n=(t[e+2]&1)<<2,n|=(t[e+3]&192)>>>6,$.log(`manifest codec:${i}, ADTS type:${s}, samplingIndex:${u}`),/firefox/i.test(l)?u>=6?(s=5,a=new Array(4),r=u-3):(s=2,a=new Array(2),r=u):l.indexOf("android")!==-1?(s=2,a=new Array(2),r=u):(s=5,a=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&u>=6?r=u-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(u>=6&&n===1||/vivaldi/i.test(l))||!i&&n===1)&&(s=2,a=new Array(2)),r=u)),a[0]=s<<3,a[0]|=(u&14)>>1,a[1]|=(u&1)<<7,a[1]|=n<<3,s===5&&(a[1]|=(r&14)>>1,a[2]=(r&1)<<7,a[2]|=2<<2,a[3]=0),{config:a,samplerate:c[u],channelCount:n,codec:"mp4a.40."+s,manifestCodec:o}}function On(d,t){return d[t]===255&&(d[t+1]&246)===240}function Nn(d,t){return d[t+1]&1?7:9}function Vr(d,t){return(d[t+3]&3)<<11|d[t+4]<<3|(d[t+5]&224)>>>5}function Fl(d,t){return t+5<d.length}function ji(d,t){return t+1<d.length&&On(d,t)}function Bl(d,t){return Fl(d,t)&&On(d,t)&&Vr(d,t)<=d.length-t}function Ul(d,t){if(ji(d,t)){const e=Nn(d,t);if(t+e>=d.length)return!1;const i=Vr(d,t);if(i<=e)return!1;const s=t+i;return s===d.length||ji(d,s)}return!1}function Fn(d,t,e,i,s){if(!d.samplerate){const r=Nl(t,e,i,s);if(!r)return;d.config=r.config,d.samplerate=r.samplerate,d.channelCount=r.channelCount,d.codec=r.codec,d.manifestCodec=r.manifestCodec,$.log(`parsed codec:${d.codec}, rate:${r.samplerate}, channels:${r.channelCount}`)}}function Bn(d){return 1024*9e4/d}function jl(d,t){const e=Nn(d,t);if(t+e<=d.length){const i=Vr(d,t)-e;if(i>0)return{headerLength:e,frameLength:i}}}function Un(d,t,e,i,s){const r=Bn(d.samplerate),n=i+s*r,a=jl(t,e);let l;if(a){const{frameLength:u,headerLength:h}=a,f=h+u,m=Math.max(0,e+f-t.length);m?(l=new Uint8Array(f-h),l.set(t.subarray(e+h,t.length),0)):l=t.subarray(e+h,e+f);const _={unit:l,pts:n};return m||d.samples.push(_),{sample:_,length:f,missing:m}}const o=t.length-e;return l=new Uint8Array(o),l.set(t.subarray(e,t.length),0),{sample:{unit:l,pts:n},length:o,missing:-1}}class Gl extends Pn{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,i,s){super.resetInitSegment(t,e,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:s,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;let i=(Oi(t,0)||[]).length;for(let s=t.length;i<s;i++)if(Ul(t,i))return $.log("ADTS sync word found !"),!0;return!1}canParse(t,e){return Bl(t,e)}appendFrame(t,e,i){Fn(t,this.observer,e,i,t.manifestCodec);const s=Un(t,e,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const Vl=/\/emsg[-/]ID3/i;class $l{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,i,s){const r=this.videoTrack=Re("video",1),n=this.audioTrack=Re("audio",1),a=this.txtTrack=Re("text",1);if(this.id3Track=Re("id3",1),this.timeOffset=0,!(t!=null&&t.byteLength))return;const l=En(t);if(l.video){const{id:o,timescale:c,codec:u}=l.video;r.id=o,r.timescale=a.timescale=c,r.codec=u}if(l.audio){const{id:o,timescale:c,codec:u}=l.audio;n.id=o,n.timescale=c,n.codec=u}a.id=yn.text,r.sampleDuration=0,r.duration=n.duration=s}resetContiguity(){this.remainderData=null}static probe(t){return t=t.length>16384?t.subarray(0,16384):t,Mt(t,["moof"]).length>0}demux(t,e){this.timeOffset=e;let i=t;const s=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=ii(this.remainderData,t));const a=Co(i);this.remainderData=a.remainder,s.samples=a.valid||new Uint8Array}else s.samples=i;const n=this.extractID3Track(s,e);return r.samples=ps(e,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,i=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(e,this.timeOffset);return i.samples=ps(t,e),{videoTrack:e,audioTrack:Re(),id3Track:s,textTrack:Re()}}extractID3Track(t,e){const i=this.id3Track;if(t.samples.length){const s=Mt(t.samples,["emsg"]);s&&s.forEach(r=>{const n=Po(r);if(Vl.test(n.schemeIdUri)){const a=_t(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale;let l=n.eventDuration===4294967295?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const o=n.payload;i.samples.push({data:o,len:o.byteLength,dts:a,pts:a,type:be.emsg,duration:l})}})}return i}demuxSampleAes(t,e,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}let wi=null;const zl=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Hl=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Yl=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Kl=[0,1,1,4];function jn(d,t,e,i,s){if(e+24>t.length)return;const r=Gn(t,e);if(r&&e+r.frameLength<=t.length){const n=r.samplesPerFrame*9e4/r.sampleRate,a=i+s*n,l={unit:t.subarray(e,e+r.frameLength),pts:a,dts:a};return d.config=[],d.channelCount=r.channelCount,d.samplerate=r.sampleRate,d.samples.push(l),{sample:l,length:r.frameLength,missing:0}}}function Gn(d,t){const e=d[t+1]>>3&3,i=d[t+1]>>1&3,s=d[t+2]>>4&15,r=d[t+2]>>2&3;if(e!==1&&s!==0&&s!==15&&r!==3){const n=d[t+2]>>1&1,a=d[t+3]>>6,l=e===3?3-i:i===3?3:4,o=zl[l*14+s-1]*1e3,u=Hl[(e===3?0:e===2?1:2)*3+r],h=a===3?1:2,f=Yl[e][i],m=Kl[i],_=f*8*m,E=Math.floor(f*o/u+n)*m;if(wi===null){const I=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);wi=I?parseInt(I[1]):0}return!!wi&&wi<=87&&i===2&&o>=224e3&&a===0&&(d[t+3]=d[t+3]|128),{sampleRate:u,channelCount:h,frameLength:E,samplesPerFrame:_}}}function $r(d,t){return d[t]===255&&(d[t+1]&224)===224&&(d[t+1]&6)!==0}function Vn(d,t){return t+1<d.length&&$r(d,t)}function Wl(d,t){return $r(d,t)&&4<=d.length-t}function ql(d,t){if(t+1<d.length&&$r(d,t)){const i=Gn(d,t);let s=4;i!=null&&i.frameLength&&(s=i.frameLength);const r=t+s;return r===d.length||Vn(d,r)}return!1}class Fs{constructor(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const t=this.data,e=this.bytesAvailable,i=t.byteLength-e,s=new Uint8Array(4),r=Math.min(4,e);if(r===0)throw new Error("no bytes available");s.set(t.subarray(i,i+r)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(t){let e;t=Math.min(t,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const i=this.word>>>32-e;if(t>32&&$.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=t-e,e>0&&this.bitsAvailable?i<<e|this.readBits(e):i}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if((this.word&2147483648>>>t)!==0)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(t){let e=8,i=8,s;for(let r=0;r<t;r++)i!==0&&(s=this.readEG(),i=(e+s+256)%256),e=i===0?e:i}readSPS(){let t=0,e=0,i=0,s=0,r,n,a;const l=this.readUByte.bind(this),o=this.readBits.bind(this),c=this.readUEG.bind(this),u=this.readBoolean.bind(this),h=this.skipBits.bind(this),f=this.skipEG.bind(this),m=this.skipUEG.bind(this),_=this.skipScalingList.bind(this);l();const E=l();if(o(5),h(3),l(),m(),E===100||E===110||E===122||E===244||E===44||E===83||E===86||E===118||E===128){const C=c();if(C===3&&h(1),m(),m(),h(1),u())for(n=C!==3?8:12,a=0;a<n;a++)u()&&(a<6?_(16):_(64))}m();const D=c();if(D===0)c();else if(D===1)for(h(1),f(),f(),r=c(),a=0;a<r;a++)f();m(),h(1);const O=c(),I=c(),x=o(1);x===0&&h(1),h(1),u()&&(t=c(),e=c(),i=c(),s=c());let P=[1,1];if(u()&&u())switch(l()){case 1:P=[1,1];break;case 2:P=[12,11];break;case 3:P=[10,11];break;case 4:P=[16,11];break;case 5:P=[40,33];break;case 6:P=[24,11];break;case 7:P=[20,11];break;case 8:P=[32,11];break;case 9:P=[80,33];break;case 10:P=[18,11];break;case 11:P=[15,11];break;case 12:P=[64,33];break;case 13:P=[160,99];break;case 14:P=[4,3];break;case 15:P=[3,2];break;case 16:P=[2,1];break;case 255:{P=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((O+1)*16-t*2-e*2),height:(2-x)*(I+1)*16-(x?2:4)*(i+s),pixelRatio:P}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class Ql{constructor(t,e,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new jr(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(t,e,i){const s=t[e].unit;if(s.length<=16)return;const r=s.subarray(16,s.length-s.length%16),n=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(n).then(a=>{const l=new Uint8Array(a);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,i)})}decryptAacSamples(t,e,i){for(;;e++){if(e>=t.length){i();return}if(!(t[e].unit.length<32)&&(this.decryptAacSample(t,e,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(t){const e=Math.floor((t.length-48)/160)*16+16,i=new Int8Array(e);let s=0;for(let r=32;r<t.length-16;r+=160,s+=16)i.set(t.subarray(r,r+16),s);return i}getAvcDecryptedUnit(t,e){const i=new Uint8Array(e);let s=0;for(let r=32;r<t.length-16;r+=160,s+=16)t.set(i.subarray(s,s+16),r);return t}decryptAvcSample(t,e,i,s,r){const n=Tn(r.data),a=this.getAvcEncryptedData(n);this.decryptBuffer(a.buffer).then(l=>{r.data=this.getAvcDecryptedUnit(n,l),this.decrypter.isSync()||this.decryptAvcSamples(t,e,i+1,s)})}decryptAvcSamples(t,e,i,s){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,i=0){if(e>=t.length){s();return}const r=t[e].units;for(;!(i>=r.length);i++){const n=r[i];if(!(n.data.length<=48||n.type!==1&&n.type!==5)&&(this.decryptAvcSample(t,e,i,s,n),!this.decrypter.isSync()))return}}}}const ae=188;class We{constructor(t,e,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=i}static probe(t){const e=We.syncOffset(t);return e>0&&$.warn(`MPEG2-TS detected but first sync word found @ offset ${e}`),e!==-1}static syncOffset(t){const e=t.length;let i=Math.min(ae*5,t.length-ae)+1,s=0;for(;s<i;){let r=!1,n=-1,a=0;for(let l=s;l<e;l+=ae)if(t[l]===71){if(a++,n===-1&&(n=l,n!==0&&(i=Math.min(n+ae*99,t.length-ae)+1)),r||(r=Dr(t,l)===0),r&&a>1&&(n===0&&a>2||l+ae>i))return n}else{if(a)return-1;break}s++}return-1}static createTrack(t,e){return{container:t==="video"||t==="audio"?"video/mp2t":void 0,type:t,id:yn[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:t==="audio"?e:void 0}}resetInitSegment(t,e,i,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=We.createTrack("video"),this._audioTrack=We.createTrack("audio",s),this._id3Track=We.createTrack("id3"),this._txtTrack=We.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=i,this._duration=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_avcTrack:e,_id3Track:i}=this;t&&(t.pesData=null),e&&(e.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(t,e,i=!1,s=!1){i||(this.sampleAes=null);let r;const n=this._avcTrack,a=this._audioTrack,l=this._id3Track,o=this._txtTrack;let c=n.pid,u=n.pesData,h=a.pid,f=l.pid,m=a.pesData,_=l.pesData,E=null,D=this.pmtParsed,O=this._pmtId,I=t.length;if(this.remainderData&&(t=ii(this.remainderData,t),I=t.length,this.remainderData=null),I<ae&&!s)return this.remainderData=t,{audioTrack:a,videoTrack:n,id3Track:l,textTrack:o};const x=Math.max(0,We.syncOffset(t));I-=(I-x)%ae,I<t.byteLength&&!s&&(this.remainderData=new Uint8Array(t.buffer,I,t.buffer.byteLength-I));let P=0;for(let b=x;b<I;b+=ae)if(t[b]===71){const S=!!(t[b+1]&64),L=Dr(t,b),A=(t[b+3]&48)>>4;let U;if(A>1){if(U=b+5+t[b+4],U===b+ae)continue}else U=b+4;switch(L){case c:S&&(u&&(r=ni(u))&&this.parseAVCPES(n,o,r,!1),u={data:[],size:0}),u&&(u.data.push(t.subarray(U,b+ae)),u.size+=b+ae-U);break;case h:if(S){if(m&&(r=ni(m)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,r);break;case"mp3":this.parseMPEGPES(a,r);break}m={data:[],size:0}}m&&(m.data.push(t.subarray(U,b+ae)),m.size+=b+ae-U);break;case f:S&&(_&&(r=ni(_))&&this.parseID3PES(l,r),_={data:[],size:0}),_&&(_.data.push(t.subarray(U,b+ae)),_.size+=b+ae-U);break;case 0:S&&(U+=t[U]+1),O=this._pmtId=Xl(t,U);break;case O:{S&&(U+=t[U]+1);const B=Zl(t,U,this.typeSupported,i);c=B.avc,c>0&&(n.pid=c),h=B.audio,h>0&&(a.pid=h,a.segmentCodec=B.segmentCodec),f=B.id3,f>0&&(l.pid=f),E!==null&&!D&&($.warn(`MPEG-TS PMT found at ${b} after unknown PID '${E}'. Backtracking to sync byte @${x} to parse all TS packets.`),E=null,b=x-188),D=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=L;break}}else P++;if(P>0){const b=new Error(`Found ${P} TS packet/s that do not start with 0x47`);this.observer.emit(w.ERROR,w.ERROR,{type:Et.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!1,error:b,reason:b.message})}n.pesData=u,a.pesData=m,l.pesData=_;const C={audioTrack:a,videoTrack:n,id3Track:l,textTrack:o};return s&&this.extractRemainingSamples(C),C}flush(){const{remainderData:t}=this;this.remainderData=null;let e;return t?e=this.demux(t,-1,!1,!0):e={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:i,id3Track:s,textTrack:r}=t,n=i.pesData,a=e.pesData,l=s.pesData;let o;if(n&&(o=ni(n))?(this.parseAVCPES(i,r,o,!0),i.pesData=null):i.pesData=n,a&&(o=ni(a))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,o);break;case"mp3":this.parseMPEGPES(e,o);break}e.pesData=null}else a!=null&&a.size&&$.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=a;l&&(o=ni(l))?(this.parseID3PES(s,o),s.pesData=null):s.pesData=l}demuxSampleAes(t,e,i){const s=this.demux(t,i,!0,!this.config.progressive),r=this.sampleAes=new Ql(this.observer,this.config,e);return this.decrypt(s,r)}decrypt(t,e){return new Promise(i=>{const{audioTrack:s,videoTrack:r}=t;s.samples&&s.segmentCodec==="aac"?e.decryptAacSamples(s.samples,0,()=>{r.samples?e.decryptAvcSamples(r.samples,0,0,()=>{i(t)}):i(t)}):r.samples&&e.decryptAvcSamples(r.samples,0,0,()=>{i(t)})})}destroy(){this._duration=0}parseAVCPES(t,e,i,s){const r=this.parseAVCNALu(t,i.data);let n=this.avcSample,a,l=!1;i.data=null,n&&r.length&&!t.audFound&&(lr(n,t),n=this.avcSample=Ri(!1,i.pts,i.dts,"")),r.forEach(o=>{switch(o.type){case 1:{a=!0,n||(n=this.avcSample=Ri(!0,i.pts,i.dts,"")),n.frame=!0;const c=o.data;if(l&&c.length>4){const u=new Fs(c).readSliceType();(u===2||u===4||u===7||u===9)&&(n.key=!0)}break}case 5:a=!0,n||(n=this.avcSample=Ri(!0,i.pts,i.dts,"")),n.key=!0,n.frame=!0;break;case 6:{a=!0,Sn(o.data,1,i.pts,e.samples);break}case 7:if(a=!0,l=!0,!t.sps){const c=o.data,h=new Fs(c).readSPS();t.width=h.width,t.height=h.height,t.pixelRatio=h.pixelRatio,t.sps=[c],t.duration=this._duration;const f=c.subarray(1,4);let m="avc1.";for(let _=0;_<3;_++){let E=f[_].toString(16);E.length<2&&(E="0"+E),m+=E}t.codec=m}break;case 8:a=!0,t.pps||(t.pps=[o.data]);break;case 9:a=!1,t.audFound=!0,n&&lr(n,t),n=this.avcSample=Ri(!1,i.pts,i.dts,"");break;case 12:a=!0;break;default:a=!1,n&&(n.debug+="unknown NAL "+o.type+" ");break}n&&a&&n.units.push(o)}),s&&n&&(lr(n,t),this.avcSample=null)}getLastNalUnit(t){var e;let i=this.avcSample,s;if((!i||i.units.length===0)&&(i=t[t.length-1]),(e=i)!=null&&e.units){const r=i.units;s=r[r.length-1]}return s}parseAVCNALu(t,e){const i=e.byteLength;let s=t.naluState||0;const r=s,n=[];let a=0,l,o,c,u=-1,h=0;for(s===-1&&(u=0,h=e[0]&31,s=0,a=1);a<i;){if(l=e[a++],!s){s=l?0:1;continue}if(s===1){s=l?0:2;continue}if(!l)s=3;else if(l===1){if(u>=0){const f={data:e.subarray(u,a-s-1),type:h};n.push(f)}else{const f=this.getLastNalUnit(t.samples);if(f&&(r&&a<=4-r&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-r)),o=a-s-1,o>0)){const m=new Uint8Array(f.data.byteLength+o);m.set(f.data,0),m.set(e.subarray(0,o),f.data.byteLength),f.data=m,f.state=0}}a<i?(c=e[a]&31,u=a,h=c,s=0):s=-1}else s=0}if(u>=0&&s>=0){const f={data:e.subarray(u,i),type:h,state:s};n.push(f)}if(n.length===0){const f=this.getLastNalUnit(t.samples);if(f){const m=new Uint8Array(f.data.byteLength+e.byteLength);m.set(f.data,0),m.set(e,f.data.byteLength),f.data=m}}return t.naluState=s,n}parseAACPES(t,e){let i=0;const s=this.aacOverFlow;let r=e.data;if(s){this.aacOverFlow=null;const u=s.missing,h=s.sample.unit.byteLength;if(u===-1){const f=new Uint8Array(h+r.byteLength);f.set(s.sample.unit,0),f.set(r,h),r=f}else{const f=h-u;s.sample.unit.set(r.subarray(0,u),f),t.samples.push(s.sample),i=s.missing}}let n,a;for(n=i,a=r.length;n<a-1&&!ji(r,n);n++);if(n!==i){let u;const h=n<a-1;h?u=`AAC PES did not start with ADTS header,offset:${n}`:u="No ADTS header found in AAC PES";const f=new Error(u);if($.warn(`parsing error: ${u}`),this.observer.emit(w.ERROR,w.ERROR,{type:Et.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!1,levelRetry:h,error:f,reason:u}),!h)return}Fn(t,this.observer,r,n,this.audioCodec);let l;if(e.pts!==void 0)l=e.pts;else if(s){const u=Bn(t.samplerate);l=s.sample.pts+u}else{$.warn("[tsdemuxer]: AAC PES unknown PTS");return}let o=0,c;for(;n<a;)if(c=Un(t,r,n,l,o),n+=c.length,c.missing){this.aacOverFlow=c;break}else for(o++;n<a-1&&!ji(r,n);n++);}parseMPEGPES(t,e){const i=e.data,s=i.length;let r=0,n=0;const a=e.pts;if(a===void 0){$.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;n<s;)if(Vn(i,n)){const l=jn(t,i,n,a,r);if(l)n+=l.length,r++;else break}else n++}parseID3PES(t,e){if(e.pts===void 0){$.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Zt({},e,{type:this._avcTrack?be.emsg:be.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(i)}}function Ri(d,t,e,i){return{key:d,frame:!1,pts:t,dts:e,units:[],debug:i,length:0}}function Dr(d,t){return((d[t+1]&31)<<8)+d[t+2]}function Xl(d,t){return(d[t+10]&31)<<8|d[t+11]}function Zl(d,t,e,i){const s={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},r=(d[t+1]&15)<<8|d[t+2],n=t+3+r-4,a=(d[t+10]&15)<<8|d[t+11];for(t+=12+a;t<n;){const l=Dr(d,t);switch(d[t]){case 207:if(!i){$.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:s.audio===-1&&(s.audio=l);break;case 21:s.id3===-1&&(s.id3=l);break;case 219:if(!i){$.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:s.avc===-1&&(s.avc=l);break;case 3:case 4:e.mpeg!==!0&&e.mp3!==!0?$.log("MPEG audio found, not supported in this browser"):s.audio===-1&&(s.audio=l,s.segmentCodec="mp3");break;case 36:$.warn("Unsupported HEVC stream type found");break}t+=((d[t+3]&15)<<8|d[t+4])+5}return s}function ni(d){let t=0,e,i,s,r,n;const a=d.data;if(!d||d.size===0)return null;for(;a[0].length<19&&a.length>1;){const o=new Uint8Array(a[0].length+a[1].length);o.set(a[0]),o.set(a[1],a[0].length),a[0]=o,a.splice(1,1)}if(e=a[0],(e[0]<<16)+(e[1]<<8)+e[2]===1){if(i=(e[4]<<8)+e[5],i&&i>d.size-6)return null;const o=e[7];o&192&&(r=(e[9]&14)*536870912+(e[10]&255)*4194304+(e[11]&254)*16384+(e[12]&255)*128+(e[13]&254)/2,o&64?(n=(e[14]&14)*536870912+(e[15]&255)*4194304+(e[16]&254)*16384+(e[17]&255)*128+(e[18]&254)/2,r-n>60*9e4&&($.warn(`${Math.round((r-n)/9e4)}s delta between PTS and DTS, align them`),r=n)):n=r),s=e[8];let c=s+9;if(d.size<=c)return null;d.size-=c;const u=new Uint8Array(d.size);for(let h=0,f=a.length;h<f;h++){e=a[h];let m=e.byteLength;if(c)if(c>m){c-=m;continue}else e=e.subarray(c),m-=c,c=0;u.set(e,t),t+=m}return i&&(i-=s+3),{data:u,pts:r,dts:n,len:i}}return null}function lr(d,t){if(d.units.length&&d.frame){if(d.pts===void 0){const e=t.samples,i=e.length;if(i){const s=e[i-1];d.pts=s.pts,d.dts=s.dts}else{t.dropped++;return}}t.samples.push(d)}d.debug.length&&$.log(d.pts+"/"+d.dts+":"+d.debug)}class Jl extends Pn{resetInitSegment(t,e,i,s){super.resetInitSegment(t,e,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:s,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;let i=(Oi(t,0)||[]).length;for(let s=t.length;i<s;i++)if(ql(t,i))return $.log("MPEG Audio sync word found !"),!0;return!1}canParse(t,e){return Wl(t,e)}appendFrame(t,e,i){if(this.basePTS!==null)return jn(t,e,i,this.basePTS,this.frameIndex)}}class Bs{static getSilentFrame(t,e){switch(t){case"mp4a.40.2":if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Ke=Math.pow(2,32)-1;class W{static init(){W.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let t;for(t in W.types)W.types.hasOwnProperty(t)&&(W.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);W.HDLR_TYPES={video:e,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);W.STTS=W.STSC=W.STCO=r,W.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),W.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),W.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),W.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const n=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);W.FTYP=W.box(W.types.ftyp,n,l,n,a),W.DINF=W.box(W.types.dinf,W.box(W.types.dref,s))}static box(t,...e){let i=8,s=e.length;const r=s;for(;s--;)i+=e[s].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=i&255,n.set(t,4),s=0,i=8;s<r;s++)n.set(e[s],i),i+=e[s].byteLength;return n}static hdlr(t){return W.box(W.types.hdlr,W.HDLR_TYPES[t])}static mdat(t){return W.box(W.types.mdat,t)}static mdhd(t,e){e*=t;const i=Math.floor(e/(Ke+1)),s=Math.floor(e%(Ke+1));return W.box(W.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(t){return W.box(W.types.mdia,W.mdhd(t.timescale,t.duration),W.hdlr(t.type),W.minf(t))}static mfhd(t){return W.box(W.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}static minf(t){return t.type==="audio"?W.box(W.types.minf,W.box(W.types.smhd,W.SMHD),W.DINF,W.stbl(t)):W.box(W.types.minf,W.box(W.types.vmhd,W.VMHD),W.DINF,W.stbl(t))}static moof(t,e,i){return W.box(W.types.moof,W.mfhd(t),W.traf(i,e))}static moov(t){let e=t.length;const i=[];for(;e--;)i[e]=W.trak(t[e]);return W.box.apply(null,[W.types.moov,W.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(W.mvex(t)))}static mvex(t){let e=t.length;const i=[];for(;e--;)i[e]=W.trex(t[e]);return W.box.apply(null,[W.types.mvex,...i])}static mvhd(t,e){e*=t;const i=Math.floor(e/(Ke+1)),s=Math.floor(e%(Ke+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return W.box(W.types.mvhd,r)}static sdtp(t){const e=t.samples||[],i=new Uint8Array(4+e.length);let s,r;for(s=0;s<e.length;s++)r=e[s].flags,i[s+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return W.box(W.types.sdtp,i)}static stbl(t){return W.box(W.types.stbl,W.stsd(t),W.box(W.types.stts,W.STTS),W.box(W.types.stsc,W.STSC),W.box(W.types.stsz,W.STSZ),W.box(W.types.stco,W.STCO))}static avc1(t){let e=[],i=[],s,r,n;for(s=0;s<t.sps.length;s++)r=t.sps[s],n=r.byteLength,e.push(n>>>8&255),e.push(n&255),e=e.concat(Array.prototype.slice.call(r));for(s=0;s<t.pps.length;s++)r=t.pps[s],n=r.byteLength,i.push(n>>>8&255),i.push(n&255),i=i.concat(Array.prototype.slice.call(r));const a=W.box(W.types.avcC,new Uint8Array([1,e[3],e[4],e[5],255,224|t.sps.length].concat(e).concat([t.pps.length]).concat(i))),l=t.width,o=t.height,c=t.pixelRatio[0],u=t.pixelRatio[1];return W.box(W.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,o>>8&255,o&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,W.box(W.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),W.box(W.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,u>>24,u>>16&255,u>>8&255,u&255])))}static esds(t){const e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}static mp4a(t){const e=t.samplerate;return W.box(W.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,e&255,0,0]),W.box(W.types.esds,W.esds(t)))}static mp3(t){const e=t.samplerate;return W.box(W.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,e&255,0,0]))}static stsd(t){return t.type==="audio"?t.segmentCodec==="mp3"&&t.codec==="mp3"?W.box(W.types.stsd,W.STSD,W.mp3(t)):W.box(W.types.stsd,W.STSD,W.mp4a(t)):W.box(W.types.stsd,W.STSD,W.avc1(t))}static tkhd(t){const e=t.id,i=t.duration*t.timescale,s=t.width,r=t.height,n=Math.floor(i/(Ke+1)),a=Math.floor(i%(Ke+1));return W.box(W.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,r>>8&255,r&255,0,0]))}static traf(t,e){const i=W.sdtp(t),s=t.id,r=Math.floor(e/(Ke+1)),n=Math.floor(e%(Ke+1));return W.box(W.types.traf,W.box(W.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),W.box(W.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,n>>24,n>>16&255,n>>8&255,n&255])),W.trun(t,i.length+16+20+8+16+8+8),i)}static trak(t){return t.duration=t.duration||4294967295,W.box(W.types.trak,W.tkhd(t),W.mdia(t))}static trex(t){const e=t.id;return W.box(W.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){const i=t.samples||[],s=i.length,r=12+16*s,n=new Uint8Array(r);let a,l,o,c,u,h;for(e+=8+r,n.set([t.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255],0),a=0;a<s;a++)l=i[a],o=l.duration,c=l.size,u=l.flags,h=l.cts,n.set([o>>>24&255,o>>>16&255,o>>>8&255,o&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,u.degradPrio&240<<8,u.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*a);return W.box(W.types.trun,n)}static initSegment(t){W.types||W.init();const e=W.moov(t),i=new Uint8Array(W.FTYP.byteLength+e.byteLength);return i.set(W.FTYP),i.set(e,W.FTYP.byteLength),i}}W.types=void 0;W.HDLR_TYPES=void 0;W.STTS=void 0;W.STSC=void 0;W.STCO=void 0;W.STSZ=void 0;W.VMHD=void 0;W.SMHD=void 0;W.STSD=void 0;W.FTYP=void 0;W.DINF=void 0;const $n=9e4;function zr(d,t,e=1,i=!1){const s=d*t*e;return i?Math.round(s):s}function tc(d,t,e=1,i=!1){return zr(d,t,1/e,i)}function hi(d,t=!1){return zr(d,1e3,1/$n,t)}function ec(d,t=1){return zr(d,$n,1/t)}const ic=10*1e3,Us=1024,rc=1152;let Di=null,cr=null;class dr{constructor(t,e,i,s=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=i,this.ISGenerated=!1,Di===null){const n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Di=n?parseInt(n[1]):0}if(cr===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);cr=r?parseInt(r[1]):0}}destroy(){}resetTimeStamp(t){$.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t}resetNextTimestamp(){$.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){$.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(t){let e=!1;const i=t.reduce((s,r)=>{const n=r.pts-s;return n<-4294967296?(e=!0,ge(s,r.pts)):n>0?s:r.pts},t[0].pts);return e&&$.debug("PTS rollover detected"),i}remux(t,e,i,s,r,n,a,l){let o,c,u,h,f,m,_=r,E=r;const D=t.pid>-1,O=e.pid>-1,I=e.samples.length,x=t.samples.length>0,P=a&&I>0||I>1;if((!D||x)&&(!O||P)||this.ISGenerated||a){this.ISGenerated||(u=this.generateIS(t,e,r,n));const b=this.isVideoContiguous;let S=-1,L;if(P&&(S=sc(e.samples),!b&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,S>0){$.warn(`[mp4-remuxer]: Dropped ${S} out of ${I} video samples due to a missing keyframe`);const A=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(S),e.dropped+=S,E+=(e.samples[0].pts-A)/e.inputTimeScale,L=E}else S===-1&&($.warn(`[mp4-remuxer]: No keyframe found out of ${I} video samples`),m=!1);if(this.ISGenerated){if(x&&P){const A=this.getVideoStartPts(e.samples),B=(ge(t.samples[0].pts,A)-A)/e.inputTimeScale;_+=Math.max(0,B),E+=Math.max(0,-B)}if(x){if(t.samplerate||($.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(t,e,r,n)),c=this.remuxAudio(t,_,this.isAudioContiguous,n,O||P||l===xt.AUDIO?E:void 0),P){const A=c?c.endPTS-c.startPTS:0;e.inputTimeScale||($.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(t,e,r,n)),o=this.remuxVideo(e,E,b,A)}}else P&&(o=this.remuxVideo(e,E,b,0));o&&(o.firstKeyFrame=S,o.independent=S!==-1,o.firstKeyFramePTS=L)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(f=zn(i,r,this._initPTS,this._initDTS)),s.samples.length&&(h=Hn(s,r,this._initPTS))),{audio:c,video:o,initSegment:u,independent:m,text:h,id3:f}}generateIS(t,e,i,s){const r=t.samples,n=e.samples,a=this.typeSupported,l={},o=this._initPTS;let c=!o||s,u="audio/mp4",h,f,m;if(c&&(h=f=1/0),t.config&&r.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":a.mpeg?(u="audio/mpeg",t.codec=""):a.mp3&&(t.codec="mp3");break}l.audio={id:"audio",container:u,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):W.initSegment([t]),metadata:{channelCount:t.channelCount}},c&&(m=t.inputTimeScale,!o||m!==o.timescale?h=f=r[0].pts-Math.round(m*i):c=!1)}if(e.sps&&e.pps&&n.length&&(e.timescale=e.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:W.initSegment([e]),metadata:{width:e.width,height:e.height}},c))if(m=e.inputTimeScale,!o||m!==o.timescale){const _=this.getVideoStartPts(n),E=Math.round(m*i);f=Math.min(f,ge(n[0].dts,_)-E),h=Math.min(h,_-E)}else c=!1;if(Object.keys(l).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:h,timescale:m},this._initDTS={baseTime:f,timescale:m}):h=m=void 0,{tracks:l,initPTS:h,timescale:m}}remuxVideo(t,e,i,s){const r=t.inputTimeScale,n=t.samples,a=[],l=n.length,o=this._initPTS;let c=this.nextAvcDts,u=8,h=this.videoSampleDuration,f,m,_=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,D=!1;if(!i||c===null){const R=e*r,N=n[0].pts-ge(n[0].dts,n[0].pts);c=R-N}const O=o.baseTime*r/o.timescale;for(let R=0;R<l;R++){const N=n[R];N.pts=ge(N.pts-O,c),N.dts=ge(N.dts-O,c),N.dts<n[R>0?R-1:R].dts&&(D=!0)}D&&n.sort(function(R,N){const j=R.dts-N.dts,X=R.pts-N.pts;return j||X}),f=n[0].dts,m=n[n.length-1].dts;const I=m-f,x=I?Math.round(I/(l-1)):h||t.inputTimeScale/30;if(i){const R=f-c,N=R>x,j=R<-1;if((N||j)&&(N?$.warn(`AVC: ${hi(R,!0)} ms (${R}dts) hole between fragments detected, filling it`):$.warn(`AVC: ${hi(-R,!0)} ms (${R}dts) overlapping between fragments detected`),!j||c>=n[0].pts)){f=c;const X=n[0].pts-R;n[0].dts=f,n[0].pts=X,$.log(`Video: First PTS/DTS adjusted: ${hi(X,!0)}/${hi(f,!0)}, delta: ${hi(R,!0)} ms`)}}f=Math.max(0,f);let P=0,C=0;for(let R=0;R<l;R++){const N=n[R],j=N.units,X=j.length;let rt=0;for(let lt=0;lt<X;lt++)rt+=j[lt].data.length;C+=rt,P+=X,N.length=rt,N.dts=Math.max(N.dts,f),_=Math.min(N.pts,_),E=Math.max(N.pts,E)}m=n[l-1].dts;const b=C+4*P+8;let S;try{S=new Uint8Array(b)}catch(R){this.observer.emit(w.ERROR,w.ERROR,{type:Et.MUX_ERROR,details:J.REMUX_ALLOC_ERROR,fatal:!1,error:R,bytes:b,reason:`fail allocating video mdat ${b}`});return}const L=new DataView(S.buffer);L.setUint32(0,b),S.set(W.types.mdat,4);let A=!1,U=Number.POSITIVE_INFINITY,B=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY,Q=Number.NEGATIVE_INFINITY;for(let R=0;R<l;R++){const N=n[R],j=N.units;let X=0;for(let Tt=0,wt=j.length;Tt<wt;Tt++){const Rt=j[Tt],tt=Rt.data,at=Rt.data.byteLength;L.setUint32(u,at),u+=4,S.set(tt,u),u+=at,X+=4+at}let rt;if(R<l-1)h=n[R+1].dts-N.dts,rt=n[R+1].pts-N.pts;else{const Tt=this.config,wt=R>0?N.dts-n[R-1].dts:x;if(rt=R>0?N.pts-n[R-1].pts:x,Tt.stretchShortVideoTrack&&this.nextAudioPts!==null){const Rt=Math.floor(Tt.maxBufferHole*r),tt=(s?_+s*r:this.nextAudioPts)-N.pts;tt>Rt?(h=tt-wt,h<0?h=wt:A=!0,$.log(`[mp4-remuxer]: It is approximately ${tt/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=wt}else h=wt}const lt=Math.round(N.pts-N.dts);U=Math.min(U,h),G=Math.max(G,h),B=Math.min(B,rt),Q=Math.max(Q,rt),a.push(new js(N.key,h,X,lt))}if(a.length){if(Di){if(Di<70){const R=a[0].flags;R.dependsOn=2,R.isNonSync=0}}else if(cr&&Q-B<G-U&&x/G<.025&&a[0].cts===0){$.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let R=f;for(let N=0,j=a.length;N<j;N++){const X=R+a[N].duration,rt=R+a[N].cts;if(N<j-1){const lt=X+a[N+1].cts;a[N].duration=lt-rt}else a[N].duration=N?a[N-1].duration:x;a[N].cts=0,R=X}}}h=A||!h?x:h,this.nextAvcDts=c=m+h,this.videoSampleDuration=h,this.isVideoContiguous=!0;const nt=W.moof(t.sequenceNumber++,f,Zt({},t,{samples:a})),ot="video",V={data1:nt,data2:S,startPTS:_/r,endPTS:(E+h)/r,startDTS:f/r,endDTS:c/r,type:ot,hasAudio:!1,hasVideo:!0,nb:a.length,dropped:t.dropped};return t.samples=[],t.dropped=0,V}remuxAudio(t,e,i,s,r){const n=t.inputTimeScale,a=t.samplerate?t.samplerate:n,l=n/a,o=t.segmentCodec==="aac"?Us:rc,c=o*l,u=this._initPTS,h=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],m=r!==void 0;let _=t.samples,E=h?0:8,D=this.nextAudioPts||-1;const O=e*n,I=u.baseTime*n/u.timescale;if(this.isAudioContiguous=i=i||_.length&&D>0&&(s&&Math.abs(O-D)<9e3||Math.abs(ge(_[0].pts-I,O)-D)<20*c),_.forEach(function(ot){ot.pts=ge(ot.pts-I,O)}),!i||D<0){if(_=_.filter(ot=>ot.pts>=0),!_.length)return;r===0?D=0:s&&!m?D=Math.max(0,O):D=_[0].pts}if(t.segmentCodec==="aac"){const ot=this.config.maxAudioFramesDrift;for(let V=0,R=D;V<_.length;V++){const N=_[V],j=N.pts,X=j-R,rt=Math.abs(1e3*X/n);if(X<=-ot*c&&m)V===0&&($.warn(`Audio frame @ ${(j/n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*X/n)} ms.`),this.nextAudioPts=D=R=j);else if(X>=ot*c&&rt<ic&&m){let lt=Math.round(X/c);R=j-lt*c,R<0&&(lt--,R+=c),V===0&&(this.nextAudioPts=D=R),$.warn(`[mp4-remuxer]: Injecting ${lt} audio frame @ ${(R/n).toFixed(3)}s due to ${Math.round(1e3*X/n)} ms gap.`);for(let Tt=0;Tt<lt;Tt++){const wt=Math.max(R,0);let Rt=Bs.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);Rt||($.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Rt=N.unit.subarray()),_.splice(V,0,{unit:Rt,pts:wt}),R+=c,V++}}N.pts=R,R+=c}}let x=null,P=null,C,b=0,S=_.length;for(;S--;)b+=_[S].unit.byteLength;for(let ot=0,V=_.length;ot<V;ot++){const R=_[ot],N=R.unit;let j=R.pts;if(P!==null){const rt=f[ot-1];rt.duration=Math.round((j-P)/l)}else if(i&&t.segmentCodec==="aac"&&(j=D),x=j,b>0){b+=E;try{C=new Uint8Array(b)}catch(rt){this.observer.emit(w.ERROR,w.ERROR,{type:Et.MUX_ERROR,details:J.REMUX_ALLOC_ERROR,fatal:!1,error:rt,bytes:b,reason:`fail allocating audio mdat ${b}`});return}h||(new DataView(C.buffer).setUint32(0,b),C.set(W.types.mdat,4))}else return;C.set(N,E);const X=N.byteLength;E+=X,f.push(new js(!0,o,X,0)),P=j}const L=f.length;if(!L)return;const A=f[f.length-1];this.nextAudioPts=D=P+l*A.duration;const U=h?new Uint8Array(0):W.moof(t.sequenceNumber++,x/l,Zt({},t,{samples:f}));t.samples=[];const B=x/n,G=D/n,nt={data1:U,data2:C,startPTS:B,endPTS:G,startDTS:B,endDTS:G,type:"audio",hasAudio:!0,hasVideo:!1,nb:L};return this.isAudioContiguous=!0,nt}remuxEmptyAudio(t,e,i,s){const r=t.inputTimeScale,n=t.samplerate?t.samplerate:r,a=r/n,l=this.nextAudioPts,o=this._initDTS,c=o.baseTime*9e4/o.timescale,u=(l!==null?l:s.startDTS*r)+c,h=s.endDTS*r+c,f=a*Us,m=Math.ceil((h-u)/f),_=Bs.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if($.warn("[mp4-remuxer]: remux empty Audio"),!_){$.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const E=[];for(let D=0;D<m;D++){const O=u+D*f;E.push({unit:_,pts:O,dts:O})}return t.samples=E,this.remuxAudio(t,e,i,!1)}}function ge(d,t){let e;if(t===null)return d;for(t<d?e=-8589934592:e=8589934592;Math.abs(d-t)>4294967296;)d+=e;return d}function sc(d){for(let t=0;t<d.length;t++)if(d[t].key)return t;return-1}function zn(d,t,e,i){const s=d.samples.length;if(!s)return;const r=d.inputTimeScale;for(let a=0;a<s;a++){const l=d.samples[a];l.pts=ge(l.pts-e.baseTime*r/e.timescale,t*r)/r,l.dts=ge(l.dts-i.baseTime*r/i.timescale,t*r)/r}const n=d.samples;return d.samples=[],{samples:n}}function Hn(d,t,e){const i=d.samples.length;if(!i)return;const s=d.inputTimeScale;for(let n=0;n<i;n++){const a=d.samples[n];a.pts=ge(a.pts-e.baseTime*9e4/e.timescale,t*s)/s}d.samples.sort((n,a)=>n.pts-a.pts);const r=d.samples;return d.samples=[],{samples:r}}class js{constructor(t,e,i,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=i,this.cts=s,this.flags=new nc(t)}}class nc{constructor(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}}class ac{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(t){this.initPTS=t,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(t,e,i,s){this.audioCodec=e,this.videoCodec=i,this.generateInitSegment(Lo(t,s)),this.emitInitSegment=!0}generateInitSegment(t){let{audioCodec:e,videoCodec:i}=this;if(!(t!=null&&t.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const s=this.initData=En(t);e||(e=Gs(s.audio,Ft.AUDIO)),i||(i=Gs(s.video,Ft.VIDEO));const r={};s.audio&&s.video?r.audiovideo={container:"video/mp4",codec:e+","+i,initSegment:t,id:"main"}:s.audio?r.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:s.video?r.video={container:"video/mp4",codec:i,initSegment:t,id:"main"}:$.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r}remux(t,e,i,s,r,n){var a,l;let{initPTS:o,lastEndTime:c}=this;const u={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};_t(c)||(c=this.lastEndTime=r||0);const h=e.samples;if(!(h!=null&&h.length))return u;const f={initPTS:void 0,timescale:1};let m=this.initData;if((a=m)!=null&&a.length||(this.generateInitSegment(h),m=this.initData),!((l=m)!=null&&l.length))return $.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),u;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const _=wo(h,m),E=Io(m,h),D=E===null?r:E;(oc(o,D,r,_)||f.timescale!==o.timescale&&n)&&(f.initPTS=D-r,o&&o.timescale===1&&$.warn(`Adjusting initPTS by ${f.initPTS-o.baseTime}`),this.initPTS=o={baseTime:f.initPTS,timescale:1});const O=t?D-o.baseTime/o.timescale:c,I=O+_;Do(m,h,o.baseTime/o.timescale),_>0?this.lastEndTime=I:($.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const x=!!m.audio,P=!!m.video;let C="";x&&(C+="audio"),P&&(C+="video");const b={data1:h,startPTS:O,startDTS:O,endPTS:I,endDTS:I,type:C,hasAudio:x,hasVideo:P,nb:1,dropped:0};return u.audio=b.type==="audio"?b:void 0,u.video=b.type!=="audio"?b:void 0,u.initSegment=f,u.id3=zn(i,r,o,o),s.samples.length&&(u.text=Hn(s,r,o)),u}}function oc(d,t,e,i){if(d===null)return!0;const s=Math.max(i,1),r=t-d.baseTime/d.timescale;return Math.abs(r-e)>s}function Gs(d,t){const e=d==null?void 0:d.codec;return e&&e.length>4?e:e==="hvc1"||e==="hev1"?"hvc1.1.6.L120.90":e==="av01"?"av01.0.04M.08":e==="avc1"||t===Ft.VIDEO?"avc1.42e01e":"mp4a.40.5"}let Ve;try{Ve=self.performance.now.bind(self.performance)}catch(d){$.debug("Unable to use Performance API on this environment"),Ve=typeof self!="undefined"&&self.Date.now}const ur=[{demux:$l,remux:ac},{demux:We,remux:dr},{demux:Gl,remux:dr},{demux:Jl,remux:dr}];class Vs{constructor(t,e,i,s,r){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=i,this.vendor=s,this.id=r}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(t,e,i,s){const r=i.transmuxing;r.executeStart=Ve();let n=new Uint8Array(t);const{currentTransmuxState:a,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:o,discontinuity:c,trackSwitch:u,accurateTimeOffset:h,timeOffset:f,initSegmentChange:m}=s||a,{audioCodec:_,videoCodec:E,defaultInitPts:D,duration:O,initSegmentData:I}=l,x=lc(n,e);if(x&&x.method==="AES-128"){const S=this.getDecrypter();if(S.isSync()){let L=S.softwareDecrypt(n,x.key.buffer,x.iv.buffer);if(i.part>-1&&(L=S.flush()),!L)return r.executeEnd=Ve(),hr(i);n=new Uint8Array(L)}else return this.decryptionPromise=S.webCryptoDecrypt(n,x.key.buffer,x.iv.buffer).then(L=>{const A=this.push(L,null,i);return this.decryptionPromise=null,A}),this.decryptionPromise}const P=this.needsProbing(c,u);if(P){const S=this.configureTransmuxer(n);if(S)return $.warn(`[transmuxer] ${S.message}`),this.observer.emit(w.ERROR,w.ERROR,{type:Et.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!1,error:S,reason:S.message}),r.executeEnd=Ve(),hr(i)}(c||u||m||P)&&this.resetInitSegment(I,_,E,O,e),(c||m||P)&&this.resetInitialTimestamp(D),o||this.resetContiguity();const C=this.transmux(n,x,f,h,i),b=this.currentTransmuxState;return b.contiguous=!0,b.discontinuity=!1,b.trackSwitch=!1,r.executeEnd=Ve(),C}flush(t){const e=t.transmuxing;e.executeStart=Ve();const{decrypter:i,currentTransmuxState:s,decryptionPromise:r}=this;if(r)return r.then(()=>this.flush(t));const n=[],{timeOffset:a}=s;if(i){const u=i.flush();u&&n.push(this.push(u,null,t))}const{demuxer:l,remuxer:o}=this;if(!l||!o)return e.executeEnd=Ve(),[hr(t)];const c=l.flush(a);return Pi(c)?c.then(u=>(this.flushRemux(n,u,t),n)):(this.flushRemux(n,c,t),n)}flushRemux(t,e,i){const{audioTrack:s,videoTrack:r,id3Track:n,textTrack:a}=e,{accurateTimeOffset:l,timeOffset:o}=this.currentTransmuxState;$.log(`[transmuxer.ts]: Flushed fragment ${i.sn}${i.part>-1?" p: "+i.part:""} of level ${i.level}`);const c=this.remuxer.remux(s,r,n,a,o,l,!0,this.id);t.push({remuxResult:c,chunkMeta:i}),i.transmuxing.executeEnd=Ve()}resetInitialTimestamp(t){const{demuxer:e,remuxer:i}=this;!e||!i||(e.resetTimeStamp(t),i.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;!t||!e||(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,i,s,r){const{demuxer:n,remuxer:a}=this;!n||!a||(n.resetInitSegment(t,e,i,s),a.resetInitSegment(t,e,i,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(t,e,i,s,r){let n;return e&&e.method==="SAMPLE-AES"?n=this.transmuxSampleAes(t,e,i,s,r):n=this.transmuxUnencrypted(t,i,s,r),n}transmuxUnencrypted(t,e,i,s){const{audioTrack:r,videoTrack:n,id3Track:a,textTrack:l}=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,n,a,l,e,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(t,e,i,s,r){return this.demuxer.demuxSampleAes(t,e,i).then(n=>({remuxResult:this.remuxer.remux(n.audioTrack,n.videoTrack,n.id3Track,n.textTrack,i,s,!1,this.id),chunkMeta:r}))}configureTransmuxer(t){const{config:e,observer:i,typeSupported:s,vendor:r}=this;let n;for(let u=0,h=ur.length;u<h;u++)if(ur[u].demux.probe(t)){n=ur[u];break}if(!n)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,o=n.remux,c=n.demux;(!l||!(l instanceof o))&&(this.remuxer=new o(i,e,s,r)),(!a||!(a instanceof c))&&(this.demuxer=new c(i,e,s),this.probe=c.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new jr(this.config)),t}}function lc(d,t){let e=null;return d.byteLength>0&&t!=null&&t.key!=null&&t.iv!==null&&t.method!=null&&(e=t),e}const hr=d=>({remuxResult:{},chunkMeta:d});function Pi(d){return"then"in d&&d.then instanceof Function}class cc{constructor(t,e,i,s,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=i,this.duration=s,this.defaultInitPts=r||null}}class dc{constructor(t,e,i,s,r,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=r,this.initSegmentChange=n}}var Yn={exports:{}};(function(d){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function s(l,o,c){this.fn=l,this.context=o,this.once=c||!1}function r(l,o,c,u,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new s(c,u||l,h),m=e?e+o:o;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],f]:l._events[m].push(f):(l._events[m]=f,l._eventsCount++),l}function n(l,o){--l._eventsCount===0?l._events=new i:delete l._events[o]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var o=[],c,u;if(this._eventsCount===0)return o;for(u in c=this._events)t.call(c,u)&&o.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(c)):o},a.prototype.listeners=function(o){var c=e?e+o:o,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var h=0,f=u.length,m=new Array(f);h<f;h++)m[h]=u[h].fn;return m},a.prototype.listenerCount=function(o){var c=e?e+o:o,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(o,c,u,h,f,m){var _=e?e+o:o;if(!this._events[_])return!1;var E=this._events[_],D=arguments.length,O,I;if(E.fn){switch(E.once&&this.removeListener(o,E.fn,void 0,!0),D){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,c),!0;case 3:return E.fn.call(E.context,c,u),!0;case 4:return E.fn.call(E.context,c,u,h),!0;case 5:return E.fn.call(E.context,c,u,h,f),!0;case 6:return E.fn.call(E.context,c,u,h,f,m),!0}for(I=1,O=new Array(D-1);I<D;I++)O[I-1]=arguments[I];E.fn.apply(E.context,O)}else{var x=E.length,P;for(I=0;I<x;I++)switch(E[I].once&&this.removeListener(o,E[I].fn,void 0,!0),D){case 1:E[I].fn.call(E[I].context);break;case 2:E[I].fn.call(E[I].context,c);break;case 3:E[I].fn.call(E[I].context,c,u);break;case 4:E[I].fn.call(E[I].context,c,u,h);break;default:if(!O)for(P=1,O=new Array(D-1);P<D;P++)O[P-1]=arguments[P];E[I].fn.apply(E[I].context,O)}}return!0},a.prototype.on=function(o,c,u){return r(this,o,c,u,!1)},a.prototype.once=function(o,c,u){return r(this,o,c,u,!0)},a.prototype.removeListener=function(o,c,u,h){var f=e?e+o:o;if(!this._events[f])return this;if(!c)return n(this,f),this;var m=this._events[f];if(m.fn)m.fn===c&&(!h||m.once)&&(!u||m.context===u)&&n(this,f);else{for(var _=0,E=[],D=m.length;_<D;_++)(m[_].fn!==c||h&&!m[_].once||u&&m[_].context!==u)&&E.push(m[_]);E.length?this._events[f]=E.length===1?E[0]:E:n(this,f)}return this},a.prototype.removeAllListeners=function(o){var c;return o?(c=e?e+o:o,this._events[c]&&n(this,c)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,d.exports=a})(Yn);var uc=Yn.exports,Hr=qa(uc);const fr=$i()||{isTypeSupported:()=>!1};class Kn{constructor(t,e,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const r=t.config;this.hls=t,this.id=e,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;const n=(o,c)=>{c=c||{},c.frag=this.frag,c.id=this.id,o===w.ERROR&&(this.error=c.error),this.hls.trigger(o,c)};this.observer=new Hr,this.observer.on(w.FRAG_DECRYPTED,n),this.observer.on(w.ERROR,n);const a={mp4:fr.isTypeSupported("video/mp4"),mpeg:fr.isTypeSupported("audio/mpeg"),mp3:fr.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"&&(r.workerPath||kl())){try{r.workerPath?($.log(`loading Web Worker ${r.workerPath} for "${e}"`),this.workerContext=Pl(r.workerPath)):($.log(`injecting Web Worker for "${e}"`),this.workerContext=Ml()),this.onwmsg=u=>this.onWorkerMessage(u);const{worker:c}=this.workerContext;c.addEventListener("message",this.onwmsg),c.onerror=u=>{const h=new Error(`${u.message}  (${u.filename}:${u.lineno})`);r.enableWorker=!1,$.warn(`Error in "${e}" Web Worker, fallback to inline`),this.hls.trigger(w.ERROR,{type:Et.OTHER_ERROR,details:J.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:h})},c.postMessage({cmd:"init",typeSupported:a,vendor:l,id:e,config:JSON.stringify(r)})}catch(c){$.warn(`Error setting up "${e}" Web Worker, fallback to inline`,c),this.resetWorker(),this.error=null,this.transmuxer=new Vs(this.observer,a,r,l,e)}return}this.transmuxer=new Vs(this.observer,a,r,l,e)}resetWorker(){if(this.workerContext){const{worker:t,objectURL:e}=this.workerContext;e&&self.URL.revokeObjectURL(e),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(t,e,i,s,r,n,a,l,o,c){var u,h;o.transmuxing.start=self.performance.now();const{transmuxer:f}=this,m=n?n.start:r.start,_=r.decryptdata,E=this.frag,D=!(E&&r.cc===E.cc),O=!(E&&o.level===E.level),I=E?o.sn-E.sn:-1,x=this.part?o.part-this.part.index:-1,P=I===0&&o.id>1&&o.id===(E==null?void 0:E.stats.chunkCount),C=!O&&(I===1||I===0&&(x===1||P&&x<=0)),b=self.performance.now();(O||I||r.stats.parsing.start===0)&&(r.stats.parsing.start=b),n&&(x||!C)&&(n.stats.parsing.start=b);const S=!(E&&((u=r.initSegment)==null?void 0:u.url)===((h=E.initSegment)==null?void 0:h.url)),L=new dc(D,C,l,O,m,S);if(!C||D||S){$.log(`[transmuxer-interface, ${r.type}]: Starting new transmux session for sn: ${o.sn} p: ${o.part} level: ${o.level} id: ${o.id}
        discontinuity: ${D}
        trackSwitch: ${O}
        contiguous: ${C}
        accurateTimeOffset: ${l}
        timeOffset: ${m}
        initSegmentChange: ${S}`);const A=new cc(i,s,e,a,c);this.configureTransmuxer(A)}if(this.frag=r,this.part=n,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:t,decryptdata:_,chunkMeta:o,state:L},t instanceof ArrayBuffer?[t]:[]);else if(f){const A=f.push(t,_,o,L);Pi(A)?(f.async=!0,A.then(U=>{this.handleTransmuxComplete(U)}).catch(U=>{this.transmuxerError(U,o,"transmuxer-interface push error")})):(f.async=!1,this.handleTransmuxComplete(A))}}flush(t){t.transmuxing.start=self.performance.now();const{transmuxer:e}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:t});else if(e){let i=e.flush(t);Pi(i)||e.async?(Pi(i)||(i=Promise.resolve(i)),i.then(r=>{this.handleFlushResult(r,t)}).catch(r=>{this.transmuxerError(r,t,"transmuxer-interface flush error")})):this.handleFlushResult(i,t)}}transmuxerError(t,e,i){!this.hls||(this.error=t,this.hls.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,chunkMeta:e,fatal:!1,error:t,err:t,reason:i}))}handleFlushResult(t,e){t.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(e)}onWorkerMessage(t){const e=t.data,i=this.hls;switch(e.event){case"init":{var s;const r=(s=this.workerContext)==null?void 0:s.objectURL;r&&self.URL.revokeObjectURL(r);break}case"transmuxComplete":{this.handleTransmuxComplete(e.data);break}case"flush":{this.onFlush(e.data);break}case"workerLog":$[e.data.logType]&&$[e.data.logType](e.data.message);break;default:{e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data);break}}}configureTransmuxer(t){const{transmuxer:e}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:t}):e&&e.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}const hc=250,pr=2,fc=.1,pc=.05;class mc{constructor(t,e,i,s){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=i,this.hls=s}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(t,e){const{config:i,media:s,stalled:r}=this;if(s===null)return;const{currentTime:n,seeking:a}=s,l=this.seeking&&!a,o=!this.seeking&&a;if(this.seeking=a,n!==t){if(this.moved=!0,r!==null){if(this.stallReported){const D=self.performance.now()-r;$.warn(`playback not stuck anymore @${n}, after ${Math.round(D)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(o||l){this.stalled=null;return}if(s.paused&&!a||s.ended||s.playbackRate===0||!Ut.getBuffered(s).length)return;const c=Ut.bufferInfo(s,n,0),u=c.len>0,h=c.nextStart||0;if(!u&&!h)return;if(a){const D=c.len>pr,O=!h||e&&e.start<=n||h-n>pr&&!this.fragmentTracker.getPartialFragment(n);if(D||O)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var f;const D=Math.max(h,c.start||0)-n,O=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,x=(O==null||(f=O.details)==null?void 0:f.live)?O.details.targetduration*2:pr,P=this.fragmentTracker.getPartialFragment(n);if(D>0&&(D<=x||P)){this._trySkipBufferHole(P);return}}const m=self.performance.now();if(r===null){this.stalled=m;return}const _=m-r;if(!a&&_>=hc&&(this._reportStall(c),!this.media))return;const E=Ut.bufferInfo(s,n,i.maxBufferHole);this._tryFixBufferStall(E,_)}_tryFixBufferStall(t,e){const{config:i,fragmentTracker:s,media:r}=this;if(r===null)return;const n=r.currentTime,a=s.getPartialFragment(n);a&&(this._trySkipBufferHole(a)||!this.media)||(t.len>i.maxBufferHole||t.nextStart&&t.nextStart-n<i.maxBufferHole)&&e>i.highBufferWatchdogPeriod*1e3&&($.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(t){const{hls:e,media:i,stallReported:s}=this;if(!s&&i){this.stallReported=!0;const r=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(t)})`);$.warn(r.message),e.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:t.len})}}_trySkipBufferHole(t){const{config:e,hls:i,media:s}=this;if(s===null)return 0;const r=s.currentTime,n=Ut.bufferInfo(s,r,0),a=r<n.start?n.start:n.nextStart;if(a){const l=n.len<=e.maxBufferHole,o=n.len>0&&n.len<1&&s.readyState<3,c=a-r;if(c>0&&(l||o)){if(c>e.maxBufferHole){const{fragmentTracker:h}=this;let f=!1;if(r===0){const m=h.getAppendedFrag(0,xt.MAIN);m&&a<m.end&&(f=!0)}if(!f){const m=t||h.getAppendedFrag(r,xt.MAIN);if(m){let _=!1,E=m.end;for(;E<a;){const D=h.getPartialFragment(E);if(D)E+=D.duration;else{_=!0;break}}if(_)return 0}}}const u=Math.max(a+pc,r+fc);if($.warn(`skipping hole, adjusting currentTime from ${r} to ${u}`),this.moved=!0,this.stalled=null,s.currentTime=u,t&&!t.gap){const h=new Error(`fragment loaded with buffer holes, seeking from ${r} to ${u}`);i.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:t})}return u}}return 0}_tryNudgeBuffer(){const{config:t,hls:e,media:i,nudgeRetry:s}=this;if(i===null)return;const r=i.currentTime;if(this.nudgeRetry++,s<t.nudgeMaxRetry){const n=r+(s+1)*t.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${r} to ${n}`);$.warn(a.message),i.currentTime=n,e.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const n=new Error(`Playhead still not moving while enough data buffered @${r} after ${t.nudgeMaxRetry} nudges`);$.error(n.message),e.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.BUFFER_STALLED_ERROR,error:n,fatal:!0})}}}const gc=100;class yc extends Gr{constructor(t,e,i){super(t,e,i,"[stream-controller]",xt.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.MANIFEST_PARSED,this.onManifestParsed,this),t.on(w.LEVEL_LOADING,this.onLevelLoading,this),t.on(w.LEVEL_LOADED,this.onLevelLoaded,this),t.on(w.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(w.ERROR,this.onError,this),t.on(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(w.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(w.BUFFER_CREATED,this.onBufferCreated,this),t.on(w.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(w.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.MANIFEST_PARSED,this.onManifestParsed,this),t.off(w.LEVEL_LOADED,this.onLevelLoaded,this),t.off(w.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(w.ERROR,this.onError,this),t.off(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(w.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(w.BUFFER_CREATED,this.onBufferCreated,this),t.off(w.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(w.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(t){if(this.levels){const{lastCurrentTime:e,hls:i}=this;if(this.stopLoad(),this.setInterval(gc),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.nextAutoLevel),this.level=i.nextLoadLevel=s,this.loadedmetadata=!1}e>0&&t===-1&&(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),t=e),this.state=it.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=it.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case it.WAITING_LEVEL:{var t;const{levels:i,level:s}=this,r=i==null||(t=i[s])==null?void 0:t.details;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=it.IDLE;break}break}case it.FRAG_LOADING_WAITING_RETRY:{var e;const i=self.performance.now(),s=this.retryDate;(!s||i>=s||(e=this.media)!=null&&e.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=it.IDLE)}break}this.state===it.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:i,media:s}=this,{config:r,nextLoadLevel:n}=t;if(e===null||!s&&(this.startFragRequested||!r.startFragPrefetch)||this.altAudio&&this.audioOnly||!(i!=null&&i[n]))return;const a=i[n],l=this.getMainFwdBufferInfo();if(l===null)return;const o=this.getLevelDetails();if(o&&this._streamEnded(l,o)){const E={};this.altAudio&&(E.type="video"),this.hls.trigger(w.BUFFER_EOS,E),this.state=it.ENDED;return}t.loadLevel!==n&&t.manualLevel===-1&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=t.nextLoadLevel=n;const c=a.details;if(!c||this.state===it.WAITING_LEVEL||c.live&&this.levelLastLoaded!==n){this.level=n,this.state=it.WAITING_LEVEL;return}const u=l.len,h=this.getMaxBufferLength(a.maxBitrate);if(u>=h)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:l.end;let m=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&m&&m.sn!=="initSegment"&&this.fragmentTracker.getState(m)!==ie.OK){var _;const D=((_=this.backtrackFragment)!=null?_:m).sn-c.startSN,O=c.fragments[D-1];O&&m.cc===O.cc&&(m=O,this.fragmentTracker.removeFragment(O))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,f)){if(!m.gap){const D=this.audioOnly&&!this.altAudio?Ft.AUDIO:Ft.VIDEO,O=(D===Ft.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;O&&this.afterBufferFlushed(O,D,xt.MAIN)}m=this.getNextFragmentLoopLoading(m,c,l,xt.MAIN,h)}!m||(m.initSegment&&!m.initSegment.data&&!this.bitrateTest&&(m=m.initSegment),this.loadFragment(m,a,f))}loadFragment(t,e,i){const s=this.fragmentTracker.getState(t);this.fragCurrent=t,s===ie.NOT_LOADED||s===ie.PARTIAL?t.sn==="initSegment"?this._loadInitSegment(t,e):this.bitrateTest?(this.log(`Fragment ${t.sn} of level ${t.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(t,e)):(this.startFragRequested=!0,super.loadFragment(t,e,i)):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,xt.MAIN)}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(e!=null&&e.readyState){let i;const s=this.getAppendedFrag(e.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<r.targetduration*2)return}if(!e.paused&&t){const a=this.hls.nextLoadLevel,l=t[a],o=this.fragLastKbps;o&&this.fragCurrent?i=this.fragCurrent.duration*l.maxBitrate/(1e3*o)+1:i=0}else i=0;const n=this.getBufferedFrag(e.currentTime+i);if(n){const a=this.followingBufferedFrag(n);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,o=a.duration,c=Math.max(n.end,l+Math.min(Math.max(o-this.config.maxFragLookUpTolerance,o*.5),o*.75));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case it.KEY_LOADING:case it.FRAG_LOADING:case it.FRAG_LOADING_WAITING_RETRY:case it.PARSING:case it.PARSED:this.state=it.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,this.altAudio?"video":null)}onMediaAttached(t,e){super.onMediaAttached(t,e);const i=e.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new mc(this.config,i,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:t}=this;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const t=this.media,e=t?t.currentTime:null;_t(e)&&this.log(`Media seeked to ${e.toFixed(3)}`);const i=this.getMainFwdBufferInfo();if(i===null||i.len===0){this.warn(`Main forward buffer length on "seeked" event ${i?i.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(w.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(t,e){let i=!1,s=!1,r;e.levels.forEach(n=>{r=n.audioCodec,r&&(r.indexOf("mp4a.40.2")!==-1&&(i=!0),r.indexOf("mp4a.40.5")!==-1&&(s=!0))}),this.audioCodecSwitch=i&&s&&!Cl(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(t,e){const{levels:i}=this;if(!i||this.state!==it.IDLE)return;const s=i[e.level];(!s.details||s.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(s.details))&&(this.state=it.WAITING_LEVEL)}onLevelLoaded(t,e){var i;const{levels:s}=this,r=e.level,n=e.details,a=n.totalduration;if(!s){this.warn(`Levels were reset while loading level ${r}`);return}this.log(`Level ${r} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""}, cc [${n.startCC}, ${n.endCC}] duration:${a}`);const l=s[r],o=this.fragCurrent;o&&(this.state===it.FRAG_LOADING||this.state===it.FRAG_LOADING_WAITING_RETRY)&&(o.level!==e.level||o.urlId!==l.urlId)&&o.loader&&this.abortCurrentFrag();let c=0;if(n.live||(i=l.details)!=null&&i.live){if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed)return;c=this.alignPlaylists(n,l.details)}if(l.details=n,this.levelLastLoaded=r,this.hls.trigger(w.LEVEL_UPDATED,{details:n,level:r}),this.state===it.WAITING_LEVEL){if(this.waitForCdnTuneIn(n))return;this.state=it.IDLE}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,c),this.tick()}_handleFragmentLoadProgress(t){var e;const{frag:i,part:s,payload:r}=t,{levels:n}=this;if(!n){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const a=n[i.level],l=a.details;if(!l){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const o=a.videoCodec,c=l.PTSKnown||!l.live,u=(e=i.initSegment)==null?void 0:e.data,h=this._getAudioCodec(a),f=this.transmuxer=this.transmuxer||new Kn(this.hls,xt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=s?s.index:-1,_=m!==-1,E=new Br(i.level,i.sn,i.stats.chunkCount,r.byteLength,m,_),D=this.initPTS[i.cc];f.push(r,u,h,o,i,s,l.totalduration,c,E,D)}onAudioTrackSwitching(t,e){const i=this.altAudio;if(!!!e.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const n=this.fragCurrent;n&&(this.log("Switching to main audio track, cancel main fragment load"),n.abortRequests(),this.fragmentTracker.removeFragment(n)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const r=this.hls;i&&(r.trigger(w.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),r.trigger(w.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(t,e){const i=e.id,s=!!this.hls.audioTracks[i].url;if(s){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=s,this.tick()}onBufferCreated(t,e){const i=e.tracks;let s,r,n=!1;for(const a in i){const l=i[a];if(l.id==="main"){if(r=a,s=l,a==="video"){const o=i[a];o&&(this.videoBuffer=o.buffer)}}else n=!0}n&&s?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(t,e){const{frag:i,part:s}=e;if(i&&i.type!==xt.MAIN)return;if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===it.PARSED&&(this.state=it.IDLE);return}const r=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*r.total/(r.buffering.end-r.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}onError(t,e){var i;if(e.fatal){this.state=it.ERROR;return}switch(e.details){case J.FRAG_GAP:case J.FRAG_PARSING_ERROR:case J.FRAG_DECRYPT_ERROR:case J.FRAG_LOAD_ERROR:case J.FRAG_LOAD_TIMEOUT:case J.KEY_LOAD_ERROR:case J.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(xt.MAIN,e);break;case J.LEVEL_LOAD_ERROR:case J.LEVEL_LOAD_TIMEOUT:case J.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===it.WAITING_LEVEL&&((i=e.context)==null?void 0:i.type)===Pt.LEVEL&&(this.state=it.IDLE);break;case J.BUFFER_FULL_ERROR:if(!e.parent||e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case J.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}checkBuffer(){const{media:t,gapController:e}=this;if(!(!t||!e||!t.readyState)){if(this.loadedmetadata||!Ut.getBuffered(t).length){const i=this.state!==it.IDLE?this.fragCurrent:null;e.poll(this.lastCurrentTime,i)}this.lastCurrentTime=t.currentTime}}onFragLoadEmergencyAborted(){this.state=it.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(t,{type:e}){if(e!==Ft.AUDIO||this.audioOnly&&!this.altAudio){const i=(e===Ft.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,e,xt.MAIN)}}onLevelsUpdated(t,e){this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let i=this.startPosition;if(i>=0&&e<i){if(t.seeking){this.log(`could not seek to ${i}, already seeking at ${e}`);return}const s=Ut.getBuffered(t),n=(s.length?s.start(0):0)-i;n>0&&(n<this.config.maxBufferHole||n<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${n} to match buffer start`),i+=n,this.startPosition=i),this.log(`seek to target start position ${i} from current time ${e}`),t.currentTime=i}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e.indexOf("mp4a.40.5")!==-1?e="mp4a.40.2":e="mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then(i=>{const{hls:s}=this;if(!i||this.fragContextChanged(t))return;e.fragmentError=0,this.state=it.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const r=t.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),s.trigger(w.FRAG_LOADED,i),t.bitrateTest=!1})}_handleTransmuxComplete(t){var e;const i="main",{hls:s}=this,{remuxResult:r,chunkMeta:n}=t,a=this.getCurrentContext(n);if(!a){this.resetWhenMissingContext(n);return}const{frag:l,part:o,level:c}=a,{video:u,text:h,id3:f,initSegment:m}=r,{details:_}=c,E=this.altAudio?void 0:r.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=it.PARSING,m){if(m!=null&&m.tracks){const I=l.initSegment||l;this._bufferInitSegment(c,m.tracks,I,n),s.trigger(w.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:i,tracks:m.tracks})}const D=m.initPTS,O=m.timescale;_t(D)&&(this.initPTS[l.cc]={baseTime:D,timescale:O},s.trigger(w.INIT_PTS_FOUND,{frag:l,id:i,initPTS:D,timescale:O}))}if(u&&r.independent!==!1){if(_){const{startPTS:D,endPTS:O,startDTS:I,endDTS:x}=u;if(o)o.elementaryStreams[u.type]={startPTS:D,endPTS:O,startDTS:I,endDTS:x};else if(u.firstKeyFrame&&u.independent&&n.id===1&&(this.couldBacktrack=!0),u.dropped&&u.independent){const P=this.getMainFwdBufferInfo(),C=(P?P.end:this.getLoadPosition())+this.config.maxBufferHole,b=u.firstKeyFramePTS?u.firstKeyFramePTS:D;if(C<b-this.config.maxBufferHole){this.backtrack(l);return}l.setElementaryStreamInfo(u.type,l.start,O,l.start,x,!0)}l.setElementaryStreamInfo(u.type,D,O,I,x),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(u,l,o,n)}}else if(r.independent===!1){this.backtrack(l);return}if(E){const{startPTS:D,endPTS:O,startDTS:I,endDTS:x}=E;o&&(o.elementaryStreams[Ft.AUDIO]={startPTS:D,endPTS:O,startDTS:I,endDTS:x}),l.setElementaryStreamInfo(Ft.AUDIO,D,O,I,x),this.bufferFragmentData(E,l,o,n)}if(_&&f!=null&&(e=f.samples)!=null&&e.length){const D={id:i,frag:l,details:_,samples:f.samples};s.trigger(w.FRAG_PARSING_METADATA,D)}if(_&&h){const D={id:i,frag:l,details:_,samples:h.samples};s.trigger(w.FRAG_PARSING_USERDATA,D)}}_bufferInitSegment(t,e,i,s){if(this.state!==it.PARSING)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;const{audio:r,video:n,audiovideo:a}=e;if(r){let l=t.audioCodec;const o=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5"),r.metadata.channelCount!==1&&o.indexOf("firefox")===-1&&(l="mp4a.40.5")),o.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),t.audioCodec&&t.audioCodec!==l&&this.log(`Swapping manifest audio codec "${t.audioCodec}" for "${l}"`),r.levelCodec=l,r.id="main",this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${l||""}/${t.audioCodec||""}/${r.codec}]`)}n&&(n.levelCodec=t.videoCodec,n.id="main",this.log(`Init video buffer, container:${n.container}, codecs[level/parsed]=[${t.videoCodec||""}/${n.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${t.attrs.CODECS||""}/${a.codec}]`),this.hls.trigger(w.BUFFER_CODECS,e),Object.keys(e).forEach(l=>{const c=e[l].initSegment;c!=null&&c.byteLength&&this.hls.trigger(w.BUFFER_APPENDING,{type:l,data:c,frag:i,part:null,chunkMeta:s,parent:i.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,xt.MAIN)}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=it.IDLE}checkFragmentChanged(){const t=this.media;let e=null;if(t&&t.readyState>1&&t.seeking===!1){const i=t.currentTime;if(Ut.isBuffered(t,i)?e=this.getAppendedFrag(i):Ut.isBuffered(t,i+.1)&&(e=this.getAppendedFrag(i+.1)),e){this.backtrackFragment=null;const s=this.fragPlaying,r=e.level;(!s||e.sn!==s.sn||s.level!==r||e.urlId!==s.urlId)&&(this.fragPlaying=e,this.hls.trigger(w.FRAG_CHANGED,{frag:e}),(!s||s.level!==r)&&this.hls.trigger(w.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){const t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}get currentProgramDateTime(){const t=this.media;if(t){const e=t.currentTime,i=this.currentFrag;if(i&&_t(e)&&_t(i.programDateTime)){const s=i.programDateTime+(e-i.start)*1e3;return new Date(s)}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class ai{constructor(t,e=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=i}sample(t,e){const i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class _c{constructor(t,e,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ai(t),this.fast_=new ai(e),this.defaultTTFB_=s,this.ttfb_=new ai(t)}update(t,e){const{slow_:i,fast_:s,ttfb_:r}=this;i.halfLife!==t&&(this.slow_=new ai(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.fast_=new ai(e,s.getEstimate(),s.getTotalWeight())),r.halfLife!==t&&(this.ttfb_=new ai(t,r.getEstimate(),r.getTotalWeight()))}sample(t,e){t=Math.max(t,this.minDelayMs_);const i=8*e,s=t/1e3,r=i/s;this.fast_.sample(s,r),this.slow_.sample(s,r)}sampleTTFB(t){const e=t/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(i,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class vc{constructor(t){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;const e=t.config;this.bwEstimator=new _c(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(w.FRAG_LOADING,this.onFragLoading,this),t.on(w.FRAG_LOADED,this.onFragLoaded,this),t.on(w.FRAG_BUFFERED,this.onFragBuffered,this),t.on(w.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(w.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:t}=this;t.off(w.FRAG_LOADING,this.onFragLoading,this),t.off(w.FRAG_LOADED,this.onFragLoaded,this),t.off(w.FRAG_BUFFERED,this.onFragBuffered,this),t.off(w.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(w.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(t,e){var i;const s=e.frag;this.ignoreFragment(s)||(this.fragCurrent=s,this.partCurrent=(i=e.part)!=null?i:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(t,e){this.clearTimer()}getTimeToLoadFrag(t,e,i,s){const r=t+i/e,n=s?this.lastLevelLoadSec:0;return r+n}onLevelLoaded(t,e){const i=this.hls.config,{total:s,bwEstimate:r}=e.stats;_t(s)&&_t(r)&&(this.lastLevelLoadSec=8*s/r),e.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:t,partCurrent:e,hls:i}=this,{autoLevelEnabled:s,media:r}=i;if(!t||!r)return;const n=performance.now(),a=e?e.stats:t.stats,l=e?e.duration:t.duration,o=n-a.loading.start;if(a.aborted||a.loaded&&a.loaded===a.total||t.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!s||r.paused||!r.playbackRate||!r.readyState)return;const c=i.mainForwardBufferInfo;if(c===null)return;const u=this.bwEstimator.getEstimateTTFB(),h=Math.abs(r.playbackRate);if(o<=Math.max(u,1e3*(l/(h*2))))return;const f=c.len/h;if(f>=2*l/h)return;const m=a.loading.first?a.loading.first-a.loading.start:-1,_=a.loaded&&m>-1,E=this.bwEstimator.getEstimate(),{levels:D,minAutoLevel:O}=i,I=D[t.level],x=a.total||Math.max(a.loaded,Math.round(l*I.maxBitrate/8));let P=o-m;P<1&&_&&(P=Math.min(o,a.loaded*8/E));const C=_?a.loaded*1e3/P:0,b=C?(x-a.loaded)/C:x*8/E+u/1e3;if(b<=f)return;const S=C?C*8:E;let L=Number.POSITIVE_INFINITY,A;for(A=t.level-1;A>O;A--){const U=D[A].maxBitrate;if(L=this.getTimeToLoadFrag(u/1e3,S,l*U,!D[A].details),L<f)break}L>=b||L>l*10||(i.nextLoadLevel=A,_?this.bwEstimator.sample(o-Math.min(u,m),a.loaded):this.bwEstimator.sampleTTFB(o),this.clearTimer(),$.warn(`[abr] Fragment ${t.sn}${e?" part "+e.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${f.toFixed(3)} s
      Estimated load time for current fragment: ${b.toFixed(3)} s
      Estimated load time for down switch fragment: ${L.toFixed(3)} s
      TTFB estimate: ${m}
      Current BW estimate: ${_t(E)?(E/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${A}`),t.loader&&(this.fragCurrent=this.partCurrent=null,t.abortRequests()),i.trigger(w.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:a}))}onFragLoaded(t,{frag:e,part:i}){const s=i?i.stats:e.stats;if(e.type===xt.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const r=i?i.duration:e.duration,n=this.hls.levels[e.level],a=(n.loaded?n.loaded.bytes:0)+s.loaded,l=(n.loaded?n.loaded.duration:0)+r;n.loaded={bytes:a,duration:l},n.realBitrate=Math.round(8*a/l)}if(e.bitrateTest){const r={stats:s,frag:e,part:i,id:e.type};this.onFragBuffered(w.FRAG_BUFFERED,r),e.bitrateTest=!1}}}onFragBuffered(t,e){const{frag:i,part:s}=e,r=s!=null&&s.stats.loaded?s.stats:i.stats;if(r.aborted||this.ignoreFragment(i))return;const n=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(n,r.loaded),r.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}ignoreFragment(t){return t.type!==xt.MAIN||t.sn==="initSegment"}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const t=this._nextAutoLevel,e=this.bwEstimator;if(t!==-1&&!e.canEstimate())return t;let i=this.getNextABRAutoLevel();if(t!==-1){const s=this.hls.levels;if(s.length>Math.max(t,i)&&s[t].loadError<=s[i].loadError)return t}return t!==-1&&(i=Math.min(t,i)),i}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:i}=this,{maxAutoLevel:s,config:r,minAutoLevel:n,media:a}=i,l=e?e.duration:t?t.duration:0,o=a&&a.playbackRate!==0?Math.abs(a.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,u=i.mainForwardBufferInfo,h=(u?u.len:0)/o;let f=this.findBestLevel(c,n,s,h,r.abrBandWidthFactor,r.abrBandWidthUpFactor);if(f>=0)return f;$.trace(`[abr] ${h?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let m=l?Math.min(l,r.maxStarvationDelay):r.maxStarvationDelay,_=r.abrBandWidthFactor,E=r.abrBandWidthUpFactor;if(!h){const D=this.bitrateTestDelay;D&&(m=(l?Math.min(l,r.maxLoadingDelay):r.maxLoadingDelay)-D,$.trace(`[abr] bitrate test took ${Math.round(1e3*D)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),_=E=1)}return f=this.findBestLevel(c,n,s,h+m,_,E),Math.max(f,0)}findBestLevel(t,e,i,s,r,n){var a;const{fragCurrent:l,partCurrent:o,lastLoadedFragLevel:c}=this,{levels:u}=this.hls,h=u[c],f=!!(h!=null&&(a=h.details)!=null&&a.live),m=h==null?void 0:h.codecSet,_=o?o.duration:l?l.duration:0,E=this.bwEstimator.getEstimateTTFB()/1e3;let D=e,O=-1;for(let I=i;I>=e;I--){const x=u[I];if(!x||m&&x.codecSet!==m){x&&(D=Math.min(I,D),O=Math.max(I,O));continue}O!==-1&&$.trace(`[abr] Skipped level(s) ${D}-${O} with CODECS:"${u[O].attrs.CODECS}"; not compatible with "${h.attrs.CODECS}"`);const P=x.details,C=(o?P==null?void 0:P.partTarget:P==null?void 0:P.averagetargetduration)||_;let b;I<=c?b=r*t:b=n*t;const S=u[I].maxBitrate,L=this.getTimeToLoadFrag(E,b,S*C,P===void 0);if($.trace(`[abr] level:${I} adjustedbw-bitrate:${Math.round(b-S)} avgDuration:${C.toFixed(1)} maxFetchDuration:${s.toFixed(1)} fetchDuration:${L.toFixed(1)}`),b>S&&(L===0||!_t(L)||f&&!this.bitrateTestDelay||L<s))return I}return-1}set nextAutoLevel(t){this._nextAutoLevel=t}}class Wn{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let i;if(t.length)t.length===1?i=t[0]:i=Ec(t,e);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function Ec(d,t){const e=new Uint8Array(t);let i=0;for(let s=0;s<d.length;s++){const r=d[s];e.set(r,i),i+=r.length}return e}const $s=100;class xc extends Gr{constructor(t,e,i){super(t,e,i,"[audio-stream-controller]",xt.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:t}=this;t.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.LEVEL_LOADED,this.onLevelLoaded,this),t.on(w.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(w.ERROR,this.onError,this),t.on(w.BUFFER_RESET,this.onBufferReset,this),t.on(w.BUFFER_CREATED,this.onBufferCreated,this),t.on(w.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(w.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(w.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.LEVEL_LOADED,this.onLevelLoaded,this),t.off(w.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(w.ERROR,this.onError,this),t.off(w.BUFFER_RESET,this.onBufferReset,this),t.off(w.BUFFER_CREATED,this.onBufferCreated,this),t.off(w.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(w.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(w.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(t,{frag:e,id:i,initPTS:s,timescale:r}){if(i==="main"){const n=e.cc;this.initPTS[e.cc]={baseTime:s,timescale:r},this.log(`InitPTS for cc: ${n} found from main: ${s}`),this.videoTrackCC=n,this.state===it.WAITING_INIT_PTS&&this.tick()}}startLoad(t){if(!this.levels){this.startPosition=t,this.state=it.STOPPED;return}const e=this.lastCurrentTime;this.stopLoad(),this.setInterval($s),e>0&&t===-1?(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),t=e,this.state=it.IDLE):(this.loadedmetadata=!1,this.state=it.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}doTick(){switch(this.state){case it.IDLE:this.doTickIdle();break;case it.WAITING_TRACK:{var t;const{levels:i,trackId:s}=this,r=i==null||(t=i[s])==null?void 0:t.details;if(r){if(this.waitForCdnTuneIn(r))break;this.state=it.WAITING_INIT_PTS}break}case it.FRAG_LOADING_WAITING_RETRY:{var e;const i=performance.now(),s=this.retryDate;(!s||i>=s||(e=this.media)!=null&&e.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=it.IDLE);break}case it.WAITING_INIT_PTS:{const i=this.waitingData;if(i){const{frag:s,part:r,cache:n,complete:a}=i;if(this.initPTS[s.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=it.FRAG_LOADING;const l=n.flush(),o={frag:s,part:r,payload:l,networkDetails:null};this._handleFragmentLoadProgress(o),a&&super._handleFragmentLoadComplete(o)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${s.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),o=Ut.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);Rr(o.end,this.config.maxFragLookUpTolerance,s)<0&&(this.log(`Waiting fragment cc (${s.cc}) @ ${s.start} cancelled because another fragment at ${o.end} is needed`),this.clearWaitingFragment())}}else this.state=it.IDLE}}this.onTickEnd()}clearWaitingFragment(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=it.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:t}=this;!(t!=null&&t.readyState)||(this.lastCurrentTime=t.currentTime)}doTickIdle(){const{hls:t,levels:e,media:i,trackId:s}=this,r=t.config;if(!(e!=null&&e[s])||!i&&(this.startFragRequested||!r.startFragPrefetch))return;const n=e[s],a=n.details;if(!a||a.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(a)){this.state=it.WAITING_TRACK;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,Ft.AUDIO,xt.AUDIO));const o=this.getFwdBufferInfo(l,xt.AUDIO);if(o===null)return;const{bufferedTrack:c,switchingTrack:u}=this;if(!u&&this._streamEnded(o,a)){t.trigger(w.BUFFER_EOS,{type:"audio"}),this.state=it.ENDED;return}const h=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,xt.MAIN),f=o.len,m=this.getMaxBufferLength(h==null?void 0:h.len);if(f>=m&&!u)return;const E=a.fragments[0].start;let D=o.end;if(u&&i){const P=this.getLoadPosition();c&&u.attrs!==c.attrs&&(D=P),a.PTSKnown&&P<E&&(o.end>E||o.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=E+.05)}let O=this.getNextFragment(D,a),I=!1;if(O&&this.isLoopLoading(O,D)&&(I=!!O.gap,O=this.getNextFragmentLoopLoading(O,a,o,xt.MAIN,m)),!O){this.bufferFlushed=!0;return}const x=h&&O.start>h.end+a.targetduration;if(x||!(h!=null&&h.len)&&o.len){const P=this.getAppendedFrag(O.start,xt.MAIN);if(P===null||(I||(I=!!P.gap||!!x&&h.len===0),x&&!I||I&&o.nextStart&&o.nextStart<P.end))return}this.loadFragment(O,n,D)}getMaxBufferLength(t){const e=super.getMaxBufferLength();return t?Math.min(Math.max(e,t),this.config.maxMaxBufferLength):e}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(t,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map(i=>new _i(i))}onAudioTrackSwitching(t,e){const i=!!e.url;this.trackId=e.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?this.setInterval($s):this.resetTransmuxer(),i?(this.switchingTrack=e,this.state=it.IDLE):(this.switchingTrack=null,this.bufferedTrack=e,this.state=it.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(t,e){this.mainDetails=e.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(w.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(t,e){var i;if(this.mainDetails==null){this.cachedTrackLoadedData=e;return}const{levels:s}=this,{details:r,id:n}=e;if(!s){this.warn(`Audio tracks were reset while loading level ${n}`);return}this.log(`Track ${n} loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const a=s[n];let l=0;if(r.live||(i=a.details)!=null&&i.live){const o=this.mainDetails;if(r.fragments[0]||(r.deltaUpdateFailed=!0),r.deltaUpdateFailed||!o)return;!a.details&&r.hasProgramDateTime&&o.hasProgramDateTime?(kn(r,o),l=r.fragments[0].start):l=this.alignPlaylists(r,a.details)}a.details=r,this.levelLastLoaded=n,!this.startFragRequested&&(this.mainDetails||!r.live)&&this.setStartPosition(a.details,l),this.state===it.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=it.IDLE),this.tick()}_handleFragmentLoadProgress(t){var e;const{frag:i,part:s,payload:r}=t,{config:n,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const o=l[a];if(!o){this.warn("Audio track is undefined on fragment load progress");return}const c=o.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const u=n.defaultAudioCodec||o.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new Kn(this.hls,xt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[i.cc],m=(e=i.initSegment)==null?void 0:e.data;if(f!==void 0){const E=s?s.index:-1,D=E!==-1,O=new Br(i.level,i.sn,i.stats.chunkCount,r.byteLength,E,D);h.push(r,m,u,"",i,s,c.totalduration,!1,O,f)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:_}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new Wn,complete:!1};_.push(new Uint8Array(r)),this.waitingVideoCC=this.videoTrackCC,this.state=it.WAITING_INIT_PTS}}_handleFragmentLoadComplete(t){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(t,e){const i=e.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer||null)}onFragBuffered(t,e){const{frag:i,part:s}=e;if(i.type!==xt.AUDIO){if(!this.loadedmetadata&&i.type===xt.MAIN){const r=this.videoBuffer||this.media;r&&Ut.getBuffered(r).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(i.sn!=="initSegment"){this.fragPrevious=i;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(w.AUDIO_TRACK_SWITCHED,he({},r)))}this.fragBufferedComplete(i,s)}onError(t,e){var i;if(e.fatal){this.state=it.ERROR;return}switch(e.details){case J.FRAG_GAP:case J.FRAG_PARSING_ERROR:case J.FRAG_DECRYPT_ERROR:case J.FRAG_LOAD_ERROR:case J.FRAG_LOAD_TIMEOUT:case J.KEY_LOAD_ERROR:case J.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(xt.AUDIO,e);break;case J.AUDIO_TRACK_LOAD_ERROR:case J.AUDIO_TRACK_LOAD_TIMEOUT:case J.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===it.WAITING_TRACK&&((i=e.context)==null?void 0:i.type)===Pt.AUDIO_TRACK&&(this.state=it.IDLE);break;case J.BUFFER_FULL_ERROR:if(!e.parent||e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case J.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onBufferFlushed(t,{type:e}){e===Ft.AUDIO&&(this.bufferFlushed=!0,this.state===it.ENDED&&(this.state=it.IDLE))}_handleTransmuxComplete(t){var e;const i="audio",{hls:s}=this,{remuxResult:r,chunkMeta:n}=t,a=this.getCurrentContext(n);if(!a){this.resetWhenMissingContext(n);return}const{frag:l,part:o,level:c}=a,{details:u}=c,{audio:h,text:f,id3:m,initSegment:_}=r;if(this.fragContextChanged(l)||!u){this.fragmentTracker.removeFragment(l);return}if(this.state=it.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),_!=null&&_.tracks){const E=l.initSegment||l;this._bufferInitSegment(_.tracks,E,n),s.trigger(w.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:i,tracks:_.tracks})}if(h){const{startPTS:E,endPTS:D,startDTS:O,endDTS:I}=h;o&&(o.elementaryStreams[Ft.AUDIO]={startPTS:E,endPTS:D,startDTS:O,endDTS:I}),l.setElementaryStreamInfo(Ft.AUDIO,E,D,O,I),this.bufferFragmentData(h,l,o,n)}if(m!=null&&(e=m.samples)!=null&&e.length){const E=Zt({id:i,frag:l,details:u},m);s.trigger(w.FRAG_PARSING_METADATA,E)}if(f){const E=Zt({id:i,frag:l,details:u},f);s.trigger(w.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(t,e,i){if(this.state!==it.PARSING)return;t.video&&delete t.video;const s=t.audio;if(!s)return;s.levelCodec=s.codec,s.id="audio",this.log(`Init audio buffer, container:${s.container}, codecs[parsed]=[${s.codec}]`),this.hls.trigger(w.BUFFER_CODECS,t);const r=s.initSegment;if(r!=null&&r.byteLength){const n={type:"audio",frag:e,part:null,chunkMeta:i,parent:e.type,data:r};this.hls.trigger(w.BUFFER_APPENDING,n)}this.tick()}loadFragment(t,e,i){const s=this.fragmentTracker.getState(t);if(this.fragCurrent=t,this.switchingTrack||s===ie.NOT_LOADED||s===ie.PARTIAL){var r;t.sn==="initSegment"?this._loadInitSegment(t,e):(r=e.details)!=null&&r.live&&!this.initPTS[t.cc]?(this.log(`Waiting for video PTS in continuity counter ${t.cc} of live stream before loading audio fragment ${t.sn} of level ${this.trackId}`),this.state=it.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(t,e,i))}else this.clearTrackerIfNeeded(t)}completeAudioSwitch(t){const{hls:e,media:i,bufferedTrack:s}=this,r=s==null?void 0:s.attrs,n=t.attrs;i&&r&&(r.CHANNELS!==n.CHANNELS||r.NAME!==n.NAME||r.LANGUAGE!==n.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(w.AUDIO_TRACK_SWITCHED,he({},t))}}class Sc extends Fr{constructor(t){super(t,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.MANIFEST_PARSED,this.onManifestParsed,this),t.on(w.LEVEL_LOADING,this.onLevelLoading,this),t.on(w.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(w.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.MANIFEST_PARSED,this.onManifestParsed,this),t.off(w.LEVEL_LOADING,this.onLevelLoading,this),t.off(w.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(w.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(t,e){const{id:i,groupId:s,details:r}=e,n=this.tracksInGroup[i];if(!n||n.groupId!==s){this.warn(`Track with id:${i} and group:${s} not found in active group ${n.groupId}`);return}const a=n.details;n.details=e.details,this.log(`audio-track ${i} "${n.name}" lang:${n.lang} group:${s} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,a)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!(e!=null&&e.audioGroupIds))return;const i=e.audioGroupIds[e.urlId];if(this.groupId!==i){this.groupId=i||null;const s=this.tracks.filter(n=>!i||n.groupId===i);this.selectDefaultTrack&&!s.some(n=>n.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=s;const r={audioTracks:s};this.log(`Updating audio tracks, ${s.length} track(s) found in group:${i}`),this.hls.trigger(w.AUDIO_TRACKS_UPDATED,r),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(t,e){e.fatal||!e.context||e.context.type===Pt.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(e))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();const i=this.currentTrack;e[this.trackId];const s=e[t],{groupId:r,name:n}=s;if(this.log(`Switching to audio-track ${t} "${n}" lang:${s.lang} group:${r}`),this.trackId=t,this.currentTrack=s,this.selectDefaultTrack=!1,this.hls.trigger(w.AUDIO_TRACK_SWITCHING,he({},s)),s.details&&!s.details.live)return;const a=this.switchParams(s.url,i==null?void 0:i.details);this.loadPlaylist(a)}selectInitialTrack(){const t=this.tracksInGroup,e=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(e!==-1)this.setAudioTrack(e);else{const i=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${t.length}`);this.warn(i.message),this.hls.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:i})}}findTrackId(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const s=e[i];if((!this.selectDefaultTrack||s.default)&&(!t||t.attrs["STABLE-RENDITION-ID"]!==void 0&&t.attrs["STABLE-RENDITION-ID"]===s.attrs["STABLE-RENDITION-ID"]||t.name===s.name&&t.lang===s.lang))return s.id}return-1}loadPlaylist(t){super.loadPlaylist();const e=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(e)){const i=e.id,s=e.groupId;let r=e.url;if(t)try{r=t.addDirectives(r)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}this.log(`loading audio-track playlist ${i} "${e.name}" lang:${e.lang} group:${s}`),this.clearTimer(),this.hls.trigger(w.AUDIO_TRACK_LOADING,{url:r,id:i,groupId:s,deliveryDirectives:t||null})}}}function qn(d,t){if(d.length!==t.length)return!1;for(let e=0;e<d.length;e++)if(!Tc(d[e].attrs,t[e].attrs))return!1;return!0}function Tc(d,t){const e=d["STABLE-RENDITION-ID"];return e?e===t["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(i=>d[i]!==t[i])}const zs=500;class bc extends Gr{constructor(t,e,i){super(t,e,i,"[subtitle-stream-controller]",xt.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:t}=this;t.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.LEVEL_LOADED,this.onLevelLoaded,this),t.on(w.ERROR,this.onError,this),t.on(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(w.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(w.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(w.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.LEVEL_LOADED,this.onLevelLoaded,this),t.off(w.ERROR,this.onError,this),t.off(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(w.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(w.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(w.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(t){this.stopLoad(),this.state=it.IDLE,this.setInterval(zs),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(t,e){this.mainDetails=e.details}onSubtitleFragProcessed(t,e){const{frag:i,success:s}=e;if(this.fragPrevious=i,this.state=it.IDLE,!s)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let n;const a=i.start;for(let o=0;o<r.length;o++)if(a>=r[o].start&&a<=r[o].end){n=r[o];break}const l=i.start+i.duration;n?n.end=l:(n={start:a,end:l},r.push(n)),this.fragmentTracker.fragBuffered(i)}onBufferFlushing(t,e){const{startOffset:i,endOffset:s}=e;if(i===0&&s!==Number.POSITIVE_INFINITY){const{currentTrackId:r,levels:n}=this;if(!n.length||!n[r]||!n[r].details)return;const l=n[r].details.targetduration,o=s-l;if(o<=0)return;e.endOffsetSubtitles=Math.max(0,o),this.tracksBuffered.forEach(c=>{for(let u=0;u<c.length;){if(c[u].end<=o){c.shift();continue}else if(c[u].start<o)c[u].start=o;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(i,o,xt.SUBTITLE)}}onFragBuffered(t,e){if(!this.loadedmetadata&&e.frag.type===xt.MAIN){var i;(i=this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)}}onError(t,e){const i=e.frag;(i==null?void 0:i.type)===xt.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==it.STOPPED&&(this.state=it.IDLE))}onSubtitleTracksUpdated(t,{subtitleTracks:e}){if(qn(this.levels,e)){this.levels=e.map(i=>new _i(i));return}this.tracksBuffered=[],this.levels=e.map(i=>{const s=new _i(i);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,xt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(t,e){if(this.currentTrackId=e.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(zs)}onSubtitleTrackLoaded(t,e){var i;const{details:s,id:r}=e,{currentTrackId:n,levels:a}=this;if(!a.length)return;const l=a[n];if(r>=a.length||r!==n||!l)return;this.mediaBuffer=this.mediaBufferTimeRanges;let o=0;if(s.live||(i=l.details)!=null&&i.live){const c=this.mainDetails;if(s.deltaUpdateFailed||!c)return;const u=c.fragments[0];l.details?(o=this.alignPlaylists(s,l.details),o===0&&u&&(o=u.start,wr(s,o))):s.hasProgramDateTime&&c.hasProgramDateTime?(kn(s,c),o=s.fragments[0].start):u&&(o=u.start,wr(s,o))}l.details=s,this.levelLastLoaded=r,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(l.details,o),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===it.IDLE&&(vi(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0))}_handleFragmentLoadComplete(t){const{frag:e,payload:i}=t,s=e.decryptdata,r=this.hls;if(!this.fragContextChanged(e)&&i&&i.byteLength>0&&s&&s.key&&s.iv&&s.method==="AES-128"){const n=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer).catch(a=>{throw r.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:e}),a}).then(a=>{const l=performance.now();r.trigger(w.FRAG_DECRYPTED,{frag:e,payload:a,stats:{tstart:n,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=it.IDLE})}}doTick(){if(!this.media){this.state=it.IDLE;return}if(this.state===it.IDLE){const{currentTrackId:t,levels:e}=this,i=e[t];if(!e.length||!i||!i.details)return;const s=i.details,r=s.targetduration,{config:n}=this,a=this.getLoadPosition(),l=Ut.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a-r,n.maxBufferHole),{end:o,len:c}=l,u=this.getFwdBufferInfo(this.media,xt.MAIN),h=this.getMaxBufferLength(u==null?void 0:u.len)+r;if(c>h)return;const f=s.fragments,m=f.length,_=s.edge;let E=null;const D=this.fragPrevious;if(o<_){const{maxFragLookUpTolerance:O}=n;E=vi(D,f,Math.max(f[0].start,o),O),!E&&D&&D.start<f[0].start&&(E=f[0])}else E=f[m-1];if(!E)return;E=this.mapToInitFragWhenRequired(E),this.fragmentTracker.getState(E)===ie.NOT_LOADED&&this.loadFragment(E,i,o)}}getMaxBufferLength(t){const e=super.getMaxBufferLength();return t?Math.max(e,t):e}loadFragment(t,e,i){this.fragCurrent=t,t.sn==="initSegment"?this._loadInitSegment(t,e):(this.startFragRequested=!0,super.loadFragment(t,e,i))}get mediaBufferTimeRanges(){return new Ac(this.tracksBuffered[this.currentTrackId]||[])}}class Ac{constructor(t){this.buffered=void 0;const e=(i,s,r)=>{if(s=s>>>0,s>r-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${r})`);return t[s][i]};this.buffered={get length(){return t.length},end(i){return e("end",i,t.length)},start(i){return e("start",i,t.length)}}}}class Lc extends Fr{constructor(t){super(t,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:t}=this;t.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.MANIFEST_PARSED,this.onManifestParsed,this),t.on(w.LEVEL_LOADING,this.onLevelLoading,this),t.on(w.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(w.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.MANIFEST_PARSED,this.onManifestParsed,this),t.off(w.LEVEL_LOADING,this.onLevelLoading,this),t.off(w.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(w.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),mr(this.media.textTracks).forEach(e=>{li(e)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(t,e){const{id:i,details:s}=e,{trackId:r}=this,n=this.tracksInGroup[r];if(!n){this.warn(`Invalid subtitle track id ${i}`);return}const a=n.details;n.details=e.details,this.log(`subtitle track ${i} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,a)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!(e!=null&&e.textGroupIds))return;const i=e.textGroupIds[e.urlId],s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==i){const r=this.tracks.filter(l=>!i||l.groupId===i);this.tracksInGroup=r;const n=this.findTrackId(s==null?void 0:s.name)||this.findTrackId();this.groupId=i||null;const a={subtitleTracks:r};this.log(`Updating subtitle tracks, ${r.length} track(s) found in "${i}" group-id`),this.hls.trigger(w.SUBTITLE_TRACKS_UPDATED,a),n!==-1&&this.setSubtitleTrack(n,s)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId,s)}findTrackId(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const s=e[i];if((!this.selectDefaultTrack||s.default)&&(!t||t===s.name))return s.id}return-1}onError(t,e){e.fatal||!e.context||e.context.type===Pt.SUBTITLE_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.checkRetry(e)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1;const e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,e)}loadPlaylist(t){super.loadPlaylist();const e=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(e)){const i=e.id,s=e.groupId;let r=e.url;if(t)try{r=t.addDirectives(r)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}this.log(`Loading subtitle playlist for id ${i}`),this.hls.trigger(w.SUBTITLE_TRACK_LOADING,{url:r,id:i,groupId:s,deliveryDirectives:t||null})}}toggleTrackModes(t){const{media:e,trackId:i}=this;if(!e)return;const s=mr(e.textTracks),r=s.filter(a=>a.groupId===this.groupId);if(t===-1)[].slice.call(s).forEach(a=>{a.mode="disabled"});else{const a=r[i];a&&(a.mode="disabled")}const n=r[t];n&&(n.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(t,e){var i;const s=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(this.trackId!==t&&this.toggleTrackModes(t),this.trackId===t&&(t===-1||(i=s[t])!=null&&i.details)||t<-1||t>=s.length)return;this.clearTimer();const r=s[t];if(this.log(`Switching to subtitle-track ${t}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:"")),this.trackId=t,r){const{id:n,groupId:a="",name:l,type:o,url:c}=r;this.hls.trigger(w.SUBTITLE_TRACK_SWITCH,{id:n,groupId:a,name:l,type:o,url:c});const u=this.switchParams(r.url,e==null?void 0:e.details);this.loadPlaylist(u)}else this.hls.trigger(w.SUBTITLE_TRACK_SWITCH,{id:t})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=-1;const e=mr(this.media.textTracks);for(let i=0;i<e.length;i++)if(e[i].mode==="hidden")t=i;else if(e[i].mode==="showing"){t=i;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}}function mr(d){const t=[];for(let e=0;e<d.length;e++){const i=d[e];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&t.push(d[e])}return t}class Ic{constructor(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}append(t,e){const i=this.queues[e];i.push(t),i.length===1&&this.buffers[e]&&this.executeNext(e)}insertAbort(t,e){this.queues[e].unshift(t),this.executeNext(e)}appendBlocker(t){let e;const i=new Promise(r=>{e=r}),s={execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(s,t),i}executeNext(t){const{buffers:e,queues:i}=this,s=e[t],r=i[t];if(r.length){const n=r[0];try{n.execute()}catch(a){$.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),n.onError(a),s!=null&&s.updating||(r.shift(),this.executeNext(t))}}}shiftAndExecuteNext(t){this.queues[t].shift(),this.executeNext(t)}current(t){return this.queues[t][0]}}const Hs=$i(),Ys=/([ha]vc.)(?:\.[^.,]+)+/;class wc{constructor(t){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:e,mediaSource:i}=this;$.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(w.MEDIA_ATTACHED,{media:e})),i&&i.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{$.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{$.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:e,_objectUrl:i}=this;e&&e.src!==i&&$.error(`Media element src was set while attaching MediaSource (${i} > ${e.src})`)},this.hls=t,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:t}=this;t.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.MANIFEST_PARSED,this.onManifestParsed,this),t.on(w.BUFFER_RESET,this.onBufferReset,this),t.on(w.BUFFER_APPENDING,this.onBufferAppending,this),t.on(w.BUFFER_CODECS,this.onBufferCodecs,this),t.on(w.BUFFER_EOS,this.onBufferEos,this),t.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(w.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(w.FRAG_PARSED,this.onFragParsed,this),t.on(w.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:t}=this;t.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.MANIFEST_PARSED,this.onManifestParsed,this),t.off(w.BUFFER_RESET,this.onBufferReset,this),t.off(w.BUFFER_APPENDING,this.onBufferAppending,this),t.off(w.BUFFER_CODECS,this.onBufferCodecs,this),t.off(w.BUFFER_EOS,this.onBufferEos,this),t.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(w.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(w.FRAG_PARSED,this.onFragParsed,this),t.off(w.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new Ic(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,e){let i=2;(e.audio&&!e.video||!e.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,$.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(t,e){const i=this.media=e.media;if(i&&Hs){const s=this.mediaSource=new Hs;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(s),this._objectUrl=i.src,i.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:t,mediaSource:e,_objectUrl:i}=this;if(e){if($.log("[buffer-controller]: media source detaching"),e.readyState==="open")try{e.endOfStream()}catch(s){$.warn(`[buffer-controller]: onMediaDetaching: ${s.message} while calling endOfStream`)}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(t.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),t.src===i?(t.removeAttribute("src"),t.load()):$.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(w.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(t=>{const e=this.sourceBuffer[t];try{e&&(this.removeBufferListeners(t),this.mediaSource&&this.mediaSource.removeSourceBuffer(e),this.sourceBuffer[t]=void 0)}catch(i){$.warn(`[buffer-controller]: Failed to reset the ${t} buffer`,i)}}),this._initSourceBuffer()}onBufferCodecs(t,e){const i=this.getSourceBufferTypes().length;Object.keys(e).forEach(s=>{if(i){const r=this.tracks[s];if(r&&typeof r.buffer.changeType=="function"){const{id:n,codec:a,levelCodec:l,container:o,metadata:c}=e[s],u=(r.levelCodec||r.codec).replace(Ys,"$1"),h=(l||a).replace(Ys,"$1");if(u!==h){const f=`${o};codecs=${l||a}`;this.appendChangeType(s,f),$.log(`[buffer-controller]: switching codec ${u} to ${h}`),this.tracks[s]={buffer:r.buffer,codec:a,container:o,levelCodec:l,metadata:c,id:n}}}}else this.pendingTracks[s]=e[s]}),!i&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())}appendChangeType(t,e){const{operationQueue:i}=this,s={execute:()=>{const r=this.sourceBuffer[t];r&&($.log(`[buffer-controller]: changing ${t} sourceBuffer type to ${e}`),r.changeType(e)),i.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:r=>{$.warn(`[buffer-controller]: Failed to change ${t} SourceBuffer type`,r)}};i.append(s,t)}onBufferAppending(t,e){const{hls:i,operationQueue:s,tracks:r}=this,{data:n,type:a,frag:l,part:o,chunkMeta:c}=e,u=c.buffering[a],h=self.performance.now();u.start=h;const f=l.stats.buffering,m=o?o.stats.buffering:null;f.start===0&&(f.start=h),m&&m.start===0&&(m.start=h);const _=r.audio;let E=!1;a==="audio"&&(_==null?void 0:_.container)==="audio/mpeg"&&(E=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const D=l.start,O={execute:()=>{if(u.executeStart=self.performance.now(),E){const I=this.sourceBuffer[a];if(I){const x=D-I.timestampOffset;Math.abs(x)>=.1&&($.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${D} (delta: ${x}) sn: ${l.sn})`),I.timestampOffset=D)}}this.appendExecutor(n,a)},onStart:()=>{},onComplete:()=>{const I=self.performance.now();u.executeEnd=u.end=I,f.first===0&&(f.first=I),m&&m.first===0&&(m.first=I);const{sourceBuffer:x}=this,P={};for(const C in x)P[C]=Ut.getBuffered(x[C]);this.appendError=0,this.hls.trigger(w.BUFFER_APPENDED,{type:a,frag:l,part:o,chunkMeta:c,parent:l.type,timeRanges:P})},onError:I=>{$.error(`[buffer-controller]: Error encountered while trying to append to the ${a} SourceBuffer`,I);const x={type:Et.MEDIA_ERROR,parent:l.type,details:J.BUFFER_APPEND_ERROR,frag:l,part:o,chunkMeta:c,error:I,err:I,fatal:!1};I.code===DOMException.QUOTA_EXCEEDED_ERR?x.details=J.BUFFER_FULL_ERROR:(this.appendError++,x.details=J.BUFFER_APPEND_ERROR,this.appendError>i.config.appendErrorMaxRetry&&($.error(`[buffer-controller]: Failed ${i.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),x.fatal=!0)),i.trigger(w.ERROR,x)}};s.append(O,a)}onBufferFlushing(t,e){const{operationQueue:i}=this,s=r=>({execute:this.removeExecutor.bind(this,r,e.startOffset,e.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(w.BUFFER_FLUSHED,{type:r})},onError:n=>{$.warn(`[buffer-controller]: Failed to remove from ${r} SourceBuffer`,n)}});e.type?i.append(s(e.type),e.type):this.getSourceBufferTypes().forEach(r=>{i.append(s(r),r)})}onFragParsed(t,e){const{frag:i,part:s}=e,r=[],n=s?s.elementaryStreams:i.elementaryStreams;n[Ft.AUDIOVIDEO]?r.push("audiovideo"):(n[Ft.AUDIO]&&r.push("audio"),n[Ft.VIDEO]&&r.push("video"));const a=()=>{const l=self.performance.now();i.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const o=s?s.stats:i.stats;this.hls.trigger(w.FRAG_BUFFERED,{frag:i,part:s,stats:o,id:i.type})};r.length===0&&$.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(a,r)}onFragChanged(t,e){this.flushBackBuffer()}onBufferEos(t,e){this.getSourceBufferTypes().reduce((s,r)=>{const n=this.sourceBuffer[r];return n&&(!e.type||e.type===r)&&(n.ending=!0,n.ended||(n.ended=!0,$.log(`[buffer-controller]: ${r} sourceBuffer now EOS`))),s&&!!(!n||n.ended)},!0)&&($.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(r=>{const n=this.sourceBuffer[r];n&&(n.ending=!1)});const{mediaSource:s}=this;if(!s||s.readyState!=="open"){s&&$.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${s.readyState}`);return}$.log("[buffer-controller]: Calling mediaSource.endOfStream()"),s.endOfStream()}))}onLevelUpdated(t,{details:e}){!e.fragments.length||(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:t,details:e,media:i,sourceBuffer:s}=this;if(!i||e===null)return;const r=this.getSourceBufferTypes();if(!r.length)return;const n=e.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(!_t(n)||n<0)return;const a=i.currentTime,l=e.levelTargetDuration,o=Math.max(n,l),c=Math.floor(a/l)*l-o;r.forEach(u=>{const h=s[u];if(h){const f=Ut.getBuffered(h);if(f.length>0&&c>f.start(0)){if(t.trigger(w.BACK_BUFFER_REACHED,{bufferEnd:c}),e.live)t.trigger(w.LIVE_BACK_BUFFER_REACHED,{bufferEnd:c});else if(h.ended&&f.end(f.length-1)-a<l*2){$.info(`[buffer-controller]: Cannot flush ${u} back buffer while SourceBuffer is in ended state`);return}t.trigger(w.BUFFER_FLUSHING,{startOffset:0,endOffset:c,type:u})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:t,hls:e,media:i,mediaSource:s}=this,r=t.fragments[0].start+t.totalduration,n=i.duration,a=_t(s.duration)?s.duration:0;t.live&&e.config.liveDurationInfinity?($.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(t)):(r>a&&r>n||!_t(n))&&($.log(`[buffer-controller]: Updating Media Source duration to ${r.toFixed(3)}`),s.duration=r)}updateSeekableRange(t){const e=this.mediaSource,i=t.fragments;if(i.length&&t.live&&e!=null&&e.setLiveSeekableRange){const r=Math.max(0,i[0].start),n=Math.max(r,r+t.totalduration);e.setLiveSeekableRange(r,n)}}checkPendingTracks(){const{bufferCodecEventsExpected:t,operationQueue:e,pendingTracks:i}=this,s=Object.keys(i).length;if(s&&!t||s===2){this.createSourceBuffers(i),this.pendingTracks={};const r=this.getSourceBufferTypes();if(r.length)this.hls.trigger(w.BUFFER_CREATED,{tracks:this.tracks}),r.forEach(n=>{e.executeNext(n)});else{const n=new Error("could not create source buffer for media codec(s)");this.hls.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:n,reason:n.message})}}}createSourceBuffers(t){const{sourceBuffer:e,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(const s in t)if(!e[s]){const r=t[s];if(!r)throw Error(`source buffer exists for track ${s}, however track does not`);const n=r.levelCodec||r.codec,a=`${r.container};codecs=${n}`;$.log(`[buffer-controller]: creating sourceBuffer(${a})`);try{const l=e[s]=i.addSourceBuffer(a),o=s;this.addBufferListener(o,"updatestart",this._onSBUpdateStart),this.addBufferListener(o,"updateend",this._onSBUpdateEnd),this.addBufferListener(o,"error",this._onSBUpdateError),this.tracks[s]={buffer:l,codec:n,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id}}catch(l){$.error(`[buffer-controller]: error while trying to add sourceBuffer: ${l.message}`),this.hls.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:l,mimeType:a})}}}_onSBUpdateStart(t){const{operationQueue:e}=this;e.current(t).onStart()}_onSBUpdateEnd(t){const{operationQueue:e}=this;e.current(t).onComplete(),e.shiftAndExecuteNext(t)}_onSBUpdateError(t,e){const i=new Error(`${t} SourceBuffer error`);$.error(`[buffer-controller]: ${i}`,e),this.hls.trigger(w.ERROR,{type:Et.MEDIA_ERROR,details:J.BUFFER_APPENDING_ERROR,error:i,fatal:!1});const s=this.operationQueue.current(t);s&&s.onError(e)}removeExecutor(t,e,i){const{media:s,mediaSource:r,operationQueue:n,sourceBuffer:a}=this,l=a[t];if(!s||!r||!l){$.warn(`[buffer-controller]: Attempting to remove from the ${t} SourceBuffer, but it does not exist`),n.shiftAndExecuteNext(t);return}const o=_t(s.duration)?s.duration:1/0,c=_t(r.duration)?r.duration:1/0,u=Math.max(0,e),h=Math.min(i,o,c);h>u&&!l.ending?(l.ended=!1,$.log(`[buffer-controller]: Removing [${u},${h}] from the ${t} SourceBuffer`),l.remove(u,h)):n.shiftAndExecuteNext(t)}appendExecutor(t,e){const{operationQueue:i,sourceBuffer:s}=this,r=s[e];if(!r){$.warn(`[buffer-controller]: Attempting to append to the ${e} SourceBuffer, but it does not exist`),i.shiftAndExecuteNext(e);return}r.ended=!1,r.appendBuffer(t)}blockBuffers(t,e=this.getSourceBufferTypes()){if(!e.length){$.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);return}const{operationQueue:i}=this,s=e.map(r=>i.appendBlocker(r));Promise.all(s).then(()=>{t(),e.forEach(r=>{const n=this.sourceBuffer[r];n!=null&&n.updating||i.shiftAndExecuteNext(r)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(t,e,i){const s=this.sourceBuffer[t];if(!s)return;const r=i.bind(this,t);this.listeners[t].push({event:e,listener:r}),s.addEventListener(e,r)}removeBufferListeners(t){const e=this.sourceBuffer[t];!e||this.listeners[t].forEach(i=>{e.removeEventListener(i.event,i.listener)})}}const Ks={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Qn=function(t){let e=t;return Ks.hasOwnProperty(t)&&(e=Ks[t]),String.fromCharCode(e)},Te=15,je=100,Rc={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Dc={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Cc={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},kc={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Mc=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Pc{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const i=typeof e=="function"?e():e;$.log(`${this.time} [${t}] ${i}`)}}}const Je=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].toString(16));return e};class Xn{constructor(t,e,i,s,r){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=i||!1,this.background=s||"black",this.flash=r||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let i=0;i<e.length;i++){const s=e[i];t.hasOwnProperty(s)&&(this[s]=t[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Oc{constructor(t,e,i,s,r,n){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new Xn(e,i,s,r,n)}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Nc{constructor(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let e=0;e<je;e++)this.chars.push(new Oc);this.logger=t,this.pos=0,this.currPenState=new Xn}equals(t){let e=!0;for(let i=0;i<je;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e}copy(t){for(let e=0;e<je;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<je;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>je&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=je)}moveCursor(t){const e=this.pos+t;if(t>1)for(let i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=Qn(t);if(this.pos>=je){this.logger.log(0,()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)}clearFromPos(t){let e;for(e=t;e<je;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let i=0;i<je;i++){const s=this.chars[i].uchar;s!==" "&&(e=!1),t.push(s)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}class gr{constructor(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let e=0;e<Te;e++)this.rows.push(new Nc(t));this.logger=t,this.currRow=Te-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let t=0;t<Te;t++)this.rows[t].clear();this.currRow=Te-1}equals(t){let e=!0;for(let i=0;i<Te;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e}copy(t){for(let e=0;e<Te;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<Te;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,()=>"pacData = "+JSON.stringify(t));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let a=0;a<Te;a++)this.rows[a].clear();const r=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const a=n.rows[r].cueStartTime,l=this.logger.time;if(a&&l!==null&&a<l)for(let o=0;o<this.nrRollUpRows;o++)this.rows[e-this.nrRollUpRows+o+1].copy(n.rows[r+o])}}this.currRow=e;const i=this.rows[this.currRow];if(t.indent!==null){const r=t.indent,n=Math.max(r-1,0);i.setCursor(t.indent),t.color=i.chars[n].penState.foreground}const s={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(t){this.logger.log(2,()=>"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let i="",s=-1;for(let r=0;r<Te;r++){const n=this.rows[r].getTextString();n&&(s=r+1,t?e.push("Row "+s+": '"+n+"'"):e.push(n.trim()))}return e.length>0&&(t?i="["+e.join(" | ")+"]":i=e.join(`
`)),i}getTextAndFormat(){return this.rows}}class Ws{constructor(t,e,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new gr(i),this.nonDisplayedMemory=new gr(i),this.lastOutputScreen=new gr(i),this.currRollUpRow=this.displayedMemory.rows[Te-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Te-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,()=>"MODE="+t),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let i=0;i<t.length;i++)this.writeScreen.insertChar(t[i]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2===1,e.italics=t>=46,e.italics)e.foreground="white";else{const i=Math.floor(t/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=s[i]}this.logger.log(2,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)}outputDataUpdate(t=!1){const e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class qs{constructor(t,e,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const s=new Pc;this.channels=[null,new Ws(t,e,s),new Ws(t+1,i,s)],this.cmdHistory=Xs(),this.logger=s}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(t,e){let i,s,r,n=!1;this.logger.time=t;for(let a=0;a<e.length;a+=2)if(s=e[a]&127,r=e[a+1]&127,!(s===0&&r===0)){if(this.logger.log(3,"["+Je([e[a],e[a+1]])+"] -> ("+Je([s,r])+")"),i=this.parseCmd(s,r),i||(i=this.parseMidrow(s,r)),i||(i=this.parsePAC(s,r)),i||(i=this.parseBackgroundAttributes(s,r)),!i&&(n=this.parseChars(s,r),n)){const l=this.currentChannel;l&&l>0?this.channels[l].insertChars(n):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!i&&!n&&this.logger.log(2,"Couldn't parse cleaned data "+Je([s,r])+" orig: "+Je([e[a],e[a+1]]))}}parseCmd(t,e){const{cmdHistory:i}=this,s=(t===20||t===28||t===21||t===29)&&e>=32&&e<=47,r=(t===23||t===31)&&e>=33&&e<=35;if(!(s||r))return!1;if(Qs(t,e,i))return oi(null,null,i),this.logger.log(3,"Repeated command ("+Je([t,e])+") is dropped"),!0;const n=t===20||t===21||t===23?1:2,a=this.channels[n];return t===20||t===21||t===28||t===29?e===32?a.ccRCL():e===33?a.ccBS():e===34?a.ccAOF():e===35?a.ccAON():e===36?a.ccDER():e===37?a.ccRU(2):e===38?a.ccRU(3):e===39?a.ccRU(4):e===40?a.ccFON():e===41?a.ccRDC():e===42?a.ccTR():e===43?a.ccRTD():e===44?a.ccEDM():e===45?a.ccCR():e===46?a.ccENM():e===47&&a.ccEOC():a.ccTO(e-32),oi(t,e,i),this.currentChannel=n,!0}parseMidrow(t,e){let i=0;if((t===17||t===25)&&e>=32&&e<=47){if(t===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[i];return s?(s.ccMIDROW(e),this.logger.log(3,"MIDROW ("+Je([t,e])+")"),!0):!1}return!1}parsePAC(t,e){let i;const s=this.cmdHistory,r=(t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127,n=(t===16||t===24)&&e>=64&&e<=95;if(!(r||n))return!1;if(Qs(t,e,s))return oi(null,null,s),!0;const a=t<=23?1:2;e>=64&&e<=95?i=a===1?Rc[t]:Cc[t]:i=a===1?Dc[t]:kc[t];const l=this.channels[a];return l?(l.setPAC(this.interpretPAC(i,e)),oi(t,e,s),this.currentChannel=a,!0):!1}interpretPAC(t,e){let i;const s={color:null,italics:!1,indent:null,underline:!1,row:t};return e>95?i=e-96:i=e-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s}parseChars(t,e){let i,s=null,r=null;if(t>=25?(i=2,r=t-8):(i=1,r=t),r>=17&&r<=19){let n;r===17?n=e+80:r===18?n=e+112:n=e+144,this.logger.log(2,"Special char '"+Qn(n)+"' in channel "+i),s=[n]}else t>=32&&t<=127&&(s=e===0?[t]:[t,e]);if(s){const n=Je(s);this.logger.log(3,"Char codes =  "+n.join(",")),oi(t,e,this.cmdHistory)}return s}parseBackgroundAttributes(t,e){const i=(t===16||t===24)&&e>=32&&e<=47,s=(t===23||t===31)&&e>=45&&e<=47;if(!(i||s))return!1;let r;const n={};t===16||t===24?(r=Math.floor((e-32)/2),n.background=Mc[r],e%2===1&&(n.background=n.background+"_semi")):e===45?n.background="transparent":(n.foreground="black",e===47&&(n.underline=!0));const a=t<=23?1:2;return this.channels[a].setBkgData(n),oi(t,e,this.cmdHistory),!0}reset(){for(let t=0;t<Object.keys(this.channels).length;t++){const e=this.channels[t];e&&e.reset()}this.cmdHistory=Xs()}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){const i=this.channels[e];i&&i.cueSplitAtTime(t)}}}function oi(d,t,e){e.a=d,e.b=t}function Qs(d,t,e){return e.a===d&&e.b===t}function Xs(){return{a:null,b:null}}class Ci{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,i){(this.startTime===null||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var Yr=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;const d=["","lr","rl"],t=["start","middle","end","left","right"];function e(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const o=l.toLowerCase();return~a.indexOf(o)?o:!1}function i(a){return e(d,a)}function s(a){return e(t,a)}function r(a,...l){let o=1;for(;o<arguments.length;o++){const c=arguments[o];for(const u in c)a[u]=c[u]}return a}function n(a,l,o){const c=this,u={enumerable:!0};c.hasBeenReset=!1;let h="",f=!1,m=a,_=l,E=o,D=null,O="",I=!0,x="auto",P="start",C=50,b="middle",S=50,L="middle";Object.defineProperty(c,"id",r({},u,{get:function(){return h},set:function(A){h=""+A}})),Object.defineProperty(c,"pauseOnExit",r({},u,{get:function(){return f},set:function(A){f=!!A}})),Object.defineProperty(c,"startTime",r({},u,{get:function(){return m},set:function(A){if(typeof A!="number")throw new TypeError("Start time must be set to a number.");m=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",r({},u,{get:function(){return _},set:function(A){if(typeof A!="number")throw new TypeError("End time must be set to a number.");_=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",r({},u,{get:function(){return E},set:function(A){E=""+A,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",r({},u,{get:function(){return D},set:function(A){D=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",r({},u,{get:function(){return O},set:function(A){const U=i(A);if(U===!1)throw new SyntaxError("An invalid or illegal string was specified.");O=U,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",r({},u,{get:function(){return I},set:function(A){I=!!A,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",r({},u,{get:function(){return x},set:function(A){if(typeof A!="number"&&A!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");x=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",r({},u,{get:function(){return P},set:function(A){const U=s(A);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");P=U,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",r({},u,{get:function(){return C},set:function(A){if(A<0||A>100)throw new Error("Position must be between 0 and 100.");C=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",r({},u,{get:function(){return b},set:function(A){const U=s(A);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");b=U,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",r({},u,{get:function(){return S},set:function(A){if(A<0||A>100)throw new Error("Size must be between 0 and 100.");S=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",r({},u,{get:function(){return L},set:function(A){const U=s(A);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");L=U,this.hasBeenReset=!0}})),c.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();class Fc{decode(t,e){if(!t)return"";if(typeof t!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}function Zn(d){function t(i,s,r,n){return(i|0)*3600+(s|0)*60+(r|0)+parseFloat(n||0)}const e=d.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?t(e[2],e[3],0,e[4]):t(e[1],e[2],e[3],e[4]):null}class Bc{constructor(){this.values=Object.create(null)}set(t,e){!this.get(t)&&e!==""&&(this.values[t]=e)}get(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,i){for(let s=0;s<i.length;++s)if(e===i[s]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const i=parseFloat(e);if(i>=0&&i<=100)return this.set(t,i),!0}return!1}}function Jn(d,t,e,i){const s=i?d.split(i):[d];for(const r in s){if(typeof s[r]!="string")continue;const n=s[r].split(e);if(n.length!==2)continue;const a=n[0],l=n[1];t(a,l)}}const Cr=new Yr(0,0,""),ki=Cr.align==="middle"?"middle":"center";function Uc(d,t,e){const i=d;function s(){const a=Zn(d);if(a===null)throw new Error("Malformed timestamp: "+i);return d=d.replace(/^[^\sa-zA-Z-]+/,""),a}function r(a,l){const o=new Bc;Jn(a,function(h,f){let m;switch(h){case"region":for(let _=e.length-1;_>=0;_--)if(e[_].id===f){o.set(h,e[_].region);break}break;case"vertical":o.alt(h,f,["rl","lr"]);break;case"line":m=f.split(","),o.integer(h,m[0]),o.percent(h,m[0])&&o.set("snapToLines",!1),o.alt(h,m[0],["auto"]),m.length===2&&o.alt("lineAlign",m[1],["start",ki,"end"]);break;case"position":m=f.split(","),o.percent(h,m[0]),m.length===2&&o.alt("positionAlign",m[1],["start",ki,"end","line-left","line-right","auto"]);break;case"size":o.percent(h,f);break;case"align":o.alt(h,f,["start",ki,"end","left","right"]);break}},/:/,/\s/),l.region=o.get("region",null),l.vertical=o.get("vertical","");let c=o.get("line","auto");c==="auto"&&Cr.line===-1&&(c=-1),l.line=c,l.lineAlign=o.get("lineAlign","start"),l.snapToLines=o.get("snapToLines",!0),l.size=o.get("size",100),l.align=o.get("align",ki);let u=o.get("position","auto");u==="auto"&&Cr.position===50&&(u=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=u}function n(){d=d.replace(/^\s+/,"")}if(n(),t.startTime=s(),n(),d.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);d=d.slice(3),n(),t.endTime=s(),n(),r(d,t)}function ta(d){return d.replace(/<br(?: \/)?>/gi,`
`)}class jc{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Fc,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(t){const e=this;t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));function i(){let r=e.buffer,n=0;for(r=ta(r);n<r.length&&r[n]!=="\r"&&r[n]!==`
`;)++n;const a=r.slice(0,n);return r[n]==="\r"&&++n,r[n]===`
`&&++n,e.buffer=r.slice(n),a}function s(r){Jn(r,function(n,a){},/:/)}try{let r="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;r=i();const a=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let n=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(n?n=!1:r=i(),e.state){case"HEADER":/:/.test(r)?s(r):r||(e.state="ID");continue;case"NOTE":r||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){e.state="NOTE";break}if(!r)continue;if(e.cue=new Yr(0,0,""),e.state="CUE",r.indexOf("-->")===-1){e.cue.id=r;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{Uc(r,e.cue,e.regionList)}catch(a){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const a=r.indexOf("-->")!==-1;if(!r||a&&(n=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=r}continue;case"BADCUE":r||(e.state="ID")}}}catch(r){e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||t.state==="HEADER")&&(t.buffer+=`

`,t.parse()),t.state==="INITIAL"||t.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}const Gc=/\r\n|\n\r|\n|\r/g,yr=function(t,e,i=0){return t.slice(i,i+e.length)===e},Vc=function(t){let e=parseInt(t.slice(-3));const i=parseInt(t.slice(-6,-4)),s=parseInt(t.slice(-9,-7)),r=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!_t(e)||!_t(i)||!_t(s)||!_t(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${t}`);return e+=1e3*i,e+=60*1e3*s,e+=60*60*1e3*r,e},_r=function(t){let e=5381,i=t.length;for(;i;)e=e*33^t.charCodeAt(--i);return(e>>>0).toString()};function Kr(d,t,e){return _r(d.toString())+_r(t.toString())+_r(e)}const $c=function(t,e,i){let s=t[e],r=t[s.prevCC];if(!r||!r.new&&s.new){t.ccOffset=t.presentationOffset=s.start,s.new=!1;return}for(;(n=r)!=null&&n.new;){var n;t.ccOffset+=s.start-r.start,s.new=!1,s=r,r=t[s.prevCC]}t.presentationOffset=i};function zc(d,t,e,i,s,r,n){const a=new jc,l=De(new Uint8Array(d)).trim().replace(Gc,`
`).split(`
`),o=[],c=ec(t.baseTime,t.timescale);let u="00:00.000",h=0,f=0,m,_=!0;a.oncue=function(E){const D=e[i];let O=e.ccOffset;const I=(h-c)/9e4;D!=null&&D.new&&(f!==void 0?O=e.ccOffset=D.start:$c(e,i,I)),I&&(O=I-e.presentationOffset);const x=E.endTime-E.startTime,P=ge((E.startTime+O-f)*9e4,s*9e4)/9e4;E.startTime=Math.max(P,0),E.endTime=Math.max(P+x,0);const C=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(C)),E.id||(E.id=Kr(E.startTime,E.endTime,C)),E.endTime>0&&o.push(E)},a.onparsingerror=function(E){m=E},a.onflush=function(){if(m){n(m);return}r(o)},l.forEach(E=>{if(_)if(yr(E,"X-TIMESTAMP-MAP=")){_=!1,E.slice(16).split(",").forEach(D=>{yr(D,"LOCAL:")?u=D.slice(6):yr(D,"MPEGTS:")&&(h=parseInt(D.slice(7)))});try{f=Vc(u)/1e3}catch(D){m=D}return}else E===""&&(_=!1);a.parse(E+`
`)}),a.flush()}const vr="stpp.ttml.im1t",ea=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ia=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Hc={left:"start",center:"center",right:"end",start:"start",end:"end"};function Zs(d,t,e,i){const s=Mt(new Uint8Array(d),["mdat"]);if(s.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const r=s.map(a=>De(a)),n=tc(t.baseTime,1,t.timescale);try{r.forEach(a=>e(Yc(a,n)))}catch(a){i(a)}}function Yc(d,t){const s=new DOMParser().parseFromString(d,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(r).reduce((u,h)=>(u[h]=s.getAttribute(`ttp:${h}`)||r[h],u),{}),a=s.getAttribute("xml:space")!=="preserve",l=Js(Er(s,"styling","style")),o=Js(Er(s,"layout","region")),c=Er(s,"body","[begin]");return[].map.call(c,u=>{const h=ra(u,a);if(!h||!u.hasAttribute("begin"))return null;const f=Sr(u.getAttribute("begin"),n),m=Sr(u.getAttribute("dur"),n);let _=Sr(u.getAttribute("end"),n);if(f===null)throw tn(u);if(_===null){if(m===null)throw tn(u);_=f+m}const E=new Yr(f-t,_-t,h);E.id=Kr(E.startTime,E.endTime,E.text);const D=o[u.getAttribute("region")],O=l[u.getAttribute("style")],I=Kc(D,O,l),{textAlign:x}=I;if(x){const P=Hc[x];P&&(E.lineAlign=P),E.align=x}return Zt(E,I),E}).filter(u=>u!==null)}function Er(d,t,e){const i=d.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(e)):[]}function Js(d){return d.reduce((t,e)=>{const i=e.getAttribute("xml:id");return i&&(t[i]=e),t},{})}function ra(d,t){return[].slice.call(d.childNodes).reduce((e,i,s)=>{var r;return i.nodeName==="br"&&s?e+`
`:(r=i.childNodes)!=null&&r.length?ra(i,t):t?e+i.textContent.trim().replace(/\s+/g," "):e+i.textContent},"")}function Kc(d,t,e){const i="http://www.w3.org/ns/ttml#styling";let s=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],n=d!=null&&d.hasAttribute("style")?d.getAttribute("style"):null;return n&&e.hasOwnProperty(n)&&(s=e[n]),r.reduce((a,l)=>{const o=xr(t,i,l)||xr(d,i,l)||xr(s,i,l);return o&&(a[l]=o),a},{})}function xr(d,t,e){return d&&d.hasAttributeNS(t,e)?d.getAttributeNS(t,e):null}function tn(d){return new Error(`Could not parse ttml timestamp ${d}`)}function Sr(d,t){if(!d)return null;let e=Zn(d);return e===null&&(ea.test(d)?e=Wc(d,t):ia.test(d)&&(e=qc(d,t))),e}function Wc(d,t){const e=ea.exec(d),i=(e[4]|0)+(e[5]|0)/t.subFrameRate;return(e[1]|0)*3600+(e[2]|0)*60+(e[3]|0)+i/t.frameRate}function qc(d,t){const e=ia.exec(d),i=Number(e[1]);switch(e[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}class Qc{constructor(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=en(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const e=new Ci(this,"textTrack1"),i=new Ci(this,"textTrack2"),s=new Ci(this,"textTrack3"),r=new Ci(this,"textTrack4");this.cea608Parser1=new qs(1,e,i),this.cea608Parser2=new qs(3,s,r)}t.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(w.FRAG_LOADING,this.onFragLoading,this),t.on(w.FRAG_LOADED,this.onFragLoaded,this),t.on(w.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(w.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(w.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(w.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(w.FRAG_LOADING,this.onFragLoading,this),t.off(w.FRAG_LOADED,this.onFragLoaded,this),t.off(w.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(w.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(w.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(w.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(t,e,i,s,r){let n=!1;for(let a=r.length;a--;){const l=r[a],o=Zc(l[0],l[1],e,i);if(o>=0&&(l[0]=Math.min(l[0],e),l[1]=Math.max(l[1],i),n=!0,o/(i-e)>.5))return}if(n||r.push([e,i]),this.config.renderTextTracksNatively){const a=this.captionsTracks[t];this.Cues.newCue(a,e,i,s)}else{const a=this.Cues.newCue(null,e,i,s);this.hls.trigger(w.CUES_PARSED,{type:"captions",cues:a,track:t})}}onInitPtsFound(t,{frag:e,id:i,initPTS:s,timescale:r}){const{unparsedVttFrags:n}=this;i==="main"&&(this.initPTS[e.cc]={baseTime:s,timescale:r}),n.length&&(this.unparsedVttFrags=[],n.forEach(a=>{this.onFragLoaded(w.FRAG_LOADED,a)}))}getExistingTrack(t){const{media:e}=this;if(e)for(let i=0;i<e.textTracks.length;i++){const s=e.textTracks[i];if(s[t])return s}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:i,media:s}=this,{label:r,languageCode:n}=e[t],a=this.getExistingTrack(t);if(a)i[t]=a,li(i[t]),An(i[t],s);else{const l=this.createTextTrack("captions",r,n);l&&(l[t]=!0,i[t]=l)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const i=e.label,s={_id:t,label:i,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=s,this.hls.trigger(w.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(t,e,i){const s=this.media;if(!!s)return s.addTextTrack(t,e,i)}onMediaAttaching(t,e){this.media=e.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:t}=this;Object.keys(t).forEach(e=>{li(t[e]),delete t[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=en(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let i=0;i<e.length;i++)li(e[i])}onSubtitleTracksUpdated(t,e){const i=e.subtitleTracks||[],s=i.some(r=>r.textCodec===vr);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(qn(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const n=this.media?this.media.textTracks:null;this.tracks.forEach((a,l)=>{let o;if(n&&l<n.length){let c=null;for(let u=0;u<n.length;u++)if(Xc(n[u],a)){c=n[u];break}c&&(o=c)}if(o)li(o);else{const c=this._captionsOrSubtitlesFromCharacteristics(a);o=this.createTextTrack(c,a.name,a.lang),o&&(o.mode="disabled")}o&&(o.groupId=a.groupId,this.textTracks.push(o))})}else if(this.tracks.length){const n=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(w.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:n})}}}_captionsOrSubtitlesFromCharacteristics(t){if(t.attrs.CHARACTERISTICS){const e=/transcribes-spoken-dialog/gi.test(t.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(t.attrs.CHARACTERISTICS);if(e&&i)return"captions"}return"subtitles"}onManifestLoaded(t,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(i=>{const s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!s)return;const r=`textTrack${s[1]}`,n=this.captionsProperties[r];!n||(n.label=i.name,i.lang&&(n.languageCode=i.lang),n.media=i)})}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return e==null?void 0:e.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,e){const{cea608Parser1:i,cea608Parser2:s,lastSn:r,lastPartIndex:n}=this;if(!(!this.enabled||!(i&&s))&&e.frag.type===xt.MAIN){var a,l;const o=e.frag.sn,c=(a=e==null||(l=e.part)==null?void 0:l.index)!=null?a:-1;o===r+1||o===r&&c===n+1||(i.reset(),s.reset()),this.lastSn=o,this.lastPartIndex=c}}onFragLoaded(t,e){const{frag:i,payload:s}=e,{initPTS:r,unparsedVttFrags:n}=this;if(i.type===xt.SUBTITLE)if(s.byteLength){if(!r[i.cc]){n.push(e),r.length&&this.hls.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")});return}const a=i.decryptdata,l="stats"in e;if(a==null||!a.encrypted||l){const o=this.tracks[i.level],c=this.vttCCs;c[i.cc]||(c[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),o&&o.textCodec===vr?this._parseIMSC1(i,s):this._parseVTTs(i,s,c)}}else this.hls.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const i=this.hls;Zs(e,this.initPTS[t.cc],s=>{this._appendCues(s,t.level),i.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},s=>{$.log(`Failed to parse IMSC1: ${s}`),i.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:s})})}_parseVTTs(t,e,i){var s;const r=this.hls,n=(s=t.initSegment)!=null&&s.data?ii(t.initSegment.data,new Uint8Array(e)):e;zc(n,this.initPTS[t.cc],i,t.cc,t.start,a=>{this._appendCues(a,t.level),r.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},a=>{this._fallbackToIMSC1(t,e),$.log(`Failed to parse VTT cue: ${a}`),r.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:a})})}_fallbackToIMSC1(t,e){const i=this.tracks[t.level];i.textCodec||Zs(e,this.initPTS[t.cc],()=>{i.textCodec=vr,this._parseIMSC1(t,e)},()=>{i.textCodec="wvtt"})}_appendCues(t,e){const i=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[e];if(!s||s.mode==="disabled")return;t.forEach(r=>Ln(s,r))}else{const s=this.tracks[e];if(!s)return;const r=s.default?"default":"subtitles"+e;i.trigger(w.CUES_PARSED,{type:"subtitles",cues:t,track:r})}}onFragDecrypted(t,e){const{frag:i}=e;if(i.type===xt.SUBTITLE){if(!this.initPTS[i.cc]){this.unparsedVttFrags.push(e);return}this.onFragLoaded(w.FRAG_LOADED,e)}}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,e){const{cea608Parser1:i,cea608Parser2:s}=this;if(!this.enabled||!(i&&s))return;const{frag:r,samples:n}=e;if(!(r.type===xt.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let a=0;a<n.length;a++){const l=n[a].bytes;if(l){const o=this.extractCea608Data(l);i.addData(n[a].pts,o[0]),s.addData(n[a].pts,o[1])}}}onBufferFlushing(t,{startOffset:e,endOffset:i,endOffsetSubtitles:s,type:r}){const{media:n}=this;if(!(!n||n.currentTime<i)){if(!r||r==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>Ar(a[l],e,i))}if(this.config.renderTextTracksNatively&&e===0&&s!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>Ar(a[l],e,s))}}}extractCea608Data(t){const e=[[],[]],i=t[0]&31;let s=2;for(let r=0;r<i;r++){const n=t[s++],a=127&t[s++],l=127&t[s++];if(a===0&&l===0)continue;if((4&n)!==0){const c=3&n;(c===0||c===1)&&(e[c].push(a),e[c].push(l))}}return e}}function Xc(d,t){return!!d&&d.label===t.name&&!(d.textTrack1||d.textTrack2)}function Zc(d,t,e,i){return Math.min(t,i)-Math.max(d,e)}function en(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class Wr{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(w.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(w.MANIFEST_PARSED,this.onManifestParsed,this),t.on(w.BUFFER_CODECS,this.onBufferCodecs,this),t.on(w.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(w.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(w.MANIFEST_PARSED,this.onManifestParsed,this),t.off(w.BUFFER_CODECS,this.onBufferCodecs,this),t.off(w.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,e){const i=this.hls.levels[e.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null}onManifestParsed(t,e){const i=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,i.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onBufferCodecs(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const t=this.hls.levels;if(t.length){const e=this.hls;e.autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const i=e.filter((s,r)=>this.isLevelAllowed(s)&&r<=t);return this.clientRect=null,Wr.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const i=t.getBoundingClientRect();e.width=i.width,e.height=i.height,!e.width&&!e.height&&(e.width=i.right-i.left||t.width||0,e.height=i.bottom-i.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(e){}return t}isLevelAllowed(t){return!this.restrictedLevels.some(i=>t.bitrate===i.bitrate&&t.width===i.width&&t.height===i.height)}static getMaxLevelByMediaSize(t,e,i){if(!(t!=null&&t.length))return-1;const s=(n,a)=>a?n.width!==a.width||n.height!==a.height:!0;let r=t.length-1;for(let n=0;n<t.length;n+=1){const a=t[n];if((a.width>=e||a.height>=i)&&s(a,t[n+1])){r=n;break}}return r}}class Jc{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,e){const i=this.hls.config;if(i.capLevelOnFPSDrop){const s=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}checkFPS(t,e,i){const s=performance.now();if(e){if(this.lastTime){const r=s-this.lastTime,n=i-this.lastDroppedFrames,a=e-this.lastDecodedFrames,l=1e3*n/r,o=this.hls;if(o.trigger(w.FPS_DROP,{currentDropped:n,currentDecoded:a,totalDroppedFrames:i}),l>0&&n>o.config.fpsDroppedMonitoringThreshold*a){let c=o.currentLevel;$.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(o.autoLevelCapping===-1||o.autoLevelCapping>=c)&&(c=c-1,o.trigger(w.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:o.currentLevel}),o.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=e}}checkFPSInterval(){const t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){const e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}const Mi="[eme]";class ci{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=ci.CDMCleanupPromise?[ci.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=$.debug.bind($,Mi),this.log=$.log.bind($,Mi),this.warn=$.warn.bind($,Mi),this.error=$.error.bind($,Mi),this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(w.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(w.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(w.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(w.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(w.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(w.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(t){const{drmSystems:e,widevineLicenseUrl:i}=this.config,s=e[t];if(s)return s.licenseUrl;if(t===Ht.WIDEVINE&&i)return i;throw new Error(`no license server URL configured for key-system "${t}"`)}getServerCertificateUrl(t){const{drmSystems:e}=this.config,i=e[t];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const e=this.hls.levels,i=(n,a,l)=>!!n&&l.indexOf(n)===a,s=e.map(n=>n.audioCodec).filter(i),r=e.map(n=>n.videoCodec).filter(i);return s.length+r.length===0&&r.push("avc1.42e01e"),new Promise((n,a)=>{const l=o=>{const c=o.shift();this.getMediaKeysPromise(c,s,r).then(u=>n({keySystem:c,mediaKeys:u})).catch(u=>{o.length?l(o):u instanceof me?a(u):a(new me({type:Et.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_NO_ACCESS,error:u,fatal:!0},u.message))})};l(t)})}requestMediaKeySystemAccess(t,e){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return fn===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(t,e)}getMediaKeysPromise(t,e,i){const s=fo(t,e,i,this.config.drmSystemOptions),r=this.keySystemAccessPromises[t];let n=r==null?void 0:r.keySystemAccess;if(!n){this.log(`Requesting encrypted media "${t}" key-system access with config: ${JSON.stringify(s)}`),n=this.requestMediaKeySystemAccess(t,s);const a=this.keySystemAccessPromises[t]={keySystemAccess:n};return n.catch(l=>{this.log(`Failed to obtain access to key-system "${t}": ${l}`)}),n.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const o=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),a.mediaKeys=l.createMediaKeys().then(c=>(this.log(`Media-keys created for "${t}"`),o.then(u=>u?this.setMediaKeysServerCertificate(c,t,u):c))),a.mediaKeys.catch(c=>{this.error(`Failed to create media-keys for "${t}"}: ${c}`)}),a.mediaKeys})}return n.then(()=>r.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:e,mediaKeys:i}){this.log(`Creating key-system session "${e}" keyId: ${we.hexDump(t.keyId||[])}`);const s=i.createSession(),r={decryptdata:t,keySystem:e,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(t){const e=t.decryptdata;if(e.pssh){const i=this.createMediaKeySessionContext(t),s=this.getKeyIdString(e),r="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,r,e.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(t.keyId===null)throw new Error("keyId is null");return we.hexDump(t.keyId)}updateKeySession(t,e){var i;const s=t.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${we.hexDump(((i=t.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${e&&e.byteLength})`),s.update(e)}selectKeySystemFormat(t){const e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(t){return new Promise((e,i)=>{const s=tr(this.config),r=t.map(hs).filter(n=>!!n&&s.indexOf(n)!==-1);return this.getKeySystemSelectionPromise(r).then(({keySystem:n})=>{const a=fs(n);a?e(a):i(new Error(`Unable to find format for key-system "${n}"`))}).catch(i)})}loadKey(t){const e=t.keyInfo.decryptdata,i=this.getKeyIdString(e),s=`(keyId: ${i} format: "${e.keyFormat}" method: ${e.method} uri: ${e.uri})`;this.log(`Starting session for key ${s}`);let r=this.keyIdToKeySessionPromise[i];return r||(r=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(e).then(({keySystem:n,mediaKeys:a})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${s}`),this.attemptSetMediaKeys(n,a).then(()=>{this.throwIfDestroyed();const l=this.createMediaKeySessionContext({keySystem:n,mediaKeys:a,decryptdata:e}),o="cenc";return this.generateRequestWithPreferredKeySession(l,o,e.pssh,"playlist-key")}))),r.catch(n=>this.handleError(n))),r}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){!this.hls||(this.error(t.message),t instanceof me?this.hls.trigger(w.ERROR,t.data):this.hls.trigger(w.ERROR,{type:Et.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){const e=this.getKeyIdString(t),i=this.keyIdToKeySessionPromise[e];if(!i){const s=hs(t.keyFormat),r=s?[s]:tr(this.config);return this.attemptKeySystemAccess(r)}return i}getKeySystemSelectionPromise(t){if(t.length||(t=tr(this.config)),t.length===0)throw new me({type:Et.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}_onMediaEncrypted(t){const{initDataType:e,initData:i}=t;if(this.debug(`"${t.type}" event: init data type: "${e}"`),i===null)return;let s,r;if(e==="sinf"&&this.config.drmSystems[Ht.FAIRPLAY]){const c=ee(new Uint8Array(i));try{const u=Pr(JSON.parse(c).sinf),h=xn(new Uint8Array(u));if(!h)return;s=h.subarray(8,24),r=Ht.FAIRPLAY}catch(u){this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const c=Fo(i);if(c===null)return;c.version===0&&c.systemId===hn.WIDEVINE&&c.data&&(s=c.data.subarray(8,24)),r=ho(c.systemId)}if(!r||!s)return;const n=we.hexDump(s),{keyIdToKeySessionPromise:a,mediaKeySessions:l}=this;let o=a[n];for(let c=0;c<l.length;c++){const u=l[c],h=u.decryptdata;if(h.pssh||!h.keyId)continue;const f=we.hexDump(h.keyId);if(n===f||h.uri.replace(/-/g,"").indexOf(n)!==-1){o=a[f],delete a[f],h.pssh=new Uint8Array(i),h.keyId=s,o=a[n]=o.then(()=>this.generateRequestWithPreferredKeySession(u,e,i,"encrypted-event-key-match"));break}}o||(o=a[n]=this.getKeySystemSelectionPromise([r]).then(({keySystem:c,mediaKeys:u})=>{var h;this.throwIfDestroyed();const f=new yi("ISO-23001-7",n,(h=fs(c))!=null?h:"");return f.pssh=new Uint8Array(i),f.keyId=s,this.attemptSetMediaKeys(c,u).then(()=>{this.throwIfDestroyed();const m=this.createMediaKeySessionContext({decryptdata:f,keySystem:c,mediaKeys:u});return this.generateRequestWithPreferredKeySession(m,e,i,"encrypted-event-no-match")})})),o.catch(c=>this.handleError(c))}_onWaitingForKey(t){this.log(`"${t.type}" event`)}attemptSetMediaKeys(t,e){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const s=Promise.all(i).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(e)});return this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${t}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>i.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(t,e,i,s){var r,n;const a=(r=this.config.drmSystems)==null||(n=r[t.keySystem])==null?void 0:n.generateRequest;if(a)try{const h=a.call(this.hls,e,i,t);if(!h)throw new Error("Invalid response from configured generateRequest filter");e=h.initDataType,i=t.decryptdata.pssh=h.initData?new Uint8Array(h.initData):null}catch(h){var l;if(this.warn(h.message),(l=this.hls)!=null&&l.config.debug)throw h}if(i===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(t);const o=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${s}": ${o} (init data type: ${e} length: ${i?i.byteLength:null})`);const c=new Hr;t.mediaKeysSession.onmessage=h=>{const f=t.mediaKeysSession;if(!f){c.emit("error",new Error("invalid state"));return}const{messageType:m,message:_}=h;this.log(`"${m}" message event for session "${f.sessionId}" message size: ${_.byteLength}`),m==="license-request"||m==="license-renewal"?this.renewLicense(t,_).catch(E=>{this.handleError(E),c.emit("error",E)}):m==="license-release"?t.keySystem===Ht.FAIRPLAY&&(this.updateKeySession(t,un("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${m}"`)},t.mediaKeysSession.onkeystatuseschange=h=>{if(!t.mediaKeysSession){c.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(t);const m=t.keyStatus;c.emit("keyStatus",m),m==="expired"&&(this.warn(`${t.keySystem} expired for key ${o}`),this.renewKeySession(t))};const u=new Promise((h,f)=>{c.on("error",f),c.on("keyStatus",m=>{m.startsWith("usable")?h():m==="output-restricted"?f(new me({type:Et.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):m==="internal-error"?f(new me({type:Et.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${m}"`)):m==="expired"?f(new Error("key expired while generating request")):this.warn(`unhandled key status change "${m}"`)})});return t.mediaKeysSession.generateRequest(e,i).then(()=>{var h;this.log(`Request generated for key-session "${(h=t.mediaKeysSession)==null?void 0:h.sessionId}" keyId: ${o}`)}).catch(h=>{throw new me({type:Et.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_NO_SESSION,error:h,fatal:!1},`Error generating key-session request: ${h}`)}).then(()=>u).catch(h=>{throw c.removeAllListeners(),this.removeSession(t),h}).then(()=>(c.removeAllListeners(),t))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach((e,i)=>{this.log(`key status change "${e}" for keyStatuses keyId: ${we.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${we.hexDump(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=e})}fetchServerCertificate(t){const e=this.config,i=e.loader,s=new i(e),r=this.getServerCertificateUrl(t);return r?(this.log(`Fetching serverCertificate for "${t}"`),new Promise((n,a)=>{const l={responseType:"arraybuffer",url:r},o=e.certLoadPolicy.default,c={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(h,f,m,_)=>{n(h.data)},onError:(h,f,m,_)=>{a(new me({type:Et.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:he({url:l.url,data:void 0},h)},`"${t}" certificate request failed (${r}). Status: ${h.code} (${h.text})`))},onTimeout:(h,f,m)=>{a(new me({type:Et.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:l.url,data:void 0}},`"${t}" certificate request timed out (${r})`))},onAbort:(h,f,m)=>{a(new Error("aborted"))}};s.load(l,c,u)})):Promise.resolve()}setMediaKeysServerCertificate(t,e,i){return new Promise((s,r)=>{t.setServerCertificate(i).then(n=>{this.log(`setServerCertificate ${n?"success":"not supported by CDM"} (${i==null?void 0:i.byteLength}) on "${e}"`),s(t)}).catch(n=>{r(new me({type:Et.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:n,fatal:!0},n.message))})})}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then(i=>this.updateKeySession(t,new Uint8Array(i)).catch(s=>{throw new me({type:Et.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}setupLicenseXHR(t,e,i,s){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return r.call(this.hls,t,e,i,s)}).catch(n=>{if(!i.decryptdata)throw n;return t.open("POST",e,!0),r.call(this.hls,t,e,i,s)}).then(n=>(t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:n||s})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:s}))}requestLicense(t,e){const i=this.config.keyLoadPolicy.default;return new Promise((s,r)=>{const n=this.getLicenseServerUrl(t.keySystem);this.log(`Sending license request to URL: ${n}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return r(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const o=this.config.licenseResponseCallback;if(o)try{l=o.call(this.hls,a,n,t)}catch(c){this.error(c)}s(l)}else{const l=i.errorRetry,o=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>o||a.status>=400&&a.status<500)r(new me({type:Et.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:n,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${n}). Status: ${a.status} (${a.statusText})`));else{const c=o-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(t,e).then(s,r)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=a,this.setupLicenseXHR(a,n,t,e).then(({xhr:l,licenseChallenge:o})=>{l.send(o)})})}onMediaAttached(t,e){if(!this.config.emeEnabled)return;const i=e.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const t=this.media,e=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},yi.clearKeyUriToKeyIdMap();const i=e.length;ci.CDMCleanupPromise=Promise.all(e.map(s=>this.removeSession(s)).concat(t==null?void 0:t.setMediaKeys(null).catch(s=>{this.log(`Could not clear media keys: ${s}. media.src: ${t==null?void 0:t.src}`)}))).then(()=>{i&&(this.log("finished closing key sessions and clearing media keys"),e.length=0)}).catch(s=>{this.log(`Could not close sessions and clear media keys: ${s}. media.src: ${t==null?void 0:t.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:e}){if(!(!e||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=e.reduce((s,r)=>(s.indexOf(r.keyFormat)===-1&&s.push(r.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(t){const{mediaKeysSession:e,licenseXhr:i}=t;if(e){this.log(`Remove licenses and keys and close session ${e.sessionId}`),e.onmessage=null,e.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(t);return s>-1&&this.mediaKeySessions.splice(s,1),e.remove().catch(r=>{this.log(`Could not remove session: ${r}`)}).then(()=>e.close()).catch(r=>{this.log(`Could not close session: ${r}`)})}}}ci.CDMCleanupPromise=void 0;class me extends Error{constructor(t,e){super(e),this.data=void 0,t.error||(t.error=new Error(e)),this.data=t,t.err=t.error}}const td=1;var le={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"};const ed="h";class qe{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:le.MANIFEST,su:!this.initialized})}catch(r){$.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=s=>{try{const r=s.frag,n=this.hls.levels[r.level],a=this.getObjectType(r),l={d:r.duration*1e3,ot:a};(a===le.VIDEO||a===le.AUDIO||a==le.MUXED)&&(l.br=n.bitrate/1e3,l.tb=this.getTopBandwidth(a)/1e3,l.bl=this.getBufferLength(a)),this.apply(s,l)}catch(r){$.warn("Could not generate segment CMCD data.",r)}},this.hls=t;const e=this.config=t.config,{cmcd:i}=e;i!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||qe.uuid(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.registerListeners())}registerListeners(){const t=this.hls;t.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(w.MEDIA_DETACHED,this.onMediaDetached,this),t.on(w.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(w.MEDIA_DETACHED,this.onMediaDetached,this),t.off(w.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,e){var i,s;this.audioBuffer=(i=e.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=e.tracks.video)==null?void 0:s.buffer}createData(){var t;return{v:td,sf:ed,sid:this.sid,cid:this.cid,pr:(t=this.media)==null?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,e={}){Zt(e,this.createData());const i=e.ot===le.INIT||e.ot===le.VIDEO||e.ot===le.MUXED;if(this.starved&&i&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering),this.useHeaders){const s=qe.toHeaders(e);if(!Object.keys(s).length)return;t.headers||(t.headers={}),Zt(t.headers,s)}else{const s=qe.toQuery(e);if(!s)return;t.url=qe.appendQueryToUri(t.url,s)}}getObjectType(t){const{type:e}=t;if(e==="subtitle")return le.TIMED_TEXT;if(t.sn==="initSegment")return le.INIT;if(e==="audio")return le.AUDIO;if(e==="main")return this.hls.audioTracks.length?le.VIDEO:le.MUXED}getTopBandwidth(t){let e=0,i;const s=this.hls;if(t===le.AUDIO)i=s.audioTracks;else{const r=s.maxAutoLevel,n=r>-1?r+1:s.levels.length;i=s.levels.slice(0,n)}for(const r of i)r.bitrate>e&&(e=r.bitrate);return e>0?e:NaN}getBufferLength(t){const e=this.hls.media,i=t===le.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!e?NaN:Ut.bufferInfo(i,e.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,i=t||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new i(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,n,a){e(r),this.loader.load(r,n,a)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,i=t||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new i(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,n,a){e(r),this.loader.load(r,n,a)}}}static uuid(){const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}static serialize(t){const e=[],i=o=>!Number.isNaN(o)&&o!=null&&o!==""&&o!==!1,s=o=>Math.round(o),r=o=>s(o/100)*100,a={br:s,d:s,bl:r,dl:r,mtp:r,nor:o=>encodeURIComponent(o),rtp:r,tb:s},l=Object.keys(t||{}).sort();for(const o of l){let c=t[o];if(!i(c)||o==="v"&&c===1||o=="pr"&&c===1)continue;const u=a[o];u&&(c=u(c));const h=typeof c;let f;o==="ot"||o==="sf"||o==="st"?f=`${o}=${c}`:h==="boolean"?f=o:h==="number"?f=`${o}=${c}`:f=`${o}=${JSON.stringify(c)}`,e.push(f)}return e.join(",")}static toHeaders(t){const e=Object.keys(t),i={},s=["Object","Request","Session","Status"],r=[{},{},{},{}],n={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const a of e){const l=n[a]!=null?n[a]:1;r[l][a]=t[a]}for(let a=0;a<r.length;a++){const l=qe.serialize(r[a]);l&&(i[`CMCD-${s[a]}`]=l)}return i}static toQuery(t){return`CMCD=${encodeURIComponent(qe.serialize(t))}`}static appendQueryToUri(t,e){if(!e)return t;const i=t.includes("?")?"&":"?";return`${t}${i}${e}`}}const id=3e5;class rd{constructor(t){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.log=$.log.bind($,"[content-steering]:"),this.registerListeners()}registerListeners(){const t=this.hls;t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(w.MANIFEST_PARSED,this.onManifestParsed,this),t.on(w.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;!t||(t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(w.MANIFEST_PARSED,this.onManifestParsed,this),t.off(w.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const t=Math.max(this.timeToLoad*1e3-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,t)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter(i=>i!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,e){const{contentSteering:i}=e;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(t,e){const{errorAction:i}=e;if((i==null?void 0:i.action)===de.SendAlternateToPenaltyBox&&i.flags===Se.MoveAllAlternatesMatchingHost){let s=this.pathwayPriority;const r=this.pathwayId;this.penalizedPathways[r]||(this.penalizedPathways[r]=performance.now()),!s&&this.levels&&(s=this.levels.reduce((n,a)=>(n.indexOf(a.pathwayId)===-1&&n.push(a.pathwayId),n),[])),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==r)}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(e.length===0){const i=t[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),e=this.getLevelsForPathway(i),this.pathwayId=i}return e.length!==t.length?(this.log(`Found ${e.length}/${t.length} levels in Pathway "${this.pathwayId}"`),e):t}getLevelsForPathway(t){return this.levels===null?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){this.pathwayPriority=t;let e;const i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(r=>{s-i[r]>id&&delete i[r]});for(let r=0;r<t.length;r++){const n=t[r];if(i[n])continue;if(n===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(e=this.getLevelsForPathway(n),e.length>0){this.log(`Setting Pathway to "${n}"`),this.pathwayId=n,this.hls.trigger(w.LEVELS_UPDATED,{levels:e});const o=this.hls.levels[a];l&&o&&this.levels&&(o.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&o.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${o.bitrate}`),this.hls.nextLoadLevel=a);break}}}clonePathways(t){const e=this.levels;if(!e)return;const i={},s={};t.forEach(r=>{const{ID:n,"BASE-ID":a,"URI-REPLACEMENT":l}=r;if(e.some(c=>c.pathwayId===n))return;const o=this.getLevelsForPathway(a).map(c=>{const u=Zt({},c);u.details=void 0,u.url=sa(c.uri,c.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l);const h=new $t(c.attrs);h["PATHWAY-ID"]=n;const f=h.AUDIO&&`${h.AUDIO}_clone_${n}`,m=h.SUBTITLES&&`${h.SUBTITLES}_clone_${n}`;f&&(i[h.AUDIO]=f,h.AUDIO=f),m&&(s[h.SUBTITLES]=m,h.SUBTITLES=m),u.attrs=h;const _=new _i(u);return Ui(_,"audio",f),Ui(_,"text",m),_});e.push(...o),rn(this.audioTracks,i,l,n),rn(this.subtitleTracks,s,l,n)})}loadSteeringManifest(t){const e=this.hls.config,i=e.loader;this.loader&&this.loader.destroy(),this.loader=new i(e);let s;try{s=new self.URL(t)}catch(c){this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${t}`);return}if(s.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+c)}const r={responseType:"json",url:s.href},n=e.steeringManifestLoadPolicy.default,a=n.errorRetry||n.timeoutRetry||{},l={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},o={onSuccess:(c,u,h,f)=>{this.log(`Loaded steering manifest: "${s}"`);const m=c.data;if(m.VERSION!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":_,"PATHWAY-CLONES":E,"PATHWAY-PRIORITY":D}=m;if(_)try{this.uri=new self.URL(_,s).href}catch(O){this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${_}`);return}this.scheduleRefresh(this.uri||h.url),E&&this.clonePathways(E),D&&this.updatePathwayPriority(D)},onError:(c,u,h,f)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${u.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${u.url} no longer available`);return}let m=this.timeToLoad*1e3;if(c.code===429){const _=this.loader;if(typeof(_==null?void 0:_.getResponseHeader)=="function"){const E=_.getResponseHeader("Retry-After");E&&(m=parseFloat(E)*1e3)}this.log(`Steering manifest ${u.url} rate limited`);return}this.scheduleRefresh(this.uri||u.url,m)},onTimeout:(c,u,h)=>{this.log(`Timeout loading steering manifest (${u.url})`),this.scheduleRefresh(this.uri||u.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(r,l,o)}scheduleRefresh(t,e=this.timeToLoad*1e3){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(t)},e)}}function rn(d,t,e,i){!d||Object.keys(t).forEach(s=>{const r=d.filter(n=>n.groupId===s).map(n=>{const a=Zt({},n);return a.details=void 0,a.attrs=new $t(a.attrs),a.url=a.attrs.URI=sa(n.url,n.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),a.groupId=a.attrs["GROUP-ID"]=t[s],a.attrs["PATHWAY-ID"]=i,a});d.push(...r)})}function sa(d,t,e,i){const{HOST:s,PARAMS:r,[e]:n}=i;let a;t&&(a=n==null?void 0:n[t],a&&(d=a));const l=new self.URL(d);return s&&!a&&(l.host=s),r&&Object.keys(r).sort().forEach(o=>{o&&l.searchParams.set(o,r[o])}),l.href}const sd=/^age:\s*[\d.]+\s*$/im;class na{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new Gi,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,t.readyState!==4&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t)return;const i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!this.stats.aborted)return r(i,e.url)}).catch(n=>(i.open("GET",e.url,!0),r(i,e.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(i,e,t)}).catch(n=>{this.callbacks.onError({code:i.status,text:n.message},e,i,s)}):this.openAndSendXhr(i,e,t)}openAndSendXhr(t,e,i){t.readyState||t.open("GET",e.url,!0);const s=this.context.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:n}=i.loadPolicy;if(s)for(const a in s)t.setRequestHeader(a,s[a]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),i.timeout=r&&_t(r)?r:n,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:i}=this;if(!t||!e)return;const s=e.readyState,r=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const n=e.status,a=e.responseType!=="text";if(n>=200&&n<300&&(a&&e.response||e.responseText!==null)){i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=a?e.response:e.responseText,o=e.responseType==="arraybuffer"?l.byteLength:l.length;if(i.loaded=i.total=o,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first),!this.callbacks)return;const c=this.callbacks.onProgress;if(c&&c(i,t,l,e),!this.callbacks)return;const u={url:e.responseURL,data:l,code:n};this.callbacks.onSuccess(u,i,t,e)}else{const l=r.loadPolicy.errorRetry,o=i.retry;Bi(l,o,!1,n)?this.retry(l):($.error(`${n} while loading ${t.url}`),this.callbacks.onError({code:n,text:e.statusText},t,e,i))}}}loadtimeout(){var t;const e=(t=this.config)==null?void 0:t.loadPolicy.timeoutRetry,i=this.stats.retry;if(Bi(e,i,!0))this.retry(e);else{$.warn(`timeout while loading ${this.context.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:i}=this;this.retryDelay=Nr(t,i.retry),i.retry++,$.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${e.url}, retrying ${i.retry}/${t.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&sd.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp(`^${t}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}function nd(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(d){}return!1}const ad=/(\d+)-(\d+)\/(\d+)/;class sn{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||dd,this.controller=new self.AbortController,this.stats=new Gi}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const t=this.response;t!=null&&t.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,i){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const r=od(t,this.controller.signal),n=i.onProgress,a=t.responseType==="arraybuffer",l=a?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:c}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=i,this.request=this.fetchSetup(t,r),self.clearTimeout(this.requestTimeout),e.timeout=o&&_t(o)?o:c,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(s,t,this.response)},e.timeout),self.fetch(this.request).then(u=>{this.response=this.loader=u;const h=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(s,t,this.response)},c-(h-s.loading.start)),!u.ok){const{status:f,statusText:m}=u;throw new ud(m||"fetch, bad network response",f,u)}return s.loading.first=h,s.total=cd(u.headers)||s.total,n&&_t(e.highWaterMark)?this.loadProgressively(u,s,t,e.highWaterMark,n):a?u.arrayBuffer():t.responseType==="json"?u.json():u.text()}).then(u=>{const{response:h}=this;self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const f=u[l];f&&(s.loaded=s.total=f);const m={url:h.url,data:u,code:h.status};n&&!_t(e.highWaterMark)&&n(s,t,u,h),i.onSuccess(m,s,t,h)}).catch(u=>{if(self.clearTimeout(this.requestTimeout),s.aborted)return;const h=u&&u.code||0,f=u?u.message:null;i.onError({code:h,text:f},t,u?u.details:null,s)})}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,i,s=0,r){const n=new Wn,a=t.body.getReader(),l=()=>a.read().then(o=>{if(o.done)return n.dataLength&&r(e,i,n.flush(),t),Promise.resolve(new ArrayBuffer(0));const c=o.value,u=c.length;return e.loaded+=u,u<s||n.dataLength?(n.push(c),n.dataLength>=s&&r(e,i,n.flush(),t)):r(e,i,c,t),l()}).catch(()=>Promise.reject());return l()}}function od(d,t){const e={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(Zt({},d.headers))};return d.rangeEnd&&e.headers.set("Range","bytes="+d.rangeStart+"-"+String(d.rangeEnd-1)),e}function ld(d){const t=ad.exec(d);if(t)return parseInt(t[2])-parseInt(t[1])+1}function cd(d){const t=d.get("Content-Range");if(t){const i=ld(t);if(_t(i))return i}const e=d.get("Content-Length");if(e)return parseInt(e)}function dd(d,t){return new self.Request(d.url,t)}class ud extends Error{constructor(t,e,i){super(t),this.code=void 0,this.details=void 0,this.code=e,this.details=i}}const hd=/\s/,fd={newCue(d,t,e,i){const s=[];let r,n,a,l,o;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<i.rows.length;h++)if(r=i.rows[h],a=!0,l=0,o="",!r.isEmpty()){var u;for(let _=0;_<r.chars.length;_++)hd.test(r.chars[_].uchar)&&a?l++:(o+=r.chars[_].uchar,a=!1);r.cueStartTime=t,t===e&&(e+=1e-4),l>=16?l--:l++;const f=ta(o.trim()),m=Kr(t,e,f);d!=null&&(u=d.cues)!=null&&u.getCueById(m)||(n=new c(t,e,f),n.id=m,n.line=h+1,n.align="left",n.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(n))}return d&&s.length&&(s.sort((h,f)=>h.line==="auto"||f.line==="auto"?0:h.line>8&&f.line>8?f.line-h.line:h.line-f.line),s.forEach(h=>Ln(d,h))),s}},pd={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},md=he(he({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:na,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:vc,bufferController:wc,capLevelController:Wr,errorController:ul,fpsController:Jc,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:fn,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:pd},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},gd()),{},{subtitleStreamController:bc,subtitleTrackController:Lc,timelineController:Qc,audioStreamController:xc,audioTrackController:Sc,emeController:ci,cmcdController:qe,contentSteeringController:rd});function gd(){return{cueHandler:fd,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function yd(d,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(t.liveMaxLatencyDurationCount!==void 0&&(t.liveSyncDurationCount===void 0||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(t.liveMaxLatencyDuration!==void 0&&(t.liveSyncDuration===void 0||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const e=kr(d),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(r=>{const n=`${r==="level"?"playlist":r}LoadPolicy`,a=t[n]===void 0,l=[];s.forEach(o=>{const c=`${r}Loading${o}`,u=t[c];if(u!==void 0&&a){l.push(c);const h=e[n].default;switch(t[n]={default:h},o){case"TimeOut":h.maxLoadTimeMs=u,h.maxTimeToFirstByteMs=u;break;case"MaxRetry":h.errorRetry.maxNumRetry=u,h.timeoutRetry.maxNumRetry=u;break;case"RetryDelay":h.errorRetry.retryDelayMs=u,h.timeoutRetry.retryDelayMs=u;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=u,h.timeoutRetry.maxRetryDelayMs=u;break}}}),l.length&&$.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${n}": ${JSON.stringify(t[n])}`)}),he(he({},e),t)}function kr(d){return d&&typeof d=="object"?Array.isArray(d)?d.map(kr):Object.keys(d).reduce((t,e)=>(t[e]=kr(d[e]),t),{}):d}function _d(d){const t=d.loader;t!==sn&&t!==na?($.log("[config]: Custom loader detected, cannot enable progressive streaming"),d.progressive=!1):nd()&&(d.loader=sn,d.progressive=!0,d.enableSoftwareAES=!0,$.log("[config]: Progressive streaming enabled, using FetchLoader"))}class Qe{static get version(){return"1.4.4"}static isSupported(){return Dl()}static get Events(){return w}static get ErrorTypes(){return Et}static get ErrorDetails(){return J}static get DefaultConfig(){return Qe.defaultConfig?Qe.defaultConfig:md}static set DefaultConfig(t){Qe.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Hr,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,eo(t.debug||!1,"Hls instance");const e=this.config=yd(Qe.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,e.progressive&&_d(e);const{abrController:i,bufferController:s,capLevelController:r,errorController:n,fpsController:a}=e,l=new n(this),o=this.abrController=new i(this),c=this.bufferController=new s(this),u=this.capLevelController=new r(this),h=new a(this),f=new Yo(this),m=new Xo(this),_=e.contentSteeringController,E=_?new _(this):null,D=this.levelController=new fl(this,E),O=new pl(this),I=new gl(this.config),x=this.streamController=new yc(this,O,I);u.setStreamController(x),h.setStreamController(x);const P=[f,D,x];E&&P.splice(1,0,E),this.networkControllers=P;const C=[o,c,u,h,m,O];this.audioTrackController=this.createController(e.audioTrackController,P);const b=e.audioStreamController;b&&P.push(new b(this,O,I)),this.subtitleTrackController=this.createController(e.subtitleTrackController,P);const S=e.subtitleStreamController;S&&P.push(new S(this,O,I)),this.createController(e.timelineController,C),I.emeController=this.emeController=this.createController(e.emeController,C),this.cmcdController=this.createController(e.cmcdController,C),this.latencyController=this.createController(Zo,C),this.coreComponents=C,P.push(l);const L=l.onErrorOut;typeof L=="function"&&this.on(w.ERROR,L,l)}createController(t,e){if(t){const i=new t(this);return e&&e.push(i),i}return null}on(t,e,i=this){this._emitter.on(t,e,i)}once(t,e,i=this){this._emitter.once(t,e,i)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e,i=this,s){this._emitter.off(t,e,i,s)}listeners(t){return this._emitter.listeners(t)}emit(t,e,i){return this._emitter.emit(t,e,i)}trigger(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(i){$.error("An internal error happened while handling event "+t+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(w.ERROR,{type:Et.OTHER_ERROR,details:J.INTERNAL_EXCEPTION,fatal:!1,event:t,error:i})}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){$.log("destroy"),this.trigger(w.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){$.log("attachMedia"),this._media=t,this.trigger(w.MEDIA_ATTACHING,{media:t})}detachMedia(){$.log("detachMedia"),this.trigger(w.MEDIA_DETACHING,void 0),this._media=null}loadSource(t){this.stopLoad();const e=this.media,i=this.url,s=this.url=Mr.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});$.log(`loadSource:${s}`),e&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(w.MANIFEST_LOADING,{url:t})}startLoad(t=-1){$.log(`startLoad(${t})`),this.networkControllers.forEach(e=>{e.startLoad(t)})}stopLoad(){$.log("stopLoad"),this.networkControllers.forEach(t=>{t.stopLoad()})}swapAudioCodec(){$.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){$.log("recoverMediaError");const t=this._media;this.detachMedia(),t&&this.attachMedia(t)}removeLevel(t,e=0){this.levelController.removeLevel(t,e)}get levels(){const t=this.levelController.levels;return t||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){$.log(`set currentLevel:${t}`),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){$.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){$.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){$.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){return this.levelController.startLevel}set startLevel(t){$.log(`set startLevel:${t}`),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&($.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){Ir.indexOf(t)>-1&&(this._maxHdcpLevel=t)}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:e}}=this;if(!t)return 0;const i=t.length;for(let s=0;s<i;s++)if(t[s].maxBitrate>=e)return s;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:e,maxHdcpLevel:i}=this;let s;if(e===-1&&t&&t.length?s=t.length-1:s=e,i)for(let r=s;r--;){const n=t[r].attrs["HDCP-LEVEL"];if(n&&n<=i)return r}return s}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const e=this.audioTrackController;e&&(e.audioTrack=t)}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return t?t.subtitleDisplay:!1}set subtitleDisplay(t){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Qe.defaultConfig=void 0;const Ce=d=>(xa("data-v-5527297c"),d=d(),Sa(),d),vd=Ce(()=>zt("div",{class:"artplayer-app"},null,-1)),Ed={key:0,class:"zfile-video-switch-tools"},xd=Ce(()=>zt("img",{src:Ra,alt:"\u4E0B\u8F7D"},null,-1)),Sd=Ce(()=>zt("img",{src:Da,alt:"\u8FC5\u96F7"},null,-1)),Td=Ce(()=>zt("img",{src:Ca,alt:"motrix"},null,-1)),bd=Ce(()=>zt("img",{src:ka,alt:"PotPlayer"},null,-1)),Ad=Ce(()=>zt("img",{src:Ma,alt:"IINA"},null,-1)),Ld=Ce(()=>zt("img",{src:Pa,alt:"VLC"},null,-1)),Id=Ce(()=>zt("img",{src:Oa,alt:"nPlayer"},null,-1)),wd=Ce(()=>zt("img",{src:Na,alt:"MXPlayer(Free)"},null,-1)),Rd=Ce(()=>zt("img",{src:Fa,alt:"MXPlayer(Pro)"},null,-1)),Dd={__name:"VideoPlayer",setup(d){let t=Ia();ga();let{getPathPwd:e}=La(),{currentPath:i,storageKey:s}=ya(),r=Ta(),n=ba();const a=A=>{let U=[];return r.filterFileByType("video").forEach(B=>{U.push({default:B.name===A,html:B.name,url:B.url})}),U};let l=_a(null);const o=A=>{switch(A){case"download":window.location=l.value.url;break;case"thunder":window.location=`thunder://${btoa("AA"+l.value.url+"ZZ")}`;break;case"motrix":window.location=`motrix://new-task?uri=${encodeURIComponent(l.value.url)}&out=${encodeURIComponent(l.value.name)}`;break;case"potplayer":window.location=`potplayer://${l.value.url}`;break;case"iina":window.location=`iina://weblink?url=${encodeURIComponent(l.value.url)}`;break;case"vlc":window.location=`vlc://${l.value.url}`;break;case"nplayer":window.location=`nplayer-${l.value.url}`;break;case"mxplayer":window.location="intent:"+l.value.url+"#Intent;package=com.mxtech.videoplayer.ad;S.title="+l.value.name+";end";break;case"mxplayer-pro":window.location="intent:"+l.value.url+"#Intent;package=com.mxtech.videoplayer.pro;S.title="+l.value.name+";end";break}},c=A=>{let U=r.filterFileByType("video");u();for(let B=0;B<U.length;B++)if(U[B].name===A)return{prev:U[B-1]||null,next:U[B+1]||null}},u=()=>{let A=JSON.parse(localStorage.getItem("_h5_player_play_progress_"));if(A){for(let U of Object.keys(A))U.endsWith(A[U].progress)&&delete A[U];localStorage.setItem("_h5_player_play_progress_",JSON.stringify(A))}},h=A=>{let U=[];return r.fileList.find(B=>{let G=A.split(".")[0],Q=B.name;(Q===A+".vtt"||Q===A+".srt"||Q===A+".ass"||Q===G+".vtt"||Q===G+".srt"||Q===G+".ass")&&U.push({default:U.length===0,url:B.url,html:Q})}),U.length>0&&U.push({url:"",html:"\u5173\u95ED\u5B57\u5E55"}),U};let f='<i class="art-icon art-icon-not-hidden"><svg t="1662978336444" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="968" width="128" height="128"><path d="M711.456 377.184c32.736 31.52 60.928 72.256 84.64 122.208a40.64 40.64 0 0 1 0 34.72c-63.776 135.04-160.48 202.528-290.112 202.528-46.752 0-89.248-8.832-127.456-26.464l37.184-37.184c27.52 10.048 57.6 15.104 90.272 15.104 108.864 0 188.48-55.168 244.608-171.296-21.088-43.584-45.44-78.56-73.44-105.28l34.304-34.336z m13.024-122.816l28.768 28.8a5.376 5.376 0 0 1 0 7.616L272.96 771.04a5.408 5.408 0 0 1-7.648 0l-28.8-28.8a5.376 5.376 0 0 1 0-7.616l71.36-71.36c-35.84-32.384-66.56-75.392-92.032-129.088a40.64 40.64 0 0 1 0-34.72C279.68 364.48 376.384 296.96 505.984 296.96c50.752 0 96.448 10.4 137.12 31.168l73.76-73.728a5.376 5.376 0 0 1 7.616 0z m-218.496 91.136c-108.8 0-188.416 55.168-244.608 171.296 22.944 47.36 49.792 84.608 80.928 112.096l56.256-56.256a118.688 118.688 0 0 1 160.576-160.576l47.424-47.424c-30.336-12.832-63.776-19.136-100.576-19.136z m-70.016 137.088a75.616 75.616 0 0 0-4.64 57.28l95.04-95.04a75.616 75.616 0 0 0-90.4 37.76z m60.416 109.504a75.456 75.456 0 0 0 82.144-82.112l35.616-35.616a118.72 118.72 0 0 1-153.376 153.344l35.616-35.616z" p-id="969"></path></svg></i>',m='<i class="art-icon art-icon-hidden"><svg t="1662978261880" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4451" width="128" height="128"><path d="M512.032 648a136.128 136.128 0 0 1-136-136c0-74.976 60.992-136 136-136s136 61.024 136 136a136.128 136.128 0 0 1-136 136z m0-224c-48.544 0-88 39.456-88 88s39.456 88 88 88 88-39.456 88-88-39.456-88-88-88z" p-id="4452"></path><path d="M512.032 743.616a327.68 327.68 0 0 1-231.872-95.616L142.88 512l137.28-136a327.68 327.68 0 0 1 231.872-95.584c87.328 0 169.664 33.952 231.872 95.584l137.28 136-137.28 136a327.52 327.52 0 0 1-231.872 95.616zM206.528 512l107.424 101.952c53.152 52.672 123.488 81.696 198.048 81.696s144.896-29.024 198.08-81.696L817.536 512l-107.424-101.952c-53.152-52.672-123.488-81.696-198.048-81.696s-144.896 29.024-198.08 81.696L206.528 512z" p-id="4453"></path></svg></i>',_='<i class="art-icon art-icon-video-list"><svg t="1650551038453" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12028" width="20" height="20"><path d="M111.395066 179.64038l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12029"></path><path d="M111.395066 468.067418l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12030"></path><path d="M111.395066 756.493433l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12031"></path></svg></i>',E=`<i class="art-icon art-icon-subtitle"><svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 48 48">
    <path d="M0 0h48v48H0z" fill="none"></path>
    <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>
</svg></i>`,D='<i class="art-icon art-icon-next-video"><svg height="25" width="25"  viewBox="0 0 22 22"><path d="M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"></path></svg></i>',O='<i class="art-icon art-icon-prev-video" style="transform: scale(-1,1);"><svg height="25" width="25"  viewBox="0 0 22 22"><path d="M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"></path></svg></i>';const I=Zi("zfile-video-auto-player-next",!1),x=Zi("zfile-video-auto-player",!1),P=Zi("zfile-video-hiddle-tools",!1);let C=null;const b=(A,U)=>ne(this,null,function*(){var R;l.value={name:A,url:U},document.querySelector(".zfile-video-dialog .el-dialog__title").innerHTML=A,C&&C.destroy();let B="mp4";A.toLowerCase().endsWith("flv")?B="flv":A.toLowerCase().endsWith("m3u8")&&(B="m3u8"),t.removeDuplicateSeparator(`${i.value}/${A}`);let G=t.removeDuplicateSeparator(`${i.value}/__${A}__/video.m3u8`),Q={storageKey:s.value,path:G,password:e()},nt=yield Aa(Q);((R=nt==null?void 0:nt.data)==null?void 0:R.code)===0&&(console.log("\u68C0\u6D4B\u5230\u5F53\u524D\u4E3A h5ai_dplayer \u517C\u5BB9\u6A21\u5F0F, \u66FF\u6362\u64AD\u653E\u6587\u4EF6\u4E3A: "+G),B="m3u8");let ot={container:".artplayer-app",title:A,url:l.value.url,type:B,setting:!0,playbackRate:!0,flip:!0,fullscreen:!0,fastForward:!0,autoOrientation:!0,aspectRatio:!0,fullscreenWeb:!0,theme:"#23ade5",lock:!0,subtitleOffset:!0,miniProgressBar:!0,autoplay:x.value,whitelist:["*"],airplay:!0,moreVideoAttr:{"x5-video-player-type":"h5","x5-video-player-fullscreen":!1,"x5-video-orientation":"portraint",preload:"metadata",crossOrigin:"anonymous"},customType:{flv:function(N,j){if(cs.isSupported()){const X=cs.createPlayer({type:"flv",url:j});X.attachMediaElement(N),X.load()}else C.notice.show="\u4E0D\u652F\u6301\u64AD\u653E\u683C\u5F0F\uFF1Aflv"},m3u8:function(N,j){if(Qe.isSupported()){const X=new Qe({xhrSetup:(rt,lt)=>{let Tt=lt.substring(lt.lastIndexOf("/")+1);if(lt!==j){let wt=r.getFileUrlByName(Tt);wt?rt.open("GET",wt,!0):rt.open("GET",lt,!0)}}});X.loadSource(j),X.attachMedia(N)}else{const X=N.canPlayType("application/vnd.apple.mpegurl");X==="probably"||X=="maybe"?N.src=j:C.notice.show="\u4E0D\u652F\u6301\u64AD\u653E\u683C\u5F0F\uFF1Am3u8"}}},contextmenu:[{html:"\u4E0B\u8F7D",click:function(){window.open(U)}}],settings:[{html:"\u81EA\u52A8\u64AD\u653E",tooltip:x.value?"\u5F00\u542F":"\u5173\u95ED",icon:'<img width="22" heigth="22" src="data:image/svg+xml;base64,Cjxzdmcgdmlld0JveD0iMCAwIDgwIDgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48cGF0aCBpZD0icGlkLTY0LXN2Z28tYSIgZD0iTTAgMGg4MHY4MEgweiI+PC9wYXRoPjxwYXRoIGQ9Ik01Mi41NDYgOC4wMTRhMy45OTggMy45OTggMCAwMTQuMjIyIDMuMDc3Yy4xMDQuNDQ2LjA5My44MDguMDM5IDEuMTM4YTIuNzQgMi43NCAwIDAxLS4zMTIuODgxYy0uMDczLjEzMi0uMTYuMjU0LS4yNDYuMzc2bC0uMjU3LjM2Ni0uNTIxLjczYy0uNy45NjktMS40MTUgMS45MjYtMi4xNTQgMi44NjZsLS4wMTUuMDJhMjQwLjk0NSAyNDAuOTQ1IDAgMDE1Ljk4Ni4zNDFsMS42NDMuMTIzLjgyMi4wNjYuNDEuMDM0LjIwNi4wMTguMTAzLjAwOC4xMTUuMDEyYzEuMjY2LjExNiAyLjUxNi40NSAzLjY3Ny45NzVhMTEuNjYzIDExLjY2MyAwIDAxMy4xNjYgMi4xMTRjLjkzMS44NyAxLjcxOSAxLjg5NSAyLjMyMSAzLjAyMmExMS41OTUgMTEuNTk1IDAgMDExLjIyNCAzLjYxM2MuMDMuMTU3LjA0Ni4zMTYuMDY4LjQ3NGwuMDE1LjExOS4wMTMuMTEyLjAyMi4yMDYuMDg1LjgyMi4xNTkgMS42NDZjLjEgMS4wOTguMTkgMi4xOTguMjcgMy4yOTguMzE1IDQuNC40NjMgOC44MjkuMzYgMTMuMjU1YTE2Ni40ODkgMTY2LjQ4OSAwIDAxLS44NDMgMTMuMjEzYy0uMDEyLjEyNy0uMDM0LjI5Ny0uMDUzLjQ1NGE3LjU4OSA3LjU4OSAwIDAxLS4wNzIuNDc1bC0uMDQuMjM3LS4wNS4yMzZhMTEuNzYyIDExLjc2MiAwIDAxLS43NCAyLjI4NyAxMS43NTUgMTEuNzU1IDAgMDEtNS4xMTggNS41NyAxMS43MDUgMTEuNzA1IDAgMDEtMy42MjMgMS4yNjNjLS4xNTguMDI0LS4zMTYuMDUyLS40NzUuMDcybC0uNDc3LjA1My0uODIxLjA3MS0xLjY0NC4xMzRjLTEuMDk2LjA4Ni0yLjE5Mi4xNi0zLjI4OC4yM2EyNjAuMDggMjYwLjA4IDAgMDEtNi41NzguMzI1Yy04Ljc3Mi4zMjQtMTcuNTQ2LjIyLTI2LjMxMy0uMzAyYTI0Mi40NTggMjQyLjQ1OCAwIDAxLTMuMjg3LS4yMmwtMS42NDMtLjEyOS0uODIyLS4wNjktLjQxLS4wMzUtLjIwNi0uMDE4Yy0uMDY4LS4wMDYtLjEzMy0uMDEtLjIxOC0uMDJhMTEuNTY2IDExLjU2NiAwIDAxLTMuNy0uOTkyIDExLjczMiAxMS43MzIgMCAwMS01LjQ5Ny01LjE3OCAxMS43MyAxMS43MyAwIDAxLTEuMjE1LTMuNjI3Yy0uMDI0LS4xNTgtLjA1MS0uMzE2LS4wNjctLjQ3NWwtLjAyNi0uMjM4LS4wMTMtLjExOS0uMDEtLjEwMy0uMDctLjgyMy0uMTMyLTEuNjQ4YTE5MC42MzcgMTkwLjYzNyAwIDAxLS4yMi0zLjI5OGMtLjI1Ni00LjM5OS0uMzU4LTguODE3LS4yNTgtMTMuMjMzLjA5OS00LjQxMi4zNzItOC44MTEuNzg4LTEzLjE5N2ExMS42NSAxMS42NSAwIDAxMy4wMzktNi44MzUgMTEuNTg1IDExLjU4NSAwIDAxNi41NzItMy41NjNjLjE1Ny0uMDIzLjMxMi0uMDUxLjQ3LS4wN2wuNDctLjA1LjgyLS4wNyAxLjY0My0uMTNhMjI4LjQ5MyAyMjguNDkzIDAgMDE2LjY0Ny0uNDA1bC0uMDQxLS4wNWE4OC4xNDUgODguMTQ1IDAgMDEtMi4xNTQtMi44NjdsLS41Mi0uNzMtLjI1OC0uMzY2Yy0uMDg2LS4xMjItLjE3My0uMjQ0LS4yNDYtLjM3NmEyLjc0IDIuNzQgMCAwMS0uMzEyLS44ODEgMi44MDggMi44MDggMCAwMS4wNC0xLjEzOCAzLjk5OCAzLjk5OCAwIDAxNC4yMi0zLjA3NyAyLjggMi44IDAgMDExLjA5My4zMTNjLjI5NC4xNTUuNTM4LjM0Ny43NDIuNTY4LjEwMi4xMS4xOS4yMy4yOC4zNWwuMjcuMzU5LjUzMi43MmE4OC4wNTkgODguMDU5IDAgMDEyLjA2IDIuOTM2IDczLjAzNiA3My4wMzYgMCAwMTEuOTI5IDMuMDNjLjE4Ny4zMTMuMzczLjYyOC41NTYuOTQ1IDIuNzI0LS4wNDcgNS40NDctLjA1NiA4LjE3LS4wMzguNzQ4LjAwNiAxLjQ5Ni4wMTUgMi4yNDQuMDI2LjE4LS4zMTMuMzY0LS42MjQuNTQ5LS45MzRhNzMuMjgxIDczLjI4MSAwIDAxMS45My0zLjAzIDg4LjczNyA4OC43MzcgMCAwMTIuMDU5LTIuOTM1bC41MzMtLjcyLjI2OC0uMzU5Yy4wOS0uMTIuMTc5LS4yNC4yODEtLjM1YTIuOCAyLjggMCAwMTEuODM0LS44ODF6TTMwLjEzIDM0LjYzMWE0IDQgMCAwMC0uNDE4IDEuNDIgOTEuMTU3IDkxLjE1NyAwIDAwLS40NDYgOS4xMjhjMCAyLjgyOC4xMjEgNS42NTYuMzY0IDguNDgzbC4xMSAxLjIxMmE0IDQgMCAwMDUuODU4IDMuMTQzYzIuODItMS40OTggNS41NS0zLjAzMyA4LjE5My00LjYwNmExNzcuNDEgMTc3LjQxIDAgMDA1Ljg5Ni0zLjY2NmwxLjQzNC0uOTQyYTQgNCAwIDAwLjA0Ny02LjYzMiAxMzcuNzAzIDEzNy43MDMgMCAwMC03LjM3Ny00LjcwOCAxNDYuODggMTQ2Ljg4IDAgMDAtNi44NzktMy44NDlsLTEuNC0uNzI1YTQgNCAwIDAwLTUuMzgyIDEuNzQyeiIgaWQ9InBpZC02NC1zdmdvLWQiPjwvcGF0aD48ZmlsdGVyIHg9Ii0xNS40JSIgeT0iLTE2LjMlIiB3aWR0aD0iMTMwLjklIiBoZWlnaHQ9IjEzMi41JSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBpZD0icGlkLTY0LXN2Z28tYyI+PGZlT2Zmc2V0IGR5PSIyIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIj48L2ZlT2Zmc2V0PjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjEiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMSI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMyAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMSIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjEiPjwvZmVDb2xvck1hdHJpeD48ZmVPZmZzZXQgaW49IlNvdXJjZUFscGhhIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMiI+PC9mZU9mZnNldD48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIzLjUiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjIiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMiI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMiAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMiIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjIiPjwvZmVDb2xvck1hdHJpeD48ZmVNZXJnZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMSI+PC9mZU1lcmdlTm9kZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMiI+PC9mZU1lcmdlTm9kZT48L2ZlTWVyZ2U+PC9maWx0ZXI+PC9kZWZzPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgb3BhY2l0eT0iLjgiPjxtYXNrIGlkPSJwaWQtNjQtc3Znby1iIiBmaWxsPSIjZmZmIj48dXNlIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1hIj48L3VzZT48L21hc2s+PGcgbWFzaz0idXJsKCNwaWQtNjQtc3Znby1iKSI+PHVzZSBmaWxsPSIjMDAwIiBmaWx0ZXI9InVybCgjcGlkLTY0LXN2Z28tYykiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48L2c+PC9nPjwvc3ZnPg==">',switch:x.value,onSwitch:function(N,j,X){const rt=!N.switch;return x.value=rt,C.autoplay=rt,N.tooltip=rt?"\u5F00\u542F":"\u5173\u95ED",rt}},{html:"\u81EA\u52A8\u64AD\u653E\u4E0B\u4E00\u4E2A\u89C6\u9891",tooltip:I.value?"\u5F00\u542F":"\u5173\u95ED",icon:'<img width="22" heigth="22" src="data:image/svg+xml;base64,Cjxzdmcgdmlld0JveD0iMCAwIDgwIDgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48cGF0aCBpZD0icGlkLTY0LXN2Z28tYSIgZD0iTTAgMGg4MHY4MEgweiI+PC9wYXRoPjxwYXRoIGQ9Ik01Mi41NDYgOC4wMTRhMy45OTggMy45OTggMCAwMTQuMjIyIDMuMDc3Yy4xMDQuNDQ2LjA5My44MDguMDM5IDEuMTM4YTIuNzQgMi43NCAwIDAxLS4zMTIuODgxYy0uMDczLjEzMi0uMTYuMjU0LS4yNDYuMzc2bC0uMjU3LjM2Ni0uNTIxLjczYy0uNy45NjktMS40MTUgMS45MjYtMi4xNTQgMi44NjZsLS4wMTUuMDJhMjQwLjk0NSAyNDAuOTQ1IDAgMDE1Ljk4Ni4zNDFsMS42NDMuMTIzLjgyMi4wNjYuNDEuMDM0LjIwNi4wMTguMTAzLjAwOC4xMTUuMDEyYzEuMjY2LjExNiAyLjUxNi40NSAzLjY3Ny45NzVhMTEuNjYzIDExLjY2MyAwIDAxMy4xNjYgMi4xMTRjLjkzMS44NyAxLjcxOSAxLjg5NSAyLjMyMSAzLjAyMmExMS41OTUgMTEuNTk1IDAgMDExLjIyNCAzLjYxM2MuMDMuMTU3LjA0Ni4zMTYuMDY4LjQ3NGwuMDE1LjExOS4wMTMuMTEyLjAyMi4yMDYuMDg1LjgyMi4xNTkgMS42NDZjLjEgMS4wOTguMTkgMi4xOTguMjcgMy4yOTguMzE1IDQuNC40NjMgOC44MjkuMzYgMTMuMjU1YTE2Ni40ODkgMTY2LjQ4OSAwIDAxLS44NDMgMTMuMjEzYy0uMDEyLjEyNy0uMDM0LjI5Ny0uMDUzLjQ1NGE3LjU4OSA3LjU4OSAwIDAxLS4wNzIuNDc1bC0uMDQuMjM3LS4wNS4yMzZhMTEuNzYyIDExLjc2MiAwIDAxLS43NCAyLjI4NyAxMS43NTUgMTEuNzU1IDAgMDEtNS4xMTggNS41NyAxMS43MDUgMTEuNzA1IDAgMDEtMy42MjMgMS4yNjNjLS4xNTguMDI0LS4zMTYuMDUyLS40NzUuMDcybC0uNDc3LjA1My0uODIxLjA3MS0xLjY0NC4xMzRjLTEuMDk2LjA4Ni0yLjE5Mi4xNi0zLjI4OC4yM2EyNjAuMDggMjYwLjA4IDAgMDEtNi41NzguMzI1Yy04Ljc3Mi4zMjQtMTcuNTQ2LjIyLTI2LjMxMy0uMzAyYTI0Mi40NTggMjQyLjQ1OCAwIDAxLTMuMjg3LS4yMmwtMS42NDMtLjEyOS0uODIyLS4wNjktLjQxLS4wMzUtLjIwNi0uMDE4Yy0uMDY4LS4wMDYtLjEzMy0uMDEtLjIxOC0uMDJhMTEuNTY2IDExLjU2NiAwIDAxLTMuNy0uOTkyIDExLjczMiAxMS43MzIgMCAwMS01LjQ5Ny01LjE3OCAxMS43MyAxMS43MyAwIDAxLTEuMjE1LTMuNjI3Yy0uMDI0LS4xNTgtLjA1MS0uMzE2LS4wNjctLjQ3NWwtLjAyNi0uMjM4LS4wMTMtLjExOS0uMDEtLjEwMy0uMDctLjgyMy0uMTMyLTEuNjQ4YTE5MC42MzcgMTkwLjYzNyAwIDAxLS4yMi0zLjI5OGMtLjI1Ni00LjM5OS0uMzU4LTguODE3LS4yNTgtMTMuMjMzLjA5OS00LjQxMi4zNzItOC44MTEuNzg4LTEzLjE5N2ExMS42NSAxMS42NSAwIDAxMy4wMzktNi44MzUgMTEuNTg1IDExLjU4NSAwIDAxNi41NzItMy41NjNjLjE1Ny0uMDIzLjMxMi0uMDUxLjQ3LS4wN2wuNDctLjA1LjgyLS4wNyAxLjY0My0uMTNhMjI4LjQ5MyAyMjguNDkzIDAgMDE2LjY0Ny0uNDA1bC0uMDQxLS4wNWE4OC4xNDUgODguMTQ1IDAgMDEtMi4xNTQtMi44NjdsLS41Mi0uNzMtLjI1OC0uMzY2Yy0uMDg2LS4xMjItLjE3My0uMjQ0LS4yNDYtLjM3NmEyLjc0IDIuNzQgMCAwMS0uMzEyLS44ODEgMi44MDggMi44MDggMCAwMS4wNC0xLjEzOCAzLjk5OCAzLjk5OCAwIDAxNC4yMi0zLjA3NyAyLjggMi44IDAgMDExLjA5My4zMTNjLjI5NC4xNTUuNTM4LjM0Ny43NDIuNTY4LjEwMi4xMS4xOS4yMy4yOC4zNWwuMjcuMzU5LjUzMi43MmE4OC4wNTkgODguMDU5IDAgMDEyLjA2IDIuOTM2IDczLjAzNiA3My4wMzYgMCAwMTEuOTI5IDMuMDNjLjE4Ny4zMTMuMzczLjYyOC41NTYuOTQ1IDIuNzI0LS4wNDcgNS40NDctLjA1NiA4LjE3LS4wMzguNzQ4LjAwNiAxLjQ5Ni4wMTUgMi4yNDQuMDI2LjE4LS4zMTMuMzY0LS42MjQuNTQ5LS45MzRhNzMuMjgxIDczLjI4MSAwIDAxMS45My0zLjAzIDg4LjczNyA4OC43MzcgMCAwMTIuMDU5LTIuOTM1bC41MzMtLjcyLjI2OC0uMzU5Yy4wOS0uMTIuMTc5LS4yNC4yODEtLjM1YTIuOCAyLjggMCAwMTEuODM0LS44ODF6TTMwLjEzIDM0LjYzMWE0IDQgMCAwMC0uNDE4IDEuNDIgOTEuMTU3IDkxLjE1NyAwIDAwLS40NDYgOS4xMjhjMCAyLjgyOC4xMjEgNS42NTYuMzY0IDguNDgzbC4xMSAxLjIxMmE0IDQgMCAwMDUuODU4IDMuMTQzYzIuODItMS40OTggNS41NS0zLjAzMyA4LjE5My00LjYwNmExNzcuNDEgMTc3LjQxIDAgMDA1Ljg5Ni0zLjY2NmwxLjQzNC0uOTQyYTQgNCAwIDAwLjA0Ny02LjYzMiAxMzcuNzAzIDEzNy43MDMgMCAwMC03LjM3Ny00LjcwOCAxNDYuODggMTQ2Ljg4IDAgMDAtNi44NzktMy44NDlsLTEuNC0uNzI1YTQgNCAwIDAwLTUuMzgyIDEuNzQyeiIgaWQ9InBpZC02NC1zdmdvLWQiPjwvcGF0aD48ZmlsdGVyIHg9Ii0xNS40JSIgeT0iLTE2LjMlIiB3aWR0aD0iMTMwLjklIiBoZWlnaHQ9IjEzMi41JSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBpZD0icGlkLTY0LXN2Z28tYyI+PGZlT2Zmc2V0IGR5PSIyIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIj48L2ZlT2Zmc2V0PjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjEiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMSI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMyAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMSIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjEiPjwvZmVDb2xvck1hdHJpeD48ZmVPZmZzZXQgaW49IlNvdXJjZUFscGhhIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMiI+PC9mZU9mZnNldD48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIzLjUiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjIiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMiI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMiAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMiIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjIiPjwvZmVDb2xvck1hdHJpeD48ZmVNZXJnZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMSI+PC9mZU1lcmdlTm9kZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMiI+PC9mZU1lcmdlTm9kZT48L2ZlTWVyZ2U+PC9maWx0ZXI+PC9kZWZzPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgb3BhY2l0eT0iLjgiPjxtYXNrIGlkPSJwaWQtNjQtc3Znby1iIiBmaWxsPSIjZmZmIj48dXNlIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1hIj48L3VzZT48L21hc2s+PGcgbWFzaz0idXJsKCNwaWQtNjQtc3Znby1iKSI+PHVzZSBmaWxsPSIjMDAwIiBmaWx0ZXI9InVybCgjcGlkLTY0LXN2Z28tYykiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48L2c+PC9nPjwvc3ZnPg==">',switch:I.value,onSwitch:function(N,j,X){const rt=!N.switch;return I.value=rt,N.tooltip=rt?"\u5F00\u542F":"\u5173\u95ED",rt}}],controls:[{position:"right",html:P.value?f:m,click:function(N,j){P.value=!P.value,j.target.parentNode.parentNode.innerHTML=P.value?f:m}},{name:"video-list",position:"right",html:_,selector:a(A),onSelect:function(N,j){return b(N.html,N.url),_}}]},V=h(A);V.length>0&&V.length>1&&ot.controls.push({name:"video-subtitle",position:"right",html:E,selector:V,onSelect:N=>(N.html==="\u5173\u95ED\u5B57\u5E55"?C.subtitle.show=!1:(C.subtitle.show=!0,C.subtitle.url=N.url),E)}),C=new Ba(ot),C.on("destory",()=>{}),t.isMobile.value===!1&&C.on("ready",()=>{let N=c(C.option.title);N.prev&&C.controls.add({name:"prev-video",position:"left",index:5,tooltip:"\u64AD\u653E\u4E0A\u4E00\u4E2A",html:O,click:()=>{L()}}),N.next&&C.controls.add({name:"next-video",position:"left",index:15,tooltip:"\u64AD\u653E\u4E0B\u4E00\u4E2A",html:D,click:()=>{S()}})}),C.on("video:ended",()=>{I.value&&S()}),V.length>0&&(C.subtitle.url=V[0].url)}),S=()=>{const A=c(C.option.title).next;A&&b(A.name,A.url)},L=()=>{const A=c(C.option.title).prev;A&&b(A.name,A.url)};return va(()=>{b(r.currentClickRow.name,r.currentClickRow.url)}),(A,U)=>{const B=pa,G=ma;return fi(),pi("div",null,[vd,Ue(l)&&Ue(t).isMobile.value?(fi(),pi("div",Ed,[Ee(B,{disabled:!c(Ue(l).name).prev,icon:Ue($a),onClick:L},{default:Qt(()=>[xe("\u4E0A\u4E00\u4E2A\u89C6\u9891")]),_:1},8,["disabled","icon"]),Ee(B,{disabled:!c(Ue(l).name).next,icon:Ue(Wa),onClick:S},{default:Qt(()=>[xe("\u4E0B\u4E00\u4E2A\u89C6\u9891")]),_:1},8,["disabled","icon"])])):os("",!0),zt("div",{class:ls(["zfile-video-tools",Ue(P)?"hidden-important":""])},[Ue(n).permission.download?(fi(),pi(Ea,{key:0},[zt("div",{class:"zfile-video-tools-item",onClick:U[0]||(U[0]=Q=>o("download"))},[Ee(G,{placement:"top"},{content:Qt(()=>[xe(" \u76F4\u63A5\u4E0B\u8F7D ")]),default:Qt(()=>[xd]),_:1})]),zt("div",{class:"zfile-video-tools-item",onClick:U[1]||(U[1]=Q=>o("thunder"))},[Ee(G,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528\u8FC5\u96F7\u4E0B\u8F7D ")]),default:Qt(()=>[Sd]),_:1})]),zt("div",{class:"zfile-video-tools-item",onClick:U[2]||(U[2]=Q=>o("motrix"))},[Ee(G,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 motrix \u4E0B\u8F7D ")]),default:Qt(()=>[Td]),_:1})])],64)):os("",!0),zt("div",{class:"zfile-video-tools-item",onClick:U[3]||(U[3]=Q=>o("potplayer"))},[Ee(G,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 PotPlayer \u64AD\u653E ")]),default:Qt(()=>[bd]),_:1})]),zt("div",{class:"zfile-video-tools-item",onClick:U[4]||(U[4]=Q=>o("iina"))},[Ee(G,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 IINA \u64AD\u653E ")]),default:Qt(()=>[Ad]),_:1})]),zt("div",{class:"zfile-video-tools-item",onClick:U[5]||(U[5]=Q=>o("vlc"))},[Ee(G,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 VLC \u64AD\u653E ")]),default:Qt(()=>[Ld]),_:1})]),zt("div",{class:"zfile-video-tools-item",onClick:U[6]||(U[6]=Q=>o("nplayer"))},[Ee(G,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 nPlayer \u64AD\u653E ")]),default:Qt(()=>[Id]),_:1})]),zt("div",{class:"zfile-video-tools-item",onClick:U[7]||(U[7]=Q=>o("mxplayer"))},[Ee(G,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 MXPlayer(Free) \u64AD\u653E ")]),default:Qt(()=>[wd]),_:1})]),zt("div",{class:"zfile-video-tools-item",onClick:U[8]||(U[8]=Q=>o("mxplayer-pro"))},[Ee(G,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 MXPlayer(Pro) \u64AD\u653E ")]),default:Qt(()=>[Rd]),_:1})])],2),zt("div",{class:ls(["zfile-video-tools-tips",Ue(P)?"hidden-important":""])}," tips: \u53EF\u70B9\u51FB\u4E0A\u65B9\u7684\u8F6F\u4EF6\u56FE\u6807\u8FDB\u884C\u4E0B\u8F7D\u64AD\u653E, \u672C\u5730\u64AD\u653E\u5668\u89E3\u7801\u6548\u679C\u66F4\u4F73. ",2)])}}};var nu=wa(Dd,[["__scopeId","data-v-5527297c"]]);export{nu as default};
