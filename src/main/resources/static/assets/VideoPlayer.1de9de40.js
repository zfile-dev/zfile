var qt=Object.defineProperty,er=Object.defineProperties;var tr=Object.getOwnPropertyDescriptors;var Gt=Object.getOwnPropertySymbols;var rr=Object.prototype.hasOwnProperty,ir=Object.prototype.propertyIsEnumerable;var Wt=(Ge,ze,G)=>ze in Ge?qt(Ge,ze,{enumerable:!0,configurable:!0,writable:!0,value:G}):Ge[ze]=G,$e=(Ge,ze)=>{for(var G in ze||(ze={}))rr.call(ze,G)&&Wt(Ge,G,ze[G]);if(Gt)for(var G of Gt(ze))ir.call(ze,G)&&Wt(Ge,G,ze[G]);return Ge},et=(Ge,ze)=>er(Ge,tr(ze));var st=(Ge,ze,G)=>new Promise((ee,W)=>{var O=a=>{try{b(G.next(a))}catch(g){W(g)}},C=a=>{try{b(G.throw(a))}catch(g){W(g)}},b=a=>a.done?ee(a.value):Promise.resolve(a.value).then(O,C);b((G=G.apply(Ge,ze)).next())});import{A as nr}from"./base.f9e60852.js";import"./tooltip.f118fcb0.js";import{E as ar}from"./popper.819708f8.js";/* empty css               */import{bE as Vt,U as wt,S as Ot,a as At,f as bt,m as Ze,I as sr,G as or,r as lr,o as ur,u as vt,j as ft,e as rt,L as ht,k as zt,F as dr,g as Ht,Q as cr,R as fr}from"./index.f20a2340.js";import{a as hr,u as pr,k as mr,m as vr}from"./useFileUpload.a94b2343.js";import{u as gr,a as Ct}from"./useCommon.9d9daf7d.js";import{_ as _r}from"./plugin-vue_export-helper.21dcd24c.js";import"./request.29c9df35.js";import"./focus-trap.7aeb3cb3.js";import"./common.81138c7e.js";import"./index.e487e6de.js";import"./index.2085544e.js";import"./event.776e7e11.js";import"./index.b60e2a18.js";import"./scroll.5771f43f.js";import"./validator.02bde218.js";import"./index.c9aefbb5.js";import"./directive.eb3ba7ee.js";var yr="/assets/video-download.3a226681.png",Er="/assets/video-thunder.5e7f4cec.png",Tr="/assets/video-motrix.95ef7e61.png",Sr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAOeUlEQVR4Xu3dy5EjuRWF4TMGyA550ibIgPZirJjFODIeaDVOaDMvSREKRdRKGy0UVF1mZTV5yGS+ACSA/G/EV1F1p7unu4pA4nEB6nK5fIeG/UN/vvyuL5df9fXyi75///zHq9/00+UP/fye+9vVr3q7cZnw7deMvy/+jPiz4s+MPz/+PyH+v//Wnx7+PmiKPIEKRUMbG/nYuIdG7Q34GPF3GTuJ4e/4hc6hDfIEDjY29njaRqN6/cSu29gxDCMTOoUKyRMoLIbS8dSs7ameS/wbx5FC/Nv9+4Gi5AlkNj7hhzl1/w1+ztghMEI4hDyBDOJJF8PgWFDzBoB745SB0UER8gQSGRs9T/nthl0MOoOM5AnswJM+n7EzYJqQlDyBDWL+OqzYP75wkd6w5fjl4eeA1eQJLDQU4MRqdrvbdK0bipWYIuwgT2AGT/s6xc+EjmA1eQITYt+auX394mfE9GAxeQI3YsGJlfw2DT+zrywaviZP4MNw8IX5fevoCF6SJ04tXiTDqTqe+L0ZOwL/mZ+cPHFaNPxzGEqPWSP4IE+cTrwYWNw7H3YNruSJ0/i2j//44sB5xGvgxOsD8sQpsMCHe/FaOOX6gDzRNYb7eCVeGyebFsgTXRrO4DPcxzIxQvTXUKfkie4M12uxuo91TrJbIE90g6c+Uuh8NCBPdGE4l89TH2l0vDYgTzRvuLf+8YcI7NfdToE80awY8nNMF7nFa6yjugF5okkM+VFSvNY6mRLIE81hyI9jdFE8JE80g1V+1CBeg/7abIg80YRo/FT0oRYNrwvIE9Vjvo8aNbouIE9UbXiHXA7xoFZvrXUC8kS1WOxDG95aKiGWJ6pE40d7mtghkCeqM5zd928uUL8GzhHIE1Vhmw+tq7wTkCeqQeNHLyruBOSJKtD40ZtKC4bkicPR+NGrCkcC8sShaPzoXWWdgDxxGFb7cRYVdQLyxCHY58f5VFEnIE8UN5T3+jcH6F8FFYPyRFHU9uPcDi8blieKiUMTNH7g0ANE8kQRcXaaI73AINrCQfcJyBNFcJkHcC8uFfF2UoA8kR17/cBzB2wPyhNZsd0HvFZ4UVCeyIZFP2CJoouC8kQWLPoByxVcFJQnsuAde4B1Ci0KyhPJMe8HtspeLixPJDXM+/0fBWCZ7OsB8kQyzPuB/aJmxttWQvJEMuz3A2lkrA+QJ5LghB+QVqapgDyRBEN/IK1oU97OEpAnduNmHyCPDFMBeWIXVv2BvBJPBeSJXTjlB+SVeFdAntiMgh+glGQFQvLEJrHnz0EfoJS3VGcF5IlN2PMHykr0TkPyxGos/AHHSLAgKE+sxsIfcIwEC4LyxCpU/AHH2nmDkDyxChV/wLF2VgjKE4ux7QfUYvO2oDyxGE9/oA47rhCTJxbh6b/Pv969/WXw9yf/HVhv0yhAnpjFRR/7/Pevl4f4zw90BNhn4yhAnpjF03+7eOJPxf/+Ofx3/z3AcqtHAfLELJ7+2z17+nvEr2E0gC027AjIEy+x77/Pmohpgf9+YN6qUYA88RJVf/usjZgWxIKh/znAlJXVgfLEJJ7++20NpgVYY0V1oDwxiXf32W9vsEiIJVa8q5A88RQn/tJIEUwLsMTCk4LyxFNc9JlGyqB2AK8svEBUnniK237SSB3UDmDa28Xb8RPyxAMW/9LJFbFIyLQAbsFioDzxgMW/dHIHtQO4tWAxUJ64M1z2+fgHY5sSwbQAt2bOB8gTd1j8S6tkUDuAMLMYKE/cofIvrSOC0cC5zVQGyhOf2PtP76igduDcXtQEyBOfGP6nd3RQO3BOL6YB8sQnhv/p1RJMC87lxTRAnrhi+J9HTUHtwLlMTAPkiSuG/3nUGNQOnMPENECeuKL4J49ag9qB/k0UBckTFP9kVHtQO9C3J0VB8gS1/xm1EkwL+vTkbIA8wVt9Z9RSUDvQnydvKS5PcOtvRi0G04J+PLk1WHcJtv/yajVYJOyHbQfq9osLb/qRV+tB7UAP7q4N1+0XzP8z6yUoKW6XrQPo9gvKfzPrKZgWtMnKgvX5Bfv/+fUYLBK256YeQOMn7P8X0HNQO9COm3oAjZ9Q/19A70HtQBtuzgVo/IT6/wLOEkwL6nZzLkDjJxQAFXC2YJGwTjcFQbp+wgJgGWcMpgV1+lgIVHygArCQMwe1A3X5WAhUfLhQAVjG2YPagZpcKwIVH6gALIQYgkXC431UBCo+sANQCHEf1A4c52MnQPGBEuBCiMdgkfAYHzsBig8X3v67DGI6mBaUd+0A2AIsh5gPFgnLeW/7YguwIGJZMC0o43d9EYeACiLWBbUDeV07AGoAyiHWB7UD+fyi78UpwIKI7cEiYXrXDoAioHKI/UHtQDrvbZ8OoCQiTbBImMZv+klUARZEpA2mBfv8oZ9FFWBBRJ5gkXCbawfARSDlEPmCacF6722fDqAkIn9QO7DGW9QBcA6gFKJMUDuw1LUD8CRyIcoGb2U2iw6gJOKYoHZgEh1AScRxEaMB/3mADqAo4thgXeABHUBJxLERi4P+Mzk5OoCSiOPDfyYnRwdQEnFssA7wgA6gJOLYYEvwAYVAJRHHBQuAz1AJWBRRPjgx+MobZwFKIsoF5cDzroeBOA5cDlEmOBC0zLUD4EKQcoi8Qe3/Otf7AOgAyiHyBMP9ba5XgnEnYDlE+mC4v931UlCuBS+HSBfcALTftQPgjUHKIdIEw/00Pt4XgLcGK4XYF+zpp/aVNwctidgWDPfzuL43IG8PXg6xPhju5/P+8H//ePnuQjlwGcTyYLif33vbj4/fUQ5cCDEfDPfLiDb/2QFQDFQG8Tq4vLOcaPOfHQDFQGUQz4PhfnnR5j87AGoByiDugxLeI3293IwAqAUogfgWDPePFW3+swNgK7AMguF+LaLNf3YA7ASUceZguF+Tt8tHu9f4CTsBBZw1OLFXl48dgKDxE04FFnC24IKOOkVbf+gAWAjM7yzBcL9uHwuAQeMnLAQWcIZguF+/jwXAoPGTKxYC8+o5GO634aMEeKTbL6gIzKzHYLjflo8KwJFuv7hQEZhXb8Fwv0XXCsCRbr/gcpDMeglO7LUr2vhkBxBYB8inh2C43y6b/wd5gnWAjFoOSnjbZ/P/IE9QD5BRi8Fwvx83+/8jeYJ6gIxaC4b7fbnZ/x/JE1e8YWgerQTD/f5Em/Z2PtkBcC4gj9qD4X6/bur/b8kTV2wH5lFzcEFH32z7byRPfGI7ML0ag+F+/55s/43kiU9MA9KrKSjhPY+J4X+QJz4xDUivlmC4fy4Tw/8gT9xhGpDW0cFw/3xeDP+DPHGHaUBaRwXD/fN6MfwP8sQdpgFpHRGc2Du3F8P/IE884LLQdEoGF3Tg5vLPKfLEA84GpFMiGO5j9KT238kTD4azAbx9eAq5g+E+vvm8+/8VeeIpjginkSsY7sM9Ofr7jDzxFIuBaaQOhvuYMrP4N5InJrEYuF/KYLiPKQsW/0byxCQWA/dLEZzYw5wFi38jeeIl7gnYZ28w3Mecmco/J0+8xLXh+2wNSnix3N2133PkiZdiS5DzAdutDYb7WCPa5pNrv16RJ2ZxPmC7NcFwH2vN1P0/I0/MojBouxjKzwXDfWzztvbpH+SJRRgFbBNP9alguI89Njz9gzyxCKOA7WL/3oPhPvbZ9PQP8sRi7AhsF0P8aPQ88ZHGqpX/W/LEYuwIAMfbsPJ/S55YhVEAcLTNT/8gT6xGdSBwjIl3+1lDnliNMwLAMVbU/E+RJzbhpCBQ1ooTf6/IE5sM9wWwLQiU8bb0vP8ceWIzioOAMjYW/TwjT2zGtiCQ38rjvnPkiV1YEATySrDwd0ue2I0LRIE8Fl70uYY8sRtTASC9nRV/U+SJJJgKAGklHvqP5IlkmAoAaWQY+o/kiWSYCgD7ZRr6j+SJpJgKAPskKviZIk8kR4EQsE3Cgp8p8kQWnBgE1klU6z9HnsiC9QBguczz/lvyRDasBwBLJDvos4Q8kRU3CAFzdt3ws5Y8kR31AcBzGff7p8gT2cXchkVB4F6C6722kCeKYFEQ+Kbgop+TJ4qIfyy3CAGh6KKfkyeKYmcA5/aW65DPUvJEcewM4KwObvxBnjgE5cI4n6LbfVPkicOwPYizKFDjv5Q8cSg6AfTugL3+V+SJw9EJoFeVNf4gT1SBdxpCbyps/EGeqAYjAfSi0sYf5Imq0AmgdRU3/iBPVIdOAK2qaLV/ijxRJeoE0J4q9vnnyBPVomIQbTi8vHcNeaJqw9kBDhChVoce7NlCnqhefIM5SozaxGuyscYf5IkmcKkIahJ1Kwed599LnmhGfMPZIcDRKt/mmyNPNIfFQRyjqcW+KfJEk1gXQEmNzvefkSeaFVMCzhAgt4bn+8/IE82jaAh5xPZzE8U9a8gTXWBKgJRix6mTIb+TJ7rBLgFSaKCefw95ojuxUstoAGvFa6aDVf458kSXGA1gjXjqd7TQ94o80TXWBvBKx3P9KfLEKQw7BRwqwqjLFf4l5InTYFqAEK+Bkwz3n5EnTmP8oceQj4NF5xMFPScb7j8jT5xWDAFZH+jfSVb3l5InTi1GBcPhItYHejN07qec578iT+AydAQsFPaBhv+SPAETHQFTg/bQ8BeRJzCBNYI2xIIuc/zF5AnMiBcXx47rw6r+JvIEFhqqClknOFKMyE5UtpuDPIENGBWU9Hb9XjPMT0KewA7jqIDCovSG7+lXnvZpyRNIZOwMWDjcLhp9fA+Z22cjTyADRgZLDcP7eNLT6IuQJ5DZcAjpy/UQCqODsTT3x+v3hOF9cfIECosnXTzxztIhDPv0NPhKyBM42DhCiClDDIdb7hTi7z78G76nwddJnkCFouHcjhSiUQ3rCTXUILxd/y5jQx/n7zT2JsgTaMzYOQxvnR7lyvG0jSH2t45iKJiJkUR0GKPHhjwaf/3YsIfpSexoDA08/l808i78HzPcPJXn8KhQAAAAAElFTkSuQmCC",xr="/assets/video-iina.1db26170.png",Ar="/assets/video-vlc.54e63a7e.png",br="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAK2UlEQVR4Xu2dC3BUZxXHD4g4VlukLRTEIKhYochjeBRaCoggpQaqBSrQWFuCwLbFDpRhQIs4Y8YRO1Lr4JSWJkCJVihgy0PerxapUhqaQrCFIkUghM1rs7sJVCYcz3d3v+Tuud+9e/dFdpPvP/OfwAzs3j0//v9zv2x2ANDS0tLS0tLS0tLS0tLS0tLS0tJqEHrhi1gJM+jrOqyAf2A5vEFeSr8exP+sVopFg59C9pJR6UrYRu7F/55WCkQJWGABoPY1Ss9K+tqZP4ZWkkQwRtGAryuG7+QAgfmFqDj+eFoJiob7nmLgbl1KNTYdEVrzx9WKQ1gFvRVDjt2VcIx8P398rRhFdfWoZbiJ2AvbCcxd/Hm0XIqAeCxDTdz19Lj5qBd/7EoREOkApWWJXvwxKMVADFdXQmkRLX7Qiz+6UgHkagXgyWrAzTWAvw0APh1s8Im5Qb34HZUMINfJ5yoBd/sAl/sB5zYCUHpOELaT+/Jr0YL4gVwmAIcpBQUEYKFi6C5cPy8I+TNr9eKPkFsgAQLwPgFYTzX0K+tw43ctBH4WgLwlevGHZAfkGu2BjwjAVgLwXOQeSJrnRLqU4OSORGjDr7FFSQIRe+A8pWAfQXiRaugZxQCTaQajwU8FoeSJlrz4j1SBZw2lYJFiaKk0BxGGYZiA4Owg7JpdC/359TZ7zQuAhw8rleYQzCBMMKTr6ff5U2rhy/y6m61uJBAnEAoYODPsWQGom9FSFv+NAhIPDAKBPyXnkh8nT/dD6fQAzG7Wiz/VQDgIFQwzCDMMAULCkP4xOccPJVOb6+JPJRAOgsPgqZAwZCrMMH4ShvEIeSr5R+TJftg3obkt/lQA4RDcwFBVlDkVAoSwAYI8iW7Nf0B3hxNqoH68Dwqyq6Arf20ZqWQC4QDcgrCDoUrFw/5GGNnkB8hjyCN8UDe8BvImZ/riTxYQDoGDsNsV5oqyS4WAIVPxkN9IhQFiLHmUgEG+hzzEBwjVUAYXBzwB+5dk5uJPFAiHoAJhB0O1uM2pUFWUTIWAIUAMEhAudUU4PQeheBfCOz6Ew36EQ/4SeNufzV9v2iteIByCHQwVCGEOQqbCXFEShLBIhYAhQEA5+VwOQsk6hCNlCP8MEogAgRAmGG+HfZD8ln8/HKzOnMWfTCBOu8IpFbyieCp6VxKAiw8ifLQC4djHCO8SgH+F3QDD3whDgBDeXxPy3pp62Fv9KuyuS//FHw8QDiIWGHxfqCpqXLWoodEI/1mKcPwownvBEAThIyYYAoSEYU7FwTCIfQYMhN1UY7vIO6vrYIcvD/5eeQufQ9ooViDxgHBa3MJTKAntL/emGlqEcHIvpYCGVxQMgVDBcKqoAyYYe3xmGAjbydsMl8OW6sf5LNJCsQCxA+EEwy4VA6taIVzw0DLeRMvYSxDqCIJwbSOIoyYQFhh+sbitFSVTIWBIEDsEDF8Ixpaw36xCeKPqZUBsxWfSpHIDxCkV0hyEeV8ICA+Ku6GL06iGChBOnCEINPz360IgGmC4SIWqosyp2OuLhCFSIZMhQGw2QCBsqgz5b1WL+EyaVNGAcBgcCE+GhDGNauhm71iET36P8CHtgeJgCIJ0BIjaRhgyFSoY5oqyLm5TRclUmEA0pCIMYiN5A/n1iquwtjZ93te3A8IhcBAcxgzy3RX9qIZ+iXCK9sBxGswHtZEQLKkQIEwVxUEYMEypiKgotridKmpzdSgVEoYBgrxOuBzhLxUL+FyaTBwIh6ACISsqu0rcDT1FNbSRaqgsBECagzDD4KlQwVClQsKQqZAVpV7c1lREwKhA+KuAIVy5jc+lySSBcAgqGI/QmaBVGR3IzuVTDZ0mCDTYD65EglDBsOwKxeK2gxHv4hapUFXUegajkPzn8nf5XJpMAgiHIEGIu6O+5fcjnF9GNUR74EQwBEH4eIww3KTC6WzBFzdPRcTiDleUJRXhinpNwqC7u7XkV737+FyaTHNMQASEMVV0HihdjHBmD0KJrxGA2W5ACMebCleL2xe5uLc6VJQqFRLGGgPI83wuTaaJPvAYe+CTDQj/LrUO3+xYU6GCwUHEe7YwUuGwuEVFOaVCwlgtvl4eyufSdDp51WMZvMoGiBhg8IqKNRXRKsq8uI2zBUuFZXFHVFQIhHDBpfRZ6IbcAHEDIu6K8lthSBDy2x92i5tXVMPZIkpFGSDIq8pOQUGgAx9J08oJiNuKkiAaYIRBqCrK6cTNzxY8FU6L21xRAgSvKJEKM4z8SzvgT95OfBxNLzsgqoriIOJOhaKilItbpsIEgqfCrqJUqRBeVVYKr5RN42NIH6mAcBDxwrA7catguF3cvKKUi7vcurgLvNdglfcP8MfT6futd0MSiKgntxVlt7hVFSXPFqoTd6oXt4SRX3YI8i9nyAeEJJBYQDilQllRNqmwragYFrdTKlZ7vbQrHku7b7E7SgBJFAYHwSvKdnErUqFa3KqKclrcKz6sh8cWvzhs2LD2/OWmv4oFEAcQsVaUanFLGDIVzu/mWVMRraJWX0CY9xL2HTsa87vdcQQBBvKXmTkqDjQCsQOhSkXK381jqTC+/WFKRd4W7PDQw/jz/t3xU6BSAqC/BLPIGf7RawGEg7CkQjjOVERb3KqKsqSC/NIxhNz5mDNiIJ6F1gKA9HVyAfl2/tIyU8W1ViDRUhENhtPibkiFCYQqFYXnEBa+gNnjx+CBrDvMAMwmSnAPf0mZLQ7EDgYHwRe307t5blKxkXbB0k1497SpuGbAN/nguenB4GlyZv64qKMkEA4iGRUVbXGvPIRZT87F34wZhFegLR+6yqKeCsnp8x540iWAcBiuKoqnIlxRTot73SmEZ5ehZ9I4PNPtK3zY0VxCHskvv/lJAnGbiljOFlvLEJa9hlOnP4pvDfk2H7Bb0xPCAnJbfunNU0UExHUqoi1uSsLqA/jdZ+bj+ux7ETu348ON1a+Ts/glN28JIBxGxOKWMGwqatNx7J23DJfnjMcrfboj3vYZxC+0QmxtGW4sPk3+Hr/UlqEiOofYpULcRfHFvfMCtl1eiM8+mYtnRw5A7EYp6HIzpeEmxHZtENtahhuLqTthMflz/DJbjo4SEBUMWVEH6ZZ07U6ctXghvjNxNGKfLog9b0P8xi2IXQlEFwLRke6Q2iWcis3k7vzyWp4EEH62eLMIf/jc87hlxkTE+76F2K8zgaDDWc+OiHfeHoIhU5F4RZ0lj+eX1XIlgOw5i/e9XIj582fhlQcGIw7thjj4q4iDskIwenUKpeLO9o0VJVMRf0V9Sv41+fP8klq0/pszzoPf6YE4/OuI9xKIIWEQ/ama+lEqeplSISsq8VTsJPfg16JFwlFf8+Dw7qFUSBgRFRVOhYDRWaRCLO64YZwnT+bXoGUSjiAgsqKMVIQrykjFreFUJFxR/yP/jpzZnyG/EcIhWZ5QRYVTwSsq8cV9gKz/iwu3olR4lBWV+NmilJxDzqD3s9NA2Kejx5IKubjjO1tcI79A/hJ/Li0Xwrs6TYpc3OFUxFdRh8n9+HNoxSDs2aFHEs4W5eRc1PWUHGGnmw7HubjrySvIt/LH1EpA2AaGUirEyZkP3MlHyYP5Y2klSTTcmRj6F88Hz11N9mDG/7hNBoiG/H3yxwoIwuJw9wo5zT5P0cyFMOCzNPQJGLp13UBeSZ5HTsPPUmhpaWlpaWlpaWlpaWlpaWlpaWlpaWklqv8Da8GBU4g36CAAAAAASUVORK5CYII=",Lr="/assets/video-mxplayer.5dfa69aa.png",Dr="/assets/video-mxplayer-pro.10406916.png",Qt={exports:{}};/*!
 * artplayer.js v4.6.2
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2023 Harvey Zack
 * Released under the MIT License.
 */(function(Ge,ze){(function(G,ee,W,O,C){var b=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof wt!="undefined"?wt:{},a=typeof b[O]=="function"&&b[O],g=a.cache||{},d=typeof Vt=="function"&&Vt.bind(Ge);function S(x,A){if(!g[x]){if(!G[x]){var D=typeof b[O]=="function"&&b[O];if(!A&&D)return D(x,!0);if(a)return a(x,!0);if(d&&typeof x=="string")return d(x);var P=new Error("Cannot find module '"+x+"'");throw P.code="MODULE_NOT_FOUND",P}c.resolve=function(m){var _=G[x][1][m];return _!=null?_:m},c.cache={};var I=g[x]=new S.Module(x);G[x][0].call(I.exports,c,I,I.exports,this)}return g[x].exports;function c(m){var _=c.resolve(m);return _===!1?{}:S(_)}}S.isParcelRequire=!0,S.Module=function(x){this.id=x,this.bundle=S,this.exports={}},S.modules=G,S.cache=g,S.parent=a,S.register=function(x,A){G[x]=[function(D,P){P.exports=A},{}]},Object.defineProperty(S,"root",{get:function(){return b[O]}}),b[O]=S;for(var E=0;E<ee.length;E++)S(ee[E]);if(W){var R=S(W);Ge.exports=R}})({"5lTcX":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("bundle-text:./style/index.less"),b=O.interopDefault(C),a=G("option-validator"),g=O.interopDefault(a),d=G("./utils/emitter"),S=O.interopDefault(d),E=G("./utils"),R=G("./scheme"),x=O.interopDefault(R),A=G("./config"),D=O.interopDefault(A),P=G("./whitelist"),I=O.interopDefault(P),c=G("./template"),m=O.interopDefault(c),_=G("./i18n"),o=O.interopDefault(_),i=G("./player"),t=O.interopDefault(i),r=G("./control"),l=O.interopDefault(r),p=G("./contextmenu"),u=O.interopDefault(p),f=G("./info"),L=O.interopDefault(f),v=G("./subtitle"),y=O.interopDefault(v),n=G("./events"),s=O.interopDefault(n),e=G("./hotkey"),h=O.interopDefault(e),M=G("./layer"),T=O.interopDefault(M),B=G("./loading"),N=O.interopDefault(B),j=G("./notice"),z=O.interopDefault(j),K=G("./mask"),V=O.interopDefault(K),$=G("./icons"),X=O.interopDefault($),Z=G("./setting"),q=O.interopDefault(Z),te=G("./storage"),ue=O.interopDefault(te),oe=G("./plugins"),le=O.interopDefault(oe),me=G("./mobile"),_e=O.interopDefault(me);let ve=0;const ce=[];class he extends S.default{constructor(De,Fe){super(),this.id=++ve;const Oe=E.mergeDeep(he.option,De);if(this.option=(0,g.default)(Oe,x.default),this.isLock=!1,this.isReady=!1,this.isFocus=!1,this.isInput=!1,this.isRotate=!1,this.isDestroy=!1,this.whitelist=new I.default(this),this.template=new m.default(this),this.events=new s.default(this),this.whitelist.state?(this.storage=new ue.default(this),this.icons=new X.default(this),this.i18n=new o.default(this),this.notice=new z.default(this),this.player=new t.default(this),this.layers=new T.default(this),this.controls=new l.default(this),this.contextmenu=new u.default(this),this.subtitle=new y.default(this),this.info=new L.default(this),this.loading=new N.default(this),this.hotkey=new h.default(this),this.mask=new V.default(this),this.setting=new q.default(this),this.plugins=new le.default(this)):this.mobile=new _e.default(this),typeof Fe=="function"&&this.on("ready",()=>Fe.call(this,this)),he.DEBUG){const ke=Ie=>console.log(`[ART.${this.id}] -> ${Ie}`);ke("Version@"+he.version),ke("Env@"+he.env),ke("Build@"+he.build);for(let Ie=0;Ie<D.default.events.length;Ie++)this.on("video:"+D.default.events[Ie],we=>ke("Event@"+we.type))}ce.push(this)}static get instances(){return ce}static get version(){return"4.6.2"}static get env(){return"production"}static get build(){return"2023-01-26 15:26:58"}static get config(){return D.default}static get utils(){return E}static get scheme(){return x.default}static get Emitter(){return S.default}static get validator(){return g.default}static get kindOf(){return g.default.kindOf}static get html(){return m.default.html}static get option(){return{id:"",container:"#artplayer",url:"",poster:"",title:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,playsInline:!0,lock:!1,fastForward:!1,autoPlayback:!1,autoOrientation:!1,airplay:!1,layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],whitelist:[],thumbnails:{url:"",number:60,column:10,width:0,height:0},subtitle:{url:"",type:"",style:{},escape:!0,encoding:"utf-8"},moreVideoAttr:{controls:!1,preload:E.isSafari?"auto":"metadata"},i18n:{},icons:{},customType:{},lang:navigator.language.toLowerCase()}}get proxy(){return this.events.proxy}get query(){return this.template.query}get video(){return this.template.$video}destroy(De=!0){this.events.destroy(),this.template.destroy(De),ce.splice(ce.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}if(W.default=he,he.DEBUG=!1,he.CONTEXTMENU=!0,he.NOTICE_TIME=2e3,he.SETTING_WIDTH=250,he.SETTING_ITEM_WIDTH=200,he.SETTING_ITEM_HEIGHT=35,he.INDICATOR_SIZE=14,he.INDICATOR_SIZE_ICON=16,he.INDICATOR_SIZE_MOBILE=18,he.INDICATOR_SIZE_MOBILE_ICON=20,he.VOLUME_PANEL_WIDTH=60,he.VOLUME_HANDLE_WIDTH=12,he.RESIZE_TIME=500,he.SCROLL_TIME=200,he.SCROLL_GAP=50,he.AUTO_PLAYBACK_MAX=10,he.AUTO_PLAYBACK_MIN=5,he.AUTO_PLAYBACK_TIMEOUT=3e3,he.RECONNECT_TIME_MAX=5,he.RECONNECT_SLEEP_TIME=1e3,he.CONTROL_HIDE_TIME=3e3,he.DB_CLICE_TIME=300,he.MOBILE_AUTO_PLAYBACKRATE=3,he.MOBILE_AUTO_PLAYBACKRATE_TIME=1e3,he.MOBILE_AUTO_ORIENTATION_TIME=200,he.INFO_LOOP_TIME=1e3,he.FAST_FORWARD_VALUE=3,he.FAST_FORWARD_TIME=1e3,he.TOUCH_MOVE_RATIO=.5,he.VOLUME_STEP=.1,he.SEEK_STEP=5,he.PROGRESS_HEIGHT=6,he.PLAYBACK_RATE=[.5,.75,1,1.25,1.5,2],he.ASPECT_RATIO=["default","4:3","16:9"],he.FLIP=["normal","horizontal","vertical"],he.FULLSCREEN_WEB_IN_BODY=!1,typeof document!="undefined"&&!document.getElementById("artplayer-style")){const Le=E.createElement("style");Le.id="artplayer-style",Le.textContent=b.default,document.head.appendChild(Le)}typeof window!="undefined"&&(window.Artplayer=he),console.log(`%c ArtPlayer %c ${he.version} %c https://artplayer.org`,"color: #fff; background: #5f5f5f","color: #fff; background: #4bc729","")},{"bundle-text:./style/index.less":"0016T","option-validator":"bAWi2","./utils/emitter":"66mFZ","./utils":"71aH7","./scheme":"AKEiO","./config":"lyjeQ","./whitelist":"9L0ao","./template":"X13Zf","./i18n":"3jKkj","./player":"a90nx","./control":"8Z0Uf","./contextmenu":"2KYsr","./info":"02ajl","./subtitle":"eSWto","./events":"jo4S1","./hotkey":"6NoFy","./layer":"6G6hZ","./loading":"3dsEe","./notice":"dWGTw","./mask":"5POkG","./icons":"6OeNg","./setting":"3eYNH","./storage":"2aaJe","./plugins":"8MTUM","./mobile":"7mil2","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"0016T":[function(G,ee,W){ee.exports='.art-video-player{z-index:20;width:100%;height:100%;zoom:1;color:#eee;text-align:left;direction:ltr;user-select:none;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#000;outline:0;margin:0 auto;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:14px;line-height:1.3;display:flex;position:relative}.art-video-player *,.art-video-player :before,.art-video-player :after{box-sizing:border-box;margin:0;padding:0}.art-video-player ::-webkit-scrollbar{width:5px;height:5px}.art-video-player ::-webkit-scrollbar-thumb{background-color:#666}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:#ccc}.art-video-player .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-video-player .art-icon svg{fill:#fff}.art-video-player img{max-width:100%;vertical-align:top}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-video-player .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-video-player .art-video{z-index:10;width:100%;height:100%;cursor:pointer;background-color:#000;position:absolute;inset:0}.art-video-player .art-poster{z-index:11;width:100%;height:100%;user-select:none;pointer-events:none;background-position:50%;background-repeat:no-repeat;background-size:cover;position:absolute;inset:0}.art-video-player .art-subtitle{z-index:20;width:100%;text-align:center;color:#fff;pointer-events:none;text-shadow:1px 0 1px #000,0 1px 1px #000,-1px 0 1px #000,0 -1px 1px #000,1px 1px 1px #000,-1px -1px 1px #000,1px -1px 1px #000,-1px 1px 1px #000;padding:0 20px;font-size:20px;transition:bottom .2s;display:none;position:absolute;bottom:10px}.art-video-player .art-subtitle p{word-break:break-all;height:fit-content;margin:5px 0 0;line-height:1.2}.art-video-player.art-subtitle-show .art-subtitle{display:block}.art-video-player.art-control-show .art-subtitle{bottom:50px}.art-video-player .art-danmuku{z-index:30;width:100%;height:100%;pointer-events:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers{z-index:40;width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:block}.art-video-player .art-mask{z-index:50;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-mask .art-state{width:60px;height:60px;opacity:.85;cursor:pointer;pointer-events:auto;justify-content:center;align-items:center;display:flex;position:absolute;bottom:65px;right:30px}.art-video-player.art-mask-show .art-mask{display:flex}.art-video-player.art-mobile .art-state{position:static}.art-video-player .art-loading{z-index:70;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{z-index:60;height:100px;opacity:0;visibility:hidden;pointer-events:none;background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x;flex-direction:column;justify-content:space-between;padding:50px 10px 0;transition:all .2s ease-in-out;display:flex;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-bottom .art-progress{z-index:0;pointer-events:auto;flex:1;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress{height:4px;cursor:pointer;flex-direction:row;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner{height:50%;width:100%;background:#fff3;align-items:center;transition:all .2s;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{z-index:10;height:100%;width:0;background:#fff6;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{z-index:20;height:100%;width:0;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{z-index:30;height:100%;pointer-events:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{width:7px;height:100%;pointer-events:auto;background:#ffffff80;display:inline-block;position:absolute;top:0;left:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:hidden;z-index:40;border-radius:50%;justify-content:center;align-items:center;transition:transform .1s ease-in-out;position:absolute;transform:scale(.1)}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{width:100%;height:100%;pointer-events:none;user-select:none}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator:hover{transform:scale(1.2)!important}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{z-index:50;height:20px;color:#fff;text-align:center;white-space:nowrap;background:#000000b3;border-radius:3px;padding:0 5px;font-size:12px;font-weight:700;line-height:20px;display:none;position:absolute;top:-25px;left:0}.art-video-player .art-bottom .art-progress .art-control-thumbnails{pointer-events:none;background-color:#000000b3;border-radius:3px;display:none;position:absolute;bottom:10px;left:0;box-shadow:0 1px 3px #0003,0 1px 2px -1px #0003}.art-video-player .art-bottom .art-progress .art-control-loop{width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-loop .art-loop-point{width:2px;height:8px;background:#ffffffbf;position:absolute;top:-2px;left:0}.art-video-player .art-bottom .art-controls{z-index:1;pointer-events:auto;height:45px;justify-content:space-between;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-controls .art-controls-left,.art-video-player .art-bottom .art-controls .art-controls-right{display:flex}.art-video-player .art-bottom .art-controls .art-controls-center{height:100%;flex:1;justify-content:center;align-items:center;padding:0 10px;display:flex}.art-video-player .art-bottom .art-controls .art-controls-right{justify-content:flex-end}.art-video-player .art-bottom .art-controls .art-control{opacity:.75;min-height:36px;min-width:36px;text-align:center;cursor:pointer;white-space:nowrap;justify-content:center;align-items:center;font-size:12px;line-height:1;transition:opacity .1s ease-in-out;display:flex}.art-video-player .art-bottom .art-controls .art-control .art-icon{float:left;height:36px;width:36px;justify-content:center;align-items:center;transition:transform .2s ease-in-out;display:flex;transform:scale(1)}.art-video-player .art-bottom .art-controls .art-control .art-icon:active{transform:scale(.85)}.art-video-player .art-bottom .art-controls .art-control:hover{opacity:1}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel{float:left;width:0;height:100%;transition:margin .2s cubic-bezier(.4,0,1,1),width .2s cubic-bezier(.4,0,1,1);position:relative;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle{width:12px;height:12px;background:#fff;border-radius:12px;margin-top:-6px;position:absolute;top:50%;left:0}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{background:#fff;left:-54px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{background:#fff3;left:6px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before,.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{content:"";height:3px;width:60px;margin-top:-2px;display:block;position:absolute;top:50%}.art-video-player .art-bottom .art-controls .art-control-volume:hover .art-volume-panel{width:60px}.art-video-player .art-bottom .art-controls .art-control-quality{z-index:30;position:relative}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys{width:100px;text-align:center;color:#fff;background:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;line-height:30px;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item:hover{background-color:#ffffff1a}.art-video-player .art-bottom .art-controls .art-control-quality:hover .art-qualitys{display:block}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:visible;transform:scale(1)}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1;visibility:visible}.art-video-player.art-error .art-progress-indicator,.art-video-player.art-destroy .art-progress-indicator,.art-video-player.art-error .art-progress-tip,.art-video-player.art-destroy .art-progress-tip{display:none!important}.art-video-player.art-mobile .art-bottom{height:105px;padding:50px 7px 0}.art-video-player.art-mobile .art-bottom .art-controls{height:40px}.art-video-player.art-mobile .art-bottom .art-progress-indicator{visibility:visible!important;transform:scale(1)!important}.art-video-player .art-notice{z-index:80;width:100%;pointer-events:none;padding:10px;font-size:14px;display:none;position:absolute;top:0;left:0}.art-video-player .art-notice .art-notice-inner{color:#fff;background-color:#0009;border-radius:3px;padding:5px 10px;display:inline-block}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{z-index:120;min-width:200px;background-color:#000000e6;border-radius:3px;flex-direction:column;padding:5px 0;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-contextmenus .art-contextmenu{cursor:pointer;color:#fff;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;border-bottom:1px solid #ffffff1a;padding:10px 15px;font-size:12px;display:block;overflow:hidden}.art-video-player .art-contextmenus .art-contextmenu a{color:#fff;text-decoration:none}.art-video-player .art-contextmenus .art-contextmenu span{padding:0 7px;display:inline-block}.art-video-player .art-contextmenus .art-contextmenu span:hover,.art-video-player .art-contextmenus .art-contextmenu span.art-current{color:var(--theme)}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:#ffffff1a}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{z-index:90;height:auto;max-height:300px;background-color:#000000e6;border-radius:3px;font-size:13px;transition:all .2s;display:none;position:absolute;bottom:60px;left:0;overflow:auto}.art-video-player .art-settings .art-setting-panel{display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:block}.art-video-player .art-settings .art-setting-panel .art-setting-item{height:35px;cursor:pointer;color:#fffc;justify-content:space-between;align-items:center;padding:0 5px;line-height:1;display:flex;overflow:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item:hover{color:#fff;background-color:#ffffff1a}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current{color:var(--theme)}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon{width:30px;height:30px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{visibility:hidden;height:15px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{white-space:nowrap;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{height:24px;width:24px;justify-content:center;align-items:center;margin-right:10px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{white-space:nowrap;color:#ffffff80;margin-right:5px;font-size:12px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{height:24px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-range{height:3px;width:80px;appearance:none;background-color:#fff3;outline:none}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid #ffffff1a}.art-video-player.art-setting-show .art-settings{display:block}.art-video-player.art-mobile .art-settings{max-height:200px}.art-video-player .art-info{z-index:100;width:350px;color:#fff;-webkit-font-smoothing:antialiased;background-color:#000000e6;flex-direction:column;padding:10px;font-family:Noto Sans CJK SC DemiLight,Roboto,Segoe UI,Tahoma,Arial,Helvetica,sans-serif;font-size:12px;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-info .art-info-item{margin-bottom:5px;display:flex}.art-video-player .art-info .art-info-item .art-info-title{width:100px;text-align:right}.art-video-player .art-info .art-info-item .art-info-content{text-overflow:ellipsis;white-space:nowrap;user-select:all;flex:1;padding-left:5px;overflow:hidden}.art-video-player .art-info .art-info-item:last-child{margin-bottom:0}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;top:5px;right:5px}.art-video-player.art-info-show .art-info{display:flex}.art-video-player.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio] video{box-sizing:content-box;object-fit:fill}.art-video-player.art-fullscreen-web{z-index:9999;width:100%;height:100%;position:fixed;inset:0}.art-video-player .art-mini-header{z-index:110;height:35px;color:#fff;opacity:0;visibility:hidden;background-color:#00000080;justify-content:space-between;align-items:center;line-height:35px;transition:all .2s ease-in-out;display:none;position:absolute;top:0;left:0;right:0}.art-video-player .art-mini-header .art-mini-title{text-overflow:ellipsis;white-space:nowrap;cursor:move;flex:1;padding:0 10px;overflow:hidden}.art-video-player .art-mini-header .art-mini-close{width:35px;text-align:center;cursor:pointer;font-size:22px}.art-video-player.art-is-dragging{opacity:.7}.art-video-player.art-mini{z-index:9999;width:400px;height:225px;position:fixed;box-shadow:0 2px 5px #00000029,0 3px 6px #0003}.art-video-player.art-mini .art-mini-header{user-select:none;display:flex}.art-video-player.art-mini.art-hover .art-mini-header{opacity:1;visibility:visible}.art-video-player.art-mini .art-mask .art-state{position:static}.art-video-player.art-mini .art-contextmenu,.art-video-player.art-mini .art-bottom,.art-video-player.art-mini .art-danmu,.art-video-player.art-mini .art-info,.art-video-player.art-mini .art-layers,.art-video-player.art-mini .art-notice,.art-video-player.art-mini .art-settings,.art-video-player.art-mini .art-subtitle{display:none!important}.art-auto-size{justify-content:center;align-items:center;display:flex}.art-auto-size .art-video-player{transition:all .2s}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layer-miniProgressBar{height:2px;background-color:var(--theme);display:block;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-layer-lock{height:34px;width:34px;color:#fff;background-color:#00000080;border-radius:50%;justify-content:center;align-items:center;display:none;position:absolute;top:calc(50% - 17px);left:15px}.art-video-player .art-layer-autoPlayback{background-color:#000c;border-radius:3px;align-items:center;padding:10px;line-height:1;display:none;position:absolute;bottom:60px;left:20px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close{cursor:pointer;align-items:center;margin-right:10px;display:flex}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close svg{width:15px;height:15px;fill:var(--theme)}.art-video-player .art-layer-autoPlayback .art-autoPlayback-last{margin-right:10px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-jump{color:var(--theme);cursor:pointer}.art-video-player.art-lock .art-bottom{display:none!important}.art-video-player.art-lock .art-subtitle{bottom:10px!important}.art-video-player.art-lock .art-layer-miniProgressBar{display:block!important}.art-video-player.art-control-show .art-layer-miniProgressBar{display:none}.art-video-player.art-control-show .art-layer-lock{display:flex}.art-video-player .art-control-selector{position:relative}.art-video-player .art-control-selector .art-selector-list{min-width:100px;max-width:200px;max-height:200px;text-align:center;color:#fff;background-color:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px;overflow:auto}.art-video-player .art-control-selector .art-selector-list .art-selector-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;padding:0 5px;line-height:30px;overflow:hidden}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{background-color:#ffffff1a}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover,.art-video-player .art-control-selector .art-selector-list .art-selector-item.art-current{color:var(--theme)}.art-video-player .art-control-selector:hover .art-selector-list{display:block}[class*=hint--]{font-style:normal;display:inline-block;position:relative}[class*=hint--]:before,[class*=hint--]:after{visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;transition:all .3s;position:absolute;transform:translate(0,0)}[class*=hint--]:hover:before,[class*=hint--]:hover:after{visibility:visible;opacity:1;transition-delay:.1s}[class*=hint--]:before{content:"";z-index:1000001;background:0 0;border:6px solid #0000;position:absolute}[class*=hint--]:after{color:#fff;white-space:nowrap;background:#000;padding:8px 10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;line-height:12px}[class*=hint--][aria-label]:after{content:attr(aria-label)}[class*=hint--][data-hint]:after{content:attr(data-hint)}[aria-label=""]:before,[aria-label=""]:after,[data-hint=""]:before,[data-hint=""]:after{display:none!important}.hint--top-left:before,.hint--top-right:before,.hint--top:before{border-top-color:#000}.hint--bottom-left:before,.hint--bottom-right:before,.hint--bottom:before{border-bottom-color:#000}.hint--left:before{border-left-color:#000}.hint--right:before{border-right-color:#000}.hint--top:before{margin-bottom:-11px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:before{left:calc(50% - 6px)}.hint--top:after{transform:translate(-50%)}.hint--top:hover:before{transform:translateY(-8px)}.hint--top:hover:after{transform:translate(-50%)translateY(-8px)}.hint--bottom:before{margin-top:-11px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:before{left:calc(50% - 6px)}.hint--bottom:after{transform:translate(-50%)}.hint--bottom:hover:before{transform:translateY(8px)}.hint--bottom:hover:after{transform:translate(-50%)translateY(8px)}.hint--right:before{margin-bottom:-6px;margin-left:-11px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{bottom:50%;left:100%}.hint--right:hover:before,.hint--right:hover:after{transform:translate(8px)}.hint--left:before{margin-bottom:-6px;margin-right:-11px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{bottom:50%;right:100%}.hint--left:hover:before,.hint--left:hover:after{transform:translate(-8px)}.hint--top-left:before{margin-bottom:-11px}.hint--top-left:before,.hint--top-left:after{bottom:100%;left:50%}.hint--top-left:before{left:calc(50% - 6px)}.hint--top-left:after{margin-left:12px;transform:translate(-100%)}.hint--top-left:hover:before{transform:translateY(-8px)}.hint--top-left:hover:after{transform:translate(-100%)translateY(-8px)}.hint--top-right:before{margin-bottom:-11px}.hint--top-right:before,.hint--top-right:after{bottom:100%;left:50%}.hint--top-right:before{left:calc(50% - 6px)}.hint--top-right:after{margin-left:-12px;transform:translate(0)}.hint--top-right:hover:before,.hint--top-right:hover:after{transform:translateY(-8px)}.hint--bottom-left:before{margin-top:-11px}.hint--bottom-left:before,.hint--bottom-left:after{top:100%;left:50%}.hint--bottom-left:before{left:calc(50% - 6px)}.hint--bottom-left:after{margin-left:12px;transform:translate(-100%)}.hint--bottom-left:hover:before{transform:translateY(8px)}.hint--bottom-left:hover:after{transform:translate(-100%)translateY(8px)}.hint--bottom-right:before{margin-top:-11px}.hint--bottom-right:before,.hint--bottom-right:after{top:100%;left:50%}.hint--bottom-right:before{left:calc(50% - 6px)}.hint--bottom-right:after{margin-left:-12px;transform:translate(0)}.hint--bottom-right:hover:before,.hint--bottom-right:hover:after{transform:translateY(8px)}.hint--small:after,.hint--medium:after,.hint--large:after{white-space:normal;word-wrap:break-word;line-height:1.4em}.hint--small:after{width:80px}.hint--medium:after{width:150px}.hint--large:after{width:300px}[class*=hint--]:after{text-shadow:0 -1px #000;box-shadow:4px 4px 8px #0000004d}.hint--error:after{text-shadow:0 -1px #592726;background-color:#b34e4d}.hint--error.hint--top-left:before,.hint--error.hint--top-right:before,.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom-left:before,.hint--error.hint--bottom-right:before,.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{text-shadow:0 -1px #6c5328;background-color:#c09854}.hint--warning.hint--top-left:before,.hint--warning.hint--top-right:before,.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom-left:before,.hint--warning.hint--bottom-right:before,.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{text-shadow:0 -1px #1a3c4d;background-color:#3986ac}.hint--info.hint--top-left:before,.hint--info.hint--top-right:before,.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom-left:before,.hint--info.hint--bottom-right:before,.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{text-shadow:0 -1px #1a321a;background-color:#458746}.hint--success.hint--top-left:before,.hint--success.hint--top-right:before,.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom-left:before,.hint--success.hint--bottom-right:before,.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:before{transform:translateY(-8px)}.hint--always.hint--top:after{transform:translate(-50%)translateY(-8px)}.hint--always.hint--top-left:before{transform:translateY(-8px)}.hint--always.hint--top-left:after{transform:translate(-100%)translateY(-8px)}.hint--always.hint--top-right:before,.hint--always.hint--top-right:after{transform:translateY(-8px)}.hint--always.hint--bottom:before{transform:translateY(8px)}.hint--always.hint--bottom:after{transform:translate(-50%)translateY(8px)}.hint--always.hint--bottom-left:before{transform:translateY(8px)}.hint--always.hint--bottom-left:after{transform:translate(-100%)translateY(8px)}.hint--always.hint--bottom-right:before,.hint--always.hint--bottom-right:after{transform:translateY(8px)}.hint--always.hint--left:before,.hint--always.hint--left:after{transform:translate(-8px)}.hint--always.hint--right:before,.hint--always.hint--right:after{transform:translate(8px)}.hint--rounded:after{border-radius:4px}.hint--no-animate:before,.hint--no-animate:after{transition-duration:0s}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s,visibility .3s,-webkit-transform .3s cubic-bezier(.71,1.7,.77,1.24);-moz-transition:opacity .3s,visibility .3s,-moz-transform .3s cubic-bezier(.71,1.7,.77,1.24);transition:opacity .3s,visibility .3s,transform .3s cubic-bezier(.71,1.7,.77,1.24)}.hint--no-shadow:before,.hint--no-shadow:after{text-shadow:initial;box-shadow:initial}.hint--no-arrow:before{display:none}'},{}],bAWi2:[function(G,ee,W){ee.exports=function(){function O(E){return(O=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R})(E)}var C=Object.prototype.toString,b=function(E){if(E===void 0)return"undefined";if(E===null)return"null";var R=O(E);if(R==="boolean")return"boolean";if(R==="string")return"string";if(R==="number")return"number";if(R==="symbol")return"symbol";if(R==="function")return function(x){return a(x)==="GeneratorFunction"}(E)?"generatorfunction":"function";if(function(x){return Array.isArray?Array.isArray(x):x instanceof Array}(E))return"array";if(function(x){return!(!x.constructor||typeof x.constructor.isBuffer!="function")&&x.constructor.isBuffer(x)}(E))return"buffer";if(function(x){try{if(typeof x.length=="number"&&typeof x.callee=="function")return!0}catch(A){if(A.message.indexOf("callee")!==-1)return!0}return!1}(E))return"arguments";if(function(x){return x instanceof Date||typeof x.toDateString=="function"&&typeof x.getDate=="function"&&typeof x.setDate=="function"}(E))return"date";if(function(x){return x instanceof Error||typeof x.message=="string"&&x.constructor&&typeof x.constructor.stackTraceLimit=="number"}(E))return"error";if(function(x){return x instanceof RegExp||typeof x.flags=="string"&&typeof x.ignoreCase=="boolean"&&typeof x.multiline=="boolean"&&typeof x.global=="boolean"}(E))return"regexp";switch(a(E)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(x){return typeof x.throw=="function"&&typeof x.return=="function"&&typeof x.next=="function"}(E))return"generator";switch(R=C.call(E)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return R.slice(8,-1).toLowerCase().replace(/\s/g,"")};function a(E){return E.constructor?E.constructor.name:null}function g(E,R){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:["option"];return d(E,R,x),S(E,R,x),function(A,D,P){var I=b(D),c=b(A);if(I==="object"){if(c!=="object")throw new Error("[Type Error]: '".concat(P.join("."),"' require 'object' type, but got '").concat(c,"'"));Object.keys(D).forEach(function(m){var _=A[m],o=D[m],i=P.slice();i.push(m),d(_,o,i),S(_,o,i),g(_,o,i)})}if(I==="array"){if(c!=="array")throw new Error("[Type Error]: '".concat(P.join("."),"' require 'array' type, but got '").concat(c,"'"));A.forEach(function(m,_){var o=A[_],i=D[_]||D[0],t=P.slice();t.push(_),d(o,i,t),S(o,i,t),g(o,i,t)})}}(E,R,x),E}function d(E,R,x){if(b(R)==="string"){var A=b(E);if(R[0]==="?"&&(R=R.slice(1)+"|undefined"),!(-1<R.indexOf("|")?R.split("|").map(function(D){return D.toLowerCase().trim()}).filter(Boolean).some(function(D){return A===D}):R.toLowerCase().trim()===A))throw new Error("[Type Error]: '".concat(x.join("."),"' require '").concat(R,"' type, but got '").concat(A,"'"))}}function S(E,R,x){if(b(R)==="function"){var A=R(E,b(E),x);if(A!==!0){var D=b(A);throw D==="string"?new Error(A):D==="error"?A:new Error("[Validator Error]: The scheme for '".concat(x.join("."),"' validator require return true, but got '").concat(A,"'"))}}}return g.kindOf=b,g}()},{}],"66mFZ":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W),W.default=class{on(O,C,b){const a=this.e||(this.e={});return(a[O]||(a[O]=[])).push({fn:C,ctx:b}),this}once(O,C,b){const a=this;function g(...d){a.off(O,g),C.apply(b,d)}return g._=C,this.on(O,g,b)}emit(O,...C){const b=((this.e||(this.e={}))[O]||[]).slice();for(let a=0;a<b.length;a+=1)b[a].fn.apply(b[a].ctx,C);return this}off(O,C){const b=this.e||(this.e={}),a=b[O],g=[];if(a&&C)for(let d=0,S=a.length;d<S;d+=1)a[d].fn!==C&&a[d].fn._!==C&&g.push(a[d]);return g.length?b[O]=g:delete b[O],this}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(G,ee,W){W.interopDefault=function(O){return O&&O.__esModule?O:{default:O}},W.defineInteropFlag=function(O){Object.defineProperty(O,"__esModule",{value:!0})},W.exportAll=function(O,C){return Object.keys(O).forEach(function(b){b==="default"||b==="__esModule"||C.hasOwnProperty(b)||Object.defineProperty(C,b,{enumerable:!0,get:function(){return O[b]}})}),C},W.export=function(O,C,b){Object.defineProperty(O,C,{enumerable:!0,get:b})}},{}],"71aH7":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("./dom");O.exportAll(C,W);var b=G("./error");O.exportAll(b,W);var a=G("./subtitle");O.exportAll(a,W);var g=G("./file");O.exportAll(g,W);var d=G("./property");O.exportAll(d,W);var S=G("./time");O.exportAll(S,W);var E=G("./format");O.exportAll(E,W);var R=G("./compatibility");O.exportAll(R,W)},{"./dom":"bSNiV","./error":"hwmZz","./subtitle":"inzwq","./file":"6b7Ip","./property":"5NSdr","./time":"epmNy","./format":"gapRl","./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bSNiV:[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W),O.export(W,"query",()=>b),O.export(W,"queryAll",()=>a),O.export(W,"addClass",()=>g),O.export(W,"removeClass",()=>d),O.export(W,"hasClass",()=>S),O.export(W,"append",()=>E),O.export(W,"remove",()=>R),O.export(W,"setStyle",()=>x),O.export(W,"setStyles",()=>A),O.export(W,"getStyle",()=>D),O.export(W,"sublings",()=>P),O.export(W,"inverseClass",()=>I),O.export(W,"tooltip",()=>c),O.export(W,"isInViewport",()=>m),O.export(W,"includeFromEvent",()=>_),O.export(W,"replaceElement",()=>o),O.export(W,"createElement",()=>i);var C=G("./compatibility");function b(t,r=document){return r.querySelector(t)}function a(t,r=document){return Array.from(r.querySelectorAll(t))}function g(t,r){return t.classList.add(r)}function d(t,r){return t.classList.remove(r)}function S(t,r){return t.classList.contains(r)}function E(t,r){return r instanceof Element?t.appendChild(r):t.insertAdjacentHTML("beforeend",String(r)),t.lastElementChild||t.lastChild}function R(t){return t.parentNode.removeChild(t)}function x(t,r,l){return t.style[r]=l,t}function A(t,r){return Object.keys(r).forEach(l=>{x(t,l,r[l])}),t}function D(t,r,l=!0){const p=window.getComputedStyle(t,null).getPropertyValue(r);return l?parseFloat(p):p}function P(t){return Array.from(t.parentElement.children).filter(r=>r!==t)}function I(t,r){P(t).forEach(l=>d(l,r)),g(t,r)}function c(t,r,l="top"){C.isMobile||(t.setAttribute("aria-label",r),g(t,"hint--rounded"),g(t,`hint--${l}`))}function m(t,r=0){const l=t.getBoundingClientRect(),p=window.innerHeight||document.documentElement.clientHeight,u=window.innerWidth||document.documentElement.clientWidth,f=l.top-r<=p&&l.top+l.height+r>=0,L=l.left-r<=u+r&&l.left+l.width+r>=0;return f&&L}function _(t,r){return t.composedPath&&t.composedPath().indexOf(r)>-1}function o(t,r){return r.parentNode.replaceChild(t,r),t}function i(t){return document.createElement(t)}},{"./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6ZTr6":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W),O.export(W,"userAgent",()=>C),O.export(W,"isMobile",()=>b),O.export(W,"isSafari",()=>a),O.export(W,"isWechat",()=>g),O.export(W,"isIE",()=>d),O.export(W,"isAndroid",()=>S),O.export(W,"isIOS",()=>E);const C=typeof window!="undefined"?window.navigator.userAgent:"",b=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(C),a=/^((?!chrome|android).)*safari/i.test(C),g=/MicroMessenger/i.test(C),d=/MSIE|Trident/i.test(C),S=/android/i.test(C),E=/iPad|iPhone|iPod/i.test(C)&&!window.MSStream},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hwmZz:[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W),O.export(W,"ArtPlayerError",()=>C),O.export(W,"errorHandle",()=>b);class C extends Error{constructor(g,d){super(g),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,d||this.constructor),this.name="ArtPlayerError"}}function b(a,g){if(!a)throw new C(g);return a}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],inzwq:[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");function C(g){return`WEBVTT \r
\r
`.concat((d=g,d.replace(/(\d\d:\d\d:\d\d)[,.](\d+)/g,(S,E,R)=>{let x=R.slice(0,3);return R.length===1&&(x=R+"00"),R.length===2&&(x=R+"0"),`${E},${x}`})).replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").replace(/{[\s\S]*?}/g,"").concat(`\r
\r
`));var d}function b(g){return URL.createObjectURL(new Blob([g],{type:"text/vtt"}))}function a(g){const d=new RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function S(E=""){return E.split(/[:.]/).map((R,x,A)=>{if(x===A.length-1){if(R.length===1)return`.${R}00`;if(R.length===2)return`.${R}0`}else if(R.length===1)return(x===0?"0":":0")+R;return x===0?R:x===A.length-1?`.${R}`:`:${R}`}).join("")}return`WEBVTT

${g.split(/\r?\n/).map(E=>{const R=E.match(d);return R?{start:S(R[1].trim()),end:S(R[2].trim()),text:R[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,`
`).trim().split(/\r?\n/).map(x=>x.trim()).join(`
`)}:null}).filter(E=>E).map((E,R)=>E?`${R+1}
${E.start} --> ${E.end}
${E.text}`:"").filter(E=>E.trim()).join(`

`)}`}O.defineInteropFlag(W),O.export(W,"srtToVtt",()=>C),O.export(W,"vttToBlob",()=>b),O.export(W,"assToVtt",()=>a)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6b7Ip":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");function C(a){return a.includes("?")?C(a.split("?")[0]):a.includes("#")?C(a.split("#")[0]):a.trim().toLowerCase().split(".").pop()}function b(a,g){const d=document.createElement("a");d.style.display="none",d.href=a,d.download=g,document.body.appendChild(d),d.click(),document.body.removeChild(d)}O.defineInteropFlag(W),O.export(W,"getExt",()=>C),O.export(W,"download",()=>b)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5NSdr":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W),O.export(W,"def",()=>C),O.export(W,"has",()=>a),O.export(W,"get",()=>g),O.export(W,"mergeDeep",()=>d);const C=Object.defineProperty,{hasOwnProperty:b}=Object.prototype;function a(S,E){return b.call(S,E)}function g(S,E){return Object.getOwnPropertyDescriptor(S,E)}function d(...S){const E=R=>R&&typeof R=="object"&&!Array.isArray(R);return S.reduce((R,x)=>(Object.keys(x).forEach(A=>{const D=R[A],P=x[A];Array.isArray(D)&&Array.isArray(P)?R[A]=D.concat(...P):!E(D)||!E(P)||P instanceof Element?R[A]=P:R[A]=d(D,P)}),R),{})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],epmNy:[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");function C(g=0){return new Promise(d=>setTimeout(d,g))}function b(g,d,S){let E;function R(...x){clearTimeout(E),E=setTimeout(function(){E=null,g.apply(S,x)},d)}return R.clearTimeout=function(){clearTimeout(E)},R}function a(g,d){let S,E,R=!1;return function x(...A){if(R)return S=A,void(E=this);R=!0,g.apply(this,A),setTimeout(()=>{R=!1,S&&(x.apply(E,S),S=null,E=null)},d)}}O.defineInteropFlag(W),O.export(W,"sleep",()=>C),O.export(W,"debounce",()=>b),O.export(W,"throttle",()=>a)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gapRl:[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");function C(S,E,R){return Math.max(Math.min(S,Math.max(E,R)),Math.min(E,R))}function b(S){return S.charAt(0).toUpperCase()+S.slice(1)}function a(S){return["string","number"].includes(typeof S)}function g(S){const E=Math.floor(S/3600),R=Math.floor((S-3600*E)/60),x=Math.floor(S-3600*E-60*R);return(E>0?[E,R,x]:[R,x]).map(A=>A<10?`0${A}`:String(A)).join(":")}function d(S){return S.replace(/[&<>'"]/g,E=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[E]||E)}O.defineInteropFlag(W),O.export(W,"clamp",()=>C),O.export(W,"capitalize",()=>b),O.export(W,"isStringOrNumber",()=>a),O.export(W,"secondToTime",()=>g),O.export(W,"escape",()=>d)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],AKEiO:[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W),O.export(W,"ComponentOption",()=>x);var C=G("../utils");const b="array",a="boolean",g="string",d="number",S="object",E="function";function R(A,D,P){return(0,C.errorHandle)(D===g||D===d||A instanceof Element,`${P.join(".")} require '${g}' or 'Element' type`)}const x={html:R,disable:`?${a}`,name:`?${g}`,index:`?${d}`,style:`?${S}`,click:`?${E}`,mounted:`?${E}`,tooltip:`?${g}|${d}`,width:`?${d}`,selector:`?${b}`,onSelect:`?${E}`,switch:`?${a}`,onSwitch:`?${E}`,range:`?${b}`,onRange:`?${E}`,onChange:`?${E}`};W.default={id:g,container:R,url:g,poster:g,title:g,type:g,theme:g,lang:g,volume:d,isLive:a,muted:a,autoplay:a,autoSize:a,autoMini:a,loop:a,flip:a,playbackRate:a,aspectRatio:a,screenshot:a,setting:a,hotkey:a,pip:a,mutex:a,backdrop:a,fullscreen:a,fullscreenWeb:a,subtitleOffset:a,miniProgressBar:a,useSSR:a,playsInline:a,lock:a,fastForward:a,autoPlayback:a,autoOrientation:a,airplay:a,plugins:[E],whitelist:[`${g}|${E}|regexp`],layers:[x],contextmenu:[x],settings:[x],controls:[et($e({},x),{position:(A,D,P)=>{const I=["top","left","right"];return(0,C.errorHandle)(I.includes(A),`${P.join(".")} only accept ${I.toString()} as parameters`)}})],quality:[{default:`?${a}`,html:g,url:g}],highlight:[{time:d,text:g}],thumbnails:{url:g,number:d,column:d,width:d,height:d},subtitle:{url:g,type:g,style:S,escape:a,encoding:g},moreVideoAttr:S,i18n:S,icons:S,customType:S}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lyjeQ:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W),W.default={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9L0ao":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("./utils");W.default=class{constructor(C){this.art=C}get state(){const{option:C,constructor:{kindOf:b}}=this.art;return!O.isMobile||!C.whitelist.length||C.whitelist.some(a=>{switch(b(a)){case"string":return a==="*"||O.userAgent.indexOf(a)>-1;case"function":return a(O.userAgent);case"regexp":return a.test(O.userAgent);default:return!1}})}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],X13Zf:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("./utils");class C{constructor(a){this.art=a;const{option:g,constructor:d,whitelist:S}=a;g.container instanceof Element?this.$container=g.container:(this.$container=(0,O.query)(g.container),(0,O.errorHandle)(this.$container,`No container element found by ${g.container}`));const E=this.$container.tagName.toLowerCase();(0,O.errorHandle)(E==="div",`Unsupported container element type, only support 'div' but got '${E}'`),(0,O.errorHandle)(d.instances.every(R=>R.template.$container!==this.$container),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=a.id,this.$original=this.$container.cloneNode(!0),S.state?this.desktop():this.mobile()}static get html(){return'<div class="art-video-player art-subtitle-show art-layer-show art-control-show art-mask-show"><video class="art-video"><track default kind="metadata" src=""></track></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-center"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">4.6.2</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span> x <span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-mini-header"><div class="art-mini-title"></div><div class="art-mini-close">\xD7</div></div><div class="art-contextmenus"></div></div>'}query(a){return(0,O.query)(a,this.$container)}desktop(){const{option:a}=this.art;a.useSSR||(this.$container.innerHTML=C.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$track=this.query("track"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsCenter=this.query(".art-controls-center"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$miniHeader=this.query(".art-mini-header"),this.$miniTitle=this.query(".art-mini-title"),this.$miniClose=this.query(".art-mini-close"),this.$contextmenu=this.query(".art-contextmenus"),a.backdrop&&((0,O.addClass)(this.$setting,"art-backdrop-filter"),(0,O.addClass)(this.$contextmenu,"art-backdrop-filter"),(0,O.addClass)(this.$info,"art-backdrop-filter")),O.isMobile&&(0,O.addClass)(this.$player,"art-mobile")}mobile(){this.$container.innerHTML='<div class="art-video-player"><video class="art-video"></video></div>',this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video")}destroy(a){a?(0,O.replaceElement)(this.$original,this.$container):(0,O.addClass)(this.$player,"art-destroy")}}W.default=C},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3jKkj":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("../utils"),b=G("./zh-cn.json"),a=O.interopDefault(b),g=G("./zh-tw.json"),d=O.interopDefault(g),S=G("./pl.json"),E=O.interopDefault(S),R=G("./cs.json"),x=O.interopDefault(R),A=G("./es.json"),D=O.interopDefault(A),P=G("./fa.json"),I=O.interopDefault(P);W.default=class{constructor(c){this.art=c,this.languages={"zh-cn":a.default,"zh-tw":d.default,pl:E.default,cs:x.default,es:D.default,fa:I.default},this.update(c.option.i18n)}init(){const c=this.art.option.lang.toLowerCase();this.language=this.languages[c]||{}}get(c){return this.language[c]||c}update(c){this.languages=(0,C.mergeDeep)(this.languages,c),this.init()}}},{"../utils":"71aH7","./zh-cn.json":"lNQi5","./zh-tw.json":"eRpom","./pl.json":"iEpPa","./cs.json":"dBgp3","./es.json":"dNIrL","./fa.json":"7Plhe","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lNQi5:[function(G,ee,W){ee.exports=JSON.parse('{"Video Info":"\u7EDF\u8BA1\u4FE1\u606F","Close":"\u5173\u95ED","Video Load Failed":"\u52A0\u8F7D\u5931\u8D25","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u6682\u505C","Rate":"\u901F\u5EA6","Mute":"\u9759\u97F3","Video Flip":"\u753B\u9762\u7FFB\u8F6C","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u8FDE\u63A5","Show Setting":"\u663E\u793A\u8BBE\u7F6E","Hide Setting":"\u9690\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u56FE","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u753B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8BA4","Normal":"\u6B63\u5E38","Open":"\u6253\u5F00","Switch Video":"\u5207\u6362","Switch Subtitle":"\u5207\u6362\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7F51\u9875\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7F51\u9875\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u5F00\u542F\u753B\u4E2D\u753B","Exit PIP Mode":"\u9000\u51FA\u753B\u4E2D\u753B","PIP Not Supported":"\u4E0D\u652F\u6301\u753B\u4E2D\u753B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F6C\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],eRpom:[function(G,ee,W){ee.exports=JSON.parse('{"Video Info":"\u7D71\u8A08\u8A0A\u606F","Close":"\u95DC\u9589","Video Load Failed":"\u8F09\u5165\u5931\u6557","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u66AB\u505C","Rate":"\u901F\u5EA6","Mute":"\u975C\u97F3","Video Flip":"\u756B\u9762\u7FFB\u8F49","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u9023\u63A5","Show Setting":"\u986F\u793A\u8BBE\u7F6E","Hide Setting":"\u96B1\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u5716","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u756B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8A8D","Normal":"\u6B63\u5E38","Open":"\u6253\u958B","Switch Video":"\u5207\u63DB","Switch Subtitle":"\u5207\u63DB\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7DB2\u9801\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u958B\u555F\u756B\u4E2D\u756B","Exit PIP Mode":"\u9000\u51FA\u756B\u4E2D\u756B","PIP Not Supported":"\u4E0D\u652F\u6301\u756B\u4E2D\u756B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F49\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],iEpPa:[function(G,ee,W){ee.exports=JSON.parse('{"Video Info":"Informacje o wideo","Close":"Zamknij","Video Load Failed":"B\u0142\u0105d \u0142adowania wideo","Volume":"G\u0142o\u015Bno\u015B\u0107","Play":"Odtw\xF3rz","Pause":"Wstrzymaj","Rate":"Oce\u0144","Mute":"Wycisz","Video Flip":"Rotacja wideo","Horizontal":"Pozioma","Vertical":"Pionowa","Reconnect":"Po\u0142\u0105cz ponownie","Show Setting":"Poka\u017C ustawienia","Hide Setting":"Ukryj ustawienia","Screenshot":"Zrzut ekranu","Play Speed":"Pr\u0119dko\u015B\u0107 odtwarzania","Aspect Ratio":"Wsp\xF3\u0142czynnik proporcji","Default":"Domy\u015Blny","Normal":"Normalny","Open":"Otw\xF3rz","Switch Video":"Prze\u0142\u0105cz wideo","Switch Subtitle":"Prze\u0142\u0105cz napisy","Fullscreen":"Pe\u0142ny ekran","Exit Fullscreen":"Zamknij pe\u0142ny ekran","Web Fullscreen":"Tryb pe\u0142nej strony","Exit Web Fullscreen":"Zamknij tryb pe\u0142nej strony","Mini Player":"Miniodtwarzacz","PIP Mode":"Tryb PiP","Exit PIP Mode":"Zamknij tryb PiP","PIP Not Supported":"Tryb PiP nieobs\u0142ugiwany","Fullscreen Not Supported":"Pe\u0142ny ekran nieobs\u0142ugiwany","Subtitle Offset":"Przesuni\u0119cie napis\xF3w","Last Seen":"Ostatnio widziany","Jump Play":"Skocz do gry","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nie jest dost\u0119pny"}')},{}],dBgp3:[function(G,ee,W){ee.exports=JSON.parse('{"Video Info":"Info o videu","Close":"Zav\u0159\xEDt","Video Load Failed":"Nahr\xE1n\xED videa selhalo","Volume":"Hlasitost","Play":"P\u0159ehr\xE1t","Pause":"Pozastavit","Rate":"Hodnocen\xED","Mute":"Ztlumit","Video Flip":"Oto\u010Dit video","Horizontal":"Horizont\xE1ln\u011B","Vertical":"Vertik\xE1ln\u011B","Reconnect":"Op\u011Btovn\xE9 p\u0159ipojen\xED","Show Setting":"Zobrazit nastaven\xED","Hide Setting":"Skr\xFDt nastaven\xED","Screenshot":"Sn\xEDmek obrazovky","Play Speed":"Rychlost p\u0159ehr\xE1v\xE1n\xED","Aspect Ratio":"Pom\u011Br stran","Default":"V\xFDchoz\xED","Normal":"Norm\xE1ln\xED","Open":"Otev\u0159\xEDt","Switch Video":"P\u0159epnout video","Switch Subtitle":"P\u0159epnout titulky","Fullscreen":"Cel\xE1 obrazovka","Exit Fullscreen":"Opustit re\u017Eim cel\xE9 obrazovky","Web Fullscreen":"Cel\xE1 str\xE1nka","Exit Web Fullscreen":"Zav\u0159\xEDt re\u017Eim cel\xE9 str\xE1nky","Mini Player":"Mini p\u0159ehr\xE1va\u010D","PIP Mode":"Re\u017Eim PIP","Exit PIP Mode":"Opustit re\u017Eim PIP","PIP Not Supported":"Re\u017Eim PIP nen\xED podporov\xE1n","Fullscreen Not Supported":"Re\u017Eim cel\xE9 obrazovky nen\xED podporov\xE1n","Subtitle Offset":"Posun titulk\u016F","Last Seen":"Naposledy vid\u011Bn","Jump Play":"Hra na skok","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nen\xED k dispozici"}')},{}],dNIrL:[function(G,ee,W){ee.exports=JSON.parse('{"Video Info":"Informaci\xF3n del video","Close":"Cerrar","Video Load Failed":"Fall\xF3 carga de video","Volume":"Volumen","Play":"Reproduciendo","Pause":"Pausa","Rate":"Velocidad","Mute":"Silencio","Video Flip":"Rotar video","Horizontal":"Horizontal","Vertical":"Vertical","Reconnect":"Reconectando","Show Setting":"Mostrar ajustes","Hide Setting":"Ocultar ajustes","Screenshot":"Captura de Pantalla","Play Speed":"Velocidad de reproducci\xF3n","Aspect Ratio":"Relaci\xF3n de aspecto","Default":"Por defecto","Normal":"Normal","Open":"Abrir","Switch Video":"Cambiar video","Switch Subtitle":"Cambiar subt\xEDtulo","Fullscreen":"Pantalla completa","Exit Fullscreen":"Salir de Pantalla completa","Web Fullscreen":"Pantalla completa Web","Exit Web Fullscreen":"Salir de Pantalla completa","Mini Player":"Mini reproductor","PIP Mode":"Modo PiP","Exit PIP Mode":"Cerrar modo PiP","PIP Not Supported":"Modo PiP no compatible","Fullscreen Not Supported":"Pantalla completa no soportada","Subtitle Offset":"Ajuste subt\xEDtulo","Last Seen":"Visto \xFAltima vez","Jump Play":"Saltar","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay no disponible"}')},{}],"7Plhe":[function(G,ee,W){ee.exports=JSON.parse('{"Video Info":"\u0627\u0637\u0644\u0627\u0639\u0627\u062A \u0648\u06CC\u062F\u06CC\u0648","Close":"\u0628\u0633\u062A\u0646","Video Load Failed":"\u0628\u0627\u0631\u06AF\u0630\u0627\u0631\u06CC \u0646\u0627\u0645\u0648\u0641\u0642","Play":"\u067E\u062E\u0634","Volume":"\u0645\u06CC\u0632\u0627\u0646 \u0635\u062F\u0627","Pause":"\u062A\u0648\u0642\u0641","Rate":"\u0646\u0631\u062E","Mute":"\u0633\u06A9\u0648\u062A","Video Flip":"\u0686\u0631\u062E\u0634 \u062A\u0635\u0648\u06CC\u0631","Horizontal":"\u0627\u0641\u0642\u06CC","Vertical":"\u0639\u0645\u0648\u062F\u06CC","Reconnect":"\u0627\u062A\u0635\u0627\u0644 \u0645\u062C\u062F\u062F","Show Setting":"\u062A\u0646\u0638\u06CC\u0645\u0627\u062A","Hide Setting":"\u0628\u0633\u062A\u0646 \u062A\u0646\u0638\u06CC\u0645\u0627\u062A","Screenshot":"\u0639\u06A9\u0633 \u0627\u0632 \u0635\u0641\u062D\u0647","Play Speed":"\u0633\u0631\u0639\u062A \u067E\u062E\u0634","Aspect Ratio":"\u0646\u0633\u0628\u062A \u062A\u0635\u0648\u06CC\u0631","Default":"\u062D\u0627\u0644\u062A \u067E\u06CC\u0634\u0641\u0631\u0636","Normal":" \u062D\u0627\u0644\u062A \u0639\u0627\u062F\u06CC","Open":"\u0628\u0627\u0632\u06A9\u0631\u062F\u0646","Switch Video":"\u062A\u063A\u06CC\u06CC\u0631 \u0648\u06CC\u062F\u06CC\u0648","Switch Subtitle":"\u0646\u063A\u06CC\u06CC\u0631 \u0632\u06CC\u0631\u0646\u0648\u06CC\u0633","Fullscreen":"\u062A\u0645\u0627\u0645 \u0635\u0641\u062D\u0647","Exit Fullscreen":"\u06A9\u0648\u0686\u06A9 \u06A9\u0631\u062F\u0646","Web Fullscreen":"\u062D\u0627\u0644\u062A \u062A\u0626\u0627\u062A\u0631","Exit Web Fullscreen":"\u062E\u0631\u0648\u062C \u0627\u0632 \u062D\u0627\u0644\u062A \u062A\u0626\u0627\u062A\u0631","Mini Player":"\u062D\u0627\u0644\u062A \u067E\u062E\u0634 \u06A9\u0648\u0686\u06A9","PIP Mode":" \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","Exit PIP Mode":"\u062E\u0631\u0648\u062C \u0627\u0632 \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","PIP Not Supported":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","Fullscreen Not Supported":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u062D\u0627\u0644\u062A \u062A\u0645\u0627\u0645 \u0635\u0641\u062D\u0647","Subtitle Offset":"\u0627\u0641\u0633\u062A \u0632\u06CC\u0631\u0646\u0648\u06CC\u0633","Last Seen":"\u0622\u062E\u0631\u06CC\u0646 \u0628\u0627\u0632\u062F\u06CC\u062F","Jump Play":"\u062C\u0627\u0645\u067E \u067E\u0644\u06CC","AirPlay":"\u0627\u06CC\u0631 \u067E\u0644\u06CC","AirPlay Not Available":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u0627\u06CC\u0631\u067E\u0644\u06CC"}')},{}],a90nx:[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("./urlMix"),b=O.interopDefault(C),a=G("./attrMix"),g=O.interopDefault(a),d=G("./playMix"),S=O.interopDefault(d),E=G("./pauseMix"),R=O.interopDefault(E),x=G("./toggleMix"),A=O.interopDefault(x),D=G("./seekMix"),P=O.interopDefault(D),I=G("./volumeMix"),c=O.interopDefault(I),m=G("./currentTimeMix"),_=O.interopDefault(m),o=G("./durationMix"),i=O.interopDefault(o),t=G("./switchMix"),r=O.interopDefault(t),l=G("./playbackRateMix"),p=O.interopDefault(l),u=G("./aspectRatioMix"),f=O.interopDefault(u),L=G("./screenshotMix"),v=O.interopDefault(L),y=G("./fullscreenMix"),n=O.interopDefault(y),s=G("./fullscreenWebMix"),e=O.interopDefault(s),h=G("./pipMix"),M=O.interopDefault(h),T=G("./loadedMix"),B=O.interopDefault(T),N=G("./playedMix"),j=O.interopDefault(N),z=G("./playingMix"),K=O.interopDefault(z),V=G("./autoSizeMix"),$=O.interopDefault(V),X=G("./rectMix"),Z=O.interopDefault(X),q=G("./flipMix"),te=O.interopDefault(q),ue=G("./miniMix"),oe=O.interopDefault(ue),le=G("./loopMix"),me=O.interopDefault(le),_e=G("./posterMix"),ve=O.interopDefault(_e),ce=G("./autoHeightMix"),he=O.interopDefault(ce),Le=G("./themeMix"),De=O.interopDefault(Le),Fe=G("./titleMix"),Oe=O.interopDefault(Fe),ke=G("./typeMix"),Ie=O.interopDefault(ke),we=G("./normalSizeMix"),Ue=O.interopDefault(we),We=G("./subtitleOffsetMix"),tt=O.interopDefault(We),je=G("./airplayMix"),Je=O.interopDefault(je),ot=G("./optionInit"),He=O.interopDefault(ot),ut=G("./eventInit"),Qe=O.interopDefault(ut);W.default=class{constructor(be){(0,b.default)(be),(0,g.default)(be),(0,S.default)(be),(0,R.default)(be),(0,A.default)(be),(0,P.default)(be),(0,c.default)(be),(0,_.default)(be),(0,i.default)(be),(0,r.default)(be),(0,p.default)(be),(0,f.default)(be),(0,v.default)(be),(0,n.default)(be),(0,e.default)(be),(0,M.default)(be),(0,B.default)(be),(0,j.default)(be),(0,K.default)(be),(0,$.default)(be),(0,Z.default)(be),(0,te.default)(be),(0,oe.default)(be),(0,me.default)(be),(0,ve.default)(be),(0,he.default)(be),(0,De.default)(be),(0,Oe.default)(be),(0,Ie.default)(be),(0,Ue.default)(be),(0,tt.default)(be),(0,Je.default)(be),(0,Qe.default)(be),(0,He.default)(be)}}},{"./urlMix":"kQoac","./attrMix":"deCma","./playMix":"fOJuP","./pauseMix":"fzHAy","./toggleMix":"cBHxQ","./seekMix":"koAPr","./volumeMix":"6eyuR","./currentTimeMix":"faaWv","./durationMix":"5y91K","./switchMix":"iceD8","./playbackRateMix":"keKwh","./aspectRatioMix":"jihET","./screenshotMix":"36kPY","./fullscreenMix":"2GYOJ","./fullscreenWebMix":"5aYAP","./pipMix":"7EnIB","./loadedMix":"3N9mP","./playedMix":"et96R","./playingMix":"9DzzM","./autoSizeMix":"i1LDY","./rectMix":"IqARI","./flipMix":"7E7Vs","./miniMix":"gpugx","./loopMix":"f1hVG","./posterMix":"1SuFS","./autoHeightMix":"8x4te","./themeMix":"2FqhO","./titleMix":"7Am53","./typeMix":"1fQQs","./normalSizeMix":"ePkBr","./subtitleOffsetMix":"6vlBV","./airplayMix":"eftqT","./optionInit":"fCWZK","./eventInit":"f8Lv3","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kQoac:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{option:b,template:{$video:a}}=C;(0,O.def)(C,"url",{get:()=>a.currentSrc,set(d){return st(this,null,function*(){if(d){const S=b.type||(0,O.getExt)(d),E=b.customType[S];S&&E?(yield(0,O.sleep)(),C.loading.show=!0,E.call(C,a,d,C)):(C.url&&C.url!==d&&C.once("video:canplay",()=>{C.isReady&&C.emit("restart")}),a.src=d,C.option.url=d,C.emit("url",d))}else yield(0,O.sleep)(),C.loading.show=!0})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],deCma:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{template:{$video:b}}=C;(0,O.def)(C,"attr",{value(a,g){if(g===void 0)return b[a];b[a]=g}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fOJuP:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{i18n:b,notice:a,option:g,constructor:{instances:d},template:{$video:S}}=C;(0,O.def)(C,"play",{value:function(){return st(this,null,function*(){const E=yield S.play();if(a.show=b.get("Play"),C.emit("play"),g.mutex)for(let R=0;R<d.length;R++){const x=d[R];x!==C&&x.pause()}return E})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fzHAy:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{template:{$video:b},i18n:a,notice:g}=C;(0,O.def)(C,"pause",{value(){const d=b.pause();return g.show=a.get("Pause"),C.emit("pause"),d}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cBHxQ:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){(0,O.def)(C,"toggle",{value:()=>C.playing?C.pause():C.play()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],koAPr:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{notice:b}=C;(0,O.def)(C,"seek",{set(a){C.currentTime=a,C.emit("seek",C.currentTime),C.duration&&(b.show=`${(0,O.secondToTime)(C.currentTime)} / ${(0,O.secondToTime)(C.duration)}`)}}),(0,O.def)(C,"forward",{set(a){C.seek=C.currentTime+a}}),(0,O.def)(C,"backward",{set(a){C.seek=C.currentTime-a}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6eyuR":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{template:{$video:b},i18n:a,notice:g,storage:d}=C;(0,O.def)(C,"volume",{get:()=>b.volume||0,set:S=>{b.volume=(0,O.clamp)(S,0,1),g.show=`${a.get("Volume")}: ${parseInt(100*b.volume,10)}`,b.volume!==0&&d.set("volume",b.volume)}}),(0,O.def)(C,"muted",{get:()=>b.muted,set:S=>{b.muted=S}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],faaWv:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{$video:b}=C.template;(0,O.def)(C,"currentTime",{get:()=>b.currentTime||0,set:a=>{a=parseFloat(a),Number.isNaN(a)||(b.currentTime=(0,O.clamp)(a,0,C.duration))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5y91K":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){(0,O.def)(C,"duration",{get:()=>{const{duration:b}=C.template.$video;return b===1/0?0:b||0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],iceD8:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{i18n:b,option:a,notice:g}=C;function d(S,E,R){return new Promise(x=>{if(S===C.url)return x(S);const{playing:A}=C;C.pause(),URL.revokeObjectURL(C.url),C.url=S,C.once("video:canplay",()=>{C.playbackRate=!1,C.aspectRatio=!1,C.flip="normal",C.autoSize=a.autoSize,C.currentTime=R,C.notice.show="",A&&C.play(),E&&(g.show=`${b.get("Switch Video")}: ${E}`),x(S)})})}(0,O.def)(C,"switchQuality",{value:(S,E)=>d(S,E,C.currentTime)}),(0,O.def)(C,"switchUrl",{value:(S,E)=>d(S,E,0)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],keKwh:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{template:{$video:b},i18n:a,notice:g}=C;(0,O.def)(C,"playbackRate",{get:()=>b.playbackRate,set(d){if(d){if(d===b.playbackRate)return;b.playbackRate=d,g.show=`${a.get("Rate")}: ${d===1?a.get("Normal"):`${d}x`}`}else C.playbackRate=1}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jihET:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{template:{$video:b,$player:a},i18n:g,notice:d}=C;(0,O.def)(C,"aspectRatio",{get:()=>a.dataset.aspectRatio||"default",set(S){if(S||(S="default"),S==="default")(0,O.setStyle)(b,"width",null),(0,O.setStyle)(b,"height",null),(0,O.setStyle)(b,"padding",null),delete a.dataset.aspectRatio;else{const E=S.split(":").map(Number),{videoWidth:R,videoHeight:x}=b,{clientWidth:A,clientHeight:D}=a,P=R/x,I=E[0]/E[1];if(P>I){const c=I*x/R;(0,O.setStyle)(b,"width",100*c+"%"),(0,O.setStyle)(b,"height","100%"),(0,O.setStyle)(b,"padding",`0 ${(A-A*c)/2}px`)}else{const c=R/I/x;(0,O.setStyle)(b,"width","100%"),(0,O.setStyle)(b,"height",100*c+"%"),(0,O.setStyle)(b,"padding",(D-D*c)/2+"px 0")}a.dataset.aspectRatio=S}d.show=`${g.get("Aspect Ratio")}: ${S==="default"?g.get("Default"):S}`,C.emit("aspectRatio",S)}}),(0,O.def)(C,"aspectRatioReset",{set(S){if(S){const{aspectRatio:E}=C;C.aspectRatio=E}}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"36kPY":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{option:b,notice:a,template:{$video:g}}=C,d=(0,O.createElement)("canvas");(0,O.def)(C,"getDataURL",{value:()=>new Promise((S,E)=>{try{d.width=g.videoWidth,d.height=g.videoHeight,d.getContext("2d").drawImage(g,0,0),S(d.toDataURL("image/png"))}catch(R){a.show=R,E(R)}})}),(0,O.def)(C,"getBlobUrl",{value:()=>new Promise((S,E)=>{try{d.width=g.videoWidth,d.height=g.videoHeight,d.getContext("2d").drawImage(g,0,0),d.toBlob(R=>{S(URL.createObjectURL(R))})}catch(R){a.show=R,E(R)}})}),(0,O.def)(C,"screenshot",{value:()=>st(this,null,function*(){const S=yield C.getDataURL();return(0,O.download)(S,`${b.title||"artplayer"}_${(0,O.secondToTime)(g.currentTime)}.png`),C.emit("screenshot",S),S})})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2GYOJ":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("../libs/screenfull"),b=O.interopDefault(C),a=G("../utils");W.default=function(g){const{i18n:d,notice:S,template:{$video:E,$player:R}}=g;g.once("video:loadedmetadata",()=>{b.default.isEnabled?(x=>{b.default.on("change",()=>{x.emit("fullscreen",b.default.isFullscreen)}),(0,a.def)(x,"fullscreen",{get:()=>b.default.isFullscreen,set(D){return st(this,null,function*(){D?(x.normalSize="fullscreen",x.aspectRatioReset=!0,x.autoSize=!1,yield b.default.request(R),(0,a.addClass)(R,"art-fullscreen"),x.emit("resize"),S.show=""):(x.aspectRatioReset=!0,x.autoSize=x.option.autoSize,yield b.default.exit(),(0,a.removeClass)(R,"art-fullscreen"),x.emit("resize"),S.show="")})}})})(g):document.fullscreenEnabled||E.webkitSupportsFullscreen?(x=>{(0,a.def)(x,"fullscreen",{get:()=>E.webkitDisplayingFullscreen,set(A){A?(x.normalSize="fullscreen",E.webkitEnterFullscreen(),x.emit("fullscreen",!0),S.show=""):(E.webkitExitFullscreen(),x.emit("fullscreen",!1),S.show="")}})})(g):(0,a.def)(g,"fullscreen",{get:()=>!1,set(){S.show=d.get("Fullscreen Not Supported")}}),(0,a.def)(g,"fullscreen",(0,a.get)(g,"fullscreen"))})}},{"../libs/screenfull":"8v40z","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8v40z":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);const O=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],C=(()=>{if(typeof document=="undefined")return!1;const g=O[0],d={};for(const S of O)if(S[1]in document){for(const[E,R]of S.entries())d[g[E]]=R;return d}return!1})(),b={change:C.fullscreenchange,error:C.fullscreenerror};let a={request:(g=document.documentElement,d)=>new Promise((S,E)=>{const R=()=>{a.off("change",R),S()};a.on("change",R);const x=g[C.requestFullscreen](d);x instanceof Promise&&x.then(R).catch(E)}),exit:()=>new Promise((g,d)=>{if(!a.isFullscreen)return void g();const S=()=>{a.off("change",S),g()};a.on("change",S);const E=document[C.exitFullscreen]();E instanceof Promise&&E.then(S).catch(d)}),toggle:(g,d)=>a.isFullscreen?a.exit():a.request(g,d),onchange(g){a.on("change",g)},onerror(g){a.on("error",g)},on(g,d){const S=b[g];S&&document.addEventListener(S,d,!1)},off(g,d){const S=b[g];S&&document.removeEventListener(S,d,!1)},raw:C};Object.defineProperties(a,{isFullscreen:{get:()=>Boolean(document[C.fullscreenElement])},element:{enumerable:!0,get:()=>document[C.fullscreenElement]},isEnabled:{enumerable:!0,get:()=>Boolean(document[C.fullscreenEnabled])}}),C||(a={isEnabled:!1}),W.default=a},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5aYAP":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{notice:b,constructor:a,template:{$container:g,$player:d}}=C;(0,O.def)(C,"fullscreenWeb",{get:()=>(0,O.hasClass)(d,"art-fullscreen-web"),set(S){S?(a.FULLSCREEN_WEB_IN_BODY&&(0,O.append)(document.body,d),C.normalSize="fullscreenWeb",(0,O.addClass)(d,"art-fullscreen-web"),C.aspectRatioReset=!0,C.autoSize=!1,C.emit("resize"),C.emit("fullscreenWeb",!0),b.show=""):(a.FULLSCREEN_WEB_IN_BODY&&(0,O.append)(g,d),(0,O.removeClass)(d,"art-fullscreen-web"),C.aspectRatioReset=!0,C.autoSize=C.option.autoSize,C.emit("resize"),C.emit("fullscreenWeb",!1),b.show="")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7EnIB":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{i18n:b,notice:a,template:{$video:g}}=C;document.pictureInPictureEnabled?function(d){const{template:{$video:S},proxy:E,notice:R}=d;S.disablePictureInPicture=!1,(0,O.def)(d,"pip",{get:()=>document.pictureInPictureElement,set(x){x?(d.normalSize="pip",S.requestPictureInPicture().catch(A=>{throw R.show=A,A})):document.exitPictureInPicture().catch(A=>{throw R.show=A,A})}}),E(S,"enterpictureinpicture",()=>{d.emit("pip",!0)}),E(S,"leavepictureinpicture",()=>{d.emit("pip",!1)})}(C):g.webkitSupportsPresentationMode?function(d){const{$video:S}=d.template;S.webkitSetPresentationMode("inline"),(0,O.def)(d,"pip",{get:()=>S.webkitPresentationMode==="picture-in-picture",set(E){E?(d.normalSize="pip",S.webkitSetPresentationMode("picture-in-picture"),d.emit("pip",!0)):(S.webkitSetPresentationMode("inline"),d.emit("pip",!1))}})}(C):(0,O.def)(C,"pip",{get:()=>!1,set(){a.show=b.get("PIP Not Supported")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3N9mP":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{$video:b}=C.template;(0,O.def)(C,"loaded",{get:()=>C.loadedTime/b.duration}),(0,O.def)(C,"loadedTime",{get:()=>b.buffered.length?b.buffered.end(b.buffered.length-1):0})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],et96R:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){(0,O.def)(C,"played",{get:()=>C.currentTime/C.duration})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9DzzM":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{$video:b}=C.template;(0,O.def)(C,"playing",{get:()=>b.currentTime>0&&!b.paused&&!b.ended&&b.readyState>2})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],i1LDY:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{$container:b,$player:a,$video:g}=C.template;(0,O.def)(C,"autoSize",{get:()=>(0,O.hasClass)(b,"art-auto-size"),set(d){if(d){const{videoWidth:S,videoHeight:E}=g,{width:R,height:x}=b.getBoundingClientRect(),A=S/E,D=R/x;if((0,O.addClass)(b,"art-auto-size"),D>A){const P=x*A/R*100;(0,O.setStyle)(a,"width",`${P}%`),(0,O.setStyle)(a,"height","100%")}else{const P=R/A/x*100;(0,O.setStyle)(a,"width","100%"),(0,O.setStyle)(a,"height",`${P}%`)}C.emit("autoSize",{width:C.width,height:C.height})}else(0,O.removeClass)(b,"art-auto-size"),(0,O.setStyle)(a,"width",null),(0,O.setStyle)(a,"height",null),C.emit("autoSize")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],IqARI:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){(0,O.def)(C,"rect",{get:()=>C.template.$player.getBoundingClientRect()});const b=["bottom","height","left","right","top","width"];for(let a=0;a<b.length;a++){const g=b[a];(0,O.def)(C,g,{get:()=>C.rect[g]})}(0,O.def)(C,"x",{get:()=>C.left+window.pageXOffset}),(0,O.def)(C,"y",{get:()=>C.top+window.pageYOffset})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7E7Vs":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{template:{$player:b},i18n:a,notice:g}=C;(0,O.def)(C,"flip",{get:()=>b.dataset.flip||"normal",set(d){d||(d="normal"),d==="normal"?delete b.dataset.flip:b.dataset.flip=d,g.show=`${a.get("Video Flip")}: ${a.get((0,O.capitalize)(d))}`,C.emit("flip",d)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gpugx:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{i18n:b,option:a,storage:g,proxy:d,template:{$player:S,$miniClose:E,$miniTitle:R,$miniHeader:x}}=C;let A=!1,D=0,P=0,I=0,c=0;d(x,"mousedown",m=>{A=!0,D=m.pageX,P=m.pageY,I=C.left,c=C.top}),d(document,"mousemove",m=>{if(A){(0,O.addClass)(S,"art-is-dragging");const _=c+m.pageY-P,o=I+m.pageX-D;(0,O.setStyle)(S,"top",`${_}px`),(0,O.setStyle)(S,"left",`${o}px`),g.set("top",_),g.set("left",o)}}),d(document,"mouseup",()=>{A=!1,(0,O.removeClass)(S,"art-is-dragging")}),d(E,"click",()=>{C.mini=!1,A=!1,(0,O.removeClass)(S,"art-is-dragging")}),(0,O.append)(R,a.title||b.get("Mini Player")),(0,O.def)(C,"mini",{get:()=>(0,O.hasClass)(S,"art-mini"),set(m){if(m){C.normalSize="mini",C.autoSize=!1,(0,O.addClass)(S,"art-mini");const _=g.get("top"),o=g.get("left");if(_&&o)(0,O.setStyle)(S,"top",`${_}px`),(0,O.setStyle)(S,"left",`${o}px`),(0,O.isInViewport)(x)||(g.del("top"),g.del("left"),C.mini=!0);else{const i=window.innerHeight-C.height-50,t=window.innerWidth-C.width-50;g.set("top",i),g.set("left",t),(0,O.setStyle)(S,"top",`${i}px`),(0,O.setStyle)(S,"left",`${t}px`)}C.aspectRatio=!1,C.playbackRate=!1,C.notice.show="",C.emit("mini",!0)}else(0,O.removeClass)(S,"art-mini"),(0,O.setStyle)(S,"top",null),(0,O.setStyle)(S,"left",null),C.aspectRatio=!1,C.playbackRate=!1,C.autoSize=a.autoSize,C.notice.show="",C.emit("mini",!1)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f1hVG:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){let b=[];(0,O.def)(C,"loop",{get:()=>b,set:a=>{if(Array.isArray(a)&&typeof a[0]=="number"&&typeof a[1]=="number"){const g=(0,O.clamp)(a[0],0,Math.min(a[1],C.duration)),d=(0,O.clamp)(a[1],g,C.duration);b=d-g>=1?[g,d]:[]}else b=[]}}),C.on("video:timeupdate",()=>{b.length&&(C.currentTime<b[0]||C.currentTime>b[1])&&(C.seek=b[0])})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1SuFS":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{option:b,template:{$poster:a}}=C;(0,O.def)(C,"poster",{get:()=>b.poster,set(g){b.poster=g,(0,O.setStyle)(a,"backgroundImage",`url(${g})`)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8x4te":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{option:b,template:{$container:a,$video:g}}=C,d=a.style.height;(0,O.def)(C,"autoHeight",{get:()=>(0,O.hasClass)(a,"art-auto-height"),set(S){if(S){const{clientWidth:E}=a,{videoHeight:R,videoWidth:x}=g,A=R*(E/x);(0,O.setStyle)(a,"height",A+"px"),(0,O.addClass)(a,"art-auto-height"),C.autoSize=b.autoSize,C.emit("autoHeight",A)}else(0,O.setStyle)(a,"height",d),(0,O.removeClass)(a,"art-auto-height"),C.autoSize=b.autoSize,C.emit("autoHeight")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2FqhO":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{option:b,template:{$player:a}}=C;(0,O.def)(C,"theme",{get:()=>getComputedStyle(a).getPropertyValue("--theme"),set(g){b.theme=g,a.style.setProperty("--theme",g)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7Am53":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){(0,O.def)(C,"title",{get:()=>C.option.title,set(b){C.option.title=b}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1fQQs":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){(0,O.def)(C,"type",{get:()=>C.option.type,set(b){C.option.type=b}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePkBr:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const b=["mini","pip","fullscreen","fullscreenWeb"];(0,O.def)(C,"normalSize",{get:()=>b.every(a=>!C[a]),set(a){b.filter(g=>g!==a).forEach(g=>{C[g]&&(C[g]=!1)})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6vlBV":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{clamp:b}=C.constructor.utils,{notice:a,template:g,i18n:d}=C;let S=0,E=[];C.on("subtitle:switch",()=>{E=[]}),(0,O.def)(C,"subtitleOffset",{get:()=>S,set(R){if(g.$track&&g.$track.track){const x=Array.from(g.$track.track.cues);S=b(R,-5,5);for(let A=0;A<x.length;A++){const D=x[A];E[A]||(E[A]={startTime:D.startTime,endTime:D.endTime}),D.startTime=b(E[A].startTime+S,0,C.duration),D.endTime=b(E[A].endTime+S,0,C.duration)}C.subtitle.update(),a.show=`${d.get("Subtitle Offset")}: ${R}s`,C.emit("subtitleOffset",R)}else C.emit("subtitleOffset",0)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eftqT:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{i18n:b,notice:a,proxy:g,template:{$video:d}}=C;let S=!0;window.WebKitPlaybackTargetAvailabilityEvent&&d.webkitShowPlaybackTargetPicker?g(d,"webkitplaybacktargetavailabilitychanged",E=>{switch(E.availability){case"available":S=!0;break;case"not-available":S=!1}}):S=!1,(0,O.def)(C,"airplay",{value(){S?(d.webkitShowPlaybackTargetPicker(),C.emit("airplay")):a.show=b.get("AirPlay Not Available")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fCWZK:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{option:b,storage:a,template:{$video:g,$poster:d}}=C;Object.keys(b.moreVideoAttr).forEach(E=>{C.attr(E,b.moreVideoAttr[E])}),b.muted&&(C.muted=b.muted),b.volume&&(g.volume=(0,O.clamp)(b.volume,0,1));const S=a.get("volume");typeof S=="number"&&(g.volume=(0,O.clamp)(S,0,1)),b.poster&&(0,O.setStyle)(d,"backgroundImage",`url(${b.poster})`),b.autoplay&&(g.autoplay=b.autoplay),b.playsInline&&(g.playsInline=!0,g["webkit-playsinline"]=!0),b.theme&&(C.theme=b.theme),C.url=b.url}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f8Lv3:[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("../config"),b=O.interopDefault(C),a=G("../utils");W.default=function(g){const{i18n:d,notice:S,option:E,constructor:R,proxy:x,template:{$player:A,$video:D,$poster:P}}=g;let I=0;for(let c=0;c<b.default.events.length;c++)x(D,b.default.events[c],m=>{g.emit(`video:${m.type}`,m)});g.on("video:canplay",()=>{I=0,g.loading.show=!1}),g.once("video:canplay",()=>{g.loading.show=!1,g.controls.show=!0,g.mask.show=!0,g.isReady=!0,g.emit("ready")}),g.on("video:ended",()=>{E.loop?(g.seek=0,g.play(),g.controls.show=!1,g.mask.show=!1):(g.controls.show=!0,g.mask.show=!0)}),g.on("video:error",c=>st(this,null,function*(){I<R.RECONNECT_TIME_MAX?(yield(0,a.sleep)(R.RECONNECT_SLEEP_TIME),I+=1,g.url=E.url,S.show=`${d.get("Reconnect")}: ${I}`,g.emit("error",c,I)):(g.mask.show=!0,g.loading.show=!1,g.controls.show=!0,(0,a.addClass)(A,"art-error"),yield(0,a.sleep)(R.RECONNECT_SLEEP_TIME),S.show=d.get("Video Load Failed"),g.destroy(!1))})),g.on("video:loadedmetadata",()=>{g.autoSize=E.autoSize,a.isMobile&&(g.loading.show=!1,g.controls.show=!0,g.mask.show=!0)}),g.on("video:loadstart",()=>{g.loading.show=!0,g.mask.show=!1,g.controls.show=!0}),g.on("video:pause",()=>{g.controls.show=!0,g.mask.show=!0}),g.on("video:play",()=>{g.mask.show=!1,(0,a.setStyle)(P,"display","none")}),g.on("video:playing",()=>{g.mask.show=!1}),g.on("video:seeked",()=>{g.loading.show=!1}),g.on("video:seeking",()=>{g.loading.show=!0,g.mask.show=!1}),g.on("video:timeupdate",()=>{g.mask.show=!1}),g.on("video:waiting",()=>{g.loading.show=!0,g.mask.show=!1})}},{"../config":"lyjeQ","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8Z0Uf":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("../utils"),b=G("../utils/component"),a=O.interopDefault(b),g=G("./fullscreen"),d=O.interopDefault(g),S=G("./fullscreenWeb"),E=O.interopDefault(S),R=G("./pip"),x=O.interopDefault(R),A=G("./playAndPause"),D=O.interopDefault(A),P=G("./progress"),I=O.interopDefault(P),c=G("./time"),m=O.interopDefault(c),_=G("./volume"),o=O.interopDefault(_),i=G("./setting"),t=O.interopDefault(i),r=G("./thumbnails"),l=O.interopDefault(r),p=G("./screenshot"),u=O.interopDefault(p),f=G("./quality"),L=O.interopDefault(f),v=G("./loop"),y=O.interopDefault(v),n=G("./airplay"),s=O.interopDefault(n);class e extends a.default{constructor(M){super(M),this.name="control";const{proxy:T,constructor:B,template:{$player:N}}=M;let j=Date.now();T(N,["click","mousemove","touchstart","touchmove"],()=>{this.show=!0,(0,C.removeClass)(N,"art-hide-cursor"),(0,C.addClass)(N,"art-hover"),j=Date.now()}),M.on("video:timeupdate",()=>{!M.isInput&&M.playing&&this.show&&Date.now()-j>=B.CONTROL_HIDE_TIME&&(this.show=!1,(0,C.addClass)(N,"art-hide-cursor"),(0,C.removeClass)(N,"art-hover"))}),this.init()}init(){const{option:M}=this.art;M.isLive||this.add((0,I.default)({name:"progress",position:"top",index:10})),!M.thumbnails.url||M.isLive||C.isMobile||this.add((0,l.default)({name:"thumbnails",position:"top",index:20})),this.add((0,y.default)({name:"loop",position:"top",index:30})),this.add((0,D.default)({name:"playAndPause",position:"left",index:10})),this.add((0,o.default)({name:"volume",position:"left",index:20})),M.isLive||this.add((0,m.default)({name:"time",position:"left",index:30})),M.quality.length&&this.add((0,L.default)({name:"quality",position:"right",index:10})),M.screenshot&&!C.isMobile&&this.add((0,u.default)({name:"screenshot",position:"right",index:20})),M.setting&&this.add((0,t.default)({name:"setting",position:"right",index:30})),M.pip&&this.add((0,x.default)({name:"pip",position:"right",index:40})),M.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&this.add((0,s.default)({name:"airplay",position:"right",index:50})),M.fullscreenWeb&&this.add((0,E.default)({name:"fullscreenWeb",position:"right",index:60})),M.fullscreen&&this.add((0,d.default)({name:"fullscreen",position:"right",index:70}));for(let T=0;T<M.controls.length;T++)this.add(M.controls[T])}add(M){const T=typeof M=="function"?M(this.art):M,{$progress:B,$controlsLeft:N,$controlsRight:j}=this.art.template;switch(T.position){case"top":this.$parent=B;break;case"left":this.$parent=N;break;case"right":this.$parent=j;break;default:(0,C.errorHandle)(!1,"Control option.position must one of 'top', 'left', 'right'")}super.add(T)}}W.default=e},{"../utils":"71aH7","../utils/component":"18nVI","./fullscreen":"c61Lj","./fullscreenWeb":"03jeB","./pip":"u8l8e","./playAndPause":"ebXtb","./progress":"bgoVP","./time":"ikc2j","./volume":"b8NFx","./setting":"03o9l","./thumbnails":"eCVx2","./screenshot":"4KCF5","./quality":"efgTY","./loop":"2hIff","./airplay":"4IS2d","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"18nVI":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("./dom"),b=G("option-validator"),a=O.interopDefault(b),g=G("../scheme"),d=G("./property"),S=G("./error");W.default=class{constructor(E){this.id=0,this.art=E,this.add=this.add.bind(this)}get show(){return(0,C.hasClass)(this.art.template.$player,`art-${this.name}-show`)}set show(E){const{$player:R}=this.art.template,x=`art-${this.name}-show`;E?(0,C.addClass)(R,x):(0,C.removeClass)(R,x),this.art.emit(this.name,E)}set toggle(E){E&&(this.show=!this.show)}add(E){const R=typeof E=="function"?E(this.art):E;if(R.html=R.html||"",(0,a.default)(R,g.ComponentOption),!this.$parent||!this.name||R.disable)return;const x=R.name||`${this.name}${this.id}`;(0,S.errorHandle)(!(0,d.has)(this,x),`Cannot add an existing name [${x}] to the [${this.name}]`),this.id+=1;const A=(0,C.createElement)("div");(0,C.addClass)(A,`art-${this.name}`),(0,C.addClass)(A,`art-${this.name}-${x}`);const D=Array.from(this.$parent.children);A.dataset.index=R.index||this.id;const P=D.find(I=>Number(I.dataset.index)>=Number(A.dataset.index));return P?P.insertAdjacentElement("beforebegin",A):(0,C.append)(this.$parent,A),R.html&&(0,C.append)(A,R.html),R.style&&(0,C.setStyles)(A,R.style),R.tooltip&&(0,C.tooltip)(A,R.tooltip),R.click&&this.art.events.proxy(A,"click",I=>{I.preventDefault(),R.click.call(this.art,this,I)}),R.selector&&["left","right"].includes(R.position)&&this.selector(R,A),R.mounted&&R.mounted.call(this.art,A),(0,d.def)(this,x,{value:A}),A}selector(E,R){const{hover:x,proxy:A}=this.art.events;(0,C.addClass)(R,"art-control-selector");const D=(0,C.createElement)("div");(0,C.addClass)(D,"art-selector-value"),(0,C.append)(D,E.html),R.innerText="",(0,C.append)(R,D);const P=E.selector.map((m,_)=>`<div class="art-selector-item ${m.default?"art-current":""}" data-index="${_}">${m.html}</div>`).join(""),I=(0,C.createElement)("div");(0,C.addClass)(I,"art-selector-list"),(0,C.append)(I,P),(0,C.append)(R,I),this.art.option.backdrop&&(0,C.addClass)(I,"art-backdrop-filter");const c=()=>{const m=(0,C.getStyle)(R,"width")/2-(0,C.getStyle)(I,"width")/2;I.style.left=`${m}px`};x(R,c),A(I,"click",m=>st(this,null,function*(){const _=(m.composedPath()||[]).find(t=>(0,C.hasClass)(t,"art-selector-item"));if(!_)return;(0,C.inverseClass)(_,"art-current");const o=Number(_.dataset.index),i=E.selector[o]||{};if(D.innerText=_.innerText,E.onSelect){const t=yield E.onSelect.call(this.art,i,_,m);typeof t!="string"&&typeof t!="number"||(D.innerHTML=t)}c()}))}}},{"./dom":"bSNiV","option-validator":"bAWi2","../scheme":"AKEiO","./property":"5NSdr","./error":"hwmZz","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],c61Lj:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>et($e({},C),{tooltip:b.i18n.get("Fullscreen"),mounted:a=>{const{proxy:g,icons:d,i18n:S}=b,E=(0,O.append)(a,d.fullscreenOn),R=(0,O.append)(a,d.fullscreenOff);(0,O.setStyle)(R,"display","none"),g(a,"click",()=>{b.fullscreen=!b.fullscreen}),b.on("fullscreen",x=>{x?((0,O.tooltip)(a,S.get("Exit Fullscreen")),(0,O.setStyle)(E,"display","none"),(0,O.setStyle)(R,"display","inline-flex")):((0,O.tooltip)(a,S.get("Fullscreen")),(0,O.setStyle)(E,"display","inline-flex"),(0,O.setStyle)(R,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03jeB":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>et($e({},C),{tooltip:b.i18n.get("Web Fullscreen"),mounted:a=>{const{proxy:g,icons:d,i18n:S}=b,E=(0,O.append)(a,d.fullscreenWebOn),R=(0,O.append)(a,d.fullscreenWebOff);(0,O.setStyle)(R,"display","none"),g(a,"click",()=>{b.fullscreenWeb=!b.fullscreenWeb}),b.on("fullscreenWeb",x=>{x?((0,O.tooltip)(a,S.get("Exit Web Fullscreen")),(0,O.setStyle)(E,"display","none"),(0,O.setStyle)(R,"display","inline-flex")):((0,O.tooltip)(a,S.get("Web Fullscreen")),(0,O.setStyle)(E,"display","inline-flex"),(0,O.setStyle)(R,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],u8l8e:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>et($e({},C),{tooltip:b.i18n.get("PIP Mode"),mounted:a=>{const{proxy:g,icons:d,i18n:S}=b;(0,O.append)(a,d.pip),g(a,"click",()=>{b.pip=!b.pip}),b.on("pip",E=>{(0,O.tooltip)(a,S.get(E?"Exit PIP Mode":"PIP Mode"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ebXtb:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>et($e({},C),{mounted:a=>{const{proxy:g,icons:d,i18n:S}=b,E=(0,O.append)(a,d.play),R=(0,O.append)(a,d.pause);function x(){(0,O.setStyle)(E,"display","flex"),(0,O.setStyle)(R,"display","none")}function A(){(0,O.setStyle)(E,"display","none"),(0,O.setStyle)(R,"display","flex")}(0,O.tooltip)(E,S.get("Play")),(0,O.tooltip)(R,S.get("Pause")),g(E,"click",()=>{b.play()}),g(R,"click",()=>{b.pause()}),b.playing?A():x(),b.on("video:playing",()=>{A()}),b.on("video:pause",()=>{x()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bgoVP:[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W),O.export(W,"getPosFromEvent",()=>b),O.export(W,"setCurrentTime",()=>a);var C=G("../utils");function b(g,d){const{$progress:S}=g.template,{left:E}=S.getBoundingClientRect(),R=C.isMobile?d.touches[0].clientX:d.pageX,x=(0,C.clamp)(R-E,0,S.clientWidth),A=x/S.clientWidth*g.duration;return{second:A,time:(0,C.secondToTime)(A),width:x,percentage:(0,C.clamp)(x/S.clientWidth,0,1)}}function a(g,d){if(g.isRotate){const S=d.touches[0].clientY/g.height,E=S*g.duration;g.emit("setBar","played",S),g.seek=E}else{const{second:S,percentage:E}=b(g,d);g.emit("setBar","played",E),g.seek=S}}W.default=function(g){return d=>{const{icons:S,option:E,proxy:R}=d;return et($e({},g),{html:'<div class="art-control-progress-inner"><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:x=>{let A=!1;const D=(0,C.query)(".art-progress-loaded",x),P=(0,C.query)(".art-progress-played",x),I=(0,C.query)(".art-progress-highlight",x),c=(0,C.query)(".art-progress-indicator",x),m=(0,C.query)(".art-progress-tip",x),{PROGRESS_HEIGHT:_,INDICATOR_SIZE:o,INDICATOR_SIZE_ICON:i,INDICATOR_SIZE_MOBILE:t,INDICATOR_SIZE_MOBILE_ICON:r}=d.constructor;(0,C.setStyle)(x,"height",`${_}px`),(0,C.setStyle)(P,"backgroundColor","var(--theme)");let l=o;function p(u,f){u==="loaded"&&(0,C.setStyle)(D,"width",100*f+"%"),u==="played"&&((0,C.setStyle)(P,"width",100*f+"%"),(0,C.setStyle)(c,"left",`calc(${100*f}% - ${l/2}px)`))}S.indicator?(l=i,(0,C.append)(c,S.indicator)):(0,C.setStyles)(c,{backgroundColor:"var(--theme)"}),C.isMobile&&(l=t,S.indicator&&(l=r)),(0,C.setStyles)(c,{left:`-${l/2}px`,width:`${l}px`,height:`${l}px`}),d.on("video:loadedmetadata",()=>{for(let u=0;u<E.highlight.length;u++){const f=E.highlight[u],L=(0,C.clamp)(f.time,0,d.duration)/d.duration*100;(0,C.append)(I,`<span data-text="${f.text}" data-time="${f.time}" style="left: ${L}%"></span>`)}}),p("loaded",d.loaded),d.on("setBar",(u,f)=>{p(u,f)}),d.on("video:progress",()=>{p("loaded",d.loaded)}),d.on("video:timeupdate",()=>{p("played",d.played)}),d.on("video:ended",()=>{p("played",1)}),C.isMobile||(R(x,"click",u=>{u.target!==c&&a(d,u)}),R(x,"mousemove",u=>{(0,C.setStyle)(m,"display","block"),(0,C.includeFromEvent)(u,I)?function(f){const{width:L}=b(d,f),{text:v}=f.target.dataset;m.innerHTML=v;const y=m.clientWidth;L<=y/2?(0,C.setStyle)(m,"left",0):L>x.clientWidth-y/2?(0,C.setStyle)(m,"left",x.clientWidth-y+"px"):(0,C.setStyle)(m,"left",L-y/2+"px")}(u):function(f){const{width:L,time:v}=b(d,f);m.innerHTML=v;const y=m.clientWidth;L<=y/2?(0,C.setStyle)(m,"left",0):L>x.clientWidth-y/2?(0,C.setStyle)(m,"left",x.clientWidth-y+"px"):(0,C.setStyle)(m,"left",L-y/2+"px")}(u)}),R(x,"mouseleave",()=>{(0,C.setStyle)(m,"display","none")}),R(x,"mousedown",()=>{A=!0}),R(document,"mousemove",u=>{if(A){const{second:f,percentage:L}=b(d,u);p("played",L),d.seek=f}}),R(document,"mouseup",()=>{A&&(A=!1)}))}})}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ikc2j:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>et($e({},C),{style:{cursor:"auto",marginLeft:"10px"},mounted:a=>{function g(){const S=`${(0,O.secondToTime)(b.currentTime)} / ${(0,O.secondToTime)(b.duration)}`;S!==a.innerText&&(a.innerText=S)}g();const d=["video:loadedmetadata","video:timeupdate","video:progress"];for(let S=0;S<d.length;S++)b.on(d[S],g)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],b8NFx:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>et($e({},C),{mounted:a=>{const{proxy:g,icons:d,i18n:S}=b;let E=!1;const R=b.constructor.VOLUME_PANEL_WIDTH,x=b.constructor.VOLUME_HANDLE_WIDTH,A=(0,O.append)(a,d.volume),D=(0,O.append)(a,d.volumeClose),P=(0,O.append)(a,'<div class="art-volume-panel"></div>'),I=(0,O.append)(P,'<div class="art-volume-slider-handle"></div>');function c(_){const{left:o}=P.getBoundingClientRect();return(0,O.clamp)(_.pageX-o-x/2,0,R-x/2)/(R-x)}function m(_=.7){if(b.muted||_===0)(0,O.setStyle)(A,"display","none"),(0,O.setStyle)(D,"display","flex"),(0,O.setStyle)(I,"left","0");else{const o=(R-x)*_;(0,O.setStyle)(A,"display","flex"),(0,O.setStyle)(D,"display","none"),(0,O.setStyle)(I,"left",`${o}px`)}}(0,O.tooltip)(A,S.get("Mute")),(0,O.setStyle)(D,"display","none"),O.isMobile&&(0,O.setStyle)(P,"display","none"),m(b.volume),b.on("video:volumechange",()=>{m(b.volume)}),g(A,"click",()=>{b.muted=!0}),g(D,"click",()=>{b.muted=!1}),g(P,"click",_=>{b.muted=!1,b.volume=c(_)}),g(I,"mousedown",()=>{E=!0}),g(a,"mousemove",_=>{E&&(b.muted=!1,b.volume=c(_))}),g(document,"mouseup",()=>{E&&(E=!1)})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03o9l":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>et($e({},C),{tooltip:b.i18n.get("Show Setting"),mounted:a=>{const{proxy:g,icons:d,i18n:S}=b;(0,O.append)(a,d.setting),g(a,"click",()=>{b.setting.toggle=!0,b.setting.updateStyle()}),b.on("setting",E=>{(0,O.tooltip)(a,S.get(E?"Hide Setting":"Show Setting"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eCVx2:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils"),C=G("./progress");W.default=function(b){return a=>et($e({},b),{mounted:g=>{const{option:d,template:{$progress:S,$video:E},events:{proxy:R,loadImg:x}}=a;let A=null,D=!1,P=!1;R(S,"mousemove",I=>st(this,null,function*(){D||(D=!0,A=yield x(d.thumbnails.url),P=!0),P&&((0,O.setStyle)(g,"display","block"),function(c){const{width:m}=(0,C.getPosFromEvent)(a,c),{url:_,number:o,column:i,width:t,height:r}=d.thumbnails,l=t||A.naturalWidth/i,p=r||l/(E.videoWidth/E.videoHeight),u=S.clientWidth/o,f=Math.floor(m/u),L=Math.ceil(f/i)-1,v=f%i||i-1;(0,O.setStyle)(g,"backgroundImage",`url(${_})`),(0,O.setStyle)(g,"height",`${p}px`),(0,O.setStyle)(g,"width",`${l}px`),(0,O.setStyle)(g,"backgroundPosition",`-${v*l}px -${L*p}px`),m<=l/2?(0,O.setStyle)(g,"left",0):m>S.clientWidth-l/2?(0,O.setStyle)(g,"left",S.clientWidth-l+"px"):(0,O.setStyle)(g,"left",m-l/2+"px")}(I))})),R(S,"mouseleave",()=>{(0,O.setStyle)(g,"display","none")}),a.on("hover",I=>{I||(0,O.setStyle)(g,"display","none")})}})}},{"../utils":"71aH7","./progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4KCF5":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>et($e({},C),{tooltip:b.i18n.get("Screenshot"),mounted:a=>{const{proxy:g,icons:d}=b;(0,O.append)(a,d.screenshot),g(a,"click",()=>{b.screenshot()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],efgTY:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W),W.default=function(O){return C=>{const b=C.option.quality,a=b.find(g=>g.default)||b[0];return et($e({},O),{style:{marginRight:"10px"},html:a?a.html:"",selector:b,onSelect(g){C.switchQuality(g.url,g.html)}})}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2hIff":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>et($e({},C),{mounted:a=>{const g=(0,O.append)(a,'<span class="art-loop-point"></span>'),d=(0,O.append)(a,'<span class="art-loop-point"></span>');b.on("loop",S=>{S&&S.length?((0,O.setStyle)(a,"display","block"),(0,O.setStyle)(g,"left",`calc(${S[0]/b.duration*100}% - ${g.clientWidth}px)`),(0,O.setStyle)(d,"left",S[1]/b.duration*100+"%")):(0,O.setStyle)(a,"display","none")})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4IS2d":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>et($e({},C),{tooltip:b.i18n.get("AirPlay"),mounted:a=>{const{proxy:g,icons:d}=b;(0,O.append)(a,d.airplay),g(a,"click",()=>b.airplay())}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2KYsr":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("../utils"),b=G("../utils/component"),a=O.interopDefault(b),g=G("./playbackRate"),d=O.interopDefault(g),S=G("./aspectRatio"),E=O.interopDefault(S),R=G("./flip"),x=O.interopDefault(R),A=G("./info"),D=O.interopDefault(A),P=G("./version"),I=O.interopDefault(P),c=G("./close"),m=O.interopDefault(c);class _ extends a.default{constructor(i){super(i),this.name="contextmenu",this.$parent=i.template.$contextmenu,C.isMobile||this.init()}init(){const{option:i,proxy:t,template:{$player:r,$contextmenu:l}}=this.art;i.playbackRate&&this.add((0,d.default)({name:"playbackRate",index:10})),i.aspectRatio&&this.add((0,E.default)({name:"aspectRatio",index:20})),i.flip&&this.add((0,x.default)({name:"flip",index:30})),this.add((0,D.default)({name:"info",index:40})),this.add((0,I.default)({name:"version",index:50})),this.add((0,m.default)({name:"close",index:60}));for(let p=0;p<i.contextmenu.length;p++)this.add(i.contextmenu[p]);t(r,"contextmenu",p=>{if(p.preventDefault(),!this.art.constructor.CONTEXTMENU)return;this.show=!0;const u=p.clientX,f=p.clientY,{height:L,width:v,left:y,top:n}=r.getBoundingClientRect(),{height:s,width:e}=l.getBoundingClientRect();let h=u-y,M=f-n;u+e>y+v&&(h=v-e),f+s>n+L&&(M=L-s),(0,C.setStyles)(l,{top:`${M}px`,left:`${h}px`})}),t(r,"click",p=>{(0,C.includeFromEvent)(p,l)||(this.show=!1)}),this.art.on("blur",()=>{this.show=!1})}}W.default=_},{"../utils":"71aH7","../utils/component":"18nVI","./playbackRate":"69eLi","./aspectRatio":"lUefg","./flip":"kysiM","./info":"gqIgJ","./version":"kRU7C","./close":"jQ8Pm","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"69eLi":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>{const{i18n:a,constructor:{PLAYBACK_RATE:g}}=b;return et($e({},C),{html:`${a.get("Play Speed")}:
                ${g.map(d=>`<span data-value="${d}">${d===1?a.get("Normal"):d}</span>`).join("")}
            `,click:(d,S)=>{const{value:E}=S.target.dataset;E&&(b.playbackRate=Number(E),d.show=!1)},mounted:d=>{const S=(0,O.query)('[data-value="1"]',d);S&&(0,O.inverseClass)(S,"art-current"),b.on("video:ratechange",()=>{const E=(0,O.queryAll)("span",d).find(R=>Number(R.dataset.value)===b.playbackRate);E&&(0,O.inverseClass)(E,"art-current")})}})}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lUefg:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>{const{i18n:a,constructor:{ASPECT_RATIO:g}}=b;return et($e({},C),{html:`${a.get("Aspect Ratio")}:
                ${g.map(d=>`<span data-value="${d}">${d==="default"?a.get("Default"):d}</span>`).join("")}
            `,click:(d,S)=>{const{value:E}=S.target.dataset;E&&(b.aspectRatio=E,d.show=!1)},mounted:d=>{const S=(0,O.query)('[data-value="default"]',d);S&&(0,O.inverseClass)(S,"art-current"),b.on("aspectRatio",E=>{const R=(0,O.queryAll)("span",d).find(x=>x.dataset.value===E);R&&(0,O.inverseClass)(R,"art-current")})}})}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kysiM:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){return b=>{const{i18n:a,constructor:{FLIP:g}}=b;return et($e({},C),{html:`${a.get("Video Flip")}:
                ${g.map(d=>`<span data-value="${d}">${a.get((0,O.capitalize)(d))}</span>`).join("")}
            `,click:(d,S)=>{const{value:E}=S.target.dataset;E&&(b.flip=E.toLowerCase(),d.show=!1)},mounted:d=>{const S=(0,O.query)('[data-value="normal"]',d);S&&(0,O.inverseClass)(S,"art-current"),b.on("flip",E=>{const R=(0,O.queryAll)("span",d).find(x=>x.dataset.value===E);R&&(0,O.inverseClass)(R,"art-current")})}})}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gqIgJ:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W),W.default=function(O){return C=>et($e({},O),{html:C.i18n.get("Video Info"),click:b=>{C.info.show=!0,b.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kRU7C:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W),W.default=function(O){return et($e({},O),{html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 4.6.2</a>'})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jQ8Pm:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W),W.default=function(O){return C=>et($e({},O),{html:C.i18n.get("Close"),click:b=>{b.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"02ajl":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("./utils"),b=G("./utils/component"),a=O.interopDefault(b);class g extends a.default{constructor(S){super(S),this.name="info",C.isMobile||this.init()}init(){const{proxy:S,constructor:E,template:{$infoPanel:R,$infoClose:x,$video:A}}=this.art;S(x,"click",()=>{this.show=!1});let D=null;const P=(0,C.queryAll)("[data-video]",R)||[];this.art.on("destroy",()=>{clearTimeout(D)}),function I(){for(let c=0;c<P.length;c++){const m=P[c],_=A[m.dataset.video],o=typeof _=="number"?_.toFixed(2):_;m.innerText!==o&&(m.innerText=o)}D=setTimeout(I,E.INFO_LOOP_TIME)}()}}W.default=g},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eSWto:[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("./utils"),b=G("./utils/component"),a=O.interopDefault(b),g=G("option-validator"),d=O.interopDefault(g),S=G("./scheme"),E=O.interopDefault(S);class R extends a.default{constructor(A){super(A),this.name="subtitle",this.eventDestroy=()=>null,this.init(A.option.subtitle);let D=!1;A.on("video:timeupdate",()=>{if(!this.url)return;const P=this.art.template.$video.webkitDisplayingFullscreen;typeof P=="boolean"&&P!==D&&(D=P,this.createTrack(P?"subtitles":"metadata",this.url))})}get url(){return this.art.template.$track.src}set url(A){this.switch(A)}get textTrack(){return this.art.template.$video.textTracks[0]}get activeCue(){return this.textTrack.activeCues[0]}style(A,D){const{$subtitle:P}=this.art.template;return typeof A=="object"?(0,C.setStyles)(P,A):(0,C.setStyle)(P,A,D)}update(){const{$subtitle:A}=this.art.template;A.innerHTML="",this.activeCue&&(this.art.option.subtitle.escape?A.innerHTML=this.activeCue.text.split(/\r?\n/).map(D=>`<p>${(0,C.escape)(D)}</p>`).join(""):A.innerHTML=this.activeCue.text,this.art.emit("subtitleUpdate",this.activeCue.text))}switch(P){return st(this,arguments,function*(A,D={}){const{i18n:I,notice:c,option:m}=this.art,_=et($e($e({},m.subtitle),D),{url:A}),o=yield this.init(_);return D.name&&(c.show=`${I.get("Switch Subtitle")}: ${D.name}`),o})}createTrack(A,D){const{template:P,proxy:I}=this.art,{$video:c,$track:m}=P,_=(0,C.createElement)("track");_.default=!0,_.kind=A,_.src=D,_.track.mode="hidden",this.eventDestroy(),(0,C.remove)(m),(0,C.append)(c,_),P.$track=_,this.eventDestroy=I(this.textTrack,"cuechange",()=>this.update())}init(A){return st(this,null,function*(){const{notice:D,template:{$subtitle:P}}=this.art;if((0,d.default)(A,E.default.subtitle),A.url)return this.style(A.style),fetch(A.url).then(I=>I.arrayBuffer()).then(I=>{const c=new TextDecoder(A.encoding).decode(I);switch(this.art.emit("subtitleLoad",A.url),A.type||(0,C.getExt)(A.url)){case"srt":return(0,C.vttToBlob)((0,C.srtToVtt)(c));case"ass":return(0,C.vttToBlob)((0,C.assToVtt)(c));case"vtt":return(0,C.vttToBlob)(c);default:return A.url}}).then(I=>(P.innerHTML="",this.url===I||(URL.revokeObjectURL(this.url),this.createTrack("metadata",I),this.art.emit("subtitleSwitch",I)),I)).catch(I=>{throw D.show=I,I})})}}W.default=R},{"./utils":"71aH7","./utils/component":"18nVI","option-validator":"bAWi2","./scheme":"AKEiO","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jo4S1:[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("../utils/error"),b=G("./clickInit"),a=O.interopDefault(b),g=G("./hoverInit"),d=O.interopDefault(g),S=G("./mousemoveInit"),E=O.interopDefault(S),R=G("./resizeInit"),x=O.interopDefault(R),A=G("./gestureInit"),D=O.interopDefault(A),P=G("./viewInit"),I=O.interopDefault(P);W.default=class{constructor(c){this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),c.whitelist.state&&((0,a.default)(c,this),(0,d.default)(c,this),(0,E.default)(c,this),(0,x.default)(c,this),(0,D.default)(c,this),(0,I.default)(c,this))}proxy(c,m,_,o={}){if(Array.isArray(m))return m.map(t=>this.proxy(c,t,_,o));c.addEventListener(m,_,o);const i=()=>c.removeEventListener(m,_,o);return this.destroyEvents.push(i),i}hover(c,m,_){m&&this.proxy(c,"mouseenter",m),_&&this.proxy(c,"mouseleave",_)}loadImg(c){return new Promise((m,_)=>{let o;if(c instanceof HTMLImageElement)o=c;else{if(typeof c!="string")return _(new C.ArtPlayerError("Unable to get Image"));o=new Image,o.src=c}if(o.complete)return m(o);this.proxy(o,"load",()=>m(o)),this.proxy(o,"error",()=>_(new C.ArtPlayerError(`Failed to load Image: ${o.src}`)))})}destroy(){for(let c=0;c<this.destroyEvents.length;c++)this.destroyEvents[c]()}}},{"../utils/error":"hwmZz","./clickInit":"6UrCm","./hoverInit":"4jWHi","./mousemoveInit":"bMF9b","./resizeInit":"eDXPO","./gestureInit":"95GtS","./viewInit":"InUBx","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6UrCm":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C,b){const{constructor:a,template:{$player:g,$video:d}}=C;b.proxy(document,["click","contextmenu"],E=>{(0,O.includeFromEvent)(E,g)?(C.isInput=E.target.tagName==="INPUT",C.isFocus=!0,C.emit("focus")):(C.isInput=!1,C.isFocus=!1,C.emit("blur"))});let S=0;b.proxy(d,"click",()=>{const E=Date.now();E-S<=a.DB_CLICE_TIME?(C.emit("dblclick"),O.isMobile?C.isLock||C.toggle():C.fullscreen=!C.fullscreen):(C.emit("click"),O.isMobile||C.toggle()),S=E})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4jWHi":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C,b){const{$player:a}=C.template;b.hover(a,g=>{(0,O.addClass)(a,"art-hover"),C.emit("hover",!0,g)},g=>{(0,O.removeClass)(a,"art-hover"),C.emit("hover",!1,g)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bMF9b:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W),W.default=function(O,C){const{$player:b}=O.template;C.proxy(b,"mousemove",a=>{O.emit("mousemove",a)})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eDXPO:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C,b){const{option:a}=C,g=(0,O.throttle)(()=>{C.normalSize&&(C.autoSize=a.autoSize),C.aspectRatioReset=!0,C.notice.show="",C.emit("resize")},C.constructor.RESIZE_TIME);b.proxy(window,["orientationchange","resize"],()=>{g()}),screen&&screen.orientation&&screen.orientation.onchange&&b.proxy(screen.orientation,"change",()=>{g()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"95GtS":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils"),C=G("../control/progress");W.default=function(b,a){if(O.isMobile&&!b.option.isLive){const{$video:g,$progress:d}=b.template;let S=null,E=!1,R=0,x=0,A=0;const D=c=>{if(c.touches.length===1&&!b.isLock){S===d&&(0,C.setCurrentTime)(b,c),E=!0;const{clientX:m,clientY:_}=c.touches[0];R=m,x=_,A=b.currentTime}},P=c=>{if(c.touches.length===1&&E&&b.duration){const{clientX:m,clientY:_}=c.touches[0],o=(0,O.clamp)((m-R)/b.width,-1,1),i=(0,O.clamp)((_-x)/b.height,-1,1),t=b.isRotate?i:o,r=S===g?b.constructor.TOUCH_MOVE_RATIO:1,l=(0,O.clamp)(A+b.duration*t*r,0,b.duration);b.seek=l,b.emit("setBar","played",(0,O.clamp)(l/b.duration,0,1)),b.notice.show=`${(0,O.secondToTime)(l)} / ${(0,O.secondToTime)(b.duration)}`}},I=()=>{E&&(R=0,x=0,A=0,E=!1,S=null)};a.proxy(d,"touchstart",c=>{S=d,D(c)}),a.proxy(g,"touchstart",c=>{S=g,D(c)}),a.proxy(g,"touchmove",P),a.proxy(d,"touchmove",P),a.proxy(document,"touchend",I)}}},{"../utils":"71aH7","../control/progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],InUBx:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C,b){const{option:a,constructor:g,template:{$container:d}}=C,S=(0,O.throttle)(()=>{C.emit("view",(0,O.isInViewport)(d,g.SCROLL_GAP))},g.SCROLL_TIME);b.proxy(window,"scroll",()=>{S()}),C.on("view",E=>{a.autoMini&&(C.mini=!E)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6NoFy":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("./utils");W.default=class{constructor(C){this.art=C,this.keys={},C.option.hotkey&&!O.isMobile&&this.init()}init(){const{proxy:C,constructor:b}=this.art;this.add(27,()=>{this.art.fullscreenWeb&&(this.art.fullscreenWeb=!1)}),this.add(32,()=>{this.art.toggle()}),this.add(37,()=>{this.art.backward=b.SEEK_STEP}),this.add(38,()=>{this.art.volume+=b.VOLUME_STEP}),this.add(39,()=>{this.art.forward=b.SEEK_STEP}),this.add(40,()=>{this.art.volume-=b.VOLUME_STEP}),C(window,"keydown",a=>{if(this.art.isFocus){const g=document.activeElement.tagName.toUpperCase(),d=document.activeElement.getAttribute("contenteditable");if(g!=="INPUT"&&g!=="TEXTAREA"&&d!==""&&d!=="true"){const S=this.keys[a.keyCode];if(S){a.preventDefault();for(let E=0;E<S.length;E++)S[E].call(this.art,a);this.art.emit("hotkey",a)}}}})}add(C,b){return this.keys[C]?this.keys[C].push(b):this.keys[C]=[b],this}remove(C,b){if(this.keys[C]){const a=this.keys[C].indexOf(b);a!==-1&&this.keys[C].splice(a,1)}return this}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6G6hZ":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("./utils/component"),b=O.interopDefault(C);class a extends b.default{constructor(d){super(d);const{option:S,template:{$layer:E}}=d;this.name="layer",this.$parent=E;for(let R=0;R<S.layers.length;R++)this.add(S.layers[R])}}W.default=a},{"./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3dsEe":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("./utils"),b=G("./utils/component"),a=O.interopDefault(b);class g extends a.default{constructor(S){super(S),this.name="loading",(0,C.append)(S.template.$loading,S.icons.loading)}}W.default=g},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],dWGTw:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("./utils");W.default=class{constructor(C){this.art=C,this.timer=null}set show(C){const{constructor:b,template:{$player:a,$noticeInner:g}}=this.art;C?(g.innerText=C instanceof Error?C.message.trim():C,(0,O.addClass)(a,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(()=>{g.innerText="",(0,O.removeClass)(a,"art-notice-show")},b.NOTICE_TIME)):(0,O.removeClass)(a,"art-notice-show")}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5POkG":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("./utils"),b=G("./utils/component"),a=O.interopDefault(b);class g extends a.default{constructor(S){super(S),this.name="mask";const{template:E,icons:R,events:x}=S,A=(0,C.append)(E.$state,R.state),D=(0,C.append)(E.$state,R.error);(0,C.setStyle)(D,"display","none"),S.on("destroy",()=>{(0,C.setStyle)(A,"display","none"),(0,C.setStyle)(D,"display",null)}),x.proxy(E.$state,"click",()=>S.play())}}W.default=g},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6OeNg":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("../utils"),b=G("bundle-text:./loading.svg"),a=O.interopDefault(b),g=G("bundle-text:./state.svg"),d=O.interopDefault(g),S=G("bundle-text:./check.svg"),E=O.interopDefault(S),R=G("bundle-text:./play.svg"),x=O.interopDefault(R),A=G("bundle-text:./pause.svg"),D=O.interopDefault(A),P=G("bundle-text:./volume.svg"),I=O.interopDefault(P),c=G("bundle-text:./volume-close.svg"),m=O.interopDefault(c),_=G("bundle-text:./screenshot.svg"),o=O.interopDefault(_),i=G("bundle-text:./setting.svg"),t=O.interopDefault(i),r=G("bundle-text:./arrow-left.svg"),l=O.interopDefault(r),p=G("bundle-text:./arrow-right.svg"),u=O.interopDefault(p),f=G("bundle-text:./playback-rate.svg"),L=O.interopDefault(f),v=G("bundle-text:./aspect-ratio.svg"),y=O.interopDefault(v),n=G("bundle-text:./config.svg"),s=O.interopDefault(n),e=G("bundle-text:./pip.svg"),h=O.interopDefault(e),M=G("bundle-text:./lock.svg"),T=O.interopDefault(M),B=G("bundle-text:./unlock.svg"),N=O.interopDefault(B),j=G("bundle-text:./fullscreen-off.svg"),z=O.interopDefault(j),K=G("bundle-text:./fullscreen-on.svg"),V=O.interopDefault(K),$=G("bundle-text:./fullscreen-web-off.svg"),X=O.interopDefault($),Z=G("bundle-text:./fullscreen-web-on.svg"),q=O.interopDefault(Z),te=G("bundle-text:./switch-on.svg"),ue=O.interopDefault(te),oe=G("bundle-text:./switch-off.svg"),le=O.interopDefault(oe),me=G("bundle-text:./flip.svg"),_e=O.interopDefault(me),ve=G("bundle-text:./error.svg"),ce=O.interopDefault(ve),he=G("bundle-text:./close.svg"),Le=O.interopDefault(he),De=G("bundle-text:./airplay.svg"),Fe=O.interopDefault(De);W.default=class{constructor(Oe){const ke=$e({loading:a.default,state:d.default,play:x.default,pause:D.default,check:E.default,volume:I.default,volumeClose:m.default,screenshot:o.default,setting:t.default,pip:h.default,arrowLeft:l.default,arrowRight:u.default,playbackRate:L.default,aspectRatio:y.default,config:s.default,lock:T.default,flip:_e.default,unlock:N.default,fullscreenOff:z.default,fullscreenOn:V.default,fullscreenWebOff:X.default,fullscreenWebOn:q.default,switchOn:ue.default,switchOff:le.default,error:ce.default,close:Le.default,airplay:Fe.default},Oe.option.icons);Object.keys(ke).forEach(Ie=>{(0,C.def)(this,Ie,{get:()=>{const we=(0,C.createElement)("i");return(0,C.addClass)(we,"art-icon"),(0,C.addClass)(we,`art-icon-${Ie}`),(0,C.append)(we,ke[Ie]),we}})})}}},{"../utils":"71aH7","bundle-text:./loading.svg":"7tDub","bundle-text:./state.svg":"1ElZc","bundle-text:./check.svg":"lmgoP","bundle-text:./play.svg":"lVWoQ","bundle-text:./pause.svg":"5Mnax","bundle-text:./volume.svg":"w3eIa","bundle-text:./volume-close.svg":"rHjo1","bundle-text:./screenshot.svg":"2KcqM","bundle-text:./setting.svg":"8rQMV","bundle-text:./arrow-left.svg":"kqGBE","bundle-text:./arrow-right.svg":"aFjpC","bundle-text:./playback-rate.svg":"lx7ZM","bundle-text:./aspect-ratio.svg":"2sEjf","bundle-text:./config.svg":"fQTgE","bundle-text:./pip.svg":"2CaxO","bundle-text:./lock.svg":"aCGnW","bundle-text:./unlock.svg":"bTrAV","bundle-text:./fullscreen-off.svg":"bA3p0","bundle-text:./fullscreen-on.svg":"fTuY8","bundle-text:./fullscreen-web-off.svg":"tvKf4","bundle-text:./fullscreen-web-on.svg":"1F1oB","bundle-text:./switch-on.svg":"7qNHs","bundle-text:./switch-off.svg":"28aV8","bundle-text:./flip.svg":"1uXI6","bundle-text:./error.svg":"9f4dh","bundle-text:./close.svg":"4nTtS","bundle-text:./airplay.svg":"cDPXC","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7tDub":[function(G,ee,W){ee.exports='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><path fill="none" class="bk" d="M0 0h100v100H0z"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(30 105.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(60 75.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(90 65 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(120 58.66 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(150 54.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(180 50 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-150 45.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-120 41.34 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-90 35 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-60 24.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-30 -5.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>'},{}],"1ElZc":[function(G,ee,W){ee.exports='<svg xmlns="http://www.w3.org/2000/svg" height="60" width="60" style="filter:drop-shadow(0 1px 1px #000)" viewBox="0 0 24 24"><path d="M20 2H4C1.8 2 0 3.8 0 6v12c0 2.2 1.8 4 4 4h16c2.2 0 4-1.8 4-4V6c0-2.2-1.8-4-4-4zm-4.4 10.8L10.5 16c-.6.5-1.5 0-1.5-.8V8.8c0-.8.9-1.3 1.5-.8l5.1 3.2c.7.3.7 1.3 0 1.6z"/></svg>'},{}],lmgoP:[function(G,ee,W){ee.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:100%;height:100%"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff"/></svg>'},{}],lVWoQ:[function(G,ee,W){ee.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M17.982 9.275 8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"/></svg>'},{}],"5Mnax":[function(G,ee,W){ee.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zm8 0a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"/></svg>'},{}],w3eIa:[function(G,ee,W){ee.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M10.188 4.65 6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zm4.258-.872a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"/><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"/></svg>'},{}],rHjo1:[function(G,ee,W){ee.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"/><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zm5.195 13.195-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"/></svg>'},{}],"2KcqM":[function(G,ee,W){ee.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50"><path d="M19.402 6a5 5 0 0 0-4.902 4.012L14.098 12H9a5 5 0 0 0-5 5v21a5 5 0 0 0 5 5h32a5 5 0 0 0 5-5V17a5 5 0 0 0-5-5h-5.098l-.402-1.988A5 5 0 0 0 30.598 6ZM25 17c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10Zm0 2c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8Z"/></svg>'},{}],"8rQMV":[function(G,ee,W){ee.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><circle cx="11" cy="11" r="2"/><path d="M19.164 8.861 17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>'},{}],kqGBE:[function(G,ee,W){ee.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m19.41 20.09-4.58-4.59 4.58-4.59L18 9.5l-6 6 6 6z" fill="#fff"/></svg>'},{}],aFjpC:[function(G,ee,W){ee.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m12.59 20.34 4.58-4.59-4.58-4.59L14 9.75l6 6-6 6z" fill="#fff"/></svg>'},{}],lx7ZM:[function(G,ee,W){ee.exports='<svg height="24" width="24"><path d="M10 8v8l6-4-6-4zM6.3 5l-.6-.8C7.2 3 9 2.2 11 2l.1 1c-1.8.2-3.4.9-4.8 2zM5 6.3l-.8-.6C3 7.2 2.2 9 2 11l1 .1c.2-1.8.9-3.4 2-4.8zm0 11.4c-1.1-1.4-1.8-3.1-2-4.8L2 13c.2 2 1 3.8 2.2 5.4l.8-.7zm6.1 3.3c-1.8-.2-3.4-.9-4.8-2l-.6.8C7.2 21 9 21.8 11 22l.1-1zM22 12c0-5.2-3.9-9.4-9-10l-.1 1c4.6.5 8.1 4.3 8.1 9s-3.5 8.5-8.1 9l.1 1c5.2-.5 9-4.8 9-10z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2sEjf":[function(G,ee,W){ee.exports=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" style="width:100%;height:100%;transform:translate(0,0)"><defs><clipPath id="__lottie_element_216"><path d="M0 0h88v88H0z"/></clipPath></defs><g style="display:block" clip-path="url('#__lottie_element_216')"><path fill="#FFF" d="m12.438-12.702-2.82 2.82c-.79.79-.79 2.05 0 2.83l7.07 7.07-7.07 7.07c-.79.79-.79 2.05 0 2.83l2.82 2.83c.79.78 2.05.78 2.83 0l11.32-11.31c.78-.78.78-2.05 0-2.83l-11.32-11.31c-.78-.79-2.04-.79-2.83 0zm-24.88 0c-.74-.74-1.92-.78-2.7-.12l-.13.12-11.31 11.31a2 2 0 0 0-.12 2.7l.12.13 11.31 11.31a2 2 0 0 0 2.7.12l.13-.12 2.83-2.83c.74-.74.78-1.91.11-2.7l-.11-.13-7.07-7.07 7.07-7.07c.74-.74.78-1.91.11-2.7l-.11-.13-2.83-2.82zM28-28c4.42 0 8 3.58 8 8v40c0 4.42-3.58 8-8 8h-56c-4.42 0-8-3.58-8-8v-40c0-4.42 3.58-8 8-8h56z" style="--darkreader-inline-fill:#a8a6a4" transform="translate(44 44)"/></g></svg>`},{}],fQTgE:[function(G,ee,W){ee.exports='<svg height="24" width="24"><path d="M15 17h6v1h-6v-1zm-4 0H3v1h8v2h1v-5h-1v2zm3-9h1V3h-1v2H3v1h11v2zm4-3v1h3V5h-3zM6 14h1V9H6v2H3v1h3v2zm4-2h11v-1H10v1z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2CaxO":[function(G,ee,W){ee.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25 17h-8v6h8v-6Zm4 8V10.98C29 9.88 28.1 9 27 9H9c-1.1 0-2 .88-2 1.98V25c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2Zm-2 .02H9V10.97h18v14.05Z"/></svg>'},{}],aCGnW:[function(G,ee,W){ee.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M298.667 426.667v-85.334a213.333 213.333 0 1 1 426.666 0v85.334H768A85.333 85.333 0 0 1 853.333 512v256A85.333 85.333 0 0 1 768 853.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667zM512 213.333a128 128 0 0 0-128 128v85.334h256v-85.334a128 128 0 0 0-128-128z" fill="#fff"/></svg>'},{}],bTrAV:[function(G,ee,W){ee.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="m666.752 194.517-49.365 74.112A128 128 0 0 0 384 341.333l.043 85.334h384A85.333 85.333 0 0 1 853.376 512v256a85.333 85.333 0 0 1-85.333 85.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667v-85.334a213.333 213.333 0 0 1 368.085-146.816z" fill="#fff"/></svg>'},{}],bA3p0:[function(G,ee,W){ee.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M768 298.667h170.667V384h-256V128H768v170.667zM341.333 384h-256v-85.333H256V128h85.333v256zM768 725.333V896h-85.333V640h256v85.333H768zM341.333 640v256H256V725.333H85.333V640h256z"/></svg>'},{}],fTuY8:[function(G,ee,W){ee.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M625.778 256H768v142.222h113.778v-256h-256V256zM256 398.222V256h142.222V142.222h-256v256H256zm512 227.556V768H625.778v113.778h256v-256H768zM398.222 768H256V625.778H142.222v256h256V768z"/></svg>'},{}],tvKf4:[function(G,ee,W){ee.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zM896 512a64 64 0 0 1 7.488 127.552L896 640H768v128a64 64 0 0 1-56.512 63.552L704 832a64 64 0 0 1-63.552-56.512L640 768V582.592c0-34.496 25.024-66.112 61.632-70.208l8-.384H896zm-640 0a64 64 0 0 1-7.488-127.552L256 384h128V256a64 64 0 0 1 56.512-63.552L448 192a64 64 0 0 1 63.552 56.512L512 256v185.408c0 34.432-25.024 66.112-61.632 70.144l-8 .448H256z"/></svg>'},{}],"1F1oB":[function(G,ee,W){ee.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zm-576 64a64 64 0 0 1 7.488 127.552L448 320H320v128a64 64 0 0 1-56.512 63.552L256 512a64 64 0 0 1-63.552-56.512L192 448V262.592c0-34.432 25.024-66.112 61.632-70.144l8-.448H448zm256 640a64 64 0 0 1-7.488-127.552L704 704h128V576a64 64 0 0 1 56.512-63.552L896 512a64 64 0 0 1 63.552 56.512L960 576v185.408c0 34.496-25.024 66.112-61.632 70.208l-8 .384H704z"/></svg>'},{}],"7qNHs":[function(G,ee,W){ee.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1664 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#648FFC" d="M1152 0H512a512 512 0 0 0 0 1024h640a512 512 0 0 0 0-1024zm0 960a448 448 0 1 1 448-448 448 448 0 0 1-448 448z"/></svg>'},{}],"28aV8":[function(G,ee,W){ee.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M511.898 1024h670.515c282.419-.41 511.18-229.478 511.18-511.898 0-282.419-228.761-511.488-511.18-511.897H511.898C229.478.615.717 229.683.717 512.102c0 282.42 228.761 511.488 511.18 511.898zm-.564-975.36A464.589 464.589 0 1 1 48.026 513.024 463.872 463.872 0 0 1 511.334 48.435v.205z"/></svg>'},{}],"1uXI6":[function(G,ee,W){ee.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M554.667 810.667V896h-85.334v-85.333h85.334zm-384-632.662a42.667 42.667 0 0 1 34.986 18.219l203.904 291.328a42.667 42.667 0 0 1 0 48.896L205.611 827.776A42.667 42.667 0 0 1 128 803.328V220.672a42.667 42.667 0 0 1 42.667-42.667zm682.666 0a42.667 42.667 0 0 1 42.368 37.718l.299 4.949v582.656a42.667 42.667 0 0 1-74.24 28.63l-3.413-4.182-203.904-291.328a42.667 42.667 0 0 1-3.03-43.861l3.03-5.035 203.946-291.328a42.667 42.667 0 0 1 34.944-18.219zM554.667 640v85.333h-85.334V640h85.334zm-358.4-320.896V716.8L335.957 512 196.31 319.104zm358.4 150.23v85.333h-85.334v-85.334h85.334zm0-170.667V384h-85.334v-85.333h85.334zm0-170.667v85.333h-85.334V128h85.334z" fill="#fff"/></svg>'},{}],"9f4dh":[function(G,ee,W){ee.exports='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="50" height="50"><path d="M593.818 168.55 949.82 763.76c26.153 43.746 10.732 99.738-34.447 125.052-14.397 8.069-30.72 12.308-47.37 12.308H155.976c-52.224 0-94.536-40.96-94.536-91.505 0-16.097 4.383-31.928 12.718-45.875l356.004-595.19c26.173-43.724 84.009-58.654 129.208-33.341a93.082 93.082 0 0 1 34.448 33.341zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88zm0-512a72.315 72.315 0 0 0-71.762 81.306l25.723 205.721a46.408 46.408 0 0 0 92.078 0l25.723-205.742A72.315 72.315 0 0 0 512 307.2z"/></svg>'},{}],"4nTtS":[function(G,ee,W){ee.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="m571.733 512 268.8-268.8c17.067-17.067 17.067-42.667 0-59.733-17.066-17.067-42.666-17.067-59.733 0L512 452.267l-268.8-268.8c-17.067-17.067-42.667-17.067-59.733 0-17.067 17.066-17.067 42.666 0 59.733l268.8 268.8-268.8 268.8c-17.067 17.067-17.067 42.667 0 59.733 8.533 8.534 19.2 12.8 29.866 12.8s21.334-4.266 29.867-12.8l268.8-268.8 268.8 268.8c8.533 8.534 19.2 12.8 29.867 12.8s21.333-4.266 29.866-12.8c17.067-17.066 17.067-42.666 0-59.733L571.733 512z"/></svg>'},{}],cDPXC:[function(G,ee,W){ee.exports='<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z"/><path d="M4 17h10l-5-6z"/></g></svg>'},{}],"3eYNH":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("./flip"),b=O.interopDefault(C),a=G("./aspectRatio"),g=O.interopDefault(a),d=G("./playbackRate"),S=O.interopDefault(d),E=G("./subtitleOffset"),R=O.interopDefault(E),x=G("../utils/component"),A=O.interopDefault(x),D=G("../utils");class P extends A.default{constructor(c){super(c);const{option:m,proxy:_,template:{$setting:o,$player:i}}=c;if(this.name="setting",this.$parent=o,this.option=[],this.events=[],this.cache=new Map,m.setting){m.playbackRate&&this.option.push((0,S.default)(c)),m.aspectRatio&&this.option.push((0,g.default)(c)),m.flip&&this.option.push((0,b.default)(c)),m.subtitleOffset&&this.option.push((0,R.default)(c));for(let t=0;t<m.settings.length;t++)this.option.push(m.settings[t]);this.update(),c.on("blur",()=>{this.show&&(this.show=!1,this.init(this.option))}),_(i,"click",t=>{!this.show||(0,D.includeFromEvent)(t,c.controls.setting)||(0,D.includeFromEvent)(t,this.$parent)||(this.show=!1,this.init(this.option))})}}static makeRecursion(c,m,_){for(let o=0;o<c.length;o++){const i=c[o];i.$parentItem=m,i.$parentList=_,i.selector&&P.makeRecursion(i.selector,i,c)}return c}update(){return this.cache=new Map,this.events.forEach(c=>c()),this.events=[],this.$parent.innerHTML="",this.option=P.makeRecursion(this.option),this.init(this.option),this.option}add(c){return this.option.push(c),this.update(),c}creatHeader(c){const{icons:m,proxy:_}=this.art,o=(0,D.createElement)("div");(0,D.addClass)(o,"art-setting-item"),(0,D.addClass)(o,"art-setting-item-back");const i=(0,D.append)(o,'<div class="art-setting-item-left"></div>'),t=(0,D.createElement)("div");(0,D.addClass)(t,"art-setting-item-left-icon"),(0,D.append)(t,m.arrowLeft),(0,D.append)(i,t),(0,D.append)(i,c.$parentItem.html);const r=_(o,"click",()=>this.init(c.$parentList));return this.events.push(r),o}creatItem(c,m){const{icons:_,proxy:o}=this.art,i=(0,D.createElement)("div");(0,D.addClass)(i,"art-setting-item"),(0,D.isStringOrNumber)(m.name)&&(i.dataset.name=m.name),(0,D.isStringOrNumber)(m.value)&&(i.dataset.value=m.value);const t=(0,D.append)(i,'<div class="art-setting-item-left"></div>'),r=(0,D.append)(i,'<div class="art-setting-item-right"></div>'),l=(0,D.createElement)("div");switch((0,D.addClass)(l,"art-setting-item-left-icon"),c){case"switch":case"range":(0,D.append)(l,(0,D.isStringOrNumber)(m.icon)||m.icon instanceof Element?m.icon:_.config);break;case"selector":m.selector&&m.selector.length?(0,D.append)(l,(0,D.isStringOrNumber)(m.icon)||m.icon instanceof Element?m.icon:_.config):(0,D.append)(l,_.check)}(0,D.append)(t,l),m.$icon=l,(0,D.def)(m,"icon",{configurable:!0,get:()=>l.innerHTML,set(f){(0,D.isStringOrNumber)(f)&&(l.innerHTML=f)}});const p=(0,D.createElement)("div");(0,D.addClass)(p,"art-setting-item-left-text"),(0,D.append)(p,m.html||""),(0,D.append)(t,p),m.$html=p,(0,D.def)(m,"html",{configurable:!0,get:()=>p.innerHTML,set(f){(0,D.isStringOrNumber)(f)&&(p.innerHTML=f)}});const u=(0,D.createElement)("div");switch((0,D.addClass)(u,"art-setting-item-right-tooltip"),(0,D.append)(u,m.tooltip||""),(0,D.append)(r,u),m.$tooltip=u,(0,D.def)(m,"tooltip",{configurable:!0,get:()=>u.innerHTML,set(f){(0,D.isStringOrNumber)(f)&&(u.innerHTML=f)}}),c){case"switch":{const f=(0,D.createElement)("div");(0,D.addClass)(f,"art-setting-item-right-icon");const L=(0,D.append)(f,_.switchOn),v=(0,D.append)(f,_.switchOff);(0,D.setStyle)(m.switch?v:L,"display","none"),(0,D.append)(r,f),m.$switch=m.switch,(0,D.def)(m,"switch",{configurable:!0,get:()=>m.$switch,set(y){m.$switch=y,y?((0,D.setStyle)(v,"display","none"),(0,D.setStyle)(L,"display",null)):((0,D.setStyle)(v,"display",null),(0,D.setStyle)(L,"display","none"))}});break}case"range":{const f=(0,D.createElement)("div");(0,D.addClass)(f,"art-setting-item-right-icon");const L=(0,D.append)(f,'<input type="range">');L.value=m.range[0]||0,L.min=m.range[1]||0,L.max=m.range[2]||10,L.step=m.range[3]||1,(0,D.addClass)(L,"art-setting-range"),(0,D.append)(r,f),m.$range=L,(0,D.def)(m,"range",{configurable:!0,get:()=>L.valueAsNumber,set(v){L.value=Number(v)}})}break;case"selector":if(m.selector&&m.selector.length){const f=(0,D.createElement)("div");(0,D.addClass)(f,"art-setting-item-right-icon"),(0,D.append)(f,_.arrowRight),(0,D.append)(r,f)}}switch(c){case"switch":if(m.onSwitch){const f=o(i,"click",L=>st(this,null,function*(){m.switch=yield m.onSwitch.call(this.art,m,i,L)}));this.events.push(f)}break;case"range":if(m.$range){if(m.onRange){const f=o(m.$range,"change",L=>st(this,null,function*(){m.tooltip=yield m.onRange.call(this.art,m,i,L)}));this.events.push(f)}if(m.onChange){const f=o(m.$range,"input",L=>st(this,null,function*(){m.tooltip=yield m.onChange.call(this.art,m,i,L)}));this.events.push(f)}}break;case"selector":{const f=o(i,"click",L=>st(this,null,function*(){if(m.selector&&m.selector.length)this.init(m.selector,m.width);else{(0,D.inverseClass)(i,"art-current");for(let v=0;v<m.$parentItem.selector.length;v++){const y=m.$parentItem.selector[v];y.default=y===m}if(m.$parentList&&this.init(m.$parentList),m.$parentItem&&m.$parentItem.onSelect){const v=yield m.$parentItem.onSelect.call(this.art,m,i,L);m.$parentItem.$tooltip&&(0,D.isStringOrNumber)(v)&&(m.$parentItem.$tooltip.innerHTML=v)}}}));this.events.push(f),m.default&&(0,D.addClass)(i,"art-current")}}return i}updateStyle(c){const{controls:m,constructor:_,template:{$player:o,$setting:i}}=this.art;if(m.setting){const t=c||_.SETTING_WIDTH,{left:r,width:l}=m.setting.getBoundingClientRect(),{left:p,width:u}=o.getBoundingClientRect(),f=r-p+l/2-t/2;f+t>u?((0,D.setStyle)(i,"left","auto"),(0,D.setStyle)(i,"right","10px")):((0,D.setStyle)(i,"left",`${f}px`),(0,D.setStyle)(i,"right","auto"))}else(0,D.setStyle)(i,"left","auto"),(0,D.setStyle)(i,"right","10px")}init(c,m){const{constructor:_}=this.art;if(this.cache.has(c)){const o=this.cache.get(c);(0,D.inverseClass)(o,"art-current"),(0,D.setStyle)(this.$parent,"width",`${o.dataset.width}px`),(0,D.setStyle)(this.$parent,"height",`${o.dataset.height}px`),this.updateStyle(Number(o.dataset.width))}else{const o=(0,D.createElement)("div");(0,D.addClass)(o,"art-setting-panel"),o.dataset.width=m||_.SETTING_WIDTH,o.dataset.height=c.length*_.SETTING_ITEM_HEIGHT,c[0]&&c[0].$parentItem&&((0,D.append)(o,this.creatHeader(c[0])),o.dataset.height=Number(o.dataset.height)+_.SETTING_ITEM_HEIGHT);for(let i=0;i<c.length;i++){const t=c[i];(0,D.has)(t,"switch")?(0,D.append)(o,this.creatItem("switch",t)):(0,D.has)(t,"range")?(0,D.append)(o,this.creatItem("range",t)):(0,D.append)(o,this.creatItem("selector",t))}(0,D.append)(this.$parent,o),this.cache.set(c,o),(0,D.inverseClass)(o,"art-current"),(0,D.setStyle)(this.$parent,"width",`${o.dataset.width}px`),(0,D.setStyle)(this.$parent,"height",`${o.dataset.height}px`),this.updateStyle(Number(o.dataset.width)),c[0]&&c[0].$parentItem&&c[0].$parentItem.mounted&&c[0].$parentItem.mounted.call(this.art,o,c[0].$parentItem)}}}W.default=P},{"./flip":"kONUB","./aspectRatio":"84NBV","./playbackRate":"aetWt","./subtitleOffset":"fIBkO","../utils/component":"18nVI","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kONUB:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{i18n:b,icons:a,constructor:{SETTING_ITEM_WIDTH:g,FLIP:d}}=C;function S(E,R,x){R&&(R.innerText=b.get((0,O.capitalize)(x)));const A=(0,O.queryAll)(".art-setting-item",E).find(D=>D.dataset.value===x);A&&(0,O.inverseClass)(A,"art-current")}return{width:g,html:b.get("Video Flip"),tooltip:b.get((0,O.capitalize)(C.flip)),icon:a.flip,selector:d.map(E=>({value:E,default:E===C.flip,html:b.get((0,O.capitalize)(E))})),onSelect:E=>(C.flip=E.value,E.value),mounted:(E,R)=>{S(E,R.$tooltip,C.flip),C.on("flip",()=>{S(E,R.$tooltip,C.flip)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"84NBV":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{i18n:b,icons:a,constructor:{SETTING_ITEM_WIDTH:g,ASPECT_RATIO:d}}=C;function S(R){return R==="default"?b.get("Default"):R}function E(R,x,A){x&&(x.innerText=S(A));const D=(0,O.queryAll)(".art-setting-item",R).find(P=>P.dataset.value===A);D&&(0,O.inverseClass)(D,"art-current")}return{width:g,html:b.get("Aspect Ratio"),icon:a.aspectRatio,tooltip:S(C.aspectRatio),selector:d.map(R=>({value:R,default:R===C.aspectRatio,html:S(R)})),onSelect:R=>(C.aspectRatio=R.value,R.value),mounted:(R,x)=>{E(R,x.$tooltip,C.aspectRatio),C.on("aspectRatio",()=>{E(R,x.$tooltip,C.aspectRatio)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],aetWt:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{i18n:b,icons:a,constructor:{SETTING_ITEM_WIDTH:g,PLAYBACK_RATE:d}}=C;function S(R){return R===1?b.get("Normal"):R}function E(R,x,A){x&&(x.innerText=S(A));const D=(0,O.queryAll)(".art-setting-item",R).find(P=>Number(P.dataset.value)===A);D&&(0,O.inverseClass)(D,"art-current")}return{width:g,html:b.get("Play Speed"),tooltip:S(C.playbackRate),icon:a.playbackRate,selector:d.map(R=>({value:R,default:R===C.playbackRate,html:S(R)})),onSelect:R=>(C.playbackRate=R.value,R.value),mounted:(R,x)=>{E(R,x.$tooltip,C.playbackRate),C.on("video:ratechange",()=>{E(R,x.$tooltip,C.playbackRate)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fIBkO:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W),W.default=function(O){const{i18n:C,icons:b,constructor:a}=O;return{width:a.SETTING_ITEM_WIDTH,html:C.get("Subtitle Offset"),icon:b.subtitle,tooltip:"0s",range:[0,-5,5,.1],onChange:g=>(O.subtitleOffset=g.range,g.range+"s")}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2aaJe":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W),W.default=class{constructor(){this.name="artplayer_settings",this.settings={}}get(O){try{const C=JSON.parse(window.localStorage.getItem(this.name))||{};return O?C[O]:C}catch(C){return O?this.settings[O]:this.settings}}set(O,C){try{const b=Object.assign({},this.get(),{[O]:C});window.localStorage.setItem(this.name,JSON.stringify(b))}catch(b){this.settings[O]=C}}del(O){try{const C=this.get();delete C[O],window.localStorage.setItem(this.name,JSON.stringify(C))}catch(C){delete this.settings[O]}}clear(){try{window.localStorage.removeItem(this.name)}catch(O){this.settings={}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8MTUM":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("../utils"),b=G("./miniProgressBar"),a=O.interopDefault(b),g=G("./autoOrientation"),d=O.interopDefault(g),S=G("./autoPlayback"),E=O.interopDefault(S),R=G("./fastForward"),x=O.interopDefault(R),A=G("./lock"),D=O.interopDefault(A);W.default=class{constructor(P){this.art=P,this.id=0;const{option:I}=P;I.miniProgressBar&&!I.isLive&&this.add(a.default),I.lock&&C.isMobile&&this.add(D.default),I.autoPlayback&&!I.isLive&&this.add(E.default),I.autoOrientation&&C.isMobile&&this.add(d.default),I.fastForward&&C.isMobile&&!I.isLive&&this.add(x.default);for(let c=0;c<I.plugins.length;c++)this.add(I.plugins[c])}add(P){this.id+=1;const I=P.call(this.art,this.art),c=I&&I.name||P.name||`plugin${this.id}`;return(0,C.errorHandle)(!(0,C.has)(this,c),`Cannot add a plugin that already has the same name: ${c}`),(0,C.def)(this,c,{value:I}),this}}},{"../utils":"71aH7","./miniProgressBar":"87pSL","./autoOrientation":"ePEg5","./autoPlayback":"cVO99","./fastForward":"hFDwt","./lock":"1hsTH","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"87pSL":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W),W.default=function(O){return O.on("ready",()=>{O.layers.add({name:"miniProgressBar",mounted(C){O.on("destroy",()=>{C.style.display="none"}),O.on("video:timeupdate",()=>{C.style.width=100*O.played+"%"}),O.on("setBar",(b,a)=>{b==="played"&&(C.style.width=100*a+"%")})}})}),{name:"miniProgressBar"}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePEg5:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{option:b,constructor:a,template:{$player:g,$video:d}}=C;return C.on("fullscreenWeb",S=>{if(S){const{videoWidth:E,videoHeight:R}=d,{clientWidth:x,clientHeight:A}=document.documentElement;(E>R&&x<A||E<R&&x>A)&&setTimeout(()=>{(0,O.setStyle)(g,"width",`${A}px`),(0,O.setStyle)(g,"height",`${x}px`),(0,O.setStyle)(g,"transform-origin","0 0"),(0,O.setStyle)(g,"transform",`rotate(90deg) translate(0, -${x}px)`),(0,O.addClass)(g,"art-auto-orientation"),C.isRotate=!0,C.emit("resize")},a.MOBILE_AUTO_ORIENTATION_TIME)}else(0,O.hasClass)(g,"art-auto-orientation")&&((0,O.setStyle)(g,"width",null),(0,O.setStyle)(g,"height",null),(0,O.setStyle)(g,"transform",null),(0,O.setStyle)(g,"transform-origin",null),(0,O.removeClass)(g,"art-auto-orientation"),C.isRotate=!1,C.aspectRatioReset=!0,C.autoSize=b.autoSize,C.notice.show="",C.emit("resize"))}),C.on("fullscreen",S=>st(this,null,function*(){const E=screen.orientation.type;if(S){const{videoWidth:R,videoHeight:x}=d,{clientWidth:A,clientHeight:D}=document.documentElement;if(R>x&&A<D||R<x&&A>D){const P=E.startsWith("portrait")?"landscape":"portrait";yield screen.orientation.lock(P),(0,O.addClass)(g,"art-auto-orientation-fullscreen")}}else(0,O.hasClass)(g,"art-auto-orientation-fullscreen")&&(yield screen.orientation.lock(E),(0,O.removeClass)(g,"art-auto-orientation-fullscreen"))})),{name:"autoOrientation",get state(){return(0,O.hasClass)(g,"art-auto-orientation")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cVO99:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{i18n:b,icons:a,storage:g,constructor:d,proxy:S,template:{$poster:E}}=C,R=C.layers.add({name:"autoPlayback",html:'<div class="art-autoPlayback-close"></div><div class="art-autoPlayback-last"></div><div class="art-autoPlayback-jump"></div>'}),x=(0,O.query)(".art-autoPlayback-last",R),A=(0,O.query)(".art-autoPlayback-jump",R),D=(0,O.query)(".art-autoPlayback-close",R);return C.on("video:timeupdate",()=>{const P=g.get("times")||{},I=Object.keys(P);I.length>d.AUTO_PLAYBACK_MAX&&delete P[I[0]],P[C.option.id||C.option.url]=C.currentTime,g.set("times",P)}),C.on("ready",()=>{const P=(g.get("times")||{})[C.option.id||C.option.url];P&&P>=d.AUTO_PLAYBACK_MIN&&((0,O.append)(D,a.close),(0,O.setStyle)(R,"display","flex"),x.innerText=`${b.get("Last Seen")} ${(0,O.secondToTime)(P)}`,A.innerText=b.get("Jump Play"),S(D,"click",()=>{(0,O.setStyle)(R,"display","none")}),S(A,"click",()=>{C.seek=P,C.play(),(0,O.setStyle)(E,"display","none"),(0,O.setStyle)(R,"display","none")}),C.once("video:timeupdate",()=>{setTimeout(()=>{(0,O.setStyle)(R,"display","none")},d.AUTO_PLAYBACK_TIMEOUT)}))}),{name:"autoPlayback",get times(){return g.get("times")||{}},clear:()=>g.del("times"),delete(P){const I=g.get("times")||{};return delete I[P],g.set("times",I),I}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hFDwt:[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{constructor:b,proxy:a,template:{$player:g,$video:d}}=C;let S=null,E=!1,R=1;const x=()=>{clearTimeout(S),E&&(E=!1,C.playbackRate=R,(0,O.removeClass)(g,"art-fast-forward"))};return a(d,"touchstart",A=>{A.touches.length===1&&C.playing&&!C.isLock&&(S=setTimeout(()=>{E=!0,R=C.playbackRate,C.playbackRate=b.FAST_FORWARD_VALUE,(0,O.addClass)(g,"art-fast-forward")},b.FAST_FORWARD_TIME))}),a(document,"touchmove",x),a(document,"touchend",x),{name:"fastForward",get state(){return(0,O.hasClass)(g,"art-fast-forward")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1hsTH":[function(G,ee,W){G("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(W);var O=G("../utils");W.default=function(C){const{layers:b,icons:a,template:{$player:g}}=C;return b.add({name:"lock",mounted(d){const S=(0,O.append)(d,a.lock),E=(0,O.append)(d,a.unlock);(0,O.setStyle)(S,"display","none"),C.on("lock",R=>{R?((0,O.setStyle)(S,"display","inline-flex"),(0,O.setStyle)(E,"display","none")):((0,O.setStyle)(S,"display","none"),(0,O.setStyle)(E,"display","inline-flex"))})},click(){(0,O.hasClass)(g,"art-lock")?((0,O.removeClass)(g,"art-lock"),this.isLock=!1):((0,O.addClass)(g,"art-lock"),this.isLock=!0)}}),{name:"lock",get state(){return(0,O.hasClass)(g,"art-lock")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7mil2":[function(G,ee,W){var O=G("@parcel/transformer-js/src/esmodule-helpers.js");O.defineInteropFlag(W);var C=G("./config"),b=O.interopDefault(C),a=G("./utils");W.default=class{constructor(g){const{option:d,proxy:S,template:{$video:E}}=g;for(let A=0;A<b.default.events.length;A++)S(E,b.default.events[A],D=>{g.emit(`video:${D.type}`,D)});Object.keys(d.moreVideoAttr).forEach(A=>{E[A]=d.moreVideoAttr[A]}),E.controls=!0,d.muted&&(E.muted=d.muted),d.volume&&(E.volume=(0,a.clamp)(d.volume,0,1)),d.poster&&(E.poster=d.poster),d.autoplay&&(E.autoplay=d.autoplay),d.playsInline&&(E.playsInline=!0,E["webkit-playsinline"]=!0);const R=d.type||(0,a.getExt)(d.url),x=d.customType[R];R&&x?x(E,d.url,g):(E.src=d.url,g.emit("url",E.src))}}},{"./config":"lyjeQ","./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}]},["5lTcX"],"5lTcX","parcelRequire4dc0")})(Qt);var Ir=Ot(Qt.exports);const Mr={style:{transform:"scale(-1,1)"},height:"25",width:"25",viewBox:"0 0 22 22",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},Rr=Ze("path",{d:"M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"},null,-1),Pr=[Rr];function Cr(Ge,ze){return At(),bt("svg",Mr,Pr)}var wr={name:"custom-prev",render:Cr};const Or={height:"25",width:"25",viewBox:"0 0 22 22",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},kr=Ze("path",{d:"M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"},null,-1),Br=[kr];function Fr(Ge,ze){return At(),bt("svg",Or,Br)}var Nr={name:"custom-next",render:Fr},Xt={exports:{}};(function(Ge,ze){(function(G,ee){Ge.exports=ee()})(window,function(){return function(G){var ee={};function W(O){if(ee[O])return ee[O].exports;var C=ee[O]={i:O,l:!1,exports:{}};return G[O].call(C.exports,C,C.exports,W),C.l=!0,C.exports}return W.m=G,W.c=ee,W.d=function(O,C,b){W.o(O,C)||Object.defineProperty(O,C,{enumerable:!0,get:b})},W.r=function(O){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})},W.t=function(O,C){if(1&C&&(O=W(O)),8&C||4&C&&typeof O=="object"&&O&&O.__esModule)return O;var b=Object.create(null);if(W.r(b),Object.defineProperty(b,"default",{enumerable:!0,value:O}),2&C&&typeof O!="string")for(var a in O)W.d(b,a,function(g){return O[g]}.bind(null,a));return b},W.n=function(O){var C=O&&O.__esModule?function(){return O.default}:function(){return O};return W.d(C,"a",C),C},W.o=function(O,C){return Object.prototype.hasOwnProperty.call(O,C)},W.p="",W(W.s=14)}([function(G,ee,W){var O=W(6),C=W.n(O),b=function(){function a(){}return a.e=function(g,d){g&&!a.FORCE_GLOBAL_TAG||(g=a.GLOBAL_TAG);var S="["+g+"] > "+d;a.ENABLE_CALLBACK&&a.emitter.emit("log","error",S),a.ENABLE_ERROR&&(console.error?console.error(S):console.warn?console.warn(S):console.log(S))},a.i=function(g,d){g&&!a.FORCE_GLOBAL_TAG||(g=a.GLOBAL_TAG);var S="["+g+"] > "+d;a.ENABLE_CALLBACK&&a.emitter.emit("log","info",S),a.ENABLE_INFO&&(console.info?console.info(S):console.log(S))},a.w=function(g,d){g&&!a.FORCE_GLOBAL_TAG||(g=a.GLOBAL_TAG);var S="["+g+"] > "+d;a.ENABLE_CALLBACK&&a.emitter.emit("log","warn",S),a.ENABLE_WARN&&(console.warn?console.warn(S):console.log(S))},a.d=function(g,d){g&&!a.FORCE_GLOBAL_TAG||(g=a.GLOBAL_TAG);var S="["+g+"] > "+d;a.ENABLE_CALLBACK&&a.emitter.emit("log","debug",S),a.ENABLE_DEBUG&&(console.debug?console.debug(S):console.log(S))},a.v=function(g,d){g&&!a.FORCE_GLOBAL_TAG||(g=a.GLOBAL_TAG);var S="["+g+"] > "+d;a.ENABLE_CALLBACK&&a.emitter.emit("log","verbose",S),a.ENABLE_VERBOSE&&console.log(S)},a}();b.GLOBAL_TAG="mpegts.js",b.FORCE_GLOBAL_TAG=!1,b.ENABLE_ERROR=!0,b.ENABLE_INFO=!0,b.ENABLE_WARN=!0,b.ENABLE_DEBUG=!0,b.ENABLE_VERBOSE=!0,b.ENABLE_CALLBACK=!1,b.emitter=new C.a,ee.a=b},function(G,ee,W){ee.a={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},function(G,ee,W){W.d(ee,"c",function(){return C}),W.d(ee,"b",function(){return b}),W.d(ee,"a",function(){return a});var O=W(3),C={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},b={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},a=function(){function g(d){this._type=d||"undefined",this._status=C.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return g.prototype.destroy=function(){this._status=C.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},g.prototype.isWorking=function(){return this._status===C.kConnecting||this._status===C.kBuffering},Object.defineProperty(g.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(d){this._onContentLengthKnown=d},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(d){this._onURLRedirect=d},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(d){this._onDataArrival=d},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onError",{get:function(){return this._onError},set:function(d){this._onError=d},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onComplete",{get:function(){return this._onComplete},set:function(d){this._onComplete=d},enumerable:!1,configurable:!0}),g.prototype.open=function(d,S){throw new O.c("Unimplemented abstract function!")},g.prototype.abort=function(){throw new O.c("Unimplemented abstract function!")},g}()},function(G,ee,W){W.d(ee,"d",function(){return b}),W.d(ee,"a",function(){return a}),W.d(ee,"b",function(){return g}),W.d(ee,"c",function(){return d});var O,C=(O=function(S,E){return(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,x){R.__proto__=x}||function(R,x){for(var A in x)x.hasOwnProperty(A)&&(R[A]=x[A])})(S,E)},function(S,E){function R(){this.constructor=S}O(S,E),S.prototype=E===null?Object.create(E):(R.prototype=E.prototype,new R)}),b=function(){function S(E){this._message=E}return Object.defineProperty(S.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),S.prototype.toString=function(){return this.name+": "+this.message},S}(),a=function(S){function E(R){return S.call(this,R)||this}return C(E,S),Object.defineProperty(E.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),E}(b),g=function(S){function E(R){return S.call(this,R)||this}return C(E,S),Object.defineProperty(E.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),E}(b),d=function(S){function E(R){return S.call(this,R)||this}return C(E,S),Object.defineProperty(E.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),E}(b)},function(G,ee,W){var O={};(function(){var C=self.navigator.userAgent.toLowerCase(),b=/(edge)\/([\w.]+)/.exec(C)||/(opr)[\/]([\w.]+)/.exec(C)||/(chrome)[ \/]([\w.]+)/.exec(C)||/(iemobile)[\/]([\w.]+)/.exec(C)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(C)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(C)||/(webkit)[ \/]([\w.]+)/.exec(C)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(C)||/(msie) ([\w.]+)/.exec(C)||C.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(C)||C.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(C)||[],a=/(ipad)/.exec(C)||/(ipod)/.exec(C)||/(windows phone)/.exec(C)||/(iphone)/.exec(C)||/(kindle)/.exec(C)||/(android)/.exec(C)||/(windows)/.exec(C)||/(mac)/.exec(C)||/(linux)/.exec(C)||/(cros)/.exec(C)||[],g={browser:b[5]||b[3]||b[1]||"",version:b[2]||b[4]||"0",majorVersion:b[4]||b[2]||"0",platform:a[0]||""},d={};if(g.browser){d[g.browser]=!0;var S=g.majorVersion.split(".");d.version={major:parseInt(g.majorVersion,10),string:g.version},S.length>1&&(d.version.minor=parseInt(S[1],10)),S.length>2&&(d.version.build=parseInt(S[2],10))}g.platform&&(d[g.platform]=!0),(d.chrome||d.opr||d.safari)&&(d.webkit=!0),(d.rv||d.iemobile)&&(d.rv&&delete d.rv,g.browser="msie",d.msie=!0),d.edge&&(delete d.edge,g.browser="msedge",d.msedge=!0),d.opr&&(g.browser="opera",d.opera=!0),d.safari&&d.android&&(g.browser="android",d.android=!0);for(var E in d.name=g.browser,d.platform=g.platform,O)O.hasOwnProperty(E)&&delete O[E];Object.assign(O,d)})(),ee.a=O},function(G,ee,W){ee.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(G,ee,W){var O,C=typeof Reflect=="object"?Reflect:null,b=C&&typeof C.apply=="function"?C.apply:function(m,_,o){return Function.prototype.apply.call(m,_,o)};O=C&&typeof C.ownKeys=="function"?C.ownKeys:Object.getOwnPropertySymbols?function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:function(m){return Object.getOwnPropertyNames(m)};var a=Number.isNaN||function(m){return m!=m};function g(){g.init.call(this)}G.exports=g,G.exports.once=function(m,_){return new Promise(function(o,i){function t(l){m.removeListener(_,r),i(l)}function r(){typeof m.removeListener=="function"&&m.removeListener("error",t),o([].slice.call(arguments))}c(m,_,r,{once:!0}),_!=="error"&&function(l,p,u){typeof l.on=="function"&&c(l,"error",p,u)}(m,t,{once:!0})})},g.EventEmitter=g,g.prototype._events=void 0,g.prototype._eventsCount=0,g.prototype._maxListeners=void 0;var d=10;function S(m){if(typeof m!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof m)}function E(m){return m._maxListeners===void 0?g.defaultMaxListeners:m._maxListeners}function R(m,_,o,i){var t,r,l,p;if(S(o),(r=m._events)===void 0?(r=m._events=Object.create(null),m._eventsCount=0):(r.newListener!==void 0&&(m.emit("newListener",_,o.listener?o.listener:o),r=m._events),l=r[_]),l===void 0)l=r[_]=o,++m._eventsCount;else if(typeof l=="function"?l=r[_]=i?[o,l]:[l,o]:i?l.unshift(o):l.push(o),(t=E(m))>0&&l.length>t&&!l.warned){l.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(_)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=m,u.type=_,u.count=l.length,p=u,console&&console.warn&&console.warn(p)}return m}function x(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function A(m,_,o){var i={fired:!1,wrapFn:void 0,target:m,type:_,listener:o},t=x.bind(i);return t.listener=o,i.wrapFn=t,t}function D(m,_,o){var i=m._events;if(i===void 0)return[];var t=i[_];return t===void 0?[]:typeof t=="function"?o?[t.listener||t]:[t]:o?function(r){for(var l=new Array(r.length),p=0;p<l.length;++p)l[p]=r[p].listener||r[p];return l}(t):I(t,t.length)}function P(m){var _=this._events;if(_!==void 0){var o=_[m];if(typeof o=="function")return 1;if(o!==void 0)return o.length}return 0}function I(m,_){for(var o=new Array(_),i=0;i<_;++i)o[i]=m[i];return o}function c(m,_,o,i){if(typeof m.on=="function")i.once?m.once(_,o):m.on(_,o);else{if(typeof m.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof m);m.addEventListener(_,function t(r){i.once&&m.removeEventListener(_,t),o(r)})}}Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(m){if(typeof m!="number"||m<0||a(m))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+m+".");d=m}}),g.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},g.prototype.setMaxListeners=function(m){if(typeof m!="number"||m<0||a(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this},g.prototype.getMaxListeners=function(){return E(this)},g.prototype.emit=function(m){for(var _=[],o=1;o<arguments.length;o++)_.push(arguments[o]);var i=m==="error",t=this._events;if(t!==void 0)i=i&&t.error===void 0;else if(!i)return!1;if(i){var r;if(_.length>0&&(r=_[0]),r instanceof Error)throw r;var l=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw l.context=r,l}var p=t[m];if(p===void 0)return!1;if(typeof p=="function")b(p,this,_);else{var u=p.length,f=I(p,u);for(o=0;o<u;++o)b(f[o],this,_)}return!0},g.prototype.addListener=function(m,_){return R(this,m,_,!1)},g.prototype.on=g.prototype.addListener,g.prototype.prependListener=function(m,_){return R(this,m,_,!0)},g.prototype.once=function(m,_){return S(_),this.on(m,A(this,m,_)),this},g.prototype.prependOnceListener=function(m,_){return S(_),this.prependListener(m,A(this,m,_)),this},g.prototype.removeListener=function(m,_){var o,i,t,r,l;if(S(_),(i=this._events)===void 0)return this;if((o=i[m])===void 0)return this;if(o===_||o.listener===_)--this._eventsCount==0?this._events=Object.create(null):(delete i[m],i.removeListener&&this.emit("removeListener",m,o.listener||_));else if(typeof o!="function"){for(t=-1,r=o.length-1;r>=0;r--)if(o[r]===_||o[r].listener===_){l=o[r].listener,t=r;break}if(t<0)return this;t===0?o.shift():function(p,u){for(;u+1<p.length;u++)p[u]=p[u+1];p.pop()}(o,t),o.length===1&&(i[m]=o[0]),i.removeListener!==void 0&&this.emit("removeListener",m,l||_)}return this},g.prototype.off=g.prototype.removeListener,g.prototype.removeAllListeners=function(m){var _,o,i;if((o=this._events)===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[m]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete o[m]),this;if(arguments.length===0){var t,r=Object.keys(o);for(i=0;i<r.length;++i)(t=r[i])!=="removeListener"&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(_=o[m])=="function")this.removeListener(m,_);else if(_!==void 0)for(i=_.length-1;i>=0;i--)this.removeListener(m,_[i]);return this},g.prototype.listeners=function(m){return D(this,m,!0)},g.prototype.rawListeners=function(m){return D(this,m,!1)},g.listenerCount=function(m,_){return typeof m.listenerCount=="function"?m.listenerCount(_):P.call(m,_)},g.prototype.listenerCount=P,g.prototype.eventNames=function(){return this._eventsCount>0?O(this._events):[]}},function(G,ee,W){W.d(ee,"d",function(){return O}),W.d(ee,"b",function(){return C}),W.d(ee,"a",function(){return b}),W.d(ee,"c",function(){return a});var O=function(g,d,S,E,R){this.dts=g,this.pts=d,this.duration=S,this.originalDts=E,this.isSyncPoint=R,this.fileposition=null},C=function(){function g(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return g.prototype.appendSyncPoint=function(d){d.isSyncPoint=!0,this.syncPoints.push(d)},g}(),b=function(){function g(){this._list=[]}return g.prototype.clear=function(){this._list=[]},g.prototype.appendArray=function(d){var S=this._list;d.length!==0&&(S.length>0&&d[0].originalDts<S[S.length-1].originalDts&&this.clear(),Array.prototype.push.apply(S,d))},g.prototype.getLastSyncPointBeforeDts=function(d){if(this._list.length==0)return null;var S=this._list,E=0,R=S.length-1,x=0,A=0,D=R;for(d<S[0].dts&&(E=0,A=D+1);A<=D;){if((x=A+Math.floor((D-A)/2))===R||d>=S[x].dts&&d<S[x+1].dts){E=x;break}S[x].dts<d?A=x+1:D=x-1}return this._list[E]},g}(),a=function(){function g(d){this._type=d,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(g.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),g.prototype.isEmpty=function(){return this._list.length===0},g.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},g.prototype._searchNearestSegmentBefore=function(d){var S=this._list;if(S.length===0)return-2;var E=S.length-1,R=0,x=0,A=E,D=0;if(d<S[0].originalBeginDts)return D=-1;for(;x<=A;){if((R=x+Math.floor((A-x)/2))===E||d>S[R].lastSample.originalDts&&d<S[R+1].originalBeginDts){D=R;break}S[R].originalBeginDts<d?x=R+1:A=R-1}return D},g.prototype._searchNearestSegmentAfter=function(d){return this._searchNearestSegmentBefore(d)+1},g.prototype.append=function(d){var S=this._list,E=d,R=this._lastAppendLocation,x=0;R!==-1&&R<S.length&&E.originalBeginDts>=S[R].lastSample.originalDts&&(R===S.length-1||R<S.length-1&&E.originalBeginDts<S[R+1].originalBeginDts)?x=R+1:S.length>0&&(x=this._searchNearestSegmentBefore(E.originalBeginDts)+1),this._lastAppendLocation=x,this._list.splice(x,0,E)},g.prototype.getLastSegmentBefore=function(d){var S=this._searchNearestSegmentBefore(d);return S>=0?this._list[S]:null},g.prototype.getLastSampleBefore=function(d){var S=this.getLastSegmentBefore(d);return S!=null?S.lastSample:null},g.prototype.getLastSyncPointBefore=function(d){for(var S=this._searchNearestSegmentBefore(d),E=this._list[S].syncPoints;E.length===0&&S>0;)S--,E=this._list[S].syncPoints;return E.length>0?E[E.length-1]:null},g}()},function(G,ee,W){var O=function(){function C(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return C.prototype.isComplete=function(){var b=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,a=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&b&&a},C.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},C.prototype.getNearestKeyframe=function(b){if(this.keyframesIndex==null)return null;var a=this.keyframesIndex,g=this._search(a.times,b);return{index:g,milliseconds:a.times[g],fileposition:a.filepositions[g]}},C.prototype._search=function(b,a){var g=0,d=b.length-1,S=0,E=0,R=d;for(a<b[0]&&(g=0,E=R+1);E<=R;){if((S=E+Math.floor((R-E)/2))===d||a>=b[S]&&a<b[S+1]){g=S;break}b[S]<a?E=S+1:R=S-1}return g},C}();ee.a=O},function(G,ee,W){var O=W(6),C=W.n(O),b=W(0),a=function(){function g(){}return Object.defineProperty(g,"forceGlobalTag",{get:function(){return b.a.FORCE_GLOBAL_TAG},set:function(d){b.a.FORCE_GLOBAL_TAG=d,g._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(g,"globalTag",{get:function(){return b.a.GLOBAL_TAG},set:function(d){b.a.GLOBAL_TAG=d,g._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(g,"enableAll",{get:function(){return b.a.ENABLE_VERBOSE&&b.a.ENABLE_DEBUG&&b.a.ENABLE_INFO&&b.a.ENABLE_WARN&&b.a.ENABLE_ERROR},set:function(d){b.a.ENABLE_VERBOSE=d,b.a.ENABLE_DEBUG=d,b.a.ENABLE_INFO=d,b.a.ENABLE_WARN=d,b.a.ENABLE_ERROR=d,g._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(g,"enableDebug",{get:function(){return b.a.ENABLE_DEBUG},set:function(d){b.a.ENABLE_DEBUG=d,g._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(g,"enableVerbose",{get:function(){return b.a.ENABLE_VERBOSE},set:function(d){b.a.ENABLE_VERBOSE=d,g._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(g,"enableInfo",{get:function(){return b.a.ENABLE_INFO},set:function(d){b.a.ENABLE_INFO=d,g._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(g,"enableWarn",{get:function(){return b.a.ENABLE_WARN},set:function(d){b.a.ENABLE_WARN=d,g._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(g,"enableError",{get:function(){return b.a.ENABLE_ERROR},set:function(d){b.a.ENABLE_ERROR=d,g._notifyChange()},enumerable:!1,configurable:!0}),g.getConfig=function(){return{globalTag:b.a.GLOBAL_TAG,forceGlobalTag:b.a.FORCE_GLOBAL_TAG,enableVerbose:b.a.ENABLE_VERBOSE,enableDebug:b.a.ENABLE_DEBUG,enableInfo:b.a.ENABLE_INFO,enableWarn:b.a.ENABLE_WARN,enableError:b.a.ENABLE_ERROR,enableCallback:b.a.ENABLE_CALLBACK}},g.applyConfig=function(d){b.a.GLOBAL_TAG=d.globalTag,b.a.FORCE_GLOBAL_TAG=d.forceGlobalTag,b.a.ENABLE_VERBOSE=d.enableVerbose,b.a.ENABLE_DEBUG=d.enableDebug,b.a.ENABLE_INFO=d.enableInfo,b.a.ENABLE_WARN=d.enableWarn,b.a.ENABLE_ERROR=d.enableError,b.a.ENABLE_CALLBACK=d.enableCallback},g._notifyChange=function(){var d=g.emitter;if(d.listenerCount("change")>0){var S=g.getConfig();d.emit("change",S)}},g.registerListener=function(d){g.emitter.addListener("change",d)},g.removeListener=function(d){g.emitter.removeListener("change",d)},g.addLogListener=function(d){b.a.emitter.addListener("log",d),b.a.emitter.listenerCount("log")>0&&(b.a.ENABLE_CALLBACK=!0,g._notifyChange())},g.removeLogListener=function(d){b.a.emitter.removeListener("log",d),b.a.emitter.listenerCount("log")===0&&(b.a.ENABLE_CALLBACK=!1,g._notifyChange())},g}();a.emitter=new C.a,ee.a=a},function(G,ee,W){var O=W(6),C=W.n(O),b=W(0),a=W(4),g=W(8);function d(U,k,F){var w=U;if(k+F<w.length){for(;F--;)if((192&w[++k])!=128)return!1;return!0}return!1}var S,E=function(U){for(var k=[],F=U,w=0,H=U.length;w<H;)if(F[w]<128)k.push(String.fromCharCode(F[w])),++w;else{if(!(F[w]<192)){if(F[w]<224){if(d(F,w,1)&&(Q=(31&F[w])<<6|63&F[w+1])>=128){k.push(String.fromCharCode(65535&Q)),w+=2;continue}}else if(F[w]<240){if(d(F,w,2)&&(Q=(15&F[w])<<12|(63&F[w+1])<<6|63&F[w+2])>=2048&&(63488&Q)!=55296){k.push(String.fromCharCode(65535&Q)),w+=3;continue}}else if(F[w]<248){var Q;if(d(F,w,3)&&(Q=(7&F[w])<<18|(63&F[w+1])<<12|(63&F[w+2])<<6|63&F[w+3])>65536&&Q<1114112){Q-=65536,k.push(String.fromCharCode(Q>>>10|55296)),k.push(String.fromCharCode(1023&Q|56320)),w+=4;continue}}}k.push(String.fromCharCode(65533)),++w}return k.join("")},R=W(3),x=(S=new ArrayBuffer(2),new DataView(S).setInt16(0,256,!0),new Int16Array(S)[0]===256),A=function(){function U(){}return U.parseScriptData=function(k,F,w){var H={};try{var Q=U.parseValue(k,F,w),Y=U.parseValue(k,F+Q.size,w-Q.size);H[Q.data]=Y.data}catch(J){b.a.e("AMF",J.toString())}return H},U.parseObject=function(k,F,w){if(w<3)throw new R.a("Data not enough when parse ScriptDataObject");var H=U.parseString(k,F,w),Q=U.parseValue(k,F+H.size,w-H.size),Y=Q.objectEnd;return{data:{name:H.data,value:Q.data},size:H.size+Q.size,objectEnd:Y}},U.parseVariable=function(k,F,w){return U.parseObject(k,F,w)},U.parseString=function(k,F,w){if(w<2)throw new R.a("Data not enough when parse String");var H=new DataView(k,F,w).getUint16(0,!x);return{data:H>0?E(new Uint8Array(k,F+2,H)):"",size:2+H}},U.parseLongString=function(k,F,w){if(w<4)throw new R.a("Data not enough when parse LongString");var H=new DataView(k,F,w).getUint32(0,!x);return{data:H>0?E(new Uint8Array(k,F+4,H)):"",size:4+H}},U.parseDate=function(k,F,w){if(w<10)throw new R.a("Data size invalid when parse Date");var H=new DataView(k,F,w),Q=H.getFloat64(0,!x),Y=H.getInt16(8,!x);return{data:new Date(Q+=60*Y*1e3),size:10}},U.parseValue=function(k,F,w){if(w<1)throw new R.a("Data not enough when parse Value");var H,Q=new DataView(k,F,w),Y=1,J=Q.getUint8(0),ie=!1;try{switch(J){case 0:H=Q.getFloat64(1,!x),Y+=8;break;case 1:H=!!Q.getUint8(1),Y+=1;break;case 2:var re=U.parseString(k,F+1,w-1);H=re.data,Y+=re.size;break;case 3:H={};var ae=0;for((16777215&Q.getUint32(w-4,!x))==9&&(ae=3);Y<w-4;){var de=U.parseObject(k,F+Y,w-Y-ae);if(de.objectEnd)break;H[de.data.name]=de.data.value,Y+=de.size}Y<=w-3&&(16777215&Q.getUint32(Y-1,!x))===9&&(Y+=3);break;case 8:for(H={},Y+=4,ae=0,(16777215&Q.getUint32(w-4,!x))==9&&(ae=3);Y<w-8;){var ne=U.parseVariable(k,F+Y,w-Y-ae);if(ne.objectEnd)break;H[ne.data.name]=ne.data.value,Y+=ne.size}Y<=w-3&&(16777215&Q.getUint32(Y-1,!x))===9&&(Y+=3);break;case 9:H=void 0,Y=1,ie=!0;break;case 10:H=[];var se=Q.getUint32(1,!x);Y+=4;for(var fe=0;fe<se;fe++){var ge=U.parseValue(k,F+Y,w-Y);H.push(ge.data),Y+=ge.size}break;case 11:var pe=U.parseDate(k,F+1,w-1);H=pe.data,Y+=pe.size;break;case 12:var Te=U.parseString(k,F+1,w-1);H=Te.data,Y+=Te.size;break;default:Y=w,b.a.w("AMF","Unsupported AMF value type "+J)}}catch(xe){b.a.e("AMF",xe.toString())}return{data:H,size:Y,objectEnd:ie}},U}(),D=function(){function U(k){this.TAG="ExpGolomb",this._buffer=k,this._buffer_index=0,this._total_bytes=k.byteLength,this._total_bits=8*k.byteLength,this._current_word=0,this._current_word_bits_left=0}return U.prototype.destroy=function(){this._buffer=null},U.prototype._fillCurrentWord=function(){var k=this._total_bytes-this._buffer_index;if(k<=0)throw new R.a("ExpGolomb: _fillCurrentWord() but no bytes available");var F=Math.min(4,k),w=new Uint8Array(4);w.set(this._buffer.subarray(this._buffer_index,this._buffer_index+F)),this._current_word=new DataView(w.buffer).getUint32(0,!1),this._buffer_index+=F,this._current_word_bits_left=8*F},U.prototype.readBits=function(k){if(k>32)throw new R.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(k<=this._current_word_bits_left){var F=this._current_word>>>32-k;return this._current_word<<=k,this._current_word_bits_left-=k,F}var w=this._current_word_bits_left?this._current_word:0;w>>>=32-this._current_word_bits_left;var H=k-this._current_word_bits_left;this._fillCurrentWord();var Q=Math.min(H,this._current_word_bits_left),Y=this._current_word>>>32-Q;return this._current_word<<=Q,this._current_word_bits_left-=Q,w=w<<Q|Y},U.prototype.readBool=function(){return this.readBits(1)===1},U.prototype.readByte=function(){return this.readBits(8)},U.prototype._skipLeadingZero=function(){var k;for(k=0;k<this._current_word_bits_left;k++)if((this._current_word&2147483648>>>k)!=0)return this._current_word<<=k,this._current_word_bits_left-=k,k;return this._fillCurrentWord(),k+this._skipLeadingZero()},U.prototype.readUEG=function(){var k=this._skipLeadingZero();return this.readBits(k+1)-1},U.prototype.readSEG=function(){var k=this.readUEG();return 1&k?k+1>>>1:-1*(k>>>1)},U}(),P=function(){function U(){}return U._ebsp2rbsp=function(k){for(var F=k,w=F.byteLength,H=new Uint8Array(w),Q=0,Y=0;Y<w;Y++)Y>=2&&F[Y]===3&&F[Y-1]===0&&F[Y-2]===0||(H[Q]=F[Y],Q++);return new Uint8Array(H.buffer,0,Q)},U.parseSPS=function(k){for(var F=k.subarray(1,4),w="avc1.",H=0;H<3;H++){var Q=F[H].toString(16);Q.length<2&&(Q="0"+Q),w+=Q}var Y=U._ebsp2rbsp(k),J=new D(Y);J.readByte();var ie=J.readByte();J.readByte();var re=J.readByte();J.readUEG();var ae=U.getProfileString(ie),de=U.getLevelString(re),ne=1,se=420,fe=8,ge=8;if((ie===100||ie===110||ie===122||ie===244||ie===44||ie===83||ie===86||ie===118||ie===128||ie===138||ie===144)&&((ne=J.readUEG())===3&&J.readBits(1),ne<=3&&(se=[0,420,422,444][ne]),fe=J.readUEG()+8,ge=J.readUEG()+8,J.readBits(1),J.readBool()))for(var pe=ne!==3?8:12,Te=0;Te<pe;Te++)J.readBool()&&(Te<6?U._skipScalingList(J,16):U._skipScalingList(J,64));J.readUEG();var xe=J.readUEG();if(xe===0)J.readUEG();else if(xe===1){J.readBits(1),J.readSEG(),J.readSEG();var Ee=J.readUEG();for(Te=0;Te<Ee;Te++)J.readSEG()}var Me=J.readUEG();J.readBits(1);var Se=J.readUEG(),ye=J.readUEG(),Ae=J.readBits(1);Ae===0&&J.readBits(1),J.readBits(1);var Ce=0,Ye=0,Pe=0,Ke=0;J.readBool()&&(Ce=J.readUEG(),Ye=J.readUEG(),Pe=J.readUEG(),Ke=J.readUEG());var Ve=1,Re=1,Ne=0,qe=!0,at=0,gt=0;if(J.readBool()){if(J.readBool()){var ct=J.readByte();ct>0&&ct<16?(Ve=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][ct-1],Re=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][ct-1]):ct===255&&(Ve=J.readByte()<<8|J.readByte(),Re=J.readByte()<<8|J.readByte())}if(J.readBool()&&J.readBool(),J.readBool()&&(J.readBits(4),J.readBool()&&J.readBits(24)),J.readBool()&&(J.readUEG(),J.readUEG()),J.readBool()){var Xe=J.readBits(32),Tt=J.readBits(32);qe=J.readBool(),Ne=(at=Tt)/(gt=2*Xe)}}var _t=1;Ve===1&&Re===1||(_t=Ve/Re);var lt=0,nt=0;ne===0?(lt=1,nt=2-Ae):(lt=ne===3?1:2,nt=(ne===1?2:1)*(2-Ae));var yt=16*(Se+1),mt=16*(ye+1)*(2-Ae);yt-=(Ce+Ye)*lt,mt-=(Pe+Ke)*nt;var Et=Math.ceil(yt*_t);return J.destroy(),J=null,{codec_mimetype:w,profile_idc:ie,level_idc:re,profile_string:ae,level_string:de,chroma_format_idc:ne,bit_depth:fe,bit_depth_luma:fe,bit_depth_chroma:ge,ref_frames:Me,chroma_format:se,chroma_format_string:U.getChromaFormatString(se),frame_rate:{fixed:qe,fps:Ne,fps_den:gt,fps_num:at},sar_ratio:{width:Ve,height:Re},codec_size:{width:yt,height:mt},present_size:{width:Et,height:mt}}},U._skipScalingList=function(k,F){for(var w=8,H=8,Q=0;Q<F;Q++)H!==0&&(H=(w+k.readSEG()+256)%256),w=H===0?w:H},U.getProfileString=function(k){switch(k){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},U.getLevelString=function(k){return(k/10).toFixed(1)},U.getChromaFormatString=function(k){switch(k){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},U}(),I=W(5),c=function(){function U(){}return U._ebsp2rbsp=function(k){for(var F=k,w=F.byteLength,H=new Uint8Array(w),Q=0,Y=0;Y<w;Y++)Y>=2&&F[Y]===3&&F[Y-1]===0&&F[Y-2]===0||(H[Q]=F[Y],Q++);return new Uint8Array(H.buffer,0,Q)},U.parseVPS=function(k){var F=U._ebsp2rbsp(k),w=new D(F);return w.readByte(),w.readByte(),w.readBits(4),w.readBits(2),w.readBits(6),{num_temporal_layers:w.readBits(3)+1,temporal_id_nested:w.readBool()}},U.parseSPS=function(k){var F=U._ebsp2rbsp(k),w=new D(F);w.readByte(),w.readByte(),w.readBits(4);for(var H=w.readBits(3),Q=(w.readBool(),w.readBits(2)),Y=w.readBool(),J=w.readBits(5),ie=w.readByte(),re=w.readByte(),ae=w.readByte(),de=w.readByte(),ne=w.readByte(),se=w.readByte(),fe=w.readByte(),ge=w.readByte(),pe=w.readByte(),Te=w.readByte(),xe=w.readByte(),Ee=[],Me=[],Se=0;Se<H;Se++)Ee.push(w.readBool()),Me.push(w.readBool());if(H>0)for(Se=H;Se<8;Se++)w.readBits(2);for(Se=0;Se<H;Se++)Ee[Se]&&(w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte()),Me[Se]&&w.readByte();w.readUEG();var ye=w.readUEG();ye==3&&w.readBits(1);var Ae=w.readUEG(),Ce=w.readUEG();w.readBool()&&(w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG());var Ye=w.readUEG(),Pe=w.readUEG(),Ke=w.readUEG();for(Se=w.readBool()?0:H;Se<=H;Se++)w.readUEG(),w.readUEG(),w.readUEG();if(w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG(),w.readBool()&&w.readBool())for(var Ve=0;Ve<4;Ve++)for(var Re=0;Re<(Ve===3?2:6);Re++)if(w.readBool()){var Ne=Math.min(64,1<<4+(Ve<<1));for(Ve>1&&w.readSEG(),Se=0;Se<Ne;Se++)w.readSEG()}else w.readUEG();w.readBool(),w.readBool(),w.readBool()&&(w.readByte(),w.readUEG(),w.readUEG(),w.readBool());var qe=w.readUEG(),at=0;for(Se=0;Se<qe;Se++){var gt=!1;if(Se!==0&&(gt=w.readBool()),gt){Se===qe&&w.readUEG(),w.readBool(),w.readUEG();for(var ct=0,Xe=0;Xe<=at;Xe++){var Tt=w.readBool(),_t=!1;Tt||(_t=w.readBool()),(Tt||_t)&&ct++}at=ct}else{var lt=w.readUEG(),nt=w.readUEG();for(at=lt+nt,Xe=0;Xe<lt;Xe++)w.readUEG(),w.readBool();for(Xe=0;Xe<nt;Xe++)w.readUEG(),w.readBool()}}if(w.readBool()){var yt=w.readUEG();for(Se=0;Se<yt;Se++){for(Xe=0;Xe<Ke+4;Xe++)w.readBits(1);w.readBits(1)}}var mt=0,Et=1,St=1,kt=!1,Dt=1,It=1;if(w.readBool(),w.readBool(),w.readBool()){if(w.readBool()){var xt=w.readByte();xt>0&&xt<16?(Et=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][xt-1],St=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][xt-1]):xt===255&&(Et=w.readBits(16),St=w.readBits(16))}if(w.readBool()&&w.readBool(),w.readBool()&&(w.readBits(3),w.readBool(),w.readBool()&&(w.readByte(),w.readByte(),w.readByte())),w.readBool()&&(w.readUEG(),w.readUEG()),w.readBool(),w.readBool(),w.readBool(),w.readBool()&&(w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG()),w.readBool()&&(Dt=w.readBits(32),It=w.readBits(32),w.readBool()&&(w.readUEG(),w.readBool()))){var Mt=!1,Rt=!1,Lt=!1;for(Mt=w.readBool(),Rt=w.readBool(),(Mt||Rt)&&((Lt=w.readBool())&&(w.readByte(),w.readBits(5),w.readBool(),w.readBits(5)),w.readBits(4),w.readBits(4),Lt&&w.readBits(4),w.readBits(5),w.readBits(5),w.readBits(5)),Se=0;Se<=H;Se++){var Bt=w.readBool();kt=Bt;var Ft=!1,Pt=1;Bt||(Ft=w.readBool());var Nt=!1;if(Ft?w.readSEG():Nt=w.readBool(),Nt||(Pt=w.readUEG()+1),Mt)for(Xe=0;Xe<Pt;Xe++)w.readUEG(),w.readUEG(),Lt&&(w.readUEG(),w.readUEG());if(Rt)for(Xe=0;Xe<Pt;Xe++)w.readUEG(),w.readUEG(),Lt&&(w.readUEG(),w.readUEG())}}w.readBool()&&(w.readBool(),w.readBool(),w.readBool(),mt=w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG())}w.readBool();var Jt="hvc1."+J+".1.L"+xe+".B0",Ut=Ae,jt=Ce,Kt=1;return Et!==1&&St!==1&&(Kt=Et/St),w.destroy(),w=null,{codec_mimetype:Jt,level_string:U.getLevelString(xe),profile_idc:J,bit_depth:Ye+8,ref_frames:1,chroma_format:ye,chroma_format_string:U.getChromaFormatString(ye),general_level_idc:xe,general_profile_space:Q,general_tier_flag:Y,general_profile_idc:J,general_profile_compatibility_flags_1:ie,general_profile_compatibility_flags_2:re,general_profile_compatibility_flags_3:ae,general_profile_compatibility_flags_4:de,general_constraint_indicator_flags_1:ne,general_constraint_indicator_flags_2:se,general_constraint_indicator_flags_3:fe,general_constraint_indicator_flags_4:ge,general_constraint_indicator_flags_5:pe,general_constraint_indicator_flags_6:Te,min_spatial_segmentation_idc:mt,constant_frame_rate:0,chroma_format_idc:ye,bit_depth_luma_minus8:Ye,bit_depth_chroma_minus8:Pe,frame_rate:{fixed:kt,fps:It/Dt,fps_den:Dt,fps_num:It},sar_ratio:{width:Et,height:St},codec_size:{width:Ut,height:jt},present_size:{width:Ut*Kt,height:jt}}},U.parsePPS=function(k){var F=U._ebsp2rbsp(k),w=new D(F);w.readByte(),w.readByte(),w.readUEG(),w.readUEG(),w.readBool(),w.readBool(),w.readBits(3),w.readBool(),w.readBool(),w.readUEG(),w.readUEG(),w.readSEG(),w.readBool(),w.readBool(),w.readBool()&&w.readUEG(),w.readSEG(),w.readSEG(),w.readBool(),w.readBool(),w.readBool(),w.readBool();var H=w.readBool(),Q=w.readBool(),Y=1;return Q&&H?Y=0:Q?Y=3:H&&(Y=2),{parallelismType:Y}},U.getChromaFormatString=function(k){switch(k){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},U.getProfileString=function(k){switch(k){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},U.getLevelString=function(k){return(k/30).toFixed(1)},U}();function m(U){return U.byteOffset%2==0&&U.byteLength%2==0}function _(U){return U.byteOffset%4==0&&U.byteLength%4==0}function o(U,k){for(var F=0;F<U.length;F++)if(U[F]!==k[F])return!1;return!0}var i=function(U,k){return U.byteLength===k.byteLength&&(_(U)&&_(k)?function(F,w){return o(new Uint32Array(F.buffer,F.byteOffset,F.byteLength/4),new Uint32Array(w.buffer,w.byteOffset,w.byteLength/4))}(U,k):m(U)&&m(k)?function(F,w){return o(new Uint16Array(F.buffer,F.byteOffset,F.byteLength/2),new Uint16Array(w.buffer,w.byteOffset,w.byteLength/2))}(U,k):function(F,w){return o(F,w)}(U,k))},t,r=function(){function U(k,F){this.TAG="FLVDemuxer",this._config=F,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=k.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=k.hasAudioTrack,this._hasVideo=k.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new g.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var w=new ArrayBuffer(2);return new DataView(w).setInt16(0,256,!0),new Int16Array(w)[0]===256}()}return U.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},U.probe=function(k){var F=new Uint8Array(k);if(F.byteLength<9)return{needMoreData:!0};var w={match:!1};if(F[0]!==70||F[1]!==76||F[2]!==86||F[3]!==1)return w;var H,Q,Y=(4&F[4])>>>2!=0,J=(1&F[4])!=0,ie=(H=F)[Q=5]<<24|H[Q+1]<<16|H[Q+2]<<8|H[Q+3];return ie<9?w:{match:!0,consumed:ie,dataOffset:ie,hasAudioTrack:Y,hasVideoTrack:J}},U.prototype.bindDataSource=function(k){return k.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(U.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(k){this._onTrackMetadata=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(k){this._onMediaInfo=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(k){this._onMetaDataArrived=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(k){this._onScriptDataArrived=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"onError",{get:function(){return this._onError},set:function(k){this._onError=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(k){this._onDataAvailable=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(k){this._timestampBase=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"overridedDuration",{get:function(){return this._duration},set:function(k){this._durationOverrided=!0,this._duration=k,this._mediaInfo.duration=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"overridedHasAudio",{set:function(k){this._hasAudioFlagOverrided=!0,this._hasAudio=k,this._mediaInfo.hasAudio=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"overridedHasVideo",{set:function(k){this._hasVideoFlagOverrided=!0,this._hasVideo=k,this._mediaInfo.hasVideo=k},enumerable:!1,configurable:!0}),U.prototype.resetMediaInfo=function(){this._mediaInfo=new g.a},U.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},U.prototype.parseChunks=function(k,F){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new R.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var w=0,H=this._littleEndian;if(F===0){if(!(k.byteLength>13))return 0;w=U.probe(k).dataOffset}for(this._firstParse&&(this._firstParse=!1,F+w!==this._dataOffset&&b.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),(Q=new DataView(k,w)).getUint32(0,!H)!==0&&b.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),w+=4);w<k.byteLength;){this._dispatch=!0;var Q=new DataView(k,w);if(w+11+4>k.byteLength)break;var Y=Q.getUint8(0),J=16777215&Q.getUint32(0,!H);if(w+11+J+4>k.byteLength)break;if(Y===8||Y===9||Y===18){var ie=Q.getUint8(4),re=Q.getUint8(5),ae=Q.getUint8(6)|re<<8|ie<<16|Q.getUint8(7)<<24;(16777215&Q.getUint32(7,!H))!==0&&b.a.w(this.TAG,"Meet tag which has StreamID != 0!");var de=w+11;switch(Y){case 8:this._parseAudioData(k,de,J,ae);break;case 9:this._parseVideoData(k,de,J,ae,F+w);break;case 18:this._parseScriptData(k,de,J)}var ne=Q.getUint32(11+J,!H);ne!==11+J&&b.a.w(this.TAG,"Invalid PrevTagSize "+ne),w+=11+J+4}else b.a.w(this.TAG,"Unsupported tag type "+Y+", skipped"),w+=11+J+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),w},U.prototype._parseScriptData=function(k,F,w){var H=A.parseScriptData(k,F,w);if(H.hasOwnProperty("onMetaData")){if(H.onMetaData==null||typeof H.onMetaData!="object")return void b.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&b.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=H;var Q=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},Q)),typeof Q.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=Q.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof Q.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=Q.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof Q.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=Q.audiodatarate),typeof Q.videodatarate=="number"&&(this._mediaInfo.videoDataRate=Q.videodatarate),typeof Q.width=="number"&&(this._mediaInfo.width=Q.width),typeof Q.height=="number"&&(this._mediaInfo.height=Q.height),typeof Q.duration=="number"){if(!this._durationOverrided){var Y=Math.floor(Q.duration*this._timescale);this._duration=Y,this._mediaInfo.duration=Y}}else this._mediaInfo.duration=0;if(typeof Q.framerate=="number"){var J=Math.floor(1e3*Q.framerate);if(J>0){var ie=J/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=ie,this._referenceFrameRate.fps_num=J,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=ie}}if(typeof Q.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var re=Q.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(re),Q.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=Q,b.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(H).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},H))},U.prototype._parseKeyframesIndex=function(k){for(var F=[],w=[],H=1;H<k.times.length;H++){var Q=this._timestampBase+Math.floor(1e3*k.times[H]);F.push(Q),w.push(k.filepositions[H])}return{times:F,filepositions:w}},U.prototype._parseAudioData=function(k,F,w,H){if(w<=1)b.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(this._hasAudioFlagOverrided!==!0||this._hasAudio!==!1){this._littleEndian;var Q=new DataView(k,F,w).getUint8(0),Y=Q>>>4;if(Y===2||Y===10){var J=0,ie=(12&Q)>>>2;if(ie>=0&&ie<=4){J=this._flvSoundRateTable[ie];var re=1&Q,ae=this._audioMetadata,de=this._audioTrack;if(ae||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(ae=this._audioMetadata={}).type="audio",ae.id=de.id,ae.timescale=this._timescale,ae.duration=this._duration,ae.audioSampleRate=J,ae.channelCount=re===0?1:2),Y===10){var ne=this._parseAACAudioData(k,F+1,w-1);if(ne==null)return;if(ne.packetType===0){if(ae.config){if(i(ne.data.config,ae.config))return;b.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var se=ne.data;ae.audioSampleRate=se.samplingRate,ae.channelCount=se.channelCount,ae.codec=se.codec,ae.originalCodec=se.originalCodec,ae.config=se.config,ae.refSampleDuration=1024/ae.audioSampleRate*ae.timescale,b.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",ae),(pe=this._mediaInfo).audioCodec=ae.originalCodec,pe.audioSampleRate=ae.audioSampleRate,pe.audioChannelCount=ae.channelCount,pe.hasVideo?pe.videoCodec!=null&&(pe.mimeType='video/x-flv; codecs="'+pe.videoCodec+","+pe.audioCodec+'"'):pe.mimeType='video/x-flv; codecs="'+pe.audioCodec+'"',pe.isComplete()&&this._onMediaInfo(pe)}else if(ne.packetType===1){var fe=this._timestampBase+H,ge={unit:ne.data,length:ne.data.byteLength,dts:fe,pts:fe};de.samples.push(ge),de.length+=ne.data.length}else b.a.e(this.TAG,"Flv: Unsupported AAC data type "+ne.packetType)}else if(Y===2){if(!ae.codec){var pe;if((se=this._parseMP3AudioData(k,F+1,w-1,!0))==null)return;ae.audioSampleRate=se.samplingRate,ae.channelCount=se.channelCount,ae.codec=se.codec,ae.originalCodec=se.originalCodec,ae.refSampleDuration=1152/ae.audioSampleRate*ae.timescale,b.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",ae),(pe=this._mediaInfo).audioCodec=ae.codec,pe.audioSampleRate=ae.audioSampleRate,pe.audioChannelCount=ae.channelCount,pe.audioDataRate=se.bitRate,pe.hasVideo?pe.videoCodec!=null&&(pe.mimeType='video/x-flv; codecs="'+pe.videoCodec+","+pe.audioCodec+'"'):pe.mimeType='video/x-flv; codecs="'+pe.audioCodec+'"',pe.isComplete()&&this._onMediaInfo(pe)}var Te=this._parseMP3AudioData(k,F+1,w-1,!1);if(Te==null)return;fe=this._timestampBase+H;var xe={unit:Te,length:Te.byteLength,dts:fe,pts:fe};de.samples.push(xe),de.length+=Te.length}}else this._onError(I.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+ie)}else this._onError(I.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+Y)}},U.prototype._parseAACAudioData=function(k,F,w){if(!(w<=1)){var H={},Q=new Uint8Array(k,F,w);return H.packetType=Q[0],Q[0]===0?H.data=this._parseAACAudioSpecificConfig(k,F+1,w-1):H.data=Q.subarray(1),H}b.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},U.prototype._parseAACAudioSpecificConfig=function(k,F,w){var H,Q,Y=new Uint8Array(k,F,w),J=null,ie=0,re=null;if(ie=H=Y[0]>>>3,(Q=(7&Y[0])<<1|Y[1]>>>7)<0||Q>=this._mpegSamplingRates.length)this._onError(I.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var ae=this._mpegSamplingRates[Q],de=(120&Y[1])>>>3;if(!(de<0||de>=8)){ie===5&&(re=(7&Y[1])<<1|Y[2]>>>7,(124&Y[2])>>>2);var ne=self.navigator.userAgent.toLowerCase();return ne.indexOf("firefox")!==-1?Q>=6?(ie=5,J=new Array(4),re=Q-3):(ie=2,J=new Array(2),re=Q):ne.indexOf("android")!==-1?(ie=2,J=new Array(2),re=Q):(ie=5,re=Q,J=new Array(4),Q>=6?re=Q-3:de===1&&(ie=2,J=new Array(2),re=Q)),J[0]=ie<<3,J[0]|=(15&Q)>>>1,J[1]=(15&Q)<<7,J[1]|=(15&de)<<3,ie===5&&(J[1]|=(15&re)>>>1,J[2]=(1&re)<<7,J[2]|=8,J[3]=0),{config:J,samplingRate:ae,channelCount:de,codec:"mp4a.40."+ie,originalCodec:"mp4a.40."+H}}this._onError(I.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},U.prototype._parseMP3AudioData=function(k,F,w,H){if(!(w<4)){this._littleEndian;var Q=new Uint8Array(k,F,w),Y=null;if(H){if(Q[0]!==255)return;var J=Q[1]>>>3&3,ie=(6&Q[1])>>1,re=(240&Q[2])>>>4,ae=(12&Q[2])>>>2,de=(Q[3]>>>6&3)!==3?2:1,ne=0,se=0;switch(J){case 0:ne=this._mpegAudioV25SampleRateTable[ae];break;case 2:ne=this._mpegAudioV20SampleRateTable[ae];break;case 3:ne=this._mpegAudioV10SampleRateTable[ae]}switch(ie){case 1:re<this._mpegAudioL3BitRateTable.length&&(se=this._mpegAudioL3BitRateTable[re]);break;case 2:re<this._mpegAudioL2BitRateTable.length&&(se=this._mpegAudioL2BitRateTable[re]);break;case 3:re<this._mpegAudioL1BitRateTable.length&&(se=this._mpegAudioL1BitRateTable[re])}Y={bitRate:se,samplingRate:ne,channelCount:de,codec:"mp3",originalCodec:"mp3"}}else Y=Q;return Y}b.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},U.prototype._parseVideoData=function(k,F,w,H,Q){if(w<=1)b.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(this._hasVideoFlagOverrided!==!0||this._hasVideo!==!1){var Y=new Uint8Array(k,F,w)[0],J=(240&Y)>>>4,ie=15&Y;if(ie===7)this._parseAVCVideoPacket(k,F+1,w-1,H,Q,J);else{if(ie!==12)return void this._onError(I.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+ie);this._parseHEVCVideoPacket(k,F+1,w-1,H,Q,J)}}},U.prototype._parseAVCVideoPacket=function(k,F,w,H,Q,Y){if(w<4)b.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var J=this._littleEndian,ie=new DataView(k,F,w),re=ie.getUint8(0),ae=(16777215&ie.getUint32(0,!J))<<8>>8;if(re===0)this._parseAVCDecoderConfigurationRecord(k,F+4,w-4);else if(re===1)this._parseAVCVideoData(k,F+4,w-4,H,Q,Y,ae);else if(re!==2)return void this._onError(I.a.FORMAT_ERROR,"Flv: Invalid video packet type "+re)}},U.prototype._parseHEVCVideoPacket=function(k,F,w,H,Q,Y){if(w<4)b.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var J=this._littleEndian,ie=new DataView(k,F,w),re=ie.getUint8(0),ae=(16777215&ie.getUint32(0,!J))<<8>>8;if(re===0)this._parseHEVCDecoderConfigurationRecord(k,F+4,w-4);else if(re===1)this._parseHEVCVideoData(k,F+4,w-4,H,Q,Y,ae);else if(re!==2)return void this._onError(I.a.FORMAT_ERROR,"Flv: Invalid video packet type "+re)}},U.prototype._parseAVCDecoderConfigurationRecord=function(k,F,w){if(w<7)b.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var H=this._videoMetadata,Q=this._videoTrack,Y=this._littleEndian,J=new DataView(k,F,w);if(H){if(H.avcc!==void 0){var ie=new Uint8Array(k,F,w);if(i(ie,H.avcc))return;b.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(H=this._videoMetadata={}).type="video",H.id=Q.id,H.timescale=this._timescale,H.duration=this._duration;var re=J.getUint8(0),ae=J.getUint8(1);if(J.getUint8(2),J.getUint8(3),re===1&&ae!==0)if(this._naluLengthSize=1+(3&J.getUint8(4)),this._naluLengthSize===3||this._naluLengthSize===4){var de=31&J.getUint8(5);if(de!==0){de>1&&b.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+de);for(var ne=6,se=0;se<de;se++){var fe=J.getUint16(ne,!Y);if(ne+=2,fe!==0){var ge=new Uint8Array(k,F+ne,fe);ne+=fe;var pe=P.parseSPS(ge);if(se===0){H.codecWidth=pe.codec_size.width,H.codecHeight=pe.codec_size.height,H.presentWidth=pe.present_size.width,H.presentHeight=pe.present_size.height,H.profile=pe.profile_string,H.level=pe.level_string,H.bitDepth=pe.bit_depth,H.chromaFormat=pe.chroma_format,H.sarRatio=pe.sar_ratio,H.frameRate=pe.frame_rate,pe.frame_rate.fixed!==!1&&pe.frame_rate.fps_num!==0&&pe.frame_rate.fps_den!==0||(H.frameRate=this._referenceFrameRate);var Te=H.frameRate.fps_den,xe=H.frameRate.fps_num;H.refSampleDuration=H.timescale*(Te/xe);for(var Ee=ge.subarray(1,4),Me="avc1.",Se=0;Se<3;Se++){var ye=Ee[Se].toString(16);ye.length<2&&(ye="0"+ye),Me+=ye}H.codec=Me;var Ae=this._mediaInfo;Ae.width=H.codecWidth,Ae.height=H.codecHeight,Ae.fps=H.frameRate.fps,Ae.profile=H.profile,Ae.level=H.level,Ae.refFrames=pe.ref_frames,Ae.chromaFormat=pe.chroma_format_string,Ae.sarNum=H.sarRatio.width,Ae.sarDen=H.sarRatio.height,Ae.videoCodec=Me,Ae.hasAudio?Ae.audioCodec!=null&&(Ae.mimeType='video/x-flv; codecs="'+Ae.videoCodec+","+Ae.audioCodec+'"'):Ae.mimeType='video/x-flv; codecs="'+Ae.videoCodec+'"',Ae.isComplete()&&this._onMediaInfo(Ae)}}}var Ce=J.getUint8(ne);if(Ce!==0){for(Ce>1&&b.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+Ce),ne++,se=0;se<Ce;se++)fe=J.getUint16(ne,!Y),ne+=2,fe!==0&&(ne+=fe);H.avcc=new Uint8Array(w),H.avcc.set(new Uint8Array(k,F,w),0),b.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",H)}else this._onError(I.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(I.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(I.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(I.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},U.prototype._parseHEVCDecoderConfigurationRecord=function(k,F,w){if(w<22)b.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var H=this._videoMetadata,Q=this._videoTrack,Y=this._littleEndian,J=new DataView(k,F,w);if(H){if(H.hvcc!==void 0){var ie=new Uint8Array(k,F,w);if(i(ie,H.hvcc))return;b.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(H=this._videoMetadata={}).type="video",H.id=Q.id,H.timescale=this._timescale,H.duration=this._duration;var re=J.getUint8(0),ae=31&J.getUint8(1);if(re===1&&ae!==0)if(this._naluLengthSize=1+(3&J.getUint8(21)),this._naluLengthSize===3||this._naluLengthSize===4){for(var de=J.getUint8(22),ne=0,se=23;ne<de;ne++){var fe=63&J.getUint8(se+0),ge=J.getUint16(se+1,!Y);se+=3;for(var pe=0;pe<ge;pe++){var Te=J.getUint16(se+0,!Y);if(pe===0)if(fe===33){se+=2;var xe=new Uint8Array(k,F+se,Te),Ee=c.parseSPS(xe);H.codecWidth=Ee.codec_size.width,H.codecHeight=Ee.codec_size.height,H.presentWidth=Ee.present_size.width,H.presentHeight=Ee.present_size.height,H.profile=Ee.profile_string,H.level=Ee.level_string,H.bitDepth=Ee.bit_depth,H.chromaFormat=Ee.chroma_format,H.sarRatio=Ee.sar_ratio,H.frameRate=Ee.frame_rate,Ee.frame_rate.fixed!==!1&&Ee.frame_rate.fps_num!==0&&Ee.frame_rate.fps_den!==0||(H.frameRate=this._referenceFrameRate);var Me=H.frameRate.fps_den,Se=H.frameRate.fps_num;H.refSampleDuration=H.timescale*(Me/Se),H.codec=Ee.codec_mimetype;var ye=this._mediaInfo;ye.width=H.codecWidth,ye.height=H.codecHeight,ye.fps=H.frameRate.fps,ye.profile=H.profile,ye.level=H.level,ye.refFrames=Ee.ref_frames,ye.chromaFormat=Ee.chroma_format_string,ye.sarNum=H.sarRatio.width,ye.sarDen=H.sarRatio.height,ye.videoCodec=Ee.codec_mimetype,ye.hasAudio?ye.audioCodec!=null&&(ye.mimeType='video/x-flv; codecs="'+ye.videoCodec+","+ye.audioCodec+'"'):ye.mimeType='video/x-flv; codecs="'+ye.videoCodec+'"',ye.isComplete()&&this._onMediaInfo(ye),se+=Te}else se+=2+Te;else se+=2+Te}}H.hvcc=new Uint8Array(w),H.hvcc.set(new Uint8Array(k,F,w),0),b.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",H)}else this._onError(I.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(I.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord")}},U.prototype._parseAVCVideoData=function(k,F,w,H,Q,Y,J){for(var ie=this._littleEndian,re=new DataView(k,F,w),ae=[],de=0,ne=0,se=this._naluLengthSize,fe=this._timestampBase+H,ge=Y===1;ne<w;){if(ne+4>=w){b.a.w(this.TAG,"Malformed Nalu near timestamp "+fe+", offset = "+ne+", dataSize = "+w);break}var pe=re.getUint32(ne,!ie);if(se===3&&(pe>>>=8),pe>w-se)return void b.a.w(this.TAG,"Malformed Nalus near timestamp "+fe+", NaluSize > DataSize!");var Te=31&re.getUint8(ne+se);Te===5&&(ge=!0);var xe=new Uint8Array(k,F+ne,se+pe),Ee={type:Te,data:xe};ae.push(Ee),de+=xe.byteLength,ne+=se+pe}if(ae.length){var Me=this._videoTrack,Se={units:ae,length:de,isKeyframe:ge,dts:fe,cts:J,pts:fe+J};ge&&(Se.fileposition=Q),Me.samples.push(Se),Me.length+=de}},U.prototype._parseHEVCVideoData=function(k,F,w,H,Q,Y,J){for(var ie=this._littleEndian,re=new DataView(k,F,w),ae=[],de=0,ne=0,se=this._naluLengthSize,fe=this._timestampBase+H,ge=Y===1;ne<w;){if(ne+4>=w){b.a.w(this.TAG,"Malformed Nalu near timestamp "+fe+", offset = "+ne+", dataSize = "+w);break}var pe=re.getUint32(ne,!ie);if(se===3&&(pe>>>=8),pe>w-se)return void b.a.w(this.TAG,"Malformed Nalus near timestamp "+fe+", NaluSize > DataSize!");var Te=31&re.getUint8(ne+se);Te!==19&&Te!==20||(ge=!0);var xe=new Uint8Array(k,F+ne,se+pe),Ee={type:Te,data:xe};ae.push(Ee),de+=xe.byteLength,ne+=se+pe}if(ae.length){var Me=this._videoTrack,Se={units:ae,length:de,isKeyframe:ge,dts:fe,cts:J,pts:fe+J};ge&&(Se.fileposition=Q),Me.samples.push(Se),Me.length+=de}},U}(),l=function(){function U(){}return U.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},U}(),p=function(){this.program_pmt_pid={}};(function(U){U[U.kMPEG1Audio=3]="kMPEG1Audio",U[U.kMPEG2Audio=4]="kMPEG2Audio",U[U.kPESPrivateData=6]="kPESPrivateData",U[U.kADTSAAC=15]="kADTSAAC",U[U.kID3=21]="kID3",U[U.kSCTE35=134]="kSCTE35",U[U.kH264=27]="kH264",U[U.kH265=36]="kH265"})(t||(t={}));var u,f=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,adts_aac:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.scte_35_pids={},this.smpte2038_pids={}},L=function(){},v=function(){},y=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};(function(U){U[U.kUnspecified=0]="kUnspecified",U[U.kSliceNonIDR=1]="kSliceNonIDR",U[U.kSliceDPA=2]="kSliceDPA",U[U.kSliceDPB=3]="kSliceDPB",U[U.kSliceDPC=4]="kSliceDPC",U[U.kSliceIDR=5]="kSliceIDR",U[U.kSliceSEI=6]="kSliceSEI",U[U.kSliceSPS=7]="kSliceSPS",U[U.kSlicePPS=8]="kSlicePPS",U[U.kSliceAUD=9]="kSliceAUD",U[U.kEndOfSequence=10]="kEndOfSequence",U[U.kEndOfStream=11]="kEndOfStream",U[U.kFiller=12]="kFiller",U[U.kSPSExt=13]="kSPSExt",U[U.kReserved0=14]="kReserved0"})(u||(u={}));var n,s,e=function(){},h=function(U){var k=U.data.byteLength;this.type=U.type,this.data=new Uint8Array(4+k),new DataView(this.data.buffer).setUint32(0,k),this.data.set(U.data,4)},M=function(){function U(k){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=k,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&b.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return U.prototype.findNextStartCodeOffset=function(k){for(var F=k,w=this.data_;;){if(F+3>=w.byteLength)return this.eof_flag_=!0,w.byteLength;var H=w[F+0]<<24|w[F+1]<<16|w[F+2]<<8|w[F+3],Q=w[F+0]<<16|w[F+1]<<8|w[F+2];if(H===1||Q===1)return F;F++}},U.prototype.readNextNaluPayload=function(){for(var k=this.data_,F=null;F==null&&!this.eof_flag_;){var w=this.current_startcode_offset_,H=31&k[w+=(k[w]<<24|k[w+1]<<16|k[w+2]<<8|k[w+3])===1?4:3],Q=(128&k[w])>>>7,Y=this.findNextStartCodeOffset(w);if(this.current_startcode_offset_=Y,!(H>=u.kReserved0)&&Q===0){var J=k.subarray(w,Y);(F=new e).type=H,F.data=J}}return F},U}(),T=function(){function U(k,F,w){var H=8+k.byteLength+1+2+F.byteLength,Q=!1;k[3]!==66&&k[3]!==77&&k[3]!==88&&(Q=!0,H+=4);var Y=this.data=new Uint8Array(H);Y[0]=1,Y[1]=k[1],Y[2]=k[2],Y[3]=k[3],Y[4]=255,Y[5]=225;var J=k.byteLength;Y[6]=J>>>8,Y[7]=255&J;var ie=8;Y.set(k,8),Y[ie+=J]=1;var re=F.byteLength;Y[ie+1]=re>>>8,Y[ie+2]=255&re,Y.set(F,ie+3),ie+=3+re,Q&&(Y[ie]=252|w.chroma_format_idc,Y[ie+1]=248|w.bit_depth_luma-8,Y[ie+2]=248|w.bit_depth_chroma-8,Y[ie+3]=0,ie+=4)}return U.prototype.getData=function(){return this.data},U}();(function(U){U[U.kNull=0]="kNull",U[U.kAACMain=1]="kAACMain",U[U.kAAC_LC=2]="kAAC_LC",U[U.kAAC_SSR=3]="kAAC_SSR",U[U.kAAC_LTP=4]="kAAC_LTP",U[U.kAAC_SBR=5]="kAAC_SBR",U[U.kAAC_Scalable=6]="kAAC_Scalable",U[U.kLayer1=32]="kLayer1",U[U.kLayer2=33]="kLayer2",U[U.kLayer3=34]="kLayer3"})(n||(n={})),function(U){U[U.k96000Hz=0]="k96000Hz",U[U.k88200Hz=1]="k88200Hz",U[U.k64000Hz=2]="k64000Hz",U[U.k48000Hz=3]="k48000Hz",U[U.k44100Hz=4]="k44100Hz",U[U.k32000Hz=5]="k32000Hz",U[U.k24000Hz=6]="k24000Hz",U[U.k22050Hz=7]="k22050Hz",U[U.k16000Hz=8]="k16000Hz",U[U.k12000Hz=9]="k12000Hz",U[U.k11025Hz=10]="k11025Hz",U[U.k8000Hz=11]="k8000Hz",U[U.k7350Hz=12]="k7350Hz"}(s||(s={}));var B,N=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],j=function(){},z=function(){function U(k){this.TAG="AACADTSParser",this.data_=k,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&b.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return U.prototype.findNextSyncwordOffset=function(k){for(var F=k,w=this.data_;;){if(F+7>=w.byteLength)return this.eof_flag_=!0,w.byteLength;if((w[F+0]<<8|w[F+1])>>>4===4095)return F;F++}},U.prototype.readNextAACFrame=function(){for(var k=this.data_,F=null;F==null&&!this.eof_flag_;){var w=this.current_syncword_offset_,H=(8&k[w+1])>>>3,Q=(6&k[w+1])>>>1,Y=1&k[w+1],J=(192&k[w+2])>>>6,ie=(60&k[w+2])>>>2,re=(1&k[w+2])<<2|(192&k[w+3])>>>6,ae=(3&k[w+3])<<11|k[w+4]<<3|(224&k[w+5])>>>5;if(k[w+6],w+ae>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var de=Y===1?7:9,ne=ae-de;w+=de;var se=this.findNextSyncwordOffset(w+ne);if(this.current_syncword_offset_=se,(H===0||H===1)&&Q===0){var fe=k.subarray(w,w+ne);(F=new j).audio_object_type=J+1,F.sampling_freq_index=ie,F.sampling_frequency=N[ie],F.channel_config=re,F.data=fe}}return F},U.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},U.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},U}(),K=function(U){var k=null,F=U.audio_object_type,w=U.audio_object_type,H=U.sampling_freq_index,Q=U.channel_config,Y=0,J=navigator.userAgent.toLowerCase();J.indexOf("firefox")!==-1?H>=6?(w=5,k=new Array(4),Y=H-3):(w=2,k=new Array(2),Y=H):J.indexOf("android")!==-1?(w=2,k=new Array(2),Y=H):(w=5,Y=H,k=new Array(4),H>=6?Y=H-3:Q===1&&(w=2,k=new Array(2),Y=H)),k[0]=w<<3,k[0]|=(15&H)>>>1,k[1]=(15&H)<<7,k[1]|=(15&Q)<<3,w===5&&(k[1]|=(15&Y)>>>1,k[2]=(1&Y)<<7,k[2]|=8,k[3]=0),this.config=k,this.sampling_rate=N[H],this.channel_count=Q,this.codec_mimetype="mp4a.40."+w,this.original_codec_mimetype="mp4a.40."+F},V=function(){},$=function(){};(function(U){U[U.kSpliceNull=0]="kSpliceNull",U[U.kSpliceSchedule=4]="kSpliceSchedule",U[U.kSpliceInsert=5]="kSpliceInsert",U[U.kTimeSignal=6]="kTimeSignal",U[U.kBandwidthReservation=7]="kBandwidthReservation",U[U.kPrivateCommand=255]="kPrivateCommand"})(B||(B={}));var X,Z=function(U){var k=U.readBool();return k?(U.readBits(6),{time_specified_flag:k,pts_time:4*U.readBits(31)+U.readBits(2)}):(U.readBits(7),{time_specified_flag:k})},q=function(U){var k=U.readBool();return U.readBits(6),{auto_return:k,duration:4*U.readBits(31)+U.readBits(2)}},te=function(U,k){var F=k.readBits(8);return U?{component_tag:F}:{component_tag:F,splice_time:Z(k)}},ue=function(U){return{component_tag:U.readBits(8),utc_splice_time:U.readBits(32)}},oe=function(U){var k=U.readBits(32),F=U.readBool();U.readBits(7);var w={splice_event_id:k,splice_event_cancel_indicator:F};if(F)return w;if(w.out_of_network_indicator=U.readBool(),w.program_splice_flag=U.readBool(),w.duration_flag=U.readBool(),U.readBits(5),w.program_splice_flag)w.utc_splice_time=U.readBits(32);else{w.component_count=U.readBits(8),w.components=[];for(var H=0;H<w.component_count;H++)w.components.push(ue(U))}return w.duration_flag&&(w.break_duration=q(U)),w.unique_program_id=U.readBits(16),w.avail_num=U.readBits(8),w.avails_expected=U.readBits(8),w},le=function(U,k,F,w){return{descriptor_tag:U,descriptor_length:k,identifier:F,provider_avail_id:w.readBits(32)}},me=function(U,k,F,w){var H=w.readBits(8),Q=w.readBits(3);w.readBits(5);for(var Y="",J=0;J<Q;J++)Y+=String.fromCharCode(w.readBits(8));return{descriptor_tag:U,descriptor_length:k,identifier:F,preroll:H,dtmf_count:Q,DTMF_char:Y}},_e=function(U){var k=U.readBits(8);return U.readBits(7),{component_tag:k,pts_offset:4*U.readBits(31)+U.readBits(2)}},ve=function(U,k,F,w){var H=w.readBits(32),Q=w.readBool();w.readBits(7);var Y={descriptor_tag:U,descriptor_length:k,identifier:F,segmentation_event_id:H,segmentation_event_cancel_indicator:Q};if(Q)return Y;if(Y.program_segmentation_flag=w.readBool(),Y.segmentation_duration_flag=w.readBool(),Y.delivery_not_restricted_flag=w.readBool(),Y.delivery_not_restricted_flag?w.readBits(5):(Y.web_delivery_allowed_flag=w.readBool(),Y.no_regional_blackout_flag=w.readBool(),Y.archive_allowed_flag=w.readBool(),Y.device_restrictions=w.readBits(2)),!Y.program_segmentation_flag){Y.component_count=w.readBits(8),Y.components=[];for(var J=0;J<Y.component_count;J++)Y.components.push(_e(w))}Y.segmentation_duration_flag&&(Y.segmentation_duration=w.readBits(40)),Y.segmentation_upid_type=w.readBits(8),Y.segmentation_upid_length=w.readBits(8);var ie=new Uint8Array(Y.segmentation_upid_length);for(J=0;J<Y.segmentation_upid_length;J++)ie[J]=w.readBits(8);return Y.segmentation_upid=ie.buffer,Y.segmentation_type_id=w.readBits(8),Y.segment_num=w.readBits(8),Y.segments_expected=w.readBits(8),Y.segmentation_type_id!==52&&Y.segmentation_type_id!==54&&Y.segmentation_type_id!==56&&Y.segmentation_type_id!==58||(Y.sub_segment_num=w.readBits(8),Y.sub_segments_expected=w.readBits(8)),Y},ce=function(U,k,F,w){return{descriptor_tag:U,descriptor_length:k,identifier:F,TAI_seconds:w.readBits(48),TAI_ns:w.readBits(32),UTC_offset:w.readBits(16)}},he=function(U){return{component_tag:U.readBits(8),ISO_code:String.fromCharCode(U.readBits(8),U.readBits(8),U.readBits(8)),Bit_Stream_Mode:U.readBits(3),Num_Channels:U.readBits(4),Full_Srvc_Audio:U.readBool()}},Le=function(U,k,F,w){for(var H=w.readBits(4),Q=[],Y=0;Y<H;Y++)Q.push(he(w));return{descriptor_tag:U,descriptor_length:k,identifier:F,audio_count:H,components:Q}},De=function(U){var k=new D(U),F=k.readBits(8),w=k.readBool(),H=k.readBool();k.readBits(2);var Q=k.readBits(12),Y=k.readBits(8),J=k.readBool(),ie=k.readBits(6),re=4*k.readBits(31)+k.readBits(2),ae=k.readBits(8),de=k.readBits(12),ne=k.readBits(12),se=k.readBits(8),fe=null;se===B.kSpliceNull?fe={}:se===B.kSpliceSchedule?fe=function(Pe){for(var Ke=Pe.readBits(8),Ve=[],Re=0;Re<Ke;Re++)Ve.push(oe(Pe));return{splice_count:Ke,events:Ve}}(k):se===B.kSpliceInsert?fe=function(Pe){var Ke=Pe.readBits(32),Ve=Pe.readBool();Pe.readBits(7);var Re={splice_event_id:Ke,splice_event_cancel_indicator:Ve};if(Ve)return Re;if(Re.out_of_network_indicator=Pe.readBool(),Re.program_splice_flag=Pe.readBool(),Re.duration_flag=Pe.readBool(),Re.splice_immediate_flag=Pe.readBool(),Pe.readBits(4),Re.program_splice_flag&&!Re.splice_immediate_flag&&(Re.splice_time=Z(Pe)),!Re.program_splice_flag){Re.component_count=Pe.readBits(8),Re.components=[];for(var Ne=0;Ne<Re.component_count;Ne++)Re.components.push(te(Re.splice_immediate_flag,Pe))}return Re.duration_flag&&(Re.break_duration=q(Pe)),Re.unique_program_id=Pe.readBits(16),Re.avail_num=Pe.readBits(8),Re.avails_expected=Pe.readBits(8),Re}(k):se===B.kTimeSignal?fe=function(Pe){return{splice_time:Z(Pe)}}(k):se===B.kBandwidthReservation?fe={}:se===B.kPrivateCommand?fe=function(Pe,Ke){for(var Ve=String.fromCharCode(Ke.readBits(8),Ke.readBits(8),Ke.readBits(8),Ke.readBits(8)),Re=new Uint8Array(Pe-4),Ne=0;Ne<Pe-4;Ne++)Re[Ne]=Ke.readBits(8);return{identifier:Ve,private_data:Re.buffer}}(ne,k):k.readBits(8*ne);for(var ge=[],pe=k.readBits(16),Te=0;Te<pe;){var xe=k.readBits(8),Ee=k.readBits(8),Me=String.fromCharCode(k.readBits(8),k.readBits(8),k.readBits(8),k.readBits(8));xe===0?ge.push(le(xe,Ee,Me,k)):xe===1?ge.push(me(xe,Ee,Me,k)):xe===2?ge.push(ve(xe,Ee,Me,k)):xe===3?ge.push(ce(xe,Ee,Me,k)):xe===4?ge.push(Le(xe,Ee,Me,k)):k.readBits(8*(Ee-4)),Te+=2+Ee}var Se={table_id:F,section_syntax_indicator:w,private_indicator:H,section_length:Q,protocol_version:Y,encrypted_packet:J,encryption_algorithm:ie,pts_adjustment:re,cw_index:ae,tier:de,splice_command_length:ne,splice_command_type:se,splice_command:fe,descriptor_loop_length:pe,splice_descriptors:ge,E_CRC32:J?k.readBits(32):void 0,CRC32:k.readBits(32)};if(se===B.kSpliceInsert){var ye=fe;if(ye.splice_event_cancel_indicator)return{splice_command_type:se,detail:Se,data:U};if(ye.program_splice_flag&&!ye.splice_immediate_flag){var Ae=ye.duration_flag?ye.break_duration.auto_return:void 0,Ce=ye.duration_flag?ye.break_duration.duration/90:void 0;return ye.splice_time.time_specified_flag?{splice_command_type:se,pts:(re+ye.splice_time.pts_time)%Math.pow(2,33),auto_return:Ae,duraiton:Ce,detail:Se,data:U}:{splice_command_type:se,auto_return:Ae,duraiton:Ce,detail:Se,data:U}}return{splice_command_type:se,auto_return:Ae=ye.duration_flag?ye.break_duration.auto_return:void 0,duraiton:Ce=ye.duration_flag?ye.break_duration.duration/90:void 0,detail:Se,data:U}}if(se===B.kTimeSignal){var Ye=fe;return Ye.splice_time.time_specified_flag?{splice_command_type:se,pts:(re+Ye.splice_time.pts_time)%Math.pow(2,33),detail:Se,data:U}:{splice_command_type:se,detail:Se,data:U}}return{splice_command_type:se,detail:Se,data:U}};(function(U){U[U.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",U[U.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",U[U.kSliceCRA_NUT=21]="kSliceCRA_NUT",U[U.kSliceVPS=32]="kSliceVPS",U[U.kSliceSPS=33]="kSliceSPS",U[U.kSlicePPS=34]="kSlicePPS",U[U.kSliceAUD=35]="kSliceAUD"})(X||(X={}));var Fe,Oe=function(){},ke=function(U){var k=U.data.byteLength;this.type=U.type,this.data=new Uint8Array(4+k),new DataView(this.data.buffer).setUint32(0,k),this.data.set(U.data,4)},Ie=function(){function U(k){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=k,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&b.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return U.prototype.findNextStartCodeOffset=function(k){for(var F=k,w=this.data_;;){if(F+3>=w.byteLength)return this.eof_flag_=!0,w.byteLength;var H=w[F+0]<<24|w[F+1]<<16|w[F+2]<<8|w[F+3],Q=w[F+0]<<16|w[F+1]<<8|w[F+2];if(H===1||Q===1)return F;F++}},U.prototype.readNextNaluPayload=function(){for(var k=this.data_,F=null;F==null&&!this.eof_flag_;){var w=this.current_startcode_offset_,H=k[w+=(k[w]<<24|k[w+1]<<16|k[w+2]<<8|k[w+3])===1?4:3]>>1&63,Q=(128&k[w])>>>7,Y=this.findNextStartCodeOffset(w);if(this.current_startcode_offset_=Y,Q===0){var J=k.subarray(w,Y);(F=new Oe).type=H,F.data=J}}return F},U}(),we=function(){function U(k,F,w,H){var Q=23+(5+k.byteLength)+(5+F.byteLength)+(5+w.byteLength),Y=this.data=new Uint8Array(Q);Y[0]=1,Y[1]=(3&H.general_profile_space)<<6|(H.general_tier_flag?1:0)<<5|31&H.general_profile_idc,Y[2]=H.general_profile_compatibility_flags_1,Y[3]=H.general_profile_compatibility_flags_2,Y[4]=H.general_profile_compatibility_flags_3,Y[5]=H.general_profile_compatibility_flags_4,Y[6]=H.general_constraint_indicator_flags_1,Y[7]=H.general_constraint_indicator_flags_2,Y[8]=H.general_constraint_indicator_flags_3,Y[9]=H.general_constraint_indicator_flags_4,Y[10]=H.general_constraint_indicator_flags_5,Y[11]=H.general_constraint_indicator_flags_6,Y[12]=60,Y[13]=240|(3840&H.min_spatial_segmentation_idc)>>8,Y[14]=255&H.min_spatial_segmentation_idc,Y[15]=252|3&H.parallelismType,Y[16]=252|3&H.chroma_format_idc,Y[17]=248|7&H.bit_depth_luma_minus8,Y[18]=248|7&H.bit_depth_chroma_minus8,Y[19]=0,Y[20]=0,Y[21]=(3&H.constant_frame_rate)<<6|(7&H.num_temporal_layers)<<3|(H.temporal_id_nested?1:0)<<2|3,Y[22]=3,Y[23]=128|X.kSliceVPS,Y[24]=0,Y[25]=1,Y[26]=(65280&k.byteLength)>>8,Y[27]=(255&k.byteLength)>>0,Y.set(k,28),Y[23+(5+k.byteLength)+0]=128|X.kSliceSPS,Y[23+(5+k.byteLength)+1]=0,Y[23+(5+k.byteLength)+2]=1,Y[23+(5+k.byteLength)+3]=(65280&F.byteLength)>>8,Y[23+(5+k.byteLength)+4]=(255&F.byteLength)>>0,Y.set(F,23+(5+k.byteLength)+5),Y[23+(5+k.byteLength+5+F.byteLength)+0]=128|X.kSlicePPS,Y[23+(5+k.byteLength+5+F.byteLength)+1]=0,Y[23+(5+k.byteLength+5+F.byteLength)+2]=1,Y[23+(5+k.byteLength+5+F.byteLength)+3]=(65280&w.byteLength)>>8,Y[23+(5+k.byteLength+5+F.byteLength)+4]=(255&w.byteLength)>>0,Y.set(w,23+(5+k.byteLength+5+F.byteLength)+5)}return U.prototype.getData=function(){return this.data},U}(),Ue=function(){},We=function(){},tt=(Fe=function(U,k){return(Fe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,w){F.__proto__=w}||function(F,w){for(var H in w)w.hasOwnProperty(H)&&(F[H]=w[H])})(U,k)},function(U,k){function F(){this.constructor=U}Fe(U,k),U.prototype=k===null?Object.create(k):(F.prototype=k.prototype,new F)}),je=function(){return(je=Object.assign||function(U){for(var k,F=1,w=arguments.length;F<w;F++)for(var H in k=arguments[F])Object.prototype.hasOwnProperty.call(k,H)&&(U[H]=k[H]);return U}).apply(this,arguments)},Je=function(U){function k(F,w){var H=U.call(this)||this;return H.TAG="TSDemuxer",H.first_parse_=!0,H.media_info_=new g.a,H.timescale_=90,H.duration_=0,H.current_pmt_pid_=-1,H.program_pmt_map_={},H.pes_slice_queues_={},H.section_slice_queues_={},H.video_metadata_={vps:void 0,sps:void 0,pps:void 0,details:void 0},H.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},H.aac_last_sample_pts_=void 0,H.aac_last_incomplete_data_=null,H.has_video_=!1,H.has_audio_=!1,H.video_init_segment_dispatched_=!1,H.audio_init_segment_dispatched_=!1,H.video_metadata_changed_=!1,H.audio_metadata_changed_=!1,H.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},H.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},H.ts_packet_size_=F.ts_packet_size,H.sync_offset_=F.sync_offset,H.config_=w,H}return tt(k,U),k.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,U.prototype.destroy.call(this)},k.probe=function(F){var w=new Uint8Array(F),H=-1,Q=188;if(w.byteLength<=3*Q)return{needMoreData:!0};for(;H===-1;){for(var Y=Math.min(1e3,w.byteLength-3*Q),J=0;J<Y;){if(w[J]===71&&w[J+Q]===71&&w[J+2*Q]===71){H=J;break}J++}if(H===-1)if(Q===188)Q=192;else{if(Q!==192)break;Q=204}}return H===-1?{match:!1}:(Q===192&&H>=4?(b.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),H-=4):Q===204&&b.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:Q,sync_offset:H})},k.prototype.bindDataSource=function(F){return F.onDataArrival=this.parseChunks.bind(this),this},k.prototype.resetMediaInfo=function(){this.media_info_=new g.a},k.prototype.parseChunks=function(F,w){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new R.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var H=0;for(this.first_parse_&&(this.first_parse_=!1,H=this.sync_offset_);H+this.ts_packet_size_<=F.byteLength;){var Q=w+H;this.ts_packet_size_===192&&(H+=4);var Y=new Uint8Array(F,H,188),J=Y[0];if(J!==71){b.a.e(this.TAG,"sync_byte = "+J+", not 0x47");break}var ie=(64&Y[1])>>>6,re=(Y[1],(31&Y[1])<<8|Y[2]),ae=(48&Y[3])>>>4,de=15&Y[3],ne={},se=4;if(ae==2||ae==3){var fe=Y[4];if(5+fe===188){H+=188,this.ts_packet_size_===204&&(H+=16);continue}fe>0&&(ne=this.parseAdaptationField(F,H+4,1+fe)),se=5+fe}if(ae==1||ae==3){if(re===0||re===this.current_pmt_pid_||this.pmt_!=null&&this.pmt_.pid_stream_type[re]===t.kSCTE35){var ge=188-se;this.handleSectionSlice(F,H+se,ge,{pid:re,file_position:Q,payload_unit_start_indicator:ie,continuity_conunter:de,random_access_indicator:ne.random_access_indicator})}else if(this.pmt_!=null&&this.pmt_.pid_stream_type[re]!=null){ge=188-se;var pe=this.pmt_.pid_stream_type[re];re!==this.pmt_.common_pids.h264&&re!==this.pmt_.common_pids.h265&&re!==this.pmt_.common_pids.adts_aac&&re!==this.pmt_.common_pids.mp3&&this.pmt_.pes_private_data_pids[re]!==!0&&this.pmt_.timed_id3_pids[re]!==!0||this.handlePESSlice(F,H+se,ge,{pid:re,stream_type:pe,file_position:Q,payload_unit_start_indicator:ie,continuity_conunter:de,random_access_indicator:ne.random_access_indicator})}}H+=188,this.ts_packet_size_===204&&(H+=16)}return this.dispatchAudioVideoMediaSegment(),H},k.prototype.parseAdaptationField=function(F,w,H){var Q=new Uint8Array(F,w,H),Y=Q[0];return Y>0?Y>183?(b.a.w(this.TAG,"Illegal adaptation_field_length: "+Y),{}):{discontinuity_indicator:(128&Q[1])>>>7,random_access_indicator:(64&Q[1])>>>6,elementary_stream_priority_indicator:(32&Q[1])>>>5}:{}},k.prototype.handleSectionSlice=function(F,w,H,Q){var Y=new Uint8Array(F,w,H),J=this.section_slice_queues_[Q.pid];if(Q.payload_unit_start_indicator){var ie=Y[0];if(J!=null&&J.total_length!==0){var re=new Uint8Array(F,w+1,Math.min(H,ie));J.slices.push(re),J.total_length+=re.byteLength,J.total_length===J.expected_length?this.emitSectionSlices(J,Q):this.clearSlices(J,Q)}for(var ae=1+ie;ae<Y.byteLength&&Y[ae+0]!==255;){var de=(15&Y[ae+1])<<8|Y[ae+2];this.section_slice_queues_[Q.pid]=new y,(J=this.section_slice_queues_[Q.pid]).expected_length=de+3,J.file_position=Q.file_position,J.random_access_indicator=Q.random_access_indicator,re=new Uint8Array(F,w+ae,Math.min(H-ae,J.expected_length-J.total_length)),J.slices.push(re),J.total_length+=re.byteLength,J.total_length===J.expected_length?this.emitSectionSlices(J,Q):J.total_length>=J.expected_length&&this.clearSlices(J,Q),ae+=re.byteLength}}else J!=null&&J.total_length!==0&&(re=new Uint8Array(F,w,Math.min(H,J.expected_length-J.total_length)),J.slices.push(re),J.total_length+=re.byteLength,J.total_length===J.expected_length?this.emitSectionSlices(J,Q):J.total_length>=J.expected_length&&this.clearSlices(J,Q))},k.prototype.handlePESSlice=function(F,w,H,Q){var Y=new Uint8Array(F,w,H),J=Y[0]<<16|Y[1]<<8|Y[2],ie=(Y[3],Y[4]<<8|Y[5]);if(Q.payload_unit_start_indicator){if(J!==1)return void b.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value "+J);var re=this.pes_slice_queues_[Q.pid];re&&(re.expected_length===0||re.expected_length===re.total_length?this.emitPESSlices(re,Q):this.clearSlices(re,Q)),this.pes_slice_queues_[Q.pid]=new y,this.pes_slice_queues_[Q.pid].file_position=Q.file_position,this.pes_slice_queues_[Q.pid].random_access_indicator=Q.random_access_indicator}if(this.pes_slice_queues_[Q.pid]!=null){var ae=this.pes_slice_queues_[Q.pid];ae.slices.push(Y),Q.payload_unit_start_indicator&&(ae.expected_length=ie===0?0:ie+6),ae.total_length+=Y.byteLength,ae.expected_length>0&&ae.expected_length===ae.total_length?this.emitPESSlices(ae,Q):ae.expected_length>0&&ae.expected_length<ae.total_length&&this.clearSlices(ae,Q)}},k.prototype.emitSectionSlices=function(F,w){for(var H=new Uint8Array(F.total_length),Q=0,Y=0;Q<F.slices.length;Q++){var J=F.slices[Q];H.set(J,Y),Y+=J.byteLength}F.slices=[],F.expected_length=-1,F.total_length=0;var ie=new v;ie.pid=w.pid,ie.data=H,ie.file_position=F.file_position,ie.random_access_indicator=F.random_access_indicator,this.parseSection(ie)},k.prototype.emitPESSlices=function(F,w){for(var H=new Uint8Array(F.total_length),Q=0,Y=0;Q<F.slices.length;Q++){var J=F.slices[Q];H.set(J,Y),Y+=J.byteLength}F.slices=[],F.expected_length=-1,F.total_length=0;var ie=new L;ie.pid=w.pid,ie.data=H,ie.stream_type=w.stream_type,ie.file_position=F.file_position,ie.random_access_indicator=F.random_access_indicator,this.parsePES(ie)},k.prototype.clearSlices=function(F,w){F.slices=[],F.expected_length=-1,F.total_length=0},k.prototype.parseSection=function(F){var w=F.data,H=F.pid;H===0?this.parsePAT(w):H===this.current_pmt_pid_?this.parsePMT(w):this.pmt_!=null&&this.pmt_.scte_35_pids[H]&&this.parseSCTE35(w)},k.prototype.parsePES=function(F){var w=F.data,H=w[0]<<16|w[1]<<8|w[2],Q=w[3],Y=w[4]<<8|w[5];if(H===1)if(Q!==188&&Q!==190&&Q!==191&&Q!==240&&Q!==241&&Q!==255&&Q!==242&&Q!==248){w[6];var J=(192&w[7])>>>6,ie=w[8],re=void 0,ae=void 0;J!==2&&J!==3||(re=536870912*(14&w[9])+4194304*(255&w[10])+16384*(254&w[11])+128*(255&w[12])+(254&w[13])/2,ae=J===3?536870912*(14&w[14])+4194304*(255&w[15])+16384*(254&w[16])+128*(255&w[17])+(254&w[18])/2:re);var de=9+ie,ne=void 0;if(Y!==0){if(Y<3+ie)return void b.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");ne=Y-3-ie}else ne=w.byteLength-de;var se=w.subarray(de,de+ne);switch(F.stream_type){case t.kMPEG1Audio:case t.kMPEG2Audio:this.parseMP3Payload(se,re);break;case t.kPESPrivateData:this.pmt_.smpte2038_pids[F.pid]?this.parseSMPTE2038MetadataPayload(se,re,ae,F.pid,Q):this.parsePESPrivateDataPayload(se,re,ae,F.pid,Q);break;case t.kADTSAAC:this.parseAACPayload(se,re);break;case t.kID3:this.parseTimedID3MetadataPayload(se,re,ae,F.pid,Q);break;case t.kH264:this.parseH264Payload(se,re,ae,F.file_position,F.random_access_indicator);break;case t.kH265:this.parseH265Payload(se,re,ae,F.file_position,F.random_access_indicator)}}else(Q===188||Q===191||Q===240||Q===241||Q===255||Q===242||Q===248)&&F.stream_type===t.kPESPrivateData&&(de=6,ne=void 0,ne=Y!==0?Y:w.byteLength-de,se=w.subarray(de,de+ne),this.parsePESPrivateDataPayload(se,void 0,void 0,F.pid,Q));else b.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value "+H)},k.prototype.parsePAT=function(F){var w=F[0];if(w===0){var H=(15&F[1])<<8|F[2],Q=(F[3],F[4],(62&F[5])>>>1),Y=1&F[5],J=F[6],ie=(F[7],null);if(Y===1&&J===0)(ie=new p).version_number=Q;else if((ie=this.pat_)==null)return;for(var re=H-5-4,ae=-1,de=-1,ne=8;ne<8+re;ne+=4){var se=F[ne]<<8|F[ne+1],fe=(31&F[ne+2])<<8|F[ne+3];se===0?ie.network_pid=fe:(ie.program_pmt_pid[se]=fe,ae===-1&&(ae=se),de===-1&&(de=fe))}Y===1&&J===0&&(this.pat_==null&&b.a.v(this.TAG,"Parsed first PAT: "+JSON.stringify(ie)),this.pat_=ie,this.current_program_=ae,this.current_pmt_pid_=de)}else b.a.e(this.TAG,"parsePAT: table_id "+w+" is not corresponded to PAT!")},k.prototype.parsePMT=function(F){var w=F[0];if(w===2){var H=(15&F[1])<<8|F[2],Q=F[3]<<8|F[4],Y=(62&F[5])>>>1,J=1&F[5],ie=F[6],re=(F[7],null);if(J===1&&ie===0)(re=new f).program_number=Q,re.version_number=Y,this.program_pmt_map_[Q]=re;else if((re=this.program_pmt_map_[Q])==null)return;F[8],F[9];for(var ae=(15&F[10])<<8|F[11],de=12+ae,ne=H-9-ae-4,se=de;se<de+ne;){var fe=F[se],ge=(31&F[se+1])<<8|F[se+2],pe=(15&F[se+3])<<8|F[se+4];if(re.pid_stream_type[ge]=fe,fe!==t.kH264||re.common_pids.h264||re.common_pids.h265)if(fe!==t.kH265||re.common_pids.h264||re.common_pids.h265)if(fe!==t.kADTSAAC||re.common_pids.adts_aac)if(fe!==t.kMPEG1Audio&&fe!==t.kMPEG2Audio||re.common_pids.mp3)if(fe===t.kPESPrivateData){if(re.pes_private_data_pids[ge]=!0,pe>0){for(var Te=se+5;Te<se+5+pe;){var xe=F[Te+0],Ee=F[Te+1];xe===5&&String.fromCharCode.apply(String,Array.from(F.subarray(Te+2,Te+2+Ee)))==="VANC"&&(re.smpte2038_pids[ge]=!0),Te+=2+Ee}var Me=F.subarray(se+5,se+5+pe);this.dispatchPESPrivateDataDescriptor(ge,fe,Me)}}else fe===t.kID3?re.timed_id3_pids[ge]=!0:fe===t.kSCTE35&&(re.scte_35_pids[ge]=!0);else re.common_pids.mp3=ge;else re.common_pids.adts_aac=ge;else re.common_pids.h265=ge;else re.common_pids.h264=ge;se+=5+pe}Q===this.current_program_&&(this.pmt_==null&&b.a.v(this.TAG,"Parsed first PMT: "+JSON.stringify(re)),this.pmt_=re,(re.common_pids.h264||re.common_pids.h265)&&(this.has_video_=!0),(re.common_pids.adts_aac||re.common_pids.mp3)&&(this.has_audio_=!0))}else b.a.e(this.TAG,"parsePMT: table_id "+w+" is not corresponded to PMT!")},k.prototype.parseSCTE35=function(F){var w=De(F);if(w.pts!=null){var H=Math.floor(w.pts/this.timescale_);w.pts=H}else w.nearest_pts=this.aac_last_sample_pts_;this.onSCTE35Metadata&&this.onSCTE35Metadata(w)},k.prototype.parseH264Payload=function(F,w,H,Q,Y){for(var J=new M(F),ie=null,re=[],ae=0,de=!1;(ie=J.readNextNaluPayload())!=null;){var ne=new h(ie);if(ne.type===u.kSliceSPS){var se=P.parseSPS(ie.data);this.video_init_segment_dispatched_?this.detectVideoMetadataChange(ne,se)===!0&&(b.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:ne,pps:void 0,details:se}):(this.video_metadata_.sps=ne,this.video_metadata_.details=se)}else ne.type===u.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=ne,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(ne.type===u.kSliceIDR||ne.type===u.kSliceNonIDR&&Y===1)&&(de=!0);this.video_init_segment_dispatched_&&(re.push(ne),ae+=ne.data.byteLength)}var fe=Math.floor(w/this.timescale_),ge=Math.floor(H/this.timescale_);if(re.length){var pe=this.video_track_,Te={units:re,length:ae,isKeyframe:de,dts:ge,pts:fe,cts:fe-ge,file_position:Q};pe.samples.push(Te),pe.length+=ae}},k.prototype.parseH265Payload=function(F,w,H,Q,Y){for(var J=new Ie(F),ie=null,re=[],ae=0,de=!1;(ie=J.readNextNaluPayload())!=null;){var ne=new ke(ie);if(ne.type===X.kSliceVPS){if(!this.video_init_segment_dispatched_){var se=c.parseVPS(ie.data);this.video_metadata_.vps=ne,this.video_metadata_.details=je(je({},this.video_metadata_.details),se)}}else ne.type===X.kSliceSPS?(se=c.parseSPS(ie.data),this.video_init_segment_dispatched_?this.detectVideoMetadataChange(ne,se)===!0&&(b.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:ne,pps:void 0,details:se}):(this.video_metadata_.sps=ne,this.video_metadata_.details=je(je({},this.video_metadata_.details),se))):ne.type===X.kSlicePPS?(!this.video_init_segment_dispatched_||this.video_metadata_changed_)&&(se=c.parsePPS(ie.data),this.video_metadata_.pps=ne,this.video_metadata_.details=je(je({},this.video_metadata_.details),se),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):ne.type!==X.kSliceIDR_W_RADL&&ne.type!==X.kSliceIDR_N_LP&&ne.type!==X.kSliceCRA_NUT||(de=!0);this.video_init_segment_dispatched_&&(re.push(ne),ae+=ne.data.byteLength)}var fe=Math.floor(w/this.timescale_),ge=Math.floor(H/this.timescale_);if(re.length){var pe=this.video_track_,Te={units:re,length:ae,isKeyframe:de,dts:ge,pts:fe,cts:fe-ge,file_position:Q};pe.samples.push(Te),pe.length+=ae}},k.prototype.detectVideoMetadataChange=function(F,w){if(w.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return b.a.v(this.TAG,"Video: Codec mimeType changed from "+this.video_metadata_.details.codec_mimetype+" to "+w.codec_mimetype),!0;if(w.codec_size.width!==this.video_metadata_.details.codec_size.width||w.codec_size.height!==this.video_metadata_.details.codec_size.height){var H=this.video_metadata_.details.codec_size,Q=w.codec_size;return b.a.v(this.TAG,"Video: Coded Resolution changed from "+H.width+"x"+H.height+" to "+Q.width+"x"+Q.height),!0}return w.present_size.width!==this.video_metadata_.details.present_size.width&&(b.a.v(this.TAG,"Video: Present resolution width changed from "+this.video_metadata_.details.present_size.width+" to "+w.present_size.width),!0)},k.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},k.prototype.dispatchVideoInitSegment=function(){var F=this.video_metadata_.details,w={type:"video"};w.id=this.video_track_.id,w.timescale=1e3,w.duration=this.duration_,w.codecWidth=F.codec_size.width,w.codecHeight=F.codec_size.height,w.presentWidth=F.present_size.width,w.presentHeight=F.present_size.height,w.profile=F.profile_string,w.level=F.level_string,w.bitDepth=F.bit_depth,w.chromaFormat=F.chroma_format,w.sarRatio=F.sar_ratio,w.frameRate=F.frame_rate;var H=w.frameRate.fps_den,Q=w.frameRate.fps_num;if(w.refSampleDuration=H/Q*1e3,w.codec=F.codec_mimetype,this.video_metadata_.vps){var Y=this.video_metadata_.vps.data.subarray(4),J=this.video_metadata_.sps.data.subarray(4),ie=this.video_metadata_.pps.data.subarray(4),re=new we(Y,J,ie,F);w.hvcc=re.getData(),this.video_init_segment_dispatched_==0&&b.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: "+w.codec)}else{J=this.video_metadata_.sps.data.subarray(4),ie=this.video_metadata_.pps.data.subarray(4);var ae=new T(J,ie,F);w.avcc=ae.getData(),this.video_init_segment_dispatched_==0&&b.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: "+w.codec)}this.onTrackMetadata("video",w),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var de=this.media_info_;de.hasVideo=!0,de.width=w.codecWidth,de.height=w.codecHeight,de.fps=w.frameRate.fps,de.profile=w.profile,de.level=w.level,de.refFrames=F.ref_frames,de.chromaFormat=F.chroma_format_string,de.sarNum=w.sarRatio.width,de.sarDen=w.sarRatio.height,de.videoCodec=w.codec,de.hasAudio&&de.audioCodec?de.mimeType='video/mp2t; codecs="'+de.videoCodec+","+de.audioCodec+'"':de.mimeType='video/mp2t; codecs="'+de.videoCodec+'"',de.isComplete()&&this.onMediaInfo(de)},k.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},k.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},k.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},k.prototype.parseAACPayload=function(F,w){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var H=new Uint8Array(F.byteLength+this.aac_last_incomplete_data_.byteLength);H.set(this.aac_last_incomplete_data_,0),H.set(F,this.aac_last_incomplete_data_.byteLength),F=H}var Q,Y;if(w!=null&&(Y=w/this.timescale_),this.audio_metadata_.codec==="aac"){if(w==null&&this.aac_last_sample_pts_!=null)Q=1024/this.audio_metadata_.sampling_frequency*1e3,Y=this.aac_last_sample_pts_+Q;else if(w==null)return void b.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.aac_last_sample_pts_){Q=1024/this.audio_metadata_.sampling_frequency*1e3;var J=this.aac_last_sample_pts_+Q;Math.abs(J-Y)>1&&(b.a.w(this.TAG,"AAC: Detected pts overlapped, expected: "+J+"ms, PES pts: "+Y+"ms"),Y=J)}}for(var ie,re=new z(F),ae=null,de=Y;(ae=re.readNextAACFrame())!=null;){Q=1024/ae.sampling_frequency*1e3;var ne={codec:"aac",data:ae};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:ae.audio_object_type,sampling_freq_index:ae.sampling_freq_index,sampling_frequency:ae.sampling_frequency,channel_config:ae.channel_config},this.dispatchAudioInitSegment(ne)):this.detectAudioMetadataChange(ne)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(ne)),ie=de;var se=Math.floor(de),fe={unit:ae.data,length:ae.data.byteLength,pts:se,dts:se};this.audio_track_.samples.push(fe),this.audio_track_.length+=ae.data.byteLength,de+=Q}re.hasIncompleteData()&&(this.aac_last_incomplete_data_=re.getIncompleteData()),ie&&(this.aac_last_sample_pts_=ie)}},k.prototype.parseMP3Payload=function(F,w){if(!this.has_video_||this.video_init_segment_dispatched_){var H=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],Q=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],Y=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],J=F[1]>>>3&3,ie=(6&F[1])>>1,re=(240&F[2])>>>4,ae=(12&F[2])>>>2,de=(F[3]>>>6&3)!==3?2:1,ne=0,se=34;switch(J){case 0:ne=[11025,12e3,8e3,0][ae];break;case 2:ne=[22050,24e3,16e3,0][ae];break;case 3:ne=[44100,48e3,32e3,0][ae]}switch(ie){case 1:se=34,re<Y.length&&Y[re];break;case 2:se=33,re<Q.length&&Q[re];break;case 3:se=32,re<H.length&&H[re]}var fe=new We;fe.object_type=se,fe.sample_rate=ne,fe.channel_count=de,fe.data=F;var ge={codec:"mp3",data:fe};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"mp3",object_type:se,sample_rate:ne,channel_count:de},this.dispatchAudioInitSegment(ge)):this.detectAudioMetadataChange(ge)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(ge));var pe={unit:F,length:F.byteLength,pts:w/this.timescale_,dts:w/this.timescale_};this.audio_track_.samples.push(pe),this.audio_track_.length+=F.byteLength}},k.prototype.detectAudioMetadataChange=function(F){if(F.codec!==this.audio_metadata_.codec)return b.a.v(this.TAG,"Audio: Audio Codecs changed from "+this.audio_metadata_.codec+" to "+F.codec),!0;if(F.codec==="aac"&&this.audio_metadata_.codec==="aac"){var w=F.data;if(w.audio_object_type!==this.audio_metadata_.audio_object_type)return b.a.v(this.TAG,"AAC: AudioObjectType changed from "+this.audio_metadata_.audio_object_type+" to "+w.audio_object_type),!0;if(w.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return b.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+this.audio_metadata_.sampling_freq_index+" to "+w.sampling_freq_index),!0;if(w.channel_config!==this.audio_metadata_.channel_config)return b.a.v(this.TAG,"AAC: Channel configuration changed from "+this.audio_metadata_.channel_config+" to "+w.channel_config),!0}else if(F.codec==="mp3"&&this.audio_metadata_.codec==="mp3"){var H=F.data;if(H.object_type!==this.audio_metadata_.object_type)return b.a.v(this.TAG,"MP3: AudioObjectType changed from "+this.audio_metadata_.object_type+" to "+H.object_type),!0;if(H.sample_rate!==this.audio_metadata_.sample_rate)return b.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+this.audio_metadata_.sample_rate+" to "+H.sample_rate),!0;if(H.channel_count!==this.audio_metadata_.channel_count)return b.a.v(this.TAG,"MP3: Channel count changed from "+this.audio_metadata_.channel_count+" to "+H.channel_count),!0}return!1},k.prototype.dispatchAudioInitSegment=function(F){var w={type:"audio"};if(w.id=this.audio_track_.id,w.timescale=1e3,w.duration=this.duration_,this.audio_metadata_.codec==="aac"){var H=F.data,Q=new K(H);w.audioSampleRate=Q.sampling_rate,w.channelCount=Q.channel_count,w.codec=Q.codec_mimetype,w.originalCodec=Q.original_codec_mimetype,w.config=Q.config}else this.audio_metadata_.codec==="mp3"&&(w.audioSampleRate=this.audio_metadata_.sample_rate,w.channelCount=this.audio_metadata_.channel_count,w.codec="mp3",w.originalCodec="mp3",w.config=void 0);w.refSampleDuration=1024/w.audioSampleRate*w.timescale,this.audio_init_segment_dispatched_==0&&b.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: "+w.codec),this.onTrackMetadata("audio",w),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var Y=this.media_info_;Y.hasAudio=!0,Y.audioCodec=w.originalCodec,Y.audioSampleRate=w.audioSampleRate,Y.audioChannelCount=w.channelCount,Y.hasVideo&&Y.videoCodec?Y.mimeType='video/mp2t; codecs="'+Y.videoCodec+","+Y.audioCodec+'"':Y.mimeType='video/mp2t; codecs="'+Y.audioCodec+'"',Y.isComplete()&&this.onMediaInfo(Y)},k.prototype.dispatchPESPrivateDataDescriptor=function(F,w,H){var Q=new $;Q.pid=F,Q.stream_type=w,Q.descriptor=H,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(Q)},k.prototype.parsePESPrivateDataPayload=function(F,w,H,Q,Y){var J=new V;if(J.pid=Q,J.stream_id=Y,J.len=F.byteLength,J.data=F,w!=null){var ie=Math.floor(w/this.timescale_);J.pts=ie}else J.nearest_pts=this.aac_last_sample_pts_;if(H!=null){var re=Math.floor(H/this.timescale_);J.dts=re}this.onPESPrivateData&&this.onPESPrivateData(J)},k.prototype.parseTimedID3MetadataPayload=function(F,w,H,Q,Y){var J=new V;if(J.pid=Q,J.stream_id=Y,J.len=F.byteLength,J.data=F,w!=null){var ie=Math.floor(w/this.timescale_);J.pts=ie}if(H!=null){var re=Math.floor(H/this.timescale_);J.dts=re}this.onTimedID3Metadata&&this.onTimedID3Metadata(J)},k.prototype.parseSMPTE2038MetadataPayload=function(F,w,H,Q,Y){var J=new Ue;if(J.pid=Q,J.stream_id=Y,J.len=F.byteLength,J.data=F,w!=null){var ie=Math.floor(w/this.timescale_);J.pts=ie}if(J.nearest_pts=this.aac_last_sample_pts_,H!=null){var re=Math.floor(H/this.timescale_);J.dts=re}J.ancillaries=function(ae){for(var de=new D(ae),ne=0,se=[];ne+=6,de.readBits(6)===0;){var fe=de.readBool();ne+=1;var ge=de.readBits(11);ne+=11;var pe=de.readBits(12);ne+=12;var Te=255&de.readBits(10);ne+=10;var xe=255&de.readBits(10);ne+=10;var Ee=255&de.readBits(10);ne+=10;for(var Me=new Uint8Array(Ee),Se=0;Se<Ee;Se++){var ye=255&de.readBits(10);ne+=10,Me[Se]=ye}de.readBits(10),ne+=10;var Ae="User Defined";Te===65?xe===7&&(Ae="SCTE-104"):Te===95?xe===220?Ae="ARIB STD-B37 (1SEG)":xe===221?Ae="ARIB STD-B37 (ANALOG)":xe===222?Ae="ARIB STD-B37 (SD)":xe===223&&(Ae="ARIB STD-B37 (HD)"):Te===97&&(xe===1?Ae="EIA-708":xe===2&&(Ae="EIA-608")),se.push({yc_indicator:fe,line_number:ge,horizontal_offset:pe,did:Te,sdid:xe,user_data:Me,description:Ae,information:{}}),de.readBits(8-(ne-Math.floor(ne/8))%8),ne+=(8-(ne-Math.floor(ne/8)))%8}return de.destroy(),de=null,se}(F),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(J)},k}(l),ot=function(){function U(){}return U.init=function(){for(var k in U.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]},U.types)U.types.hasOwnProperty(k)&&(U.types[k]=[k.charCodeAt(0),k.charCodeAt(1),k.charCodeAt(2),k.charCodeAt(3)]);var F=U.constants={};F.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),F.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),F.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),F.STSC=F.STCO=F.STTS,F.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),F.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),F.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),F.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),F.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),F.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},U.box=function(k){for(var F=8,w=null,H=Array.prototype.slice.call(arguments,1),Q=H.length,Y=0;Y<Q;Y++)F+=H[Y].byteLength;(w=new Uint8Array(F))[0]=F>>>24&255,w[1]=F>>>16&255,w[2]=F>>>8&255,w[3]=255&F,w.set(k,4);var J=8;for(Y=0;Y<Q;Y++)w.set(H[Y],J),J+=H[Y].byteLength;return w},U.generateInitSegment=function(k){var F=U.box(U.types.ftyp,U.constants.FTYP),w=U.moov(k),H=new Uint8Array(F.byteLength+w.byteLength);return H.set(F,0),H.set(w,F.byteLength),H},U.moov=function(k){var F=U.mvhd(k.timescale,k.duration),w=U.trak(k),H=U.mvex(k);return U.box(U.types.moov,F,w,H)},U.mvhd=function(k,F){return U.box(U.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,k>>>24&255,k>>>16&255,k>>>8&255,255&k,F>>>24&255,F>>>16&255,F>>>8&255,255&F,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},U.trak=function(k){return U.box(U.types.trak,U.tkhd(k),U.mdia(k))},U.tkhd=function(k){var F=k.id,w=k.duration,H=k.presentWidth,Q=k.presentHeight;return U.box(U.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,F>>>24&255,F>>>16&255,F>>>8&255,255&F,0,0,0,0,w>>>24&255,w>>>16&255,w>>>8&255,255&w,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,H>>>8&255,255&H,0,0,Q>>>8&255,255&Q,0,0]))},U.mdia=function(k){return U.box(U.types.mdia,U.mdhd(k),U.hdlr(k),U.minf(k))},U.mdhd=function(k){var F=k.timescale,w=k.duration;return U.box(U.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,F>>>24&255,F>>>16&255,F>>>8&255,255&F,w>>>24&255,w>>>16&255,w>>>8&255,255&w,85,196,0,0]))},U.hdlr=function(k){var F=null;return F=k.type==="audio"?U.constants.HDLR_AUDIO:U.constants.HDLR_VIDEO,U.box(U.types.hdlr,F)},U.minf=function(k){var F=null;return F=k.type==="audio"?U.box(U.types.smhd,U.constants.SMHD):U.box(U.types.vmhd,U.constants.VMHD),U.box(U.types.minf,F,U.dinf(),U.stbl(k))},U.dinf=function(){return U.box(U.types.dinf,U.box(U.types.dref,U.constants.DREF))},U.stbl=function(k){return U.box(U.types.stbl,U.stsd(k),U.box(U.types.stts,U.constants.STTS),U.box(U.types.stsc,U.constants.STSC),U.box(U.types.stsz,U.constants.STSZ),U.box(U.types.stco,U.constants.STCO))},U.stsd=function(k){return k.type==="audio"?k.codec==="mp3"?U.box(U.types.stsd,U.constants.STSD_PREFIX,U.mp3(k)):U.box(U.types.stsd,U.constants.STSD_PREFIX,U.mp4a(k)):k.type==="video"&&k.codec.startsWith("hvc1")?U.box(U.types.stsd,U.constants.STSD_PREFIX,U.hvc1(k)):U.box(U.types.stsd,U.constants.STSD_PREFIX,U.avc1(k))},U.mp3=function(k){var F=k.channelCount,w=k.audioSampleRate,H=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,F,0,16,0,0,0,0,w>>>8&255,255&w,0,0]);return U.box(U.types[".mp3"],H)},U.mp4a=function(k){var F=k.channelCount,w=k.audioSampleRate,H=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,F,0,16,0,0,0,0,w>>>8&255,255&w,0,0]);return U.box(U.types.mp4a,H,U.esds(k))},U.esds=function(k){var F=k.config||[],w=F.length,H=new Uint8Array([0,0,0,0,3,23+w,0,1,0,4,15+w,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([w]).concat(F).concat([6,1,2]));return U.box(U.types.esds,H)},U.avc1=function(k){var F=k.avcc,w=k.codecWidth,H=k.codecHeight,Q=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,w>>>8&255,255&w,H>>>8&255,255&H,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return U.box(U.types.avc1,Q,U.box(U.types.avcC,F))},U.hvc1=function(k){var F=k.hvcc,w=k.codecWidth,H=k.codecHeight,Q=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,w>>>8&255,255&w,H>>>8&255,255&H,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return U.box(U.types.hvc1,Q,U.box(U.types.hvcC,F))},U.mvex=function(k){return U.box(U.types.mvex,U.trex(k))},U.trex=function(k){var F=k.id,w=new Uint8Array([0,0,0,0,F>>>24&255,F>>>16&255,F>>>8&255,255&F,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return U.box(U.types.trex,w)},U.moof=function(k,F){return U.box(U.types.moof,U.mfhd(k.sequenceNumber),U.traf(k,F))},U.mfhd=function(k){var F=new Uint8Array([0,0,0,0,k>>>24&255,k>>>16&255,k>>>8&255,255&k]);return U.box(U.types.mfhd,F)},U.traf=function(k,F){var w=k.id,H=U.box(U.types.tfhd,new Uint8Array([0,0,0,0,w>>>24&255,w>>>16&255,w>>>8&255,255&w])),Q=U.box(U.types.tfdt,new Uint8Array([0,0,0,0,F>>>24&255,F>>>16&255,F>>>8&255,255&F])),Y=U.sdtp(k),J=U.trun(k,Y.byteLength+16+16+8+16+8+8);return U.box(U.types.traf,H,Q,J,Y)},U.sdtp=function(k){for(var F=k.samples||[],w=F.length,H=new Uint8Array(4+w),Q=0;Q<w;Q++){var Y=F[Q].flags;H[Q+4]=Y.isLeading<<6|Y.dependsOn<<4|Y.isDependedOn<<2|Y.hasRedundancy}return U.box(U.types.sdtp,H)},U.trun=function(k,F){var w=k.samples||[],H=w.length,Q=12+16*H,Y=new Uint8Array(Q);F+=8+Q,Y.set([0,0,15,1,H>>>24&255,H>>>16&255,H>>>8&255,255&H,F>>>24&255,F>>>16&255,F>>>8&255,255&F],0);for(var J=0;J<H;J++){var ie=w[J].duration,re=w[J].size,ae=w[J].flags,de=w[J].cts;Y.set([ie>>>24&255,ie>>>16&255,ie>>>8&255,255&ie,re>>>24&255,re>>>16&255,re>>>8&255,255&re,ae.isLeading<<2|ae.dependsOn,ae.isDependedOn<<6|ae.hasRedundancy<<4|ae.isNonSync,0,0,de>>>24&255,de>>>16&255,de>>>8&255,255&de],12+16*J)}return U.box(U.types.trun,Y)},U.mdat=function(k){return U.box(U.types.mdat,k)},U}();ot.init();var He=ot,ut=function(){function U(){}return U.getSilentFrame=function(k,F){if(k==="mp4a.40.2"){if(F===1)return new Uint8Array([0,200,0,128,35,128]);if(F===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(F===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(F===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(F===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(F===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(F===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(F===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(F===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},U}(),Qe=W(7),be=function(){function U(k){this.TAG="MP4Remuxer",this._config=k,this._isLive=k.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new Qe.c("audio"),this._videoSegmentInfoList=new Qe.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!a.a.chrome||!(a.a.version.major<50||a.a.version.major===50&&a.a.version.build<2661)),this._fillSilentAfterSeek=a.a.msedge||a.a.msie,this._mp3UseMpegAudio=!a.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return U.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},U.prototype.bindDataSource=function(k){return k.onDataAvailable=this.remux.bind(this),k.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(U.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(k){this._onInitSegment=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(k){this._onMediaSegment=k},enumerable:!1,configurable:!0}),U.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},U.prototype.seek=function(k){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},U.prototype.remux=function(k,F){if(!this._onMediaSegment)throw new R.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(k,F),F&&this._remuxVideo(F),k&&this._remuxAudio(k)},U.prototype._onTrackMetadataReceived=function(k,F){var w=null,H="mp4",Q=F.codec;if(k==="audio")this._audioMeta=F,F.codec==="mp3"&&this._mp3UseMpegAudio?(H="mpeg",Q="",w=new Uint8Array):w=He.generateInitSegment(F);else{if(k!=="video")return;this._videoMeta=F,w=He.generateInitSegment(F)}if(!this._onInitSegment)throw new R.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(k,{type:k,data:w.buffer,codec:Q,container:k+"/"+H,mediaDuration:F.duration})},U.prototype._calculateDtsBase=function(k,F){this._dtsBaseInited||(k&&k.samples&&k.samples.length&&(this._audioDtsBase=k.samples[0].dts),F&&F.samples&&F.samples.length&&(this._videoDtsBase=F.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},U.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},U.prototype.flushStashedSamples=function(){var k=this._videoStashedLastSample,F=this._audioStashedLastSample,w={type:"video",id:1,sequenceNumber:0,samples:[],length:0};k!=null&&(w.samples.push(k),w.length=k.length);var H={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};F!=null&&(H.samples.push(F),H.length=F.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(w,!0),this._remuxAudio(H,!0)},U.prototype._remuxAudio=function(k,F){if(this._audioMeta!=null){var w,H=k,Q=H.samples,Y=void 0,J=-1,ie=this._audioMeta.refSampleDuration,re=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,ae=this._dtsBaseInited&&this._audioNextDts===void 0,de=!1;if(Q&&Q.length!==0&&(Q.length!==1||F)){var ne=0,se=null,fe=0;re?(ne=0,fe=H.length):(ne=8,fe=8+H.length);var ge=null;if(Q.length>1&&(fe-=(ge=Q.pop()).length),this._audioStashedLastSample!=null){var pe=this._audioStashedLastSample;this._audioStashedLastSample=null,Q.unshift(pe),fe+=pe.length}ge!=null&&(this._audioStashedLastSample=ge);var Te=Q[0].dts-this._dtsBase;if(this._audioNextDts)Y=Te-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())Y=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(de=!0);else{var xe=this._audioSegmentInfoList.getLastSampleBefore(Te);if(xe!=null){var Ee=Te-(xe.originalDts+xe.duration);Ee<=3&&(Ee=0),Y=Te-(xe.dts+xe.duration+Ee)}else Y=0}if(de){var Me=Te-Y,Se=this._videoSegmentInfoList.getLastSegmentBefore(Te);if(Se!=null&&Se.beginDts<Me){if(at=ut.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var ye=Se.beginDts,Ae=Me-Se.beginDts;b.a.v(this.TAG,"InsertPrefixSilentAudio: dts: "+ye+", duration: "+Ae),Q.unshift({unit:at,dts:ye,pts:ye}),fe+=at.byteLength}}else de=!1}for(var Ce=[],Ye=0;Ye<Q.length;Ye++){var Pe=(pe=Q[Ye]).unit,Ke=pe.dts-this._dtsBase,Ve=(ye=Ke,!1),Re=null,Ne=0;if(!(Ke<-.001)){if(this._audioMeta.codec!=="mp3"){var qe=Ke;if(this._audioNextDts&&(qe=this._audioNextDts),(Y=Ke-qe)<=-3*ie){b.a.w(this.TAG,"Dropping 1 audio frame (originalDts: "+Ke+" ms ,curRefDts: "+qe+" ms)  due to dtsCorrection: "+Y+" ms overlap.");continue}if(Y>=3*ie&&this._fillAudioTimestampGap&&!a.a.safari){Ve=!0;var at,gt=Math.floor(Y/ie);b.a.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
originalDts: `+Ke+" ms, curRefDts: "+qe+" ms, dtsCorrection: "+Math.round(Y)+" ms, generate: "+gt+" frames"),ye=Math.floor(qe),Ne=Math.floor(qe+ie)-ye,(at=ut.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))==null&&(b.a.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),at=Pe),Re=[];for(var ct=0;ct<gt;ct++){qe+=ie;var Xe=Math.floor(qe),Tt=Math.floor(qe+ie)-Xe,_t={dts:Xe,pts:Xe,cts:0,unit:at,size:at.byteLength,duration:Tt,originalDts:Ke,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};Re.push(_t),fe+=_t.size}this._audioNextDts=qe+ie}else ye=Math.floor(qe),Ne=Math.floor(qe+ie)-ye,this._audioNextDts=qe+ie}else ye=Ke-Y,Ye!==Q.length-1?Ne=Q[Ye+1].dts-this._dtsBase-Y-ye:ge!=null?Ne=ge.dts-this._dtsBase-Y-ye:Ne=Ce.length>=1?Ce[Ce.length-1].duration:Math.floor(ie),this._audioNextDts=ye+Ne;J===-1&&(J=ye),Ce.push({dts:ye,pts:ye,cts:0,unit:pe.unit,size:pe.unit.byteLength,duration:Ne,originalDts:Ke,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Ve&&Ce.push.apply(Ce,Re)}}if(Ce.length===0)return H.samples=[],void(H.length=0);for(re?se=new Uint8Array(fe):((se=new Uint8Array(fe))[0]=fe>>>24&255,se[1]=fe>>>16&255,se[2]=fe>>>8&255,se[3]=255&fe,se.set(He.types.mdat,4)),Ye=0;Ye<Ce.length;Ye++)Pe=Ce[Ye].unit,se.set(Pe,ne),ne+=Pe.byteLength;var lt=Ce[Ce.length-1];w=lt.dts+lt.duration;var nt=new Qe.b;nt.beginDts=J,nt.endDts=w,nt.beginPts=J,nt.endPts=w,nt.originalBeginDts=Ce[0].originalDts,nt.originalEndDts=lt.originalDts+lt.duration,nt.firstSample=new Qe.d(Ce[0].dts,Ce[0].pts,Ce[0].duration,Ce[0].originalDts,!1),nt.lastSample=new Qe.d(lt.dts,lt.pts,lt.duration,lt.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(nt),H.samples=Ce,H.sequenceNumber++;var yt=null;yt=re?new Uint8Array:He.moof(H,J),H.samples=[],H.length=0;var mt={type:"audio",data:this._mergeBoxes(yt,se).buffer,sampleCount:Ce.length,info:nt};re&&ae&&(mt.timestampOffset=J),this._onMediaSegment("audio",mt)}}},U.prototype._remuxVideo=function(k,F){if(this._videoMeta!=null){var w,H,Q=k,Y=Q.samples,J=void 0,ie=-1,re=-1;if(Y&&Y.length!==0&&(Y.length!==1||F)){var ae=8,de=null,ne=8+k.length,se=null;if(Y.length>1&&(ne-=(se=Y.pop()).length),this._videoStashedLastSample!=null){var fe=this._videoStashedLastSample;this._videoStashedLastSample=null,Y.unshift(fe),ne+=fe.length}se!=null&&(this._videoStashedLastSample=se);var ge=Y[0].dts-this._dtsBase;if(this._videoNextDts)J=ge-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())J=0;else{var pe=this._videoSegmentInfoList.getLastSampleBefore(ge);if(pe!=null){var Te=ge-(pe.originalDts+pe.duration);Te<=3&&(Te=0),J=ge-(pe.dts+pe.duration+Te)}else J=0}for(var xe=new Qe.b,Ee=[],Me=0;Me<Y.length;Me++){var Se=(fe=Y[Me]).dts-this._dtsBase,ye=fe.isKeyframe,Ae=Se-J,Ce=fe.cts,Ye=Ae+Ce;ie===-1&&(ie=Ae,re=Ye);var Pe=0;if(Me!==Y.length-1?Pe=Y[Me+1].dts-this._dtsBase-J-Ae:se!=null?Pe=se.dts-this._dtsBase-J-Ae:Pe=Ee.length>=1?Ee[Ee.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),ye){var Ke=new Qe.d(Ae,Ye,Pe,fe.dts,!0);Ke.fileposition=fe.fileposition,xe.appendSyncPoint(Ke)}Ee.push({dts:Ae,pts:Ye,cts:Ce,units:fe.units,size:fe.length,isKeyframe:ye,duration:Pe,originalDts:Se,flags:{isLeading:0,dependsOn:ye?2:1,isDependedOn:ye?1:0,hasRedundancy:0,isNonSync:ye?0:1}})}for((de=new Uint8Array(ne))[0]=ne>>>24&255,de[1]=ne>>>16&255,de[2]=ne>>>8&255,de[3]=255&ne,de.set(He.types.mdat,4),Me=0;Me<Ee.length;Me++)for(var Ve=Ee[Me].units;Ve.length;){var Re=Ve.shift().data;de.set(Re,ae),ae+=Re.byteLength}var Ne=Ee[Ee.length-1];if(w=Ne.dts+Ne.duration,H=Ne.pts+Ne.duration,this._videoNextDts=w,xe.beginDts=ie,xe.endDts=w,xe.beginPts=re,xe.endPts=H,xe.originalBeginDts=Ee[0].originalDts,xe.originalEndDts=Ne.originalDts+Ne.duration,xe.firstSample=new Qe.d(Ee[0].dts,Ee[0].pts,Ee[0].duration,Ee[0].originalDts,Ee[0].isKeyframe),xe.lastSample=new Qe.d(Ne.dts,Ne.pts,Ne.duration,Ne.originalDts,Ne.isKeyframe),this._isLive||this._videoSegmentInfoList.append(xe),Q.samples=Ee,Q.sequenceNumber++,this._forceFirstIDR){var qe=Ee[0].flags;qe.dependsOn=2,qe.isNonSync=0}var at=He.moof(Q,ie);Q.samples=[],Q.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(at,de).buffer,sampleCount:Ee.length,info:xe})}}},U.prototype._mergeBoxes=function(k,F){var w=new Uint8Array(k.byteLength+F.byteLength);return w.set(k,0),w.set(F,k.byteLength),w},U}(),dt=W(11),Be=W(1),it=function(){function U(k,F){this.TAG="TransmuxingController",this._emitter=new C.a,this._config=F,k.segments||(k.segments=[{duration:k.duration,filesize:k.filesize,url:k.url}]),typeof k.cors!="boolean"&&(k.cors=!0),typeof k.withCredentials!="boolean"&&(k.withCredentials=!1),this._mediaDataSource=k,this._currentSegmentIndex=0;var w=0;this._mediaDataSource.segments.forEach(function(H){H.timestampBase=w,w+=H.duration,H.cors=k.cors,H.withCredentials=k.withCredentials,F.referrerPolicy&&(H.referrerPolicy=F.referrerPolicy)}),isNaN(w)||this._mediaDataSource.duration===w||(this._mediaDataSource.duration=w),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return U.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},U.prototype.on=function(k,F){this._emitter.addListener(k,F)},U.prototype.off=function(k,F){this._emitter.removeListener(k,F)},U.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},U.prototype._loadSegment=function(k,F){this._currentSegmentIndex=k;var w=this._mediaDataSource.segments[k],H=this._ioctl=new dt.a(w,this._config,k);H.onError=this._onIOException.bind(this),H.onSeeked=this._onIOSeeked.bind(this),H.onComplete=this._onIOComplete.bind(this),H.onRedirect=this._onIORedirect.bind(this),H.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),F?this._demuxer.bindDataSource(this._ioctl):H.onDataArrival=this._onInitChunkArrival.bind(this),H.open(F)},U.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},U.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},U.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},U.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},U.prototype.seek=function(k){if(this._mediaInfo!=null&&this._mediaInfo.isSeekable()){var F=this._searchSegmentIndexContains(k);if(F===this._currentSegmentIndex){var w=this._mediaInfo.segments[F];if(w==null)this._pendingSeekTime=k;else{var H=w.getNearestKeyframe(k);this._remuxer.seek(H.milliseconds),this._ioctl.seek(H.fileposition),this._pendingResolveSeekPoint=H.milliseconds}}else{var Q=this._mediaInfo.segments[F];Q==null?(this._pendingSeekTime=k,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(F)):(H=Q.getNearestKeyframe(k),this._internalAbort(),this._remuxer.seek(k),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[F].timestampBase,this._loadSegment(F,H.fileposition),this._pendingResolveSeekPoint=H.milliseconds,this._reportSegmentMediaInfo(F))}this._enableStatisticsReporter()}},U.prototype._searchSegmentIndexContains=function(k){for(var F=this._mediaDataSource.segments,w=F.length-1,H=0;H<F.length;H++)if(k<F[H].timestampBase){w=H-1;break}return w},U.prototype._onInitChunkArrival=function(k,F){var w=this,H=0;if(F>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,H=this._demuxer.parseChunks(k,F);else{var Q=null;(Q=r.probe(k)).match&&(this._setupFLVDemuxerRemuxer(Q),H=this._demuxer.parseChunks(k,F)),Q.match||Q.needMoreData||(Q=Je.probe(k)).match&&(this._setupTSDemuxerRemuxer(Q),H=this._demuxer.parseChunks(k,F)),Q.match||Q.needMoreData||(Q=null,b.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then(function(){w._internalAbort()}),this._emitter.emit(Be.a.DEMUX_ERROR,I.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return H},U.prototype._setupFLVDemuxerRemuxer=function(k){this._demuxer=new r(k,this._config),this._remuxer||(this._remuxer=new be(this._config));var F=this._mediaDataSource;F.duration==null||isNaN(F.duration)||(this._demuxer.overridedDuration=F.duration),typeof F.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=F.hasAudio),typeof F.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=F.hasVideo),this._demuxer.timestampBase=F.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},U.prototype._setupTSDemuxerRemuxer=function(k){var F=this._demuxer=new Je(k,this._config);this._remuxer||(this._remuxer=new be(this._config)),F.onError=this._onDemuxException.bind(this),F.onMediaInfo=this._onMediaInfo.bind(this),F.onMetaDataArrived=this._onMetaDataArrived.bind(this),F.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),F.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),F.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),F.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),F.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},U.prototype._onMediaInfo=function(k){var F=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},k),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,g.a.prototype));var w=Object.assign({},k);Object.setPrototypeOf(w,g.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=w,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var H=F._pendingSeekTime;F._pendingSeekTime=null,F.seek(H)})},U.prototype._onMetaDataArrived=function(k){this._emitter.emit(Be.a.METADATA_ARRIVED,k)},U.prototype._onScriptDataArrived=function(k){this._emitter.emit(Be.a.SCRIPTDATA_ARRIVED,k)},U.prototype._onTimedID3Metadata=function(k){var F=this._remuxer.getTimestampBase();F!=null&&(k.pts!=null&&(k.pts-=F),k.dts!=null&&(k.dts-=F),this._emitter.emit(Be.a.TIMED_ID3_METADATA_ARRIVED,k))},U.prototype._onSMPTE2038Metadata=function(k){var F=this._remuxer.getTimestampBase();F!=null&&(k.pts!=null&&(k.pts-=F),k.dts!=null&&(k.dts-=F),k.nearest_pts!=null&&(k.nearest_pts-=F),this._emitter.emit(Be.a.SMPTE2038_METADATA_ARRIVED,k))},U.prototype._onSCTE35Metadata=function(k){var F=this._remuxer.getTimestampBase();F!=null&&(k.pts!=null&&(k.pts-=F),k.nearest_pts!=null&&(k.nearest_pts-=F),this._emitter.emit(Be.a.SCTE35_METADATA_ARRIVED,k))},U.prototype._onPESPrivateDataDescriptor=function(k){this._emitter.emit(Be.a.PES_PRIVATE_DATA_DESCRIPTOR,k)},U.prototype._onPESPrivateData=function(k){var F=this._remuxer.getTimestampBase();F!=null&&(k.pts!=null&&(k.pts-=F),k.nearest_pts!=null&&(k.nearest_pts-=F),k.dts!=null&&(k.dts-=F),this._emitter.emit(Be.a.PES_PRIVATE_DATA_ARRIVED,k))},U.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},U.prototype._onIOComplete=function(k){var F=k+1;F<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(F)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(Be.a.LOADING_COMPLETE),this._disableStatisticsReporter())},U.prototype._onIORedirect=function(k){var F=this._ioctl.extraData;this._mediaDataSource.segments[F].redirectedURL=k},U.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(Be.a.RECOVERED_EARLY_EOF)},U.prototype._onIOException=function(k,F){b.a.e(this.TAG,"IOException: type = "+k+", code = "+F.code+", msg = "+F.msg),this._emitter.emit(Be.a.IO_ERROR,k,F),this._disableStatisticsReporter()},U.prototype._onDemuxException=function(k,F){b.a.e(this.TAG,"DemuxException: type = "+k+", info = "+F),this._emitter.emit(Be.a.DEMUX_ERROR,k,F)},U.prototype._onRemuxerInitSegmentArrival=function(k,F){this._emitter.emit(Be.a.INIT_SEGMENT,k,F)},U.prototype._onRemuxerMediaSegmentArrival=function(k,F){if(this._pendingSeekTime==null&&(this._emitter.emit(Be.a.MEDIA_SEGMENT,k,F),this._pendingResolveSeekPoint!=null&&k==="video")){var w=F.info.syncPoints,H=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,a.a.safari&&w.length>0&&w[0].originalDts===H&&(H=w[0].pts),this._emitter.emit(Be.a.RECOMMEND_SEEKPOINT,H)}},U.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},U.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},U.prototype._reportSegmentMediaInfo=function(k){var F=this._mediaInfo.segments[k],w=Object.assign({},F);w.duration=this._mediaInfo.duration,w.segmentCount=this._mediaInfo.segmentCount,delete w.segments,delete w.keyframesIndex,this._emitter.emit(Be.a.MEDIA_INFO,w)},U.prototype._reportStatisticsInfo=function(){var k={};k.url=this._ioctl.currentURL,k.hasRedirect=this._ioctl.hasRedirect,k.hasRedirect&&(k.redirectedURL=this._ioctl.currentRedirectedURL),k.speed=this._ioctl.currentSpeed,k.loaderType=this._ioctl.loaderType,k.currentSegmentIndex=this._currentSegmentIndex,k.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(Be.a.STATISTICS_INFO,k)},U}();ee.a=it},function(G,ee,W){var O,C=W(0),b=function(){function o(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return o.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},o.prototype.addBytes=function(i){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=i,this._totalBytes+=i):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=i,this._totalBytes+=i):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=i,this._totalBytes+=i,this._lastCheckpoint=this._now())},Object.defineProperty(o.prototype,"currentKBps",{get:function(){this.addBytes(0);var i=(this._now()-this._lastCheckpoint)/1e3;return i==0&&(i=1),this._intervalBytes/i/1024},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"averageKBps",{get:function(){var i=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/i/1024},enumerable:!1,configurable:!0}),o}(),a=W(2),g=W(4),d=W(3),S=(O=function(o,i){return(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var l in r)r.hasOwnProperty(l)&&(t[l]=r[l])})(o,i)},function(o,i){function t(){this.constructor=o}O(o,i),o.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}),E=function(o){function i(t,r){var l=o.call(this,"fetch-stream-loader")||this;return l.TAG="FetchStreamLoader",l._seekHandler=t,l._config=r,l._needStash=!0,l._requestAbort=!1,l._abortController=null,l._contentLength=null,l._receivedLength=0,l}return S(i,o),i.isSupported=function(){try{var t=g.a.msedge&&g.a.version.minor>=15048,r=!g.a.msedge||t;return self.fetch&&self.ReadableStream&&r}catch(l){return!1}},i.prototype.destroy=function(){this.isWorking()&&this.abort(),o.prototype.destroy.call(this)},i.prototype.open=function(t,r){var l=this;this._dataSource=t,this._range=r;var p=t.url;this._config.reuseRedirectedURL&&t.redirectedURL!=null&&(p=t.redirectedURL);var u=this._seekHandler.getConfig(p,r),f=new self.Headers;if(typeof u.headers=="object"){var L=u.headers;for(var v in L)L.hasOwnProperty(v)&&f.append(v,L[v])}var y={method:"GET",headers:f,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var v in this._config.headers)f.append(v,this._config.headers[v]);t.cors===!1&&(y.mode="same-origin"),t.withCredentials&&(y.credentials="include"),t.referrerPolicy&&(y.referrerPolicy=t.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,y.signal=this._abortController.signal),this._status=a.c.kConnecting,self.fetch(u.url,y).then(function(n){if(l._requestAbort)return l._status=a.c.kIdle,void n.body.cancel();if(n.ok&&n.status>=200&&n.status<=299){if(n.url!==u.url&&l._onURLRedirect){var s=l._seekHandler.removeURLParameters(n.url);l._onURLRedirect(s)}var e=n.headers.get("Content-Length");return e!=null&&(l._contentLength=parseInt(e),l._contentLength!==0&&l._onContentLengthKnown&&l._onContentLengthKnown(l._contentLength)),l._pump.call(l,n.body.getReader())}if(l._status=a.c.kError,!l._onError)throw new d.d("FetchStreamLoader: Http code invalid, "+n.status+" "+n.statusText);l._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:n.status,msg:n.statusText})}).catch(function(n){if(!l._abortController||!l._abortController.signal.aborted){if(l._status=a.c.kError,!l._onError)throw n;l._onError(a.b.EXCEPTION,{code:-1,msg:n.message})}})},i.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==a.c.kBuffering||!g.a.chrome)&&this._abortController)try{this._abortController.abort()}catch(t){}},i.prototype._pump=function(t){var r=this;return t.read().then(function(l){if(l.done)if(r._contentLength!==null&&r._receivedLength<r._contentLength){r._status=a.c.kError;var p=a.b.EARLY_EOF,u={code:-1,msg:"Fetch stream meet Early-EOF"};if(!r._onError)throw new d.d(u.msg);r._onError(p,u)}else r._status=a.c.kComplete,r._onComplete&&r._onComplete(r._range.from,r._range.from+r._receivedLength-1);else{if(r._abortController&&r._abortController.signal.aborted)return void(r._status=a.c.kComplete);if(r._requestAbort===!0)return r._status=a.c.kComplete,t.cancel();r._status=a.c.kBuffering;var f=l.value.buffer,L=r._range.from+r._receivedLength;r._receivedLength+=f.byteLength,r._onDataArrival&&r._onDataArrival(f,L,r._receivedLength),r._pump(t)}}).catch(function(l){if(r._abortController&&r._abortController.signal.aborted)r._status=a.c.kComplete;else if(l.code!==11||!g.a.msedge){r._status=a.c.kError;var p=0,u=null;if(l.code!==19&&l.message!=="network error"||!(r._contentLength===null||r._contentLength!==null&&r._receivedLength<r._contentLength)?(p=a.b.EXCEPTION,u={code:l.code,msg:l.message}):(p=a.b.EARLY_EOF,u={code:l.code,msg:"Fetch stream meet Early-EOF"}),!r._onError)throw new d.d(u.msg);r._onError(p,u)}})},i}(a.a),R=function(){var o=function(i,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,l){r.__proto__=l}||function(r,l){for(var p in l)l.hasOwnProperty(p)&&(r[p]=l[p])})(i,t)};return function(i,t){function r(){this.constructor=i}o(i,t),i.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),x=function(o){function i(t,r){var l=o.call(this,"xhr-moz-chunked-loader")||this;return l.TAG="MozChunkedLoader",l._seekHandler=t,l._config=r,l._needStash=!0,l._xhr=null,l._requestAbort=!1,l._contentLength=null,l._receivedLength=0,l}return R(i,o),i.isSupported=function(){try{var t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="moz-chunked-arraybuffer",t.responseType==="moz-chunked-arraybuffer"}catch(r){return C.a.w("MozChunkedLoader",r.message),!1}},i.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),o.prototype.destroy.call(this)},i.prototype.open=function(t,r){this._dataSource=t,this._range=r;var l=t.url;this._config.reuseRedirectedURL&&t.redirectedURL!=null&&(l=t.redirectedURL);var p=this._seekHandler.getConfig(l,r);this._requestURL=p.url;var u=this._xhr=new XMLHttpRequest;if(u.open("GET",p.url,!0),u.responseType="moz-chunked-arraybuffer",u.onreadystatechange=this._onReadyStateChange.bind(this),u.onprogress=this._onProgress.bind(this),u.onloadend=this._onLoadEnd.bind(this),u.onerror=this._onXhrError.bind(this),t.withCredentials&&(u.withCredentials=!0),typeof p.headers=="object"){var f=p.headers;for(var L in f)f.hasOwnProperty(L)&&u.setRequestHeader(L,f[L])}if(typeof this._config.headers=="object"){f=this._config.headers;for(var L in f)f.hasOwnProperty(L)&&u.setRequestHeader(L,f[L])}this._status=a.c.kConnecting,u.send()},i.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=a.c.kComplete},i.prototype._onReadyStateChange=function(t){var r=t.target;if(r.readyState===2){if(r.responseURL!=null&&r.responseURL!==this._requestURL&&this._onURLRedirect){var l=this._seekHandler.removeURLParameters(r.responseURL);this._onURLRedirect(l)}if(r.status!==0&&(r.status<200||r.status>299)){if(this._status=a.c.kError,!this._onError)throw new d.d("MozChunkedLoader: Http code invalid, "+r.status+" "+r.statusText);this._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:r.status,msg:r.statusText})}else this._status=a.c.kBuffering}},i.prototype._onProgress=function(t){if(this._status!==a.c.kError){this._contentLength===null&&t.total!==null&&t.total!==0&&(this._contentLength=t.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var r=t.target.response,l=this._range.from+this._receivedLength;this._receivedLength+=r.byteLength,this._onDataArrival&&this._onDataArrival(r,l,this._receivedLength)}},i.prototype._onLoadEnd=function(t){this._requestAbort!==!0?this._status!==a.c.kError&&(this._status=a.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},i.prototype._onXhrError=function(t){this._status=a.c.kError;var r=0,l=null;if(this._contentLength&&t.loaded<this._contentLength?(r=a.b.EARLY_EOF,l={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(r=a.b.EXCEPTION,l={code:-1,msg:t.constructor.name+" "+t.type}),!this._onError)throw new d.d(l.msg);this._onError(r,l)},i}(a.a),A=function(){var o=function(i,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,l){r.__proto__=l}||function(r,l){for(var p in l)l.hasOwnProperty(p)&&(r[p]=l[p])})(i,t)};return function(i,t){function r(){this.constructor=i}o(i,t),i.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),D=function(o){function i(t,r){var l=o.call(this,"xhr-range-loader")||this;return l.TAG="RangeLoader",l._seekHandler=t,l._config=r,l._needStash=!1,l._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],l._currentChunkSizeKB=384,l._currentSpeedNormalized=0,l._zeroSpeedChunkCount=0,l._xhr=null,l._speedSampler=new b,l._requestAbort=!1,l._waitForTotalLength=!1,l._totalLengthReceived=!1,l._currentRequestURL=null,l._currentRedirectedURL=null,l._currentRequestRange=null,l._totalLength=null,l._contentLength=null,l._receivedLength=0,l._lastTimeLoaded=0,l}return A(i,o),i.isSupported=function(){try{var t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="arraybuffer",t.responseType==="arraybuffer"}catch(r){return C.a.w("RangeLoader",r.message),!1}},i.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),o.prototype.destroy.call(this)},Object.defineProperty(i.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),i.prototype.open=function(t,r){this._dataSource=t,this._range=r,this._status=a.c.kConnecting;var l=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(l=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||l?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},i.prototype._openSubRange=function(){var t=1024*this._currentChunkSizeKB,r=this._range.from+this._receivedLength,l=r+t;this._contentLength!=null&&l-this._range.from>=this._contentLength&&(l=this._range.from+this._contentLength-1),this._currentRequestRange={from:r,to:l},this._internalOpen(this._dataSource,this._currentRequestRange)},i.prototype._internalOpen=function(t,r){this._lastTimeLoaded=0;var l=t.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?l=this._currentRedirectedURL:t.redirectedURL!=null&&(l=t.redirectedURL));var p=this._seekHandler.getConfig(l,r);this._currentRequestURL=p.url;var u=this._xhr=new XMLHttpRequest;if(u.open("GET",p.url,!0),u.responseType="arraybuffer",u.onreadystatechange=this._onReadyStateChange.bind(this),u.onprogress=this._onProgress.bind(this),u.onload=this._onLoad.bind(this),u.onerror=this._onXhrError.bind(this),t.withCredentials&&(u.withCredentials=!0),typeof p.headers=="object"){var f=p.headers;for(var L in f)f.hasOwnProperty(L)&&u.setRequestHeader(L,f[L])}if(typeof this._config.headers=="object"){f=this._config.headers;for(var L in f)f.hasOwnProperty(L)&&u.setRequestHeader(L,f[L])}u.send()},i.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=a.c.kComplete},i.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},i.prototype._onReadyStateChange=function(t){var r=t.target;if(r.readyState===2){if(r.responseURL!=null){var l=this._seekHandler.removeURLParameters(r.responseURL);r.responseURL!==this._currentRequestURL&&l!==this._currentRedirectedURL&&(this._currentRedirectedURL=l,this._onURLRedirect&&this._onURLRedirect(l))}if(r.status>=200&&r.status<=299){if(this._waitForTotalLength)return;this._status=a.c.kBuffering}else{if(this._status=a.c.kError,!this._onError)throw new d.d("RangeLoader: Http code invalid, "+r.status+" "+r.statusText);this._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:r.status,msg:r.statusText})}}},i.prototype._onProgress=function(t){if(this._status!==a.c.kError){if(this._contentLength===null){var r=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,r=!0;var l=t.total;this._internalAbort(),l!=null&l!==0&&(this._totalLength=l)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,r)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var p=t.loaded-this._lastTimeLoaded;this._lastTimeLoaded=t.loaded,this._speedSampler.addBytes(p)}},i.prototype._normalizeSpeed=function(t){var r=this._chunkSizeKBList,l=r.length-1,p=0,u=0,f=l;if(t<r[0])return r[0];for(;u<=f;){if((p=u+Math.floor((f-u)/2))===l||t>=r[p]&&t<r[p+1])return r[p];r[p]<t?u=p+1:f=p-1}},i.prototype._onLoad=function(t){if(this._status!==a.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var r=this._speedSampler.lastSecondKBps;if(r===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(r=this._speedSampler.currentKBps)),r!==0){var l=this._normalizeSpeed(r);this._currentSpeedNormalized!==l&&(this._currentSpeedNormalized=l,this._currentChunkSizeKB=l)}var p=t.target.response,u=this._range.from+this._receivedLength;this._receivedLength+=p.byteLength;var f=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():f=!0,this._onDataArrival&&this._onDataArrival(p,u,this._receivedLength),f&&(this._status=a.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},i.prototype._onXhrError=function(t){this._status=a.c.kError;var r=0,l=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(r=a.b.EARLY_EOF,l={code:-1,msg:"RangeLoader meet Early-Eof"}):(r=a.b.EXCEPTION,l={code:-1,msg:t.constructor.name+" "+t.type}),!this._onError)throw new d.d(l.msg);this._onError(r,l)},i}(a.a),P=function(){var o=function(i,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,l){r.__proto__=l}||function(r,l){for(var p in l)l.hasOwnProperty(p)&&(r[p]=l[p])})(i,t)};return function(i,t){function r(){this.constructor=i}o(i,t),i.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),I=function(o){function i(){var t=o.call(this,"websocket-loader")||this;return t.TAG="WebSocketLoader",t._needStash=!0,t._ws=null,t._requestAbort=!1,t._receivedLength=0,t}return P(i,o),i.isSupported=function(){try{return self.WebSocket!==void 0}catch(t){return!1}},i.prototype.destroy=function(){this._ws&&this.abort(),o.prototype.destroy.call(this)},i.prototype.open=function(t){try{var r=this._ws=new self.WebSocket(t.url);r.binaryType="arraybuffer",r.onopen=this._onWebSocketOpen.bind(this),r.onclose=this._onWebSocketClose.bind(this),r.onmessage=this._onWebSocketMessage.bind(this),r.onerror=this._onWebSocketError.bind(this),this._status=a.c.kConnecting}catch(p){this._status=a.c.kError;var l={code:p.code,msg:p.message};if(!this._onError)throw new d.d(l.msg);this._onError(a.b.EXCEPTION,l)}},i.prototype.abort=function(){var t=this._ws;!t||t.readyState!==0&&t.readyState!==1||(this._requestAbort=!0,t.close()),this._ws=null,this._status=a.c.kComplete},i.prototype._onWebSocketOpen=function(t){this._status=a.c.kBuffering},i.prototype._onWebSocketClose=function(t){this._requestAbort!==!0?(this._status=a.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},i.prototype._onWebSocketMessage=function(t){var r=this;if(t.data instanceof ArrayBuffer)this._dispatchArrayBuffer(t.data);else if(t.data instanceof Blob){var l=new FileReader;l.onload=function(){r._dispatchArrayBuffer(l.result)},l.readAsArrayBuffer(t.data)}else{this._status=a.c.kError;var p={code:-1,msg:"Unsupported WebSocket message type: "+t.data.constructor.name};if(!this._onError)throw new d.d(p.msg);this._onError(a.b.EXCEPTION,p)}},i.prototype._dispatchArrayBuffer=function(t){var r=t,l=this._receivedLength;this._receivedLength+=r.byteLength,this._onDataArrival&&this._onDataArrival(r,l,this._receivedLength)},i.prototype._onWebSocketError=function(t){this._status=a.c.kError;var r={code:t.code,msg:t.message};if(!this._onError)throw new d.d(r.msg);this._onError(a.b.EXCEPTION,r)},i}(a.a),c=function(){function o(i){this._zeroStart=i||!1}return o.prototype.getConfig=function(i,t){var r={};if(t.from!==0||t.to!==-1){var l=void 0;l=t.to!==-1?"bytes="+t.from.toString()+"-"+t.to.toString():"bytes="+t.from.toString()+"-",r.Range=l}else this._zeroStart&&(r.Range="bytes=0-");return{url:i,headers:r}},o.prototype.removeURLParameters=function(i){return i},o}(),m=function(){function o(i,t){this._startName=i,this._endName=t}return o.prototype.getConfig=function(i,t){var r=i;if(t.from!==0||t.to!==-1){var l=!0;r.indexOf("?")===-1&&(r+="?",l=!1),l&&(r+="&"),r+=this._startName+"="+t.from.toString(),t.to!==-1&&(r+="&"+this._endName+"="+t.to.toString())}return{url:r,headers:{}}},o.prototype.removeURLParameters=function(i){var t=i.split("?")[0],r=void 0,l=i.indexOf("?");l!==-1&&(r=i.substring(l+1));var p="";if(r!=null&&r.length>0)for(var u=r.split("&"),f=0;f<u.length;f++){var L=u[f].split("="),v=f>0;L[0]!==this._startName&&L[0]!==this._endName&&(v&&(p+="&"),p+=u[f])}return p.length===0?t:t+"?"+p},o}(),_=function(){function o(i,t,r){this.TAG="IOController",this._config=t,this._extraData=r,this._stashInitialSize=65536,t.stashInitialSize!=null&&t.stashInitialSize>0&&(this._stashInitialSize=t.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,t.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=i,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(i.url),this._refTotalLength=i.filesize?i.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new b,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return o.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},o.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},o.prototype.isPaused=function(){return this._paused},Object.defineProperty(o.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"extraData",{get:function(){return this._extraData},set:function(i){this._extraData=i},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(i){this._onDataArrival=i},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(i){this._onSeeked=i},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onError",{get:function(){return this._onError},set:function(i){this._onError=i},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onComplete",{get:function(){return this._onComplete},set:function(i){this._onComplete=i},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(i){this._onRedirect=i},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(i){this._onRecoveredEarlyEof=i},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentSpeed",{get:function(){return this._loaderClass===D?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),o.prototype._selectSeekHandler=function(){var i=this._config;if(i.seekType==="range")this._seekHandler=new c(this._config.rangeLoadZeroStart);else if(i.seekType==="param"){var t=i.seekParamStart||"bstart",r=i.seekParamEnd||"bend";this._seekHandler=new m(t,r)}else{if(i.seekType!=="custom")throw new d.b("Invalid seekType in config: "+i.seekType);if(typeof i.customSeekHandler!="function")throw new d.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new i.customSeekHandler}},o.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=I;else if(E.isSupported())this._loaderClass=E;else if(x.isSupported())this._loaderClass=x;else{if(!D.isSupported())throw new d.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=D}},o.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},o.prototype.open=function(i){this._currentRange={from:0,to:-1},i&&(this._currentRange.from=i),this._speedSampler.reset(),i||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},o.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},o.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},o.prototype.resume=function(){if(this._paused){this._paused=!1;var i=this._resumeFrom;this._resumeFrom=0,this._internalSeek(i,!0)}},o.prototype.seek=function(i){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(i,!0)},o.prototype._internalSeek=function(i,t){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var r={from:i,to:-1};this._currentRange={from:r.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,r),this._onSeeked&&this._onSeeked()},o.prototype.updateUrl=function(i){if(!i||typeof i!="string"||i.length===0)throw new d.b("Url must be a non-empty string!");this._dataSource.url=i},o.prototype._expandBuffer=function(i){for(var t=this._stashSize;t+1048576<i;)t*=2;if((t+=1048576)!==this._bufferSize){var r=new ArrayBuffer(t);if(this._stashUsed>0){var l=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(r,0,t).set(l,0)}this._stashBuffer=r,this._bufferSize=t}},o.prototype._normalizeSpeed=function(i){var t=this._speedNormalizeList,r=t.length-1,l=0,p=0,u=r;if(i<t[0])return t[0];for(;p<=u;){if((l=p+Math.floor((u-p)/2))===r||i>=t[l]&&i<t[l+1])return t[l];t[l]<i?p=l+1:u=l-1}},o.prototype._adjustStashSize=function(i){var t=0;(t=this._config.isLive?i/8:i<512?i:i>=512&&i<=1024?Math.floor(1.5*i):2*i)>8192&&(t=8192);var r=1024*t+1048576;this._bufferSize<r&&this._expandBuffer(r),this._stashSize=1024*t},o.prototype._dispatchChunks=function(i,t){return this._currentRange.to=t+i.byteLength-1,this._onDataArrival(i,t)},o.prototype._onURLRedirect=function(i){this._redirectedURL=i,this._onRedirect&&this._onRedirect(i)},o.prototype._onContentLengthKnown=function(i){i&&this._fullRequestFlag&&(this._totalLength=i,this._fullRequestFlag=!1)},o.prototype._onLoaderChunkArrival=function(i,t,r){if(!this._onDataArrival)throw new d.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(i.byteLength);var l=this._speedSampler.lastSecondKBps;if(l!==0){var p=this._normalizeSpeed(l);this._speedNormalized!==p&&(this._speedNormalized=p,this._adjustStashSize(p))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=t),this._stashUsed+i.byteLength<=this._stashSize)(L=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(i),this._stashUsed),this._stashUsed+=i.byteLength;else if(L=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var u=this._stashBuffer.slice(0,this._stashUsed);(v=this._dispatchChunks(u,this._stashByteStart))<u.byteLength?v>0&&(y=new Uint8Array(u,v),L.set(y,0),this._stashUsed=y.byteLength,this._stashByteStart+=v):(this._stashUsed=0,this._stashByteStart+=v),this._stashUsed+i.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+i.byteLength),L=new Uint8Array(this._stashBuffer,0,this._bufferSize)),L.set(new Uint8Array(i),this._stashUsed),this._stashUsed+=i.byteLength}else(v=this._dispatchChunks(i,t))<i.byteLength&&((f=i.byteLength-v)>this._bufferSize&&(this._expandBuffer(f),L=new Uint8Array(this._stashBuffer,0,this._bufferSize)),L.set(new Uint8Array(i,v),0),this._stashUsed+=f,this._stashByteStart=t+v);else if(this._stashUsed===0){var f;(v=this._dispatchChunks(i,t))<i.byteLength&&((f=i.byteLength-v)>this._bufferSize&&this._expandBuffer(f),(L=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(i,v),0),this._stashUsed+=f,this._stashByteStart=t+v)}else{var L,v;if(this._stashUsed+i.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+i.byteLength),(L=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(i),this._stashUsed),this._stashUsed+=i.byteLength,(v=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&v>0){var y=new Uint8Array(this._stashBuffer,v);L.set(y,0)}this._stashUsed-=v,this._stashByteStart+=v}}},o.prototype._flushStashBuffer=function(i){if(this._stashUsed>0){var t=this._stashBuffer.slice(0,this._stashUsed),r=this._dispatchChunks(t,this._stashByteStart),l=t.byteLength-r;if(r<t.byteLength){if(!i){if(r>0){var p=new Uint8Array(this._stashBuffer,0,this._bufferSize),u=new Uint8Array(t,r);p.set(u,0),this._stashUsed=u.byteLength,this._stashByteStart+=r}return 0}C.a.w(this.TAG,l+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,l}return 0},o.prototype._onLoaderComplete=function(i,t){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},o.prototype._onLoaderError=function(i,t){switch(C.a.e(this.TAG,"Loader error, code = "+t.code+", msg = "+t.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,i=a.b.UNRECOVERABLE_EARLY_EOF),i){case a.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var r=this._currentRange.to+1;return void(r<this._totalLength&&(C.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(r,!1)))}i=a.b.UNRECOVERABLE_EARLY_EOF;break;case a.b.UNRECOVERABLE_EARLY_EOF:case a.b.CONNECTING_TIMEOUT:case a.b.HTTP_STATUS_CODE_INVALID:case a.b.EXCEPTION:}if(!this._onError)throw new d.d("IOException: "+t.msg);this._onError(i,t)},o}();ee.a=_},function(G,ee,W){var O=function(){function C(){}return C.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(b,a){return b.__proto__=a,b},Object.assign=Object.assign||function(b){if(b==null)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(b),g=1;g<arguments.length;g++){var d=arguments[g];if(d!=null)for(var S in d)d.hasOwnProperty(S)&&(a[S]=d[S])}return a},typeof self.Promise!="function"&&W(15).polyfill()},C}();O.install(),ee.a=O},function(G,ee,W){function O(g){var d={};function S(R){if(d[R])return d[R].exports;var x=d[R]={i:R,l:!1,exports:{}};return g[R].call(x.exports,x,x.exports,S),x.l=!0,x.exports}S.m=g,S.c=d,S.i=function(R){return R},S.d=function(R,x,A){S.o(R,x)||Object.defineProperty(R,x,{configurable:!1,enumerable:!0,get:A})},S.r=function(R){Object.defineProperty(R,"__esModule",{value:!0})},S.n=function(R){var x=R&&R.__esModule?function(){return R.default}:function(){return R};return S.d(x,"a",x),x},S.o=function(R,x){return Object.prototype.hasOwnProperty.call(R,x)},S.p="/",S.oe=function(R){throw console.error(R),R};var E=S(S.s=ENTRY_MODULE);return E.default||E}function C(g){return(g+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function b(g,d,S){var E={};E[S]=[];var R=d.toString(),x=R.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!x)return E;for(var A,D=x[1],P=new RegExp("(\\\\n|\\W)"+C(D)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");A=P.exec(R);)A[3]!=="dll-reference"&&E[S].push(A[3]);for(P=new RegExp("\\("+C(D)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");A=P.exec(R);)g[A[2]]||(E[S].push(A[1]),g[A[2]]=W(A[1]).m),E[A[2]]=E[A[2]]||[],E[A[2]].push(A[4]);for(var I,c=Object.keys(E),m=0;m<c.length;m++)for(var _=0;_<E[c[m]].length;_++)I=E[c[m]][_],isNaN(1*I)||(E[c[m]][_]=1*E[c[m]][_]);return E}function a(g){return Object.keys(g).reduce(function(d,S){return d||g[S].length>0},!1)}G.exports=function(g,d){d=d||{};var S={main:W.m},E=d.all?{main:Object.keys(S.main)}:function(P,I){for(var c={main:[I]},m={main:[]},_={main:{}};a(c);)for(var o=Object.keys(c),i=0;i<o.length;i++){var t=o[i],r=c[t].pop();if(_[t]=_[t]||{},!_[t][r]&&P[t][r]){_[t][r]=!0,m[t]=m[t]||[],m[t].push(r);for(var l=b(P,P[t][r],t),p=Object.keys(l),u=0;u<p.length;u++)c[p[u]]=c[p[u]]||[],c[p[u]]=c[p[u]].concat(l[p[u]])}}return m}(S,g),R="";Object.keys(E).filter(function(P){return P!=="main"}).forEach(function(P){for(var I=0;E[P][I];)I++;E[P].push(I),S[P][I]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",R=R+"var "+P+" = ("+O.toString().replace("ENTRY_MODULE",JSON.stringify(I))+")({"+E[P].map(function(c){return JSON.stringify(c)+": "+S[P][c].toString()}).join(",")+`});
`}),R=R+"new (("+O.toString().replace("ENTRY_MODULE",JSON.stringify(g))+")({"+E.main.map(function(P){return JSON.stringify(P)+": "+S.main[P].toString()}).join(",")+"}))(self);";var x=new window.Blob([R],{type:"text/javascript"});if(d.bare)return x;var A=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(x),D=new window.Worker(A);return D.objectURL=A,D}},function(G,ee,W){G.exports=W(19).default},function(G,ee,W){(function(O,C){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var b;b=function(){function a(K){return typeof K=="function"}var g=Array.isArray?Array.isArray:function(K){return Object.prototype.toString.call(K)==="[object Array]"},d=0,S=void 0,E=void 0,R=function(K,V){m[d]=K,m[d+1]=V,(d+=2)===2&&(E?E(_):l())},x=typeof window!="undefined"?window:void 0,A=x||{},D=A.MutationObserver||A.WebKitMutationObserver,P=typeof self=="undefined"&&O!==void 0&&{}.toString.call(O)==="[object process]",I=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined";function c(){var K=setTimeout;return function(){return K(_,1)}}var m=new Array(1e3);function _(){for(var K=0;K<d;K+=2)(0,m[K])(m[K+1]),m[K]=void 0,m[K+1]=void 0;d=0}var o,i,t,r,l=void 0;function p(K,V){var $=this,X=new this.constructor(L);X[f]===void 0&&N(X);var Z=$._state;if(Z){var q=arguments[Z-1];R(function(){return T(Z,X,q,$._result)})}else h($,X,K,V);return X}function u(K){if(K&&typeof K=="object"&&K.constructor===this)return K;var V=new this(L);return y(V,K),V}P?l=function(){return O.nextTick(_)}:D?(i=0,t=new D(_),r=document.createTextNode(""),t.observe(r,{characterData:!0}),l=function(){r.data=i=++i%2}):I?((o=new MessageChannel).port1.onmessage=_,l=function(){return o.port2.postMessage(0)}):l=x===void 0?function(){try{var K=Function("return this")().require("vertx");return(S=K.runOnLoop||K.runOnContext)!==void 0?function(){S(_)}:c()}catch(V){return c()}}():c();var f=Math.random().toString(36).substring(2);function L(){}function v(K,V,$){V.constructor===K.constructor&&$===p&&V.constructor.resolve===u?function(X,Z){Z._state===1?s(X,Z._result):Z._state===2?e(X,Z._result):h(Z,void 0,function(q){return y(X,q)},function(q){return e(X,q)})}(K,V):$===void 0?s(K,V):a($)?function(X,Z,q){R(function(te){var ue=!1,oe=function(le,me,_e,ve){try{le.call(me,_e,ve)}catch(ce){return ce}}(q,Z,function(le){ue||(ue=!0,Z!==le?y(te,le):s(te,le))},function(le){ue||(ue=!0,e(te,le))},te._label);!ue&&oe&&(ue=!0,e(te,oe))},X)}(K,V,$):s(K,V)}function y(K,V){if(K===V)e(K,new TypeError("You cannot resolve a promise with itself"));else if(Z=typeof(X=V),X===null||Z!=="object"&&Z!=="function")s(K,V);else{var $=void 0;try{$=V.then}catch(q){return void e(K,q)}v(K,V,$)}var X,Z}function n(K){K._onerror&&K._onerror(K._result),M(K)}function s(K,V){K._state===void 0&&(K._result=V,K._state=1,K._subscribers.length!==0&&R(M,K))}function e(K,V){K._state===void 0&&(K._state=2,K._result=V,R(n,K))}function h(K,V,$,X){var Z=K._subscribers,q=Z.length;K._onerror=null,Z[q]=V,Z[q+1]=$,Z[q+2]=X,q===0&&K._state&&R(M,K)}function M(K){var V=K._subscribers,$=K._state;if(V.length!==0){for(var X=void 0,Z=void 0,q=K._result,te=0;te<V.length;te+=3)X=V[te],Z=V[te+$],X?T($,X,Z,q):Z(q);K._subscribers.length=0}}function T(K,V,$,X){var Z=a($),q=void 0,te=void 0,ue=!0;if(Z){try{q=$(X)}catch(oe){ue=!1,te=oe}if(V===q)return void e(V,new TypeError("A promises callback cannot return that same promise."))}else q=X;V._state!==void 0||(Z&&ue?y(V,q):ue===!1?e(V,te):K===1?s(V,q):K===2&&e(V,q))}var B=0;function N(K){K[f]=B++,K._state=void 0,K._result=void 0,K._subscribers=[]}var j=function(){function K(V,$){this._instanceConstructor=V,this.promise=new V(L),this.promise[f]||N(this.promise),g($)?(this.length=$.length,this._remaining=$.length,this._result=new Array(this.length),this.length===0?s(this.promise,this._result):(this.length=this.length||0,this._enumerate($),this._remaining===0&&s(this.promise,this._result))):e(this.promise,new Error("Array Methods must be provided an Array"))}return K.prototype._enumerate=function(V){for(var $=0;this._state===void 0&&$<V.length;$++)this._eachEntry(V[$],$)},K.prototype._eachEntry=function(V,$){var X=this._instanceConstructor,Z=X.resolve;if(Z===u){var q=void 0,te=void 0,ue=!1;try{q=V.then}catch(le){ue=!0,te=le}if(q===p&&V._state!==void 0)this._settledAt(V._state,$,V._result);else if(typeof q!="function")this._remaining--,this._result[$]=V;else if(X===z){var oe=new X(L);ue?e(oe,te):v(oe,V,q),this._willSettleAt(oe,$)}else this._willSettleAt(new X(function(le){return le(V)}),$)}else this._willSettleAt(Z(V),$)},K.prototype._settledAt=function(V,$,X){var Z=this.promise;Z._state===void 0&&(this._remaining--,V===2?e(Z,X):this._result[$]=X),this._remaining===0&&s(Z,this._result)},K.prototype._willSettleAt=function(V,$){var X=this;h(V,void 0,function(Z){return X._settledAt(1,$,Z)},function(Z){return X._settledAt(2,$,Z)})},K}(),z=function(){function K(V){this[f]=B++,this._result=this._state=void 0,this._subscribers=[],L!==V&&(typeof V!="function"&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof K?function($,X){try{X(function(Z){y($,Z)},function(Z){e($,Z)})}catch(Z){e($,Z)}}(this,V):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return K.prototype.catch=function(V){return this.then(null,V)},K.prototype.finally=function(V){var $=this.constructor;return a(V)?this.then(function(X){return $.resolve(V()).then(function(){return X})},function(X){return $.resolve(V()).then(function(){throw X})}):this.then(V,V)},K}();return z.prototype.then=p,z.all=function(K){return new j(this,K).promise},z.race=function(K){var V=this;return g(K)?new V(function($,X){for(var Z=K.length,q=0;q<Z;q++)V.resolve(K[q]).then($,X)}):new V(function($,X){return X(new TypeError("You must pass an array to race."))})},z.resolve=u,z.reject=function(K){var V=new this(L);return e(V,K),V},z._setScheduler=function(K){E=K},z._setAsap=function(K){R=K},z._asap=R,z.polyfill=function(){var K=void 0;if(C!==void 0)K=C;else if(typeof self!="undefined")K=self;else try{K=Function("return this")()}catch(X){throw new Error("polyfill failed because global object is unavailable in this environment")}var V=K.Promise;if(V){var $=null;try{$=Object.prototype.toString.call(V.resolve())}catch(X){}if($==="[object Promise]"&&!V.cast)return}K.Promise=z},z.Promise=z,z},G.exports=b()}).call(this,W(16),W(17))},function(G,ee){var W,O,C=G.exports={};function b(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function g(I){if(W===setTimeout)return setTimeout(I,0);if((W===b||!W)&&setTimeout)return W=setTimeout,setTimeout(I,0);try{return W(I,0)}catch(c){try{return W.call(null,I,0)}catch(m){return W.call(this,I,0)}}}(function(){try{W=typeof setTimeout=="function"?setTimeout:b}catch(I){W=b}try{O=typeof clearTimeout=="function"?clearTimeout:a}catch(I){O=a}})();var d,S=[],E=!1,R=-1;function x(){E&&d&&(E=!1,d.length?S=d.concat(S):R=-1,S.length&&A())}function A(){if(!E){var I=g(x);E=!0;for(var c=S.length;c;){for(d=S,S=[];++R<c;)d&&d[R].run();R=-1,c=S.length}d=null,E=!1,function(m){if(O===clearTimeout)return clearTimeout(m);if((O===a||!O)&&clearTimeout)return O=clearTimeout,clearTimeout(m);try{O(m)}catch(_){try{return O.call(null,m)}catch(o){return O.call(this,m)}}}(I)}}function D(I,c){this.fun=I,this.array=c}function P(){}C.nextTick=function(I){var c=new Array(arguments.length-1);if(arguments.length>1)for(var m=1;m<arguments.length;m++)c[m-1]=arguments[m];S.push(new D(I,c)),S.length!==1||E||g(A)},D.prototype.run=function(){this.fun.apply(null,this.array)},C.title="browser",C.browser=!0,C.env={},C.argv=[],C.version="",C.versions={},C.on=P,C.addListener=P,C.once=P,C.off=P,C.removeListener=P,C.removeAllListeners=P,C.emit=P,C.prependListener=P,C.prependOnceListener=P,C.listeners=function(I){return[]},C.binding=function(I){throw new Error("process.binding is not supported")},C.cwd=function(){return"/"},C.chdir=function(I){throw new Error("process.chdir is not supported")},C.umask=function(){return 0}},function(G,ee){var W;W=function(){return this}();try{W=W||new Function("return this")()}catch(O){typeof window=="object"&&(W=window)}G.exports=W},function(G,ee,W){W.r(ee);var O=W(9),C=W(12),b=W(10),a=W(1);ee.default=function(g){var d=null,S=function(u,f){g.postMessage({msg:"logcat_callback",data:{type:u,logcat:f}})}.bind(this);function E(u,f){var L={msg:a.a.INIT_SEGMENT,data:{type:u,data:f}};g.postMessage(L,[f.data])}function R(u,f){var L={msg:a.a.MEDIA_SEGMENT,data:{type:u,data:f}};g.postMessage(L,[f.data])}function x(){var u={msg:a.a.LOADING_COMPLETE};g.postMessage(u)}function A(){var u={msg:a.a.RECOVERED_EARLY_EOF};g.postMessage(u)}function D(u){var f={msg:a.a.MEDIA_INFO,data:u};g.postMessage(f)}function P(u){var f={msg:a.a.METADATA_ARRIVED,data:u};g.postMessage(f)}function I(u){var f={msg:a.a.SCRIPTDATA_ARRIVED,data:u};g.postMessage(f)}function c(u){var f={msg:a.a.TIMED_ID3_METADATA_ARRIVED,data:u};g.postMessage(f)}function m(u){var f={msg:a.a.SMPTE2038_METADATA_ARRIVED,data:u};g.postMessage(f)}function _(u){var f={msg:a.a.SCTE35_METADATA_ARRIVED,data:u};g.postMessage(f)}function o(u){var f={msg:a.a.PES_PRIVATE_DATA_DESCRIPTOR,data:u};g.postMessage(f)}function i(u){var f={msg:a.a.PES_PRIVATE_DATA_ARRIVED,data:u};g.postMessage(f)}function t(u){var f={msg:a.a.STATISTICS_INFO,data:u};g.postMessage(f)}function r(u,f){g.postMessage({msg:a.a.IO_ERROR,data:{type:u,info:f}})}function l(u,f){g.postMessage({msg:a.a.DEMUX_ERROR,data:{type:u,info:f}})}function p(u){g.postMessage({msg:a.a.RECOMMEND_SEEKPOINT,data:u})}C.a.install(),g.addEventListener("message",function(u){switch(u.data.cmd){case"init":(d=new b.a(u.data.param[0],u.data.param[1])).on(a.a.IO_ERROR,r.bind(this)),d.on(a.a.DEMUX_ERROR,l.bind(this)),d.on(a.a.INIT_SEGMENT,E.bind(this)),d.on(a.a.MEDIA_SEGMENT,R.bind(this)),d.on(a.a.LOADING_COMPLETE,x.bind(this)),d.on(a.a.RECOVERED_EARLY_EOF,A.bind(this)),d.on(a.a.MEDIA_INFO,D.bind(this)),d.on(a.a.METADATA_ARRIVED,P.bind(this)),d.on(a.a.SCRIPTDATA_ARRIVED,I.bind(this)),d.on(a.a.TIMED_ID3_METADATA_ARRIVED,c.bind(this)),d.on(a.a.SMPTE2038_METADATA_ARRIVED,m.bind(this)),d.on(a.a.SCTE35_METADATA_ARRIVED,_.bind(this)),d.on(a.a.PES_PRIVATE_DATA_DESCRIPTOR,o.bind(this)),d.on(a.a.PES_PRIVATE_DATA_ARRIVED,i.bind(this)),d.on(a.a.STATISTICS_INFO,t.bind(this)),d.on(a.a.RECOMMEND_SEEKPOINT,p.bind(this));break;case"destroy":d&&(d.destroy(),d=null),g.postMessage({msg:"destroyed"});break;case"start":d.start();break;case"stop":d.stop();break;case"seek":d.seek(u.data.param);break;case"pause":d.pause();break;case"resume":d.resume();break;case"logging_config":var f=u.data.param;O.a.applyConfig(f),f.enableCallback===!0?O.a.addLogListener(S):O.a.removeLogListener(S)}})}},function(G,ee,W){W.r(ee);var O=W(12),C=W(11),b={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function a(){return Object.assign({},b)}var g=function(){function n(){}return n.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},n.supportMSEH265Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"')},n.supportNetworkStreamIO=function(){var s=new C.a({},a()),e=s.loaderType;return s.destroy(),e=="fetch-stream-loader"||e=="xhr-moz-chunked-loader"},n.getNetworkLoaderTypeName=function(){var s=new C.a({},a()),e=s.loaderType;return s.destroy(),e},n.supportNativeMediaPlayback=function(s){n.videoElement==null&&(n.videoElement=window.document.createElement("video"));var e=n.videoElement.canPlayType(s);return e==="probably"||e=="maybe"},n.getFeatureList=function(){var s={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return s.msePlayback=n.supportMSEH264Playback(),s.networkStreamIO=n.supportNetworkStreamIO(),s.networkLoaderName=n.getNetworkLoaderTypeName(),s.mseLivePlayback=s.msePlayback&&s.networkStreamIO,s.mseH265Playback=n.supportMSEH265Playback(),s.nativeMP4H264Playback=n.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),s.nativeMP4H265Playback=n.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),s.nativeWebmVP8Playback=n.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),s.nativeWebmVP9Playback=n.supportNativeMediaPlayback('video/webm; codecs="vp9"'),s},n}(),d=W(2),S=W(6),E=W.n(S),R=W(0),x=W(4),A={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info"},D=W(13),P=W.n(D),I=W(9),c=W(10),m=W(1),_=W(8),o=function(){function n(s,e){if(this.TAG="Transmuxer",this._emitter=new E.a,e.enableWorker&&typeof Worker!="undefined")try{this._worker=P()(18),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[s,e]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},I.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:I.a.getConfig()})}catch(M){R.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new c.a(s,e)}else this._controller=new c.a(s,e);if(this._controller){var h=this._controller;h.on(m.a.IO_ERROR,this._onIOError.bind(this)),h.on(m.a.DEMUX_ERROR,this._onDemuxError.bind(this)),h.on(m.a.INIT_SEGMENT,this._onInitSegment.bind(this)),h.on(m.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),h.on(m.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),h.on(m.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),h.on(m.a.MEDIA_INFO,this._onMediaInfo.bind(this)),h.on(m.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),h.on(m.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),h.on(m.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),h.on(m.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),h.on(m.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),h.on(m.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),h.on(m.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),h.on(m.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),h.on(m.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return n.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),I.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},n.prototype.on=function(s,e){this._emitter.addListener(s,e)},n.prototype.off=function(s,e){this._emitter.removeListener(s,e)},n.prototype.hasWorker=function(){return this._worker!=null},n.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},n.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},n.prototype.seek=function(s){this._worker?this._worker.postMessage({cmd:"seek",param:s}):this._controller.seek(s)},n.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},n.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},n.prototype._onInitSegment=function(s,e){var h=this;Promise.resolve().then(function(){h._emitter.emit(m.a.INIT_SEGMENT,s,e)})},n.prototype._onMediaSegment=function(s,e){var h=this;Promise.resolve().then(function(){h._emitter.emit(m.a.MEDIA_SEGMENT,s,e)})},n.prototype._onLoadingComplete=function(){var s=this;Promise.resolve().then(function(){s._emitter.emit(m.a.LOADING_COMPLETE)})},n.prototype._onRecoveredEarlyEof=function(){var s=this;Promise.resolve().then(function(){s._emitter.emit(m.a.RECOVERED_EARLY_EOF)})},n.prototype._onMediaInfo=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(m.a.MEDIA_INFO,s)})},n.prototype._onMetaDataArrived=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(m.a.METADATA_ARRIVED,s)})},n.prototype._onScriptDataArrived=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(m.a.SCRIPTDATA_ARRIVED,s)})},n.prototype._onTimedID3MetadataArrived=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(m.a.TIMED_ID3_METADATA_ARRIVED,s)})},n.prototype._onSMPTE2038MetadataArrived=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(m.a.SMPTE2038_METADATA_ARRIVED,s)})},n.prototype._onSCTE35MetadataArrived=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(m.a.SCTE35_METADATA_ARRIVED,s)})},n.prototype._onPESPrivateDataDescriptor=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(m.a.PES_PRIVATE_DATA_DESCRIPTOR,s)})},n.prototype._onPESPrivateDataArrived=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(m.a.PES_PRIVATE_DATA_ARRIVED,s)})},n.prototype._onStatisticsInfo=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(m.a.STATISTICS_INFO,s)})},n.prototype._onIOError=function(s,e){var h=this;Promise.resolve().then(function(){h._emitter.emit(m.a.IO_ERROR,s,e)})},n.prototype._onDemuxError=function(s,e){var h=this;Promise.resolve().then(function(){h._emitter.emit(m.a.DEMUX_ERROR,s,e)})},n.prototype._onRecommendSeekpoint=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(m.a.RECOMMEND_SEEKPOINT,s)})},n.prototype._onLoggingConfigChanged=function(s){this._worker&&this._worker.postMessage({cmd:"logging_config",param:s})},n.prototype._onWorkerMessage=function(s){var e=s.data,h=e.data;if(e.msg==="destroyed"||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(e.msg){case m.a.INIT_SEGMENT:case m.a.MEDIA_SEGMENT:this._emitter.emit(e.msg,h.type,h.data);break;case m.a.LOADING_COMPLETE:case m.a.RECOVERED_EARLY_EOF:this._emitter.emit(e.msg);break;case m.a.MEDIA_INFO:Object.setPrototypeOf(h,_.a.prototype),this._emitter.emit(e.msg,h);break;case m.a.METADATA_ARRIVED:case m.a.SCRIPTDATA_ARRIVED:case m.a.TIMED_ID3_METADATA_ARRIVED:case m.a.SMPTE2038_METADATA_ARRIVED:case m.a.SCTE35_METADATA_ARRIVED:case m.a.PES_PRIVATE_DATA_DESCRIPTOR:case m.a.PES_PRIVATE_DATA_ARRIVED:case m.a.STATISTICS_INFO:this._emitter.emit(e.msg,h);break;case m.a.IO_ERROR:case m.a.DEMUX_ERROR:this._emitter.emit(e.msg,h.type,h.info);break;case m.a.RECOMMEND_SEEKPOINT:this._emitter.emit(e.msg,h);break;case"logcat_callback":R.a.emitter.emit("log",h.type,h.logcat)}},n}(),i={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"},t=W(7),r=W(3),l=function(){function n(s){this.TAG="MSEController",this._config=s,this._emitter=new E.a,this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new t.a}return n.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},n.prototype.on=function(s,e){this._emitter.addListener(s,e)},n.prototype.off=function(s,e){this._emitter.removeListener(s,e)},n.prototype.attachMediaElement=function(s){if(this._mediaSource)throw new r.a("MediaSource has been attached to an HTMLMediaElement!");var e=this._mediaSource=new window.MediaSource;e.addEventListener("sourceopen",this.e.onSourceOpen),e.addEventListener("sourceended",this.e.onSourceEnded),e.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=s,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),s.src=this._mediaSourceObjectURL},n.prototype.detachMediaElement=function(){if(this._mediaSource){var s=this._mediaSource;for(var e in this._sourceBuffers){var h=this._pendingSegments[e];h.splice(0,h.length),this._pendingSegments[e]=null,this._pendingRemoveRanges[e]=null,this._lastInitSegments[e]=null;var M=this._sourceBuffers[e];if(M){if(s.readyState!=="closed"){try{s.removeSourceBuffer(M)}catch(T){R.a.e(this.TAG,T.message)}M.removeEventListener("error",this.e.onSourceBufferError),M.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[e]=null,this._sourceBuffers[e]=null}}if(s.readyState==="open")try{s.endOfStream()}catch(T){R.a.e(this.TAG,T.message)}s.removeEventListener("sourceopen",this.e.onSourceOpen),s.removeEventListener("sourceended",this.e.onSourceEnded),s.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},n.prototype.appendInitSegment=function(s,e){if(!this._mediaSource||this._mediaSource.readyState!=="open")return this._pendingSourceBufferInit.push(s),void this._pendingSegments[s.type].push(s);var h=s,M=""+h.container;h.codec&&h.codec.length>0&&(M+=";codecs="+h.codec);var T=!1;if(R.a.v(this.TAG,"Received Initialization Segment, mimeType: "+M),this._lastInitSegments[h.type]=h,M!==this._mimeTypes[h.type]){if(this._mimeTypes[h.type])R.a.v(this.TAG,"Notice: "+h.type+" mimeType changed, origin: "+this._mimeTypes[h.type]+", target: "+M);else{T=!0;try{var B=this._sourceBuffers[h.type]=this._mediaSource.addSourceBuffer(M);B.addEventListener("error",this.e.onSourceBufferError),B.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(N){return R.a.e(this.TAG,N.message),void this._emitter.emit(i.ERROR,{code:N.code,msg:N.message})}}this._mimeTypes[h.type]=M}e||this._pendingSegments[h.type].push(h),T||this._sourceBuffers[h.type]&&!this._sourceBuffers[h.type].updating&&this._doAppendSegments(),x.a.safari&&h.container==="audio/mpeg"&&h.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=h.mediaDuration/1e3,this._updateMediaSourceDuration())},n.prototype.appendMediaSegment=function(s){var e=s;this._pendingSegments[e.type].push(e),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var h=this._sourceBuffers[e.type];!h||h.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},n.prototype.seek=function(s){for(var e in this._sourceBuffers)if(this._sourceBuffers[e]){var h=this._sourceBuffers[e];if(this._mediaSource.readyState==="open")try{h.abort()}catch(z){R.a.e(this.TAG,z.message)}this._idrList.clear();var M=this._pendingSegments[e];if(M.splice(0,M.length),this._mediaSource.readyState!=="closed"){for(var T=0;T<h.buffered.length;T++){var B=h.buffered.start(T),N=h.buffered.end(T);this._pendingRemoveRanges[e].push({start:B,end:N})}if(h.updating||this._doRemoveRanges(),x.a.safari){var j=this._lastInitSegments[e];j&&(this._pendingSegments[e].push(j),h.updating||this._doAppendSegments())}}}},n.prototype.endOfStream=function(){var s=this._mediaSource,e=this._sourceBuffers;s&&s.readyState==="open"?e.video&&e.video.updating||e.audio&&e.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,s.endOfStream()):s&&s.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},n.prototype.getNearestKeyframe=function(s){return this._idrList.getLastSyncPointBeforeDts(s)},n.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var s=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var h=this._sourceBuffers[e];if(h){var M=h.buffered;if(M.length>=1&&s-M.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},n.prototype._doCleanupSourceBuffer=function(){var s=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var h=this._sourceBuffers[e];if(h){for(var M=h.buffered,T=!1,B=0;B<M.length;B++){var N=M.start(B),j=M.end(B);if(N<=s&&s<j+3){if(s-N>=this._config.autoCleanupMaxBackwardDuration){T=!0;var z=s-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[e].push({start:N,end:z})}}else j<s&&(T=!0,this._pendingRemoveRanges[e].push({start:N,end:j}))}T&&!h.updating&&this._doRemoveRanges()}}},n.prototype._updateMediaSourceDuration=function(){var s=this._sourceBuffers;if(this._mediaElement.readyState!==0&&this._mediaSource.readyState==="open"&&!(s.video&&s.video.updating||s.audio&&s.audio.updating)){var e=this._mediaSource.duration,h=this._pendingMediaDuration;h>0&&(isNaN(e)||h>e)&&(R.a.v(this.TAG,"Update MediaSource duration from "+e+" to "+h),this._mediaSource.duration=h),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},n.prototype._doRemoveRanges=function(){for(var s in this._pendingRemoveRanges)if(this._sourceBuffers[s]&&!this._sourceBuffers[s].updating)for(var e=this._sourceBuffers[s],h=this._pendingRemoveRanges[s];h.length&&!e.updating;){var M=h.shift();e.remove(M.start,M.end)}},n.prototype._doAppendSegments=function(){var s=this._pendingSegments;for(var e in s)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating&&s[e].length>0){var h=s[e].shift();if(h.timestampOffset){var M=this._sourceBuffers[e].timestampOffset,T=h.timestampOffset/1e3;Math.abs(M-T)>.1&&(R.a.v(this.TAG,"Update MPEG audio timestampOffset from "+M+" to "+T),this._sourceBuffers[e].timestampOffset=T),delete h.timestampOffset}if(!h.data||h.data.byteLength===0)continue;try{this._sourceBuffers[e].appendBuffer(h.data),this._isBufferFull=!1,e==="video"&&h.hasOwnProperty("info")&&this._idrList.appendArray(h.info.syncPoints)}catch(B){this._pendingSegments[e].unshift(h),B.code===22?(this._isBufferFull||this._emitter.emit(i.BUFFER_FULL),this._isBufferFull=!0):(R.a.e(this.TAG,B.message),this._emitter.emit(i.ERROR,{code:B.code,msg:B.message}))}}},n.prototype._onSourceOpen=function(){if(R.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var s=this._pendingSourceBufferInit;s.length;){var e=s.shift();this.appendInitSegment(e,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(i.SOURCE_OPEN)},n.prototype._onSourceEnded=function(){R.a.v(this.TAG,"MediaSource onSourceEnded")},n.prototype._onSourceClose=function(){R.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},n.prototype._hasPendingSegments=function(){var s=this._pendingSegments;return s.video.length>0||s.audio.length>0},n.prototype._hasPendingRemoveRanges=function(){var s=this._pendingRemoveRanges;return s.video.length>0||s.audio.length>0},n.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(i.UPDATE_END)},n.prototype._onSourceBufferError=function(s){R.a.e(this.TAG,"SourceBuffer Error: "+s)},n}(),p=W(5),u={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},f={NETWORK_EXCEPTION:d.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:d.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:d.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:d.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:p.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:p.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:p.a.CODEC_UNSUPPORTED},L=function(){function n(s,e){this.TAG="MSEPlayer",this._type="MSEPlayer",this._emitter=new E.a,this._config=a(),typeof e=="object"&&Object.assign(this._config,e);var h=s.type.toLowerCase();if(h!=="mse"&&h!=="mpegts"&&h!=="m2ts"&&h!=="flv")throw new r.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");s.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=s,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var M=x.a.chrome&&(x.a.version.major<50||x.a.version.major===50&&x.a.version.build<2661);this._alwaysSeekKeyframe=!!(M||x.a.msedge||x.a.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return n.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},n.prototype.on=function(s,e){var h=this;s===A.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){h._emitter.emit(A.MEDIA_INFO,h.mediaInfo)}):s===A.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){h._emitter.emit(A.STATISTICS_INFO,h.statisticsInfo)}),this._emitter.addListener(s,e)},n.prototype.off=function(s,e){this._emitter.removeListener(s,e)},n.prototype.attachMediaElement=function(s){var e=this;if(this._mediaElement=s,s.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),s.addEventListener("seeking",this.e.onvSeeking),s.addEventListener("canplay",this.e.onvCanPlay),s.addEventListener("stalled",this.e.onvStalled),s.addEventListener("progress",this.e.onvProgress),this._msectl=new l(this._config),this._msectl.on(i.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(i.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(i.SOURCE_OPEN,function(){e._mseSourceOpened=!0,e._hasPendingLoad&&(e._hasPendingLoad=!1,e.load())}),this._msectl.on(i.ERROR,function(h){e._emitter.emit(A.ERROR,u.MEDIA_ERROR,f.MEDIA_MSE_ERROR,h)}),this._msectl.attachMediaElement(s),this._pendingSeekTime!=null)try{s.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(h){}},n.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},n.prototype.load=function(){var s=this;if(!this._mediaElement)throw new r.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new r.a("MSEPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new o(this._mediaDataSource,this._config),this._transmuxer.on(m.a.INIT_SEGMENT,function(e,h){s._msectl.appendInitSegment(h)}),this._transmuxer.on(m.a.MEDIA_SEGMENT,function(e,h){if(s._msectl.appendMediaSegment(h),s._config.lazyLoad&&!s._config.isLive){var M=s._mediaElement.currentTime;h.info.endDts>=1e3*(M+s._config.lazyLoadMaxDuration)&&s._progressChecker==null&&(R.a.v(s.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),s._suspendTransmuxer())}}),this._transmuxer.on(m.a.LOADING_COMPLETE,function(){s._msectl.endOfStream(),s._emitter.emit(A.LOADING_COMPLETE)}),this._transmuxer.on(m.a.RECOVERED_EARLY_EOF,function(){s._emitter.emit(A.RECOVERED_EARLY_EOF)}),this._transmuxer.on(m.a.IO_ERROR,function(e,h){s._emitter.emit(A.ERROR,u.NETWORK_ERROR,e,h)}),this._transmuxer.on(m.a.DEMUX_ERROR,function(e,h){s._emitter.emit(A.ERROR,u.MEDIA_ERROR,e,{code:-1,msg:h})}),this._transmuxer.on(m.a.MEDIA_INFO,function(e){s._mediaInfo=e,s._emitter.emit(A.MEDIA_INFO,Object.assign({},e))}),this._transmuxer.on(m.a.METADATA_ARRIVED,function(e){s._emitter.emit(A.METADATA_ARRIVED,e)}),this._transmuxer.on(m.a.SCRIPTDATA_ARRIVED,function(e){s._emitter.emit(A.SCRIPTDATA_ARRIVED,e)}),this._transmuxer.on(m.a.TIMED_ID3_METADATA_ARRIVED,function(e){s._emitter.emit(A.TIMED_ID3_METADATA_ARRIVED,e)}),this._transmuxer.on(m.a.SMPTE2038_METADATA_ARRIVED,function(e){s._emitter.emit(A.SMPTE2038_METADATA_ARRIVED,e)}),this._transmuxer.on(m.a.SCTE35_METADATA_ARRIVED,function(e){s._emitter.emit(A.SCTE35_METADATA_ARRIVED,e)}),this._transmuxer.on(m.a.PES_PRIVATE_DATA_DESCRIPTOR,function(e){s._emitter.emit(A.PES_PRIVATE_DATA_DESCRIPTOR,e)}),this._transmuxer.on(m.a.PES_PRIVATE_DATA_ARRIVED,function(e){s._emitter.emit(A.PES_PRIVATE_DATA_ARRIVED,e)}),this._transmuxer.on(m.a.STATISTICS_INFO,function(e){s._statisticsInfo=s._fillStatisticsInfo(e),s._emitter.emit(A.STATISTICS_INFO,Object.assign({},s._statisticsInfo))}),this._transmuxer.on(m.a.RECOMMEND_SEEKPOINT,function(e){s._mediaElement&&!s._config.accurateSeek&&(s._requestSetTime=!0,s._mediaElement.currentTime=e/1e3)}),this._transmuxer.open()))},n.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},n.prototype.play=function(){return this._mediaElement.play()},n.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(n.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(s){this._mediaElement.volume=s},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(s){this._mediaElement.muted=s},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(s){this._mediaElement?this._internalSeek(s):this._pendingSeekTime=s},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),n.prototype._fillStatisticsInfo=function(s){if(s.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return s;var e=!0,h=0,M=0;if(this._mediaElement.getVideoPlaybackQuality){var T=this._mediaElement.getVideoPlaybackQuality();h=T.totalVideoFrames,M=T.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(h=this._mediaElement.webkitDecodedFrameCount,M=this._mediaElement.webkitDroppedFrameCount):e=!1;return e&&(s.decodedFrames=h,s.droppedFrames=M),s},n.prototype._onmseUpdateEnd=function(){var s=this._mediaElement.buffered,e=this._mediaElement.currentTime;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&s.length>0&&!this._mediaElement.paused){var h=s.end(s.length-1);if(h>this._config.liveBufferLatencyMaxLatency&&h-e>this._config.liveBufferLatencyMaxLatency){var M=h-this._config.liveBufferLatencyMinRemain;this.currentTime=M}}if(this._config.lazyLoad&&!this._config.isLive){for(var T=0,B=0;B<s.length;B++){var N=s.start(B),j=s.end(B);if(N<=e&&e<j){T=j;break}}T>=e+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(R.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},n.prototype._onmseBufferFull=function(){R.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},n.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},n.prototype._checkProgressAndResume=function(){for(var s=this._mediaElement.currentTime,e=this._mediaElement.buffered,h=!1,M=0;M<e.length;M++){var T=e.start(M),B=e.end(M);if(s>=T&&s<B){s>=B-this._config.lazyLoadRecoverDuration&&(h=!0);break}}h&&(window.clearInterval(this._progressChecker),this._progressChecker=null,h&&(R.a.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},n.prototype._isTimepointBuffered=function(s){for(var e=this._mediaElement.buffered,h=0;h<e.length;h++){var M=e.start(h),T=e.end(h);if(s>=M&&s<T)return!0}return!1},n.prototype._internalSeek=function(s){var e=this._isTimepointBuffered(s),h=!1,M=0;if(s<1&&this._mediaElement.buffered.length>0){var T=this._mediaElement.buffered.start(0);(T<1&&s<T||x.a.safari)&&(h=!0,M=x.a.safari?.1:T)}if(h)this._requestSetTime=!0,this._mediaElement.currentTime=M;else if(e){if(this._alwaysSeekKeyframe){var B=this._msectl.getNearestKeyframe(Math.floor(1e3*s));this._requestSetTime=!0,this._mediaElement.currentTime=B!=null?B.dts/1e3:s}else this._requestSetTime=!0,this._mediaElement.currentTime=s;this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(s),this._transmuxer.seek(Math.floor(1e3*s)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=s)},n.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var s=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(s)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(s),this._transmuxer.seek(Math.floor(1e3*s)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=s))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},n.prototype._checkAndResumeStuckPlayback=function(s){var e=this._mediaElement;if(s||!this._receivedCanPlay||e.readyState<2){var h=e.buffered;h.length>0&&e.currentTime<h.start(0)&&(R.a.w(this.TAG,"Playback seems stuck at "+e.currentTime+", seek to "+h.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=h.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},n.prototype._onvLoadedMetadata=function(s){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},n.prototype._onvSeeking=function(s){var e=this._mediaElement.currentTime,h=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(e<1&&h.length>0){var M=h.start(0);if(M<1&&e<M||x.a.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=x.a.safari?.1:M)}if(this._isTimepointBuffered(e)){if(this._alwaysSeekKeyframe){var T=this._msectl.getNearestKeyframe(Math.floor(1e3*e));T!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=T.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:e,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},n.prototype._onvCanPlay=function(s){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},n.prototype._onvStalled=function(s){this._checkAndResumeStuckPlayback(!0)},n.prototype._onvProgress=function(s){this._checkAndResumeStuckPlayback()},n}(),v=function(){function n(s,e){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new E.a,this._config=a(),typeof e=="object"&&Object.assign(this._config,e);var h=s.type.toLowerCase();if(h==="mse"||h==="mpegts"||h==="m2ts"||h==="flv")throw new r.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(s.hasOwnProperty("segments"))throw new r.b("NativePlayer("+s.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=s,this._mediaElement=null}return n.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},n.prototype.on=function(s,e){var h=this;s===A.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){h._emitter.emit(A.MEDIA_INFO,h.mediaInfo)}):s===A.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){h._emitter.emit(A.STATISTICS_INFO,h.statisticsInfo)}),this._emitter.addListener(s,e)},n.prototype.off=function(s,e){this._emitter.removeListener(s,e)},n.prototype.attachMediaElement=function(s){if(this._mediaElement=s,s.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{s.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}},n.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},n.prototype.load=function(){if(!this._mediaElement)throw new r.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},n.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},n.prototype.play=function(){return this._mediaElement.play()},n.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(n.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(s){this._mediaElement.volume=s},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(s){this._mediaElement.muted=s},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(s){this._mediaElement?this._mediaElement.currentTime=s:this._pendingSeekTime=s},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mediaInfo",{get:function(){var s={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(s.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(s.width=this._mediaElement.videoWidth,s.height=this._mediaElement.videoHeight)),s},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"statisticsInfo",{get:function(){var s={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return s;var e=!0,h=0,M=0;if(this._mediaElement.getVideoPlaybackQuality){var T=this._mediaElement.getVideoPlaybackQuality();h=T.totalVideoFrames,M=T.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(h=this._mediaElement.webkitDecodedFrameCount,M=this._mediaElement.webkitDroppedFrameCount):e=!1;return e&&(s.decodedFrames=h,s.droppedFrames=M),s},enumerable:!1,configurable:!0}),n.prototype._onvLoadedMetadata=function(s){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(A.MEDIA_INFO,this.mediaInfo)},n.prototype._reportStatisticsInfo=function(){this._emitter.emit(A.STATISTICS_INFO,this.statisticsInfo)},n}();O.a.install();var y={createPlayer:function(n,s){var e=n;if(e==null||typeof e!="object")throw new r.b("MediaDataSource must be an javascript object!");if(!e.hasOwnProperty("type"))throw new r.b("MediaDataSource must has type field to indicate video file type!");switch(e.type){case"mse":case"mpegts":case"m2ts":case"flv":return new L(e,s);default:return new v(e,s)}},isSupported:function(){return g.supportMSEH264Playback()},getFeatureList:function(){return g.getFeatureList()}};y.BaseLoader=d.a,y.LoaderStatus=d.c,y.LoaderErrors=d.b,y.Events=A,y.ErrorTypes=u,y.ErrorDetails=f,y.MSEPlayer=L,y.NativePlayer=v,y.LoggingControl=I.a,Object.defineProperty(y,"version",{enumerable:!0,get:function(){return"1.7.2"}}),ee.default=y}])})})(Xt);var Yt=Ot(Xt.exports),Zt={exports:{}};(function(Ge,ze){typeof window!="undefined"&&function(ee,W){Ge.exports=W()}(wt,()=>(()=>{var G={"./src/config.ts":(C,b,a)=>{a.r(b),a.d(b,{enableStreamingMode:()=>s,hlsDefaultConfig:()=>v,mergeConfig:()=>n});var g=a("./src/controller/abr-controller.ts"),d=a("./src/controller/audio-stream-controller.ts"),S=a("./src/controller/audio-track-controller.ts"),E=a("./src/controller/subtitle-stream-controller.ts"),R=a("./src/controller/subtitle-track-controller.ts"),x=a("./src/controller/buffer-controller.ts"),A=a("./src/controller/timeline-controller.ts"),D=a("./src/controller/cap-level-controller.ts"),P=a("./src/controller/fps-controller.ts"),I=a("./src/controller/eme-controller.ts"),c=a("./src/controller/cmcd-controller.ts"),m=a("./src/utils/xhr-loader.ts"),_=a("./src/utils/fetch-loader.ts"),o=a("./src/utils/cues.ts"),i=a("./src/utils/mediakeys-helper.ts"),t=a("./src/utils/logger.ts");function r(){return r=Object.assign?Object.assign.bind():function(e){for(var h=1;h<arguments.length;h++){var M=arguments[h];for(var T in M)Object.prototype.hasOwnProperty.call(M,T)&&(e[T]=M[T])}return e},r.apply(this,arguments)}function l(e,h){var M=Object.keys(e);if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(e);h&&(T=T.filter(function(B){return Object.getOwnPropertyDescriptor(e,B).enumerable})),M.push.apply(M,T)}return M}function p(e){for(var h=1;h<arguments.length;h++){var M=arguments[h]!=null?arguments[h]:{};h%2?l(Object(M),!0).forEach(function(T){u(e,T,M[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(M)):l(Object(M)).forEach(function(T){Object.defineProperty(e,T,Object.getOwnPropertyDescriptor(M,T))})}return e}function u(e,h,M){return h=f(h),h in e?Object.defineProperty(e,h,{value:M,enumerable:!0,configurable:!0,writable:!0}):e[h]=M,e}function f(e){var h=L(e,"string");return typeof h=="symbol"?h:String(h)}function L(e,h){if(typeof e!="object"||e===null)return e;var M=e[Symbol.toPrimitive];if(M!==void 0){var T=M.call(e,h||"default");if(typeof T!="object")return T;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(e)}var v=p(p({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:m.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:g.default,bufferController:x.default,capLevelController:D.default,fpsController:P.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:i.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},y()),{},{subtitleStreamController:E.SubtitleStreamController,subtitleTrackController:R.default,timelineController:A.TimelineController,audioStreamController:d.default,audioTrackController:S.default,emeController:I.default,cmcdController:c.default});function y(){return{cueHandler:o.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function n(e,h){if((h.liveSyncDurationCount||h.liveMaxLatencyDurationCount)&&(h.liveSyncDuration||h.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(h.liveMaxLatencyDurationCount!==void 0&&(h.liveSyncDurationCount===void 0||h.liveMaxLatencyDurationCount<=h.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(h.liveMaxLatencyDuration!==void 0&&(h.liveSyncDuration===void 0||h.liveMaxLatencyDuration<=h.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return r({},e,h)}function s(e){var h=e.loader;if(h!==_.default&&h!==m.default)t.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{var M=(0,_.fetchSupported)();M&&(e.loader=_.default,e.progressive=!0,e.enableSoftwareAES=!0,t.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>m});var g=a("./src/polyfills/number.ts"),d=a("./src/utils/ewma-bandwidth-estimator.ts"),S=a("./src/events.ts"),E=a("./src/errors.ts"),R=a("./src/types/loader.ts"),x=a("./src/utils/logger.ts");function A(_,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(_,P(t.key),t)}}function D(_,o,i){return o&&A(_.prototype,o),i&&A(_,i),Object.defineProperty(_,"prototype",{writable:!1}),_}function P(_){var o=I(_,"string");return typeof o=="symbol"?o:String(o)}function I(_,o){if(typeof _!="object"||_===null)return _;var i=_[Symbol.toPrimitive];if(i!==void 0){var t=i.call(_,o||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(_)}var c=function(){function _(i){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=i;var t=i.config;this.bwEstimator=new d.default(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var o=_.prototype;return o.registerListeners=function(){var t=this.hls;t.on(S.Events.FRAG_LOADING,this.onFragLoading,this),t.on(S.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(S.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(S.Events.ERROR,this.onError,this)},o.unregisterListeners=function(){var t=this.hls;t.off(S.Events.FRAG_LOADING,this.onFragLoading,this),t.off(S.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(S.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(S.Events.ERROR,this.onError,this)},o.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},o.onFragLoading=function(t,r){var l=r.frag;if(l.type===R.PlaylistLevelType.MAIN&&!this.timer){var p;this.fragCurrent=l,this.partCurrent=(p=r.part)!=null?p:null,this.timer=self.setInterval(this.onCheck,100)}},o.onLevelLoaded=function(t,r){var l=this.hls.config;r.details.live?this.bwEstimator.update(l.abrEwmaSlowLive,l.abrEwmaFastLive):this.bwEstimator.update(l.abrEwmaSlowVoD,l.abrEwmaFastVoD)},o._abandonRulesCheck=function(){var t=this.fragCurrent,r=this.partCurrent,l=this.hls,p=l.autoLevelEnabled,u=l.media;if(!(!t||!u)){var f=r?r.stats:t.stats,L=r?r.duration:t.duration;if(f.aborted||f.loaded&&f.loaded===f.total||t.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!p||u.paused||!u.playbackRate||!u.readyState)){var v=l.mainForwardBufferInfo;if(v!==null){var y=performance.now()-f.loading.start,n=Math.abs(u.playbackRate);if(!(y<=500*L/n)){var s=f.loaded&&f.loading.first,e=this.bwEstimator.getEstimate(),h=l.levels,M=l.minAutoLevel,T=h[t.level],B=f.total||Math.max(f.loaded,Math.round(L*T.maxBitrate/8)),N=s?f.loaded*1e3/y:0,j=N?(B-f.loaded)/N:B*8/e,z=v.len/n;if(!(j<=z)){var K=Number.POSITIVE_INFINITY,V;for(V=t.level-1;V>M;V--){var $=h[V].maxBitrate;if(K=N?L*$/(8*.8*N):L*$/e,K<z)break}K>=j||(x.logger.warn("Fragment "+t.sn+(r?" part "+r.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+V+`
      Current BW estimate: `+((0,g.isFiniteNumber)(e)?(e/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+j.toFixed(3)+` s
      Estimated load time for the next fragment: `+K.toFixed(3)+` s
      Time to underbuffer: `+z.toFixed(3)+" s"),l.nextLoadLevel=V,s&&this.bwEstimator.sample(y,f.loaded),this.clearTimer(),(t.loader||t.keyLoader)&&(this.fragCurrent=this.partCurrent=null,t.abortRequests()),l.trigger(S.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:r,stats:f}))}}}}}},o.onFragLoaded=function(t,r){var l=r.frag,p=r.part;if(l.type===R.PlaylistLevelType.MAIN&&(0,g.isFiniteNumber)(l.sn)){var u=p?p.stats:l.stats,f=p?p.duration:l.duration;if(this.clearTimer(),this.lastLoadedFragLevel=l.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var L=this.hls.levels[l.level],v=(L.loaded?L.loaded.bytes:0)+u.loaded,y=(L.loaded?L.loaded.duration:0)+f;L.loaded={bytes:v,duration:y},L.realBitrate=Math.round(8*v/y)}if(l.bitrateTest){var n={stats:u,frag:l,part:p,id:l.type};this.onFragBuffered(S.Events.FRAG_BUFFERED,n)}}},o.onFragBuffered=function(t,r){var l=r.frag,p=r.part,u=p?p.stats:l.stats;if(!u.aborted&&!(l.type!==R.PlaylistLevelType.MAIN||l.sn==="initSegment")){var f=u.parsing.end-u.loading.start;this.bwEstimator.sample(f,u.loaded),u.bwEstimate=this.bwEstimator.getEstimate(),l.bitrateTest?this.bitrateTestDelay=f/1e3:this.bitrateTestDelay=0}},o.onError=function(t,r){var l;if(((l=r.frag)===null||l===void 0?void 0:l.type)===R.PlaylistLevelType.MAIN){if(r.type===E.ErrorTypes.KEY_SYSTEM_ERROR){this.clearTimer();return}switch(r.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer();break}}},o.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},o.getNextABRAutoLevel=function(){var t=this.fragCurrent,r=this.partCurrent,l=this.hls,p=l.maxAutoLevel,u=l.config,f=l.minAutoLevel,L=l.media,v=r?r.duration:t?t.duration:0,y=L&&L.playbackRate!==0?Math.abs(L.playbackRate):1,n=this.bwEstimator?this.bwEstimator.getEstimate():u.abrEwmaDefaultEstimate,s=l.mainForwardBufferInfo,e=(s?s.len:0)/y,h=this.findBestLevel(n,f,p,e,u.abrBandWidthFactor,u.abrBandWidthUpFactor);if(h>=0)return h;x.logger.trace((e?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var M=v?Math.min(v,u.maxStarvationDelay):u.maxStarvationDelay,T=u.abrBandWidthFactor,B=u.abrBandWidthUpFactor;if(!e){var N=this.bitrateTestDelay;if(N){var j=v?Math.min(v,u.maxLoadingDelay):u.maxLoadingDelay;M=j-N,x.logger.trace("bitrate test took "+Math.round(1e3*N)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*M)+" ms"),T=B=1}}return h=this.findBestLevel(n,f,p,e+M,T,B),Math.max(h,0)},o.findBestLevel=function(t,r,l,p,u,f){for(var L,v=this.fragCurrent,y=this.partCurrent,n=this.lastLoadedFragLevel,s=this.hls.levels,e=s[n],h=!!(e!=null&&(L=e.details)!==null&&L!==void 0&&L.live),M=e==null?void 0:e.codecSet,T=y?y.duration:v?v.duration:0,B=l;B>=r;B--){var N=s[B];if(!(!N||M&&N.codecSet!==M)){var j=N.details,z=(y?j==null?void 0:j.partTarget:j==null?void 0:j.averagetargetduration)||T,K=void 0;B<=n?K=u*t:K=f*t;var V=s[B].maxBitrate,$=V*z/K;if(x.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+B+"/"+Math.round(K)+"/"+V+"/"+z+"/"+p+"/"+$),K>V&&($===0||!(0,g.isFiniteNumber)($)||h&&!this.bitrateTestDelay||$<p))return B}}return-1},D(_,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,r=this.bwEstimator;if(t!==-1&&!r.canEstimate())return t;var l=this.getNextABRAutoLevel();return t!==-1&&this.hls.levels[l].loadError?t:(t!==-1&&(l=Math.min(t,l)),l)},set:function(t){this._nextAutoLevel=t}}]),_}();const m=c},"./src/controller/audio-stream-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>u});var g=a("./src/polyfills/number.ts"),d=a("./src/controller/base-stream-controller.ts"),S=a("./src/events.ts"),E=a("./src/utils/buffer-helper.ts"),R=a("./src/controller/fragment-tracker.ts"),x=a("./src/types/level.ts"),A=a("./src/types/loader.ts"),D=a("./src/loader/fragment.ts"),P=a("./src/demux/chunk-cache.ts"),I=a("./src/demux/transmuxer-interface.ts"),c=a("./src/types/transmuxer.ts"),m=a("./src/controller/fragment-finders.ts"),_=a("./src/utils/discontinuities.ts"),o=a("./src/errors.ts");function i(){return i=Object.assign?Object.assign.bind():function(f){for(var L=1;L<arguments.length;L++){var v=arguments[L];for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(f[y]=v[y])}return f},i.apply(this,arguments)}function t(f,L){f.prototype=Object.create(L.prototype),f.prototype.constructor=f,r(f,L)}function r(f,L){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,n){return y.__proto__=n,y},r(f,L)}var l=100,p=function(f){t(L,f);function L(y,n,s){var e;return e=f.call(this,y,n,s,"[audio-stream-controller]")||this,e.videoBuffer=null,e.videoTrackCC=-1,e.waitingVideoCC=-1,e.audioSwitch=!1,e.trackId=-1,e.waitingData=null,e.mainDetails=null,e.bufferFlushed=!1,e.cachedTrackLoadedData=null,e._registerListeners(),e}var v=L.prototype;return v.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},v._registerListeners=function(){var n=this.hls;n.on(S.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(S.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.on(S.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(S.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(S.Events.ERROR,this.onError,this),n.on(S.Events.BUFFER_RESET,this.onBufferReset,this),n.on(S.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(S.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(S.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(S.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var n=this.hls;n.off(S.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(S.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.off(S.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(S.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(S.Events.ERROR,this.onError,this),n.off(S.Events.BUFFER_RESET,this.onBufferReset,this),n.off(S.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(S.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(S.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(S.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onInitPtsFound=function(n,s){var e=s.frag,h=s.id,M=s.initPTS;if(h==="main"){var T=e.cc;this.initPTS[e.cc]=M,this.log("InitPTS for cc: "+T+" found from main: "+M),this.videoTrackCC=T,this.state===d.State.WAITING_INIT_PTS&&this.tick()}},v.startLoad=function(n){if(!this.levels){this.startPosition=n,this.state=d.State.STOPPED;return}var s=this.lastCurrentTime;this.stopLoad(),this.setInterval(l),this.fragLoadError=0,s>0&&n===-1?(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),n=s,this.state=d.State.IDLE):(this.loadedmetadata=!1,this.state=d.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()},v.doTick=function(){switch(this.state){case d.State.IDLE:this.doTickIdle();break;case d.State.WAITING_TRACK:{var n,s=this.levels,e=this.trackId,h=s==null||(n=s[e])===null||n===void 0?void 0:n.details;if(h){if(this.waitForCdnTuneIn(h))break;this.state=d.State.WAITING_INIT_PTS}break}case d.State.FRAG_LOADING_WAITING_RETRY:{var M,T=performance.now(),B=this.retryDate;(!B||T>=B||(M=this.media)!==null&&M!==void 0&&M.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=d.State.IDLE);break}case d.State.WAITING_INIT_PTS:{var N=this.waitingData;if(N){var j=N.frag,z=N.part,K=N.cache,V=N.complete;if(this.initPTS[j.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=d.State.FRAG_LOADING;var $=K.flush(),X={frag:j,part:z,payload:$,networkDetails:null};this._handleFragmentLoadProgress(X),V&&f.prototype._handleFragmentLoadComplete.call(this,X)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+j.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Z=this.getLoadPosition(),q=E.BufferHelper.bufferInfo(this.mediaBuffer,Z,this.config.maxBufferHole),te=(0,m.fragmentWithinToleranceTest)(q.end,this.config.maxFragLookUpTolerance,j);te<0&&(this.log("Waiting fragment cc ("+j.cc+") @ "+j.start+" cancelled because another fragment at "+q.end+" is needed"),this.clearWaitingFragment())}}else this.state=d.State.IDLE}}this.onTickEnd()},v.clearWaitingFragment=function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=d.State.IDLE)},v.resetLoadingState=function(){this.clearWaitingFragment(),f.prototype.resetLoadingState.call(this)},v.onTickEnd=function(){var n=this.media;!n||!n.readyState||(this.lastCurrentTime=n.currentTime)},v.doTickIdle=function(){var n=this.hls,s=this.levels,e=this.media,h=this.trackId,M=n.config;if(!(!s||!s[h])&&!(!e&&(this.startFragRequested||!M.startFragPrefetch))){var T=s[h],B=T.details;if(!B||B.live&&this.levelLastLoaded!==h||this.waitForCdnTuneIn(B)){this.state=d.State.WAITING_TRACK;return}var N=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&N&&(this.bufferFlushed=!1,this.afterBufferFlushed(N,D.ElementaryStreamTypes.AUDIO,A.PlaylistLevelType.AUDIO));var j=this.getFwdBufferInfo(N,A.PlaylistLevelType.AUDIO);if(j!==null){var z=this.audioSwitch;if(!z&&this._streamEnded(j,B)){n.trigger(S.Events.BUFFER_EOS,{type:"audio"}),this.state=d.State.ENDED;return}var K=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,A.PlaylistLevelType.MAIN),V=j.len,$=this.getMaxBufferLength(K==null?void 0:K.len);if(!(V>=$&&!z)){var X=B.fragments,Z=X[0].start,q=j.end;if(z&&e){var te=this.getLoadPosition();q=te,B.PTSKnown&&te<Z&&(j.end>Z||j.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),e.currentTime=Z+.05)}if(!(K&&q>K.end+B.targetduration)&&!((!K||!K.len)&&j.len)){var ue=this.getNextFragment(q,B);if(!ue){this.bufferFlushed=!0;return}this.loadFragment(ue,B,q)}}}}},v.getMaxBufferLength=function(n){var s=f.prototype.getMaxBufferLength.call(this);return n?Math.max(s,n):s},v.onMediaDetaching=function(){this.videoBuffer=null,f.prototype.onMediaDetaching.call(this)},v.onAudioTracksUpdated=function(n,s){var e=s.audioTracks;this.resetTransmuxer(),this.levels=e.map(function(h){return new x.Level(h)})},v.onAudioTrackSwitching=function(n,s){var e=!!s.url;this.trackId=s.id;var h=this.fragCurrent;h&&h.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),e?this.setInterval(l):this.resetTransmuxer(),e?(this.audioSwitch=!0,this.state=d.State.IDLE):this.state=d.State.STOPPED,this.tick()},v.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},v.onLevelLoaded=function(n,s){this.mainDetails=s.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(S.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},v.onAudioTrackLoaded=function(n,s){var e;if(this.mainDetails==null){this.cachedTrackLoadedData=s;return}var h=this.levels,M=s.details,T=s.id;if(!h){this.warn("Audio tracks were reset while loading level "+T);return}this.log("Track "+T+" loaded ["+M.startSN+","+M.endSN+"],duration:"+M.totalduration);var B=h[T],N=0;if(M.live||(e=B.details)!==null&&e!==void 0&&e.live){var j=this.mainDetails;if(M.fragments[0]||(M.deltaUpdateFailed=!0),M.deltaUpdateFailed||!j)return;!B.details&&M.hasProgramDateTime&&j.hasProgramDateTime?((0,_.alignMediaPlaylistByPDT)(M,j),N=M.fragments[0].start):N=this.alignPlaylists(M,B.details)}B.details=M,this.levelLastLoaded=T,!this.startFragRequested&&(this.mainDetails||!M.live)&&this.setStartPosition(B.details,N),this.state===d.State.WAITING_TRACK&&!this.waitForCdnTuneIn(M)&&(this.state=d.State.IDLE),this.tick()},v._handleFragmentLoadProgress=function(n){var s,e=n.frag,h=n.part,M=n.payload,T=this.config,B=this.trackId,N=this.levels;if(!N){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered");return}var j=N[B];console.assert(j,"Audio track is defined on fragment load progress");var z=j.details;console.assert(z,"Audio track details are defined on fragment load progress");var K=T.defaultAudioCodec||j.audioCodec||"mp4a.40.2",V=this.transmuxer;V||(V=this.transmuxer=new I.default(this.hls,A.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var $=this.initPTS[e.cc],X=(s=e.initSegment)===null||s===void 0?void 0:s.data;if($!==void 0){var Z=!1,q=h?h.index:-1,te=q!==-1,ue=new c.ChunkMetadata(e.level,e.sn,e.stats.chunkCount,M.byteLength,q,te);V.push(M,X,K,"",e,h,z.totalduration,Z,ue,$)}else{this.log("Unknown video PTS for cc "+e.cc+", waiting for video PTS before demuxing audio frag "+e.sn+" of ["+z.startSN+" ,"+z.endSN+"],track "+B);var oe=this.waitingData=this.waitingData||{frag:e,part:h,cache:new P.default,complete:!1},le=oe.cache;le.push(new Uint8Array(M)),this.waitingVideoCC=this.videoTrackCC,this.state=d.State.WAITING_INIT_PTS}},v._handleFragmentLoadComplete=function(n){if(this.waitingData){this.waitingData.complete=!0;return}f.prototype._handleFragmentLoadComplete.call(this,n)},v.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},v.onBufferCreated=function(n,s){var e=s.tracks.audio;e&&(this.mediaBuffer=e.buffer||null),s.tracks.video&&(this.videoBuffer=s.tracks.video.buffer||null)},v.onFragBuffered=function(n,s){var e=s.frag,h=s.part;if(e.type!==A.PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&e.type===A.PlaylistLevelType.MAIN){var M;(M=this.videoBuffer||this.media)!==null&&M!==void 0&&M.buffered.length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(e)){this.warn("Fragment "+e.sn+(h?" p: "+h.index:"")+" of level "+e.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}e.sn!=="initSegment"&&(this.fragPrevious=e,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(S.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(e,h)},v.onError=function(n,s){if(s.type===o.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(A.PlaylistLevelType.AUDIO,s);return}switch(s.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.FRAG_PARSING_ERROR:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.AUDIO,s);break;case o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==d.State.ERROR&&this.state!==d.State.STOPPED&&(this.state=s.fatal?d.State.ERROR:d.State.IDLE,this.warn(s.details+" while loading frag, switching to "+this.state+" state"));break;case o.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="audio"&&(this.state===d.State.PARSING||this.state===d.State.PARSED)){var e=!0,h=this.getFwdBufferInfo(this.mediaBuffer,A.PlaylistLevelType.AUDIO);h&&h.len>.5&&(e=!this.reduceMaxBufferLength(h.len)),e&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,f.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},v.onBufferFlushed=function(n,s){var e=s.type;e===D.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===d.State.ENDED&&(this.state=d.State.IDLE))},v._handleTransmuxComplete=function(n){var s,e="audio",h=this.hls,M=n.remuxResult,T=n.chunkMeta,B=this.getCurrentContext(T);if(!B){this.warn("The loading context changed while buffering fragment "+T.sn+" of level "+T.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(T.level);return}var N=B.frag,j=B.part,z=B.level.details,K=M.audio,V=M.text,$=M.id3,X=M.initSegment;if(!(this.fragContextChanged(N)||!z)){if(this.state=d.State.PARSING,this.audioSwitch&&K&&this.completeAudioSwitch(),X!=null&&X.tracks&&(this._bufferInitSegment(X.tracks,N,T),h.trigger(S.Events.FRAG_PARSING_INIT_SEGMENT,{frag:N,id:e,tracks:X.tracks})),K){var Z=K.startPTS,q=K.endPTS,te=K.startDTS,ue=K.endDTS;j&&(j.elementaryStreams[D.ElementaryStreamTypes.AUDIO]={startPTS:Z,endPTS:q,startDTS:te,endDTS:ue}),N.setElementaryStreamInfo(D.ElementaryStreamTypes.AUDIO,Z,q,te,ue),this.bufferFragmentData(K,N,j,T)}if($!=null&&(s=$.samples)!==null&&s!==void 0&&s.length){var oe=i({id:e,frag:N,details:z},$);h.trigger(S.Events.FRAG_PARSING_METADATA,oe)}if(V){var le=i({id:e,frag:N,details:z},V);h.trigger(S.Events.FRAG_PARSING_USERDATA,le)}}},v._bufferInitSegment=function(n,s,e){if(this.state===d.State.PARSING){n.video&&delete n.video;var h=n.audio;if(!!h){h.levelCodec=h.codec,h.id="audio",this.log("Init audio buffer, container:"+h.container+", codecs[parsed]=["+h.codec+"]"),this.hls.trigger(S.Events.BUFFER_CODECS,n);var M=h.initSegment;if(M!=null&&M.byteLength){var T={type:"audio",frag:s,part:null,chunkMeta:e,parent:s.type,data:M};this.hls.trigger(S.Events.BUFFER_APPENDING,T)}this.tick()}}},v.loadFragment=function(n,s,e){var h=this.fragmentTracker.getState(n);this.fragCurrent=n,(this.audioSwitch||h===R.FragmentState.NOT_LOADED||h===R.FragmentState.PARTIAL)&&(n.sn==="initSegment"?this._loadInitSegment(n,s):s.live&&!(0,g.isFiniteNumber)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=d.State.WAITING_INIT_PTS):(this.startFragRequested=!0,f.prototype.loadFragment.call(this,n,s,e)))},v.completeAudioSwitch=function(){var n=this.hls,s=this.media,e=this.trackId;s&&(this.log("Switching audio track : flushing all audio"),f.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,n.trigger(S.Events.AUDIO_TRACK_SWITCHED,{id:e})},L}(d.default);const u=p},"./src/controller/audio-track-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>m});var g=a("./src/events.ts"),d=a("./src/errors.ts"),S=a("./src/controller/base-playlist-controller.ts"),E=a("./src/types/loader.ts");function R(_,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(_,A(t.key),t)}}function x(_,o,i){return o&&R(_.prototype,o),i&&R(_,i),Object.defineProperty(_,"prototype",{writable:!1}),_}function A(_){var o=D(_,"string");return typeof o=="symbol"?o:String(o)}function D(_,o){if(typeof _!="object"||_===null)return _;var i=_[Symbol.toPrimitive];if(i!==void 0){var t=i.call(_,o||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(_)}function P(_,o){_.prototype=Object.create(o.prototype),_.prototype.constructor=_,I(_,o)}function I(_,o){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},I(_,o)}var c=function(_){P(o,_);function o(t){var r;return r=_.call(this,t,"[audio-track-controller]")||this,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.trackName="",r.selectDefaultTrack=!0,r.registerListeners(),r}var i=o.prototype;return i.registerListeners=function(){var r=this.hls;r.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(g.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(g.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(g.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(g.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){var r=this.hls;r.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(g.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(g.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(g.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(g.Events.ERROR,this.onError,this)},i.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,_.prototype.destroy.call(this)},i.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},i.onManifestParsed=function(r,l){this.tracks=l.audioTracks||[]},i.onAudioTrackLoaded=function(r,l){var p=l.id,u=l.details,f=this.tracksInGroup[p];if(!f){this.warn("Invalid audio track id "+p);return}var L=f.details;f.details=l.details,this.log("audioTrack "+p+" loaded ["+u.startSN+"-"+u.endSN+"]"),p===this.trackId&&(this.retryCount=0,this.playlistLoaded(p,l,L))},i.onLevelLoading=function(r,l){this.switchLevel(l.level)},i.onLevelSwitching=function(r,l){this.switchLevel(l.level)},i.switchLevel=function(r){var l=this.hls.levels[r];if(!!(l!=null&&l.audioGroupIds)){var p=l.audioGroupIds[l.urlId];if(this.groupId!==p){this.groupId=p;var u=this.tracks.filter(function(L){return!p||L.groupId===p});this.selectDefaultTrack&&!u.some(function(L){return L.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;var f={audioTracks:u};this.log("Updating audio tracks, "+u.length+' track(s) found in "'+p+'" group-id'),this.hls.trigger(g.Events.AUDIO_TRACKS_UPDATED,f),this.selectInitialTrack()}}},i.onError=function(r,l){_.prototype.onError.call(this,r,l),!(l.fatal||!l.context)&&l.context.type===E.PlaylistContextType.AUDIO_TRACK&&l.context.id===this.trackId&&l.context.groupId===this.groupId&&this.retryLoadingOrFail(l)},i.setAudioTrack=function(r){var l=this.tracksInGroup;if(r<0||r>=l.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var p=l[this.trackId];this.log("Now switching to audio-track index "+r);var u=l[r],f=u.id,L=u.groupId,v=L===void 0?"":L,y=u.name,n=u.type,s=u.url;if(this.trackId=r,this.trackName=y,this.selectDefaultTrack=!1,this.hls.trigger(g.Events.AUDIO_TRACK_SWITCHING,{id:f,groupId:v,name:y,type:n,url:s}),!(u.details&&!u.details.live)){var e=this.switchParams(u.url,p==null?void 0:p.details);this.loadPlaylist(e)}},i.selectInitialTrack=function(){var r=this.tracksInGroup;console.assert(r.length,"Initial audio track should be selected when tracks are known");var l=this.trackName,p=this.findTrackId(l)||this.findTrackId();p!==-1?this.setAudioTrack(p):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(g.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},i.findTrackId=function(r){for(var l=this.tracksInGroup,p=0;p<l.length;p++){var u=l[p];if((!this.selectDefaultTrack||u.default)&&(!r||r===u.name))return u.id}return-1},i.loadPlaylist=function(r){_.prototype.loadPlaylist.call(this);var l=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(l)){var p=l.id,u=l.groupId,f=l.url;if(r)try{f=r.addDirectives(f)}catch(L){this.warn("Could not construct new URL with HLS Delivery Directives: "+L)}this.log("loading audio-track playlist for id: "+p),this.clearTimer(),this.hls.trigger(g.Events.AUDIO_TRACK_LOADING,{url:f,id:p,groupId:u,deliveryDirectives:r||null})}},x(o,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1,this.setAudioTrack(r)}}]),o}(S.default);const m=c},"./src/controller/base-playlist-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>R});var g=a("./src/types/level.ts"),d=a("./src/controller/level-helper.ts"),S=a("./src/utils/logger.ts"),E=a("./src/errors.ts"),R=function(){function x(D,P){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=S.logger.log.bind(S.logger,P+":"),this.warn=S.logger.warn.bind(S.logger,P+":"),this.hls=D}var A=x.prototype;return A.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},A.onError=function(P,I){I.fatal&&(I.type===E.ErrorTypes.NETWORK_ERROR||I.type===E.ErrorTypes.KEY_SYSTEM_ERROR)&&this.stopLoad()},A.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},A.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},A.stopLoad=function(){this.canLoad=!1,this.clearTimer()},A.switchParams=function(P,I){var c=I==null?void 0:I.renditionReports;if(c)for(var m=0;m<c.length;m++){var _=c[m],o=void 0;try{o=new self.URL(_.URI,I.url).href}catch(l){S.logger.warn("Could not construct new URL for Rendition Report: "+l),o=_.URI||""}if(o===P.slice(-o.length)){var i=parseInt(_["LAST-MSN"])||(I==null?void 0:I.lastPartSn),t=parseInt(_["LAST-PART"])||(I==null?void 0:I.lastPartIndex);if(this.hls.config.lowLatencyMode){var r=Math.min(I.age-I.partTarget,I.targetduration);t>=0&&r>I.partTarget&&(t+=1)}return new g.HlsUrlParameters(i,t>=0?t:void 0,g.HlsSkip.No)}}},A.loadPlaylist=function(P){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},A.shouldLoadTrack=function(P){return this.canLoad&&P&&!!P.url&&(!P.details||P.details.live)},A.playlistLoaded=function(P,I,c){var m=this,_=I.details,o=I.stats,i=self.performance.now(),t=o.loading.first?Math.max(0,i-o.loading.first):0;if(_.advancedDateTime=Date.now()-t,_.live||c!=null&&c.live){if(_.reloaded(c),c&&this.log("live playlist "+P+" "+(_.advanced?"REFRESHED "+_.lastPartSn+"-"+_.lastPartIndex:"MISSED")),c&&_.fragments.length>0&&(0,d.mergeDetails)(c,_),!this.canLoad||!_.live)return;var r,l=void 0,p=void 0;if(_.canBlockReload&&_.endSN&&_.advanced){var u=this.hls.config.lowLatencyMode,f=_.lastPartSn,L=_.endSN,v=_.lastPartIndex,y=v!==-1,n=f===L,s=u?0:v;y?(l=n?L+1:f,p=n?s:v+1):l=L+1;var e=_.age,h=e+_.ageHeader,M=Math.min(h-_.partTarget,_.targetduration*1.5);if(M>0){if(c&&M>c.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+c.tuneInGoal+" to: "+M+" with playlist age: "+_.age),M=0;else{var T=Math.floor(M/_.targetduration);if(l+=T,p!==void 0){var B=Math.round(M%_.targetduration/_.partTarget);p+=B}this.log("CDN Tune-in age: "+_.ageHeader+"s last advanced "+e.toFixed(2)+"s goal: "+M+" skip sn "+T+" to part "+p)}_.tuneInGoal=M}if(r=this.getDeliveryDirectives(_,I.deliveryDirectives,l,p),u||!n){this.loadPlaylist(r);return}}else r=this.getDeliveryDirectives(_,I.deliveryDirectives,l,p);var N=this.hls.mainForwardBufferInfo,j=N?N.end-N.len:0,z=(_.edge-j)*1e3,K=(0,d.computeReloadInterval)(_,z);_.updated?i>this.requestScheduled+K&&(this.requestScheduled=o.loading.start):this.requestScheduled=-1,l!==void 0&&_.canBlockReload?this.requestScheduled=o.loading.first+K-(_.partTarget*1e3||1e3):this.requestScheduled=(this.requestScheduled===-1?i:this.requestScheduled)+K;var V=this.requestScheduled-i;V=Math.max(0,V),this.log("reload live playlist "+P+" in "+Math.round(V)+" ms"),this.timer=self.setTimeout(function(){return m.loadPlaylist(r)},V)}else this.clearTimer()},A.getDeliveryDirectives=function(P,I,c,m){var _=(0,g.getSkipValue)(P,c);return I!=null&&I.skip&&P.deltaUpdateFailed&&(c=I.msn,m=I.part,_=g.HlsSkip.No),new g.HlsUrlParameters(c,m,_)},A.retryLoadingOrFail=function(P){var I=this,c=this.hls.config,m=this.retryCount<c.levelLoadingMaxRetry;if(m){var _;if(this.requestScheduled=-1,this.retryCount++,P.details.indexOf("LoadTimeOut")>-1&&(_=P.context)!==null&&_!==void 0&&_.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+P.details+'"'),this.loadPlaylist();else{var o=Math.min(Math.pow(2,this.retryCount)*c.levelLoadingRetryDelay,c.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return I.loadPlaylist()},o),this.warn("retry playlist loading #"+this.retryCount+" in "+o+' ms after "'+P.details+'"')}}else this.warn('cannot recover from error "'+P.details+'"'),this.clearTimer(),P.fatal=!0;return m},x}()},"./src/controller/base-stream-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{State:()=>y,default:()=>n});var g=a("./src/polyfills/number.ts"),d=a("./src/task-loop.ts"),S=a("./src/controller/fragment-tracker.ts"),E=a("./src/utils/buffer-helper.ts"),R=a("./src/utils/logger.ts"),x=a("./src/events.ts"),A=a("./src/errors.ts"),D=a("./src/types/transmuxer.ts"),P=a("./src/utils/mp4-tools.ts"),I=a("./src/utils/discontinuities.ts"),c=a("./src/controller/fragment-finders.ts"),m=a("./src/controller/level-helper.ts"),_=a("./src/loader/fragment-loader.ts"),o=a("./src/crypt/decrypter.ts"),i=a("./src/utils/time-ranges.ts"),t=a("./src/types/loader.ts");function r(s,e){for(var h=0;h<e.length;h++){var M=e[h];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(s,p(M.key),M)}}function l(s,e,h){return e&&r(s.prototype,e),h&&r(s,h),Object.defineProperty(s,"prototype",{writable:!1}),s}function p(s){var e=u(s,"string");return typeof e=="symbol"?e:String(e)}function u(s,e){if(typeof s!="object"||s===null)return s;var h=s[Symbol.toPrimitive];if(h!==void 0){var M=h.call(s,e||"default");if(typeof M!="object")return M;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function f(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function L(s,e){s.prototype=Object.create(e.prototype),s.prototype.constructor=s,v(s,e)}function v(s,e){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(M,T){return M.__proto__=T,M},v(s,e)}var y={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},n=function(s){L(e,s);function e(M,T,B,N){var j;return j=s.call(this)||this,j.hls=void 0,j.fragPrevious=null,j.fragCurrent=null,j.fragmentTracker=void 0,j.transmuxer=null,j._state=y.STOPPED,j.media=null,j.mediaBuffer=null,j.config=void 0,j.bitrateTest=!1,j.lastCurrentTime=0,j.nextLoadPosition=0,j.startPosition=0,j.loadedmetadata=!1,j.fragLoadError=0,j.retryDate=0,j.levels=null,j.fragmentLoader=void 0,j.keyLoader=void 0,j.levelLastLoaded=null,j.startFragRequested=!1,j.decrypter=void 0,j.initPTS=[],j.onvseeking=null,j.onvended=null,j.logPrefix="",j.log=void 0,j.warn=void 0,j.logPrefix=N,j.log=R.logger.log.bind(R.logger,N+":"),j.warn=R.logger.warn.bind(R.logger,N+":"),j.hls=M,j.fragmentLoader=new _.default(M.config),j.keyLoader=B,j.fragmentTracker=T,j.config=M.config,j.decrypter=new o.default(M.config),M.on(x.Events.LEVEL_SWITCHING,j.onLevelSwitching,f(j)),j}var h=e.prototype;return h.doTick=function(){this.onTickEnd()},h.onTickEnd=function(){},h.startLoad=function(T){},h.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var T=this.fragCurrent;T&&(T.abortRequests(),this.fragmentTracker.removeFragment(T)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=y.STOPPED},h._streamEnded=function(T,B){if(B.live||T.nextStart||!T.end||!this.media)return!1;var N=B.partList;if(N!=null&&N.length){var j=N[N.length-1],z=E.BufferHelper.isBuffered(this.media,j.start+j.duration/2);return z}var K=B.fragments[B.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(K)},h.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var T;return(T=this.levels[this.levelLastLoaded])===null||T===void 0?void 0:T.details}},h.onMediaAttached=function(T,B){var N=this.media=this.mediaBuffer=B.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),N.addEventListener("seeking",this.onvseeking),N.addEventListener("ended",this.onvended);var j=this.config;this.levels&&j.autoStartLoad&&this.state===y.STOPPED&&this.startLoad(j.startPosition)},h.onMediaDetaching=function(){var T=this.media;T!=null&&T.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),T&&this.onvseeking&&this.onvended&&(T.removeEventListener("seeking",this.onvseeking),T.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},h.onMediaSeeking=function(){var T=this.config,B=this.fragCurrent,N=this.media,j=this.mediaBuffer,z=this.state,K=N?N.currentTime:0,V=E.BufferHelper.bufferInfo(j||N,K,T.maxBufferHole);if(this.log("media seeking to "+((0,g.isFiniteNumber)(K)?K.toFixed(3):K)+", state: "+z),this.state===y.ENDED)this.resetLoadingState();else if(B){var $=T.maxFragLookUpTolerance,X=B.start-$,Z=B.start+B.duration+$;if(!V.len||Z<V.start||X>V.end){var q=K>Z;(K<X||q)&&(q&&B.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),B.abortRequests()),this.resetLoadingState())}}N&&(this.lastCurrentTime=K),!this.loadedmetadata&&!V.len&&(this.nextLoadPosition=this.startPosition=K),this.tickImmediate()},h.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},h.onLevelSwitching=function(T,B){this.fragLoadError=0},h.onHandlerDestroying=function(){this.stopLoad(),s.prototype.onHandlerDestroying.call(this)},h.onHandlerDestroyed=function(){this.state=y.STOPPED,this.hls.off(x.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},h.loadFragment=function(T,B,N){this._loadFragForPlayback(T,B,N)},h._loadFragForPlayback=function(T,B,N){var j=this,z=function(V){if(j.fragContextChanged(T)){j.warn("Fragment "+T.sn+(V.part?" p: "+V.part.index:"")+" of level "+T.level+" was dropped during download."),j.fragmentTracker.removeFragment(T);return}T.stats.chunkCount++,j._handleFragmentLoadProgress(V)};this._doFragLoad(T,B,N,z).then(function(K){if(!!K){j.fragLoadError=0;var V=j.state;if(j.fragContextChanged(T)){(V===y.FRAG_LOADING||!j.fragCurrent&&V===y.PARSING)&&(j.fragmentTracker.removeFragment(T),j.state=y.IDLE);return}"payload"in K&&(j.log("Loaded fragment "+T.sn+" of level "+T.level),j.hls.trigger(x.Events.FRAG_LOADED,K)),j._handleFragmentLoadComplete(K)}}).catch(function(K){j.state===y.STOPPED||j.state===y.ERROR||(j.warn(K),j.resetFragmentLoading(T))})},h.flushMainBuffer=function(T,B,N){if(N===void 0&&(N=null),!!(T-B)){var j={startOffset:T,endOffset:B,type:N};this.fragLoadError=0,this.hls.trigger(x.Events.BUFFER_FLUSHING,j)}},h._loadInitSegment=function(T,B){var N=this;this._doFragLoad(T,B).then(function(j){if(!j||N.fragContextChanged(T)||!N.levels)throw new Error("init load aborted");return j}).then(function(j){var z=N.hls,K=j.payload,V=T.decryptdata;if(K&&K.byteLength>0&&V&&V.key&&V.iv&&V.method==="AES-128"){var $=self.performance.now();return N.decrypter.decrypt(new Uint8Array(K),V.key.buffer,V.iv.buffer).then(function(X){var Z=self.performance.now();return z.trigger(x.Events.FRAG_DECRYPTED,{frag:T,payload:X,stats:{tstart:$,tdecrypt:Z}}),j.payload=X,j})}return j}).then(function(j){var z=N.fragCurrent,K=N.hls,V=N.levels;if(!V)throw new Error("init load aborted, missing levels");var $=V[T.level].details;console.assert($,"Level details are defined when init segment is loaded");var X=T.stats;N.state=y.IDLE,N.fragLoadError=0,T.data=new Uint8Array(j.payload),X.parsing.start=X.buffering.start=self.performance.now(),X.parsing.end=X.buffering.end=self.performance.now(),j.frag===z&&K.trigger(x.Events.FRAG_BUFFERED,{stats:X,frag:z,part:null,id:T.type}),N.tick()}).catch(function(j){N.state===y.STOPPED||N.state===y.ERROR||(N.warn(j),N.resetFragmentLoading(T))})},h.fragContextChanged=function(T){var B=this.fragCurrent;return!T||!B||T.level!==B.level||T.sn!==B.sn||T.urlId!==B.urlId},h.fragBufferedComplete=function(T,B){var N,j,z,K,V=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+T.type+" sn: "+T.sn+(B?" part: "+B.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+T.level+" (frag:["+((N=T.startPTS)!=null?N:NaN).toFixed(3)+"-"+((j=T.endPTS)!=null?j:NaN).toFixed(3)+"] > buffer:"+(V?i.default.toString(E.BufferHelper.getBuffered(V)):"(detached)")+")"),this.state=y.IDLE,V&&(!this.loadedmetadata&&T.type==t.PlaylistLevelType.MAIN&&V.buffered.length&&((z=this.fragCurrent)===null||z===void 0?void 0:z.sn)===((K=this.fragPrevious)===null||K===void 0?void 0:K.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},h.seekToStartPos=function(){},h._handleFragmentLoadComplete=function(T){var B=this.transmuxer;if(!!B){var N=T.frag,j=T.part,z=T.partsLoaded,K=!z||z.length===0||z.some(function($){return!$}),V=new D.ChunkMetadata(N.level,N.sn,N.stats.chunkCount+1,0,j?j.index:-1,!K);B.flush(V)}},h._handleFragmentLoadProgress=function(T){},h._doFragLoad=function(T,B,N,j){var z,K=this;if(N===void 0&&(N=null),!this.levels)throw new Error("frag load aborted, missing levels");var V=null;if(T.encrypted&&!((z=T.decryptdata)!==null&&z!==void 0&&z.key)?(this.log("Loading key for "+T.sn+" of ["+B.startSN+"-"+B.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+T.level),this.state=y.KEY_LOADING,this.fragCurrent=T,V=this.keyLoader.load(T).then(function(te){if(!K.fragContextChanged(te.frag))return K.hls.trigger(x.Events.KEY_LOADED,te),K.state===y.KEY_LOADING&&(K.state=y.IDLE),te}),this.hls.trigger(x.Events.KEY_LOADING,{frag:T}),this.throwIfFragContextChanged("KEY_LOADING")):!T.encrypted&&B.encryptedFragments.length&&this.keyLoader.loadClear(T,B.encryptedFragments),N=Math.max(T.start,N||0),this.config.lowLatencyMode&&B){var $=B.partList;if($&&j){N>T.end&&B.fragmentHint&&(T=B.fragmentHint);var X=this.getNextPart($,T,N);if(X>-1){var Z=$[X];return this.log("Loading part sn: "+T.sn+" p: "+Z.index+" cc: "+T.cc+" of playlist ["+B.startSN+"-"+B.endSN+"] parts [0-"+X+"-"+($.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+T.level+", target: "+parseFloat(N.toFixed(3))),this.nextLoadPosition=Z.start+Z.duration,this.state=y.FRAG_LOADING,this.hls.trigger(x.Events.FRAG_LOADING,{frag:T,part:$[X],targetBufferTime:N}),this.throwIfFragContextChanged("FRAG_LOADING parts"),V?V.then(function(te){return!te||K.fragContextChanged(te.frag)?null:K.doFragPartsLoad(T,$,X,j)}).catch(function(te){return K.handleFragLoadError(te)}):this.doFragPartsLoad(T,$,X,j).catch(function(te){return K.handleFragLoadError(te)})}else if(!T.url||this.loadedEndOfParts($,N))return Promise.resolve(null)}}this.log("Loading fragment "+T.sn+" cc: "+T.cc+" "+(B?"of ["+B.startSN+"-"+B.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+T.level+", target: "+parseFloat(N.toFixed(3))),(0,g.isFiniteNumber)(T.sn)&&!this.bitrateTest&&(this.nextLoadPosition=T.start+T.duration),this.state=y.FRAG_LOADING,this.hls.trigger(x.Events.FRAG_LOADING,{frag:T,targetBufferTime:N}),this.throwIfFragContextChanged("FRAG_LOADING");var q=this.config.progressive;return q&&V?V.then(function(te){return!te||K.fragContextChanged(te==null?void 0:te.frag)?null:K.fragmentLoader.load(T,j)}).catch(function(te){return K.handleFragLoadError(te)}):Promise.all([this.fragmentLoader.load(T,q?j:void 0),V]).then(function(te){var ue=te[0];return!q&&ue&&j&&j(ue),ue}).catch(function(te){return K.handleFragLoadError(te)})},h.throwIfFragContextChanged=function(T){if(this.fragCurrent===null)throw new Error("frag load aborted, context changed in "+T)},h.doFragPartsLoad=function(T,B,N,j){var z=this;return new Promise(function(K,V){var $=[],X=function Z(q){var te=B[q];z.fragmentLoader.loadPart(T,te,j).then(function(ue){$[te.index]=ue;var oe=ue.part;z.hls.trigger(x.Events.FRAG_LOADED,ue);var le=B[q+1];if(le&&le.fragment===T)Z(q+1);else return K({frag:T,part:oe,partsLoaded:$})}).catch(V)};X(N)})},h.handleFragLoadError=function(T){if("data"in T){var B=T.data;T.data&&B.details===A.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(B.frag,B.part):this.hls.trigger(x.Events.ERROR,B)}else this.hls.trigger(x.Events.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.INTERNAL_EXCEPTION,err:T,fatal:!0});return null},h._handleTransmuxerFlush=function(T){var B=this.getCurrentContext(T);if(!B||this.state!==y.PARSING){!this.fragCurrent&&this.state!==y.STOPPED&&this.state!==y.ERROR&&(this.state=y.IDLE);return}var N=B.frag,j=B.part,z=B.level,K=self.performance.now();N.stats.parsing.end=K,j&&(j.stats.parsing.end=K),this.updateLevelTiming(N,j,z,T.partial)},h.getCurrentContext=function(T){var B=this.levels,N=T.level,j=T.sn,z=T.part;if(!B||!B[N])return this.warn("Levels object was unset while buffering fragment "+j+" of level "+N+". The current chunk will not be buffered."),null;var K=B[N],V=z>-1?(0,m.getPartWith)(K,j,z):null,$=V?V.fragment:(0,m.getFragmentWithSN)(K,j,this.fragCurrent);return $?{frag:$,part:V,level:K}:null},h.bufferFragmentData=function(T,B,N,j){if(!(!T||this.state!==y.PARSING)){var z=T.data1,K=T.data2,V=z;if(z&&K&&(V=(0,P.appendUint8Array)(z,K)),!(!V||!V.length)){var $={type:T.type,frag:B,part:N,chunkMeta:j,parent:B.type,data:V};this.hls.trigger(x.Events.BUFFER_APPENDING,$),T.dropped&&T.independent&&!N&&this.flushBufferGap(B)}}},h.flushBufferGap=function(T){var B=this.media;if(!!B){if(!E.BufferHelper.isBuffered(B,B.currentTime)){this.flushMainBuffer(0,T.start);return}var N=B.currentTime,j=E.BufferHelper.bufferInfo(B,N,0),z=T.duration,K=Math.min(this.config.maxFragLookUpTolerance*2,z*.25),V=Math.max(Math.min(T.start-K,j.end-K),N+K);T.start-V>K&&this.flushMainBuffer(V,T.start)}},h.getFwdBufferInfo=function(T,B){var N=this.config,j=this.getLoadPosition();if(!(0,g.isFiniteNumber)(j))return null;var z=E.BufferHelper.bufferInfo(T,j,N.maxBufferHole);if(z.len===0&&z.nextStart!==void 0){var K=this.fragmentTracker.getBufferedFrag(j,B);if(K&&z.nextStart<K.end)return E.BufferHelper.bufferInfo(T,j,Math.max(z.nextStart,N.maxBufferHole))}return z},h.getMaxBufferLength=function(T){var B=this.config,N;return T?N=Math.max(8*B.maxBufferSize/T,B.maxBufferLength):N=B.maxBufferLength,Math.min(N,B.maxMaxBufferLength)},h.reduceMaxBufferLength=function(T){var B=this.config,N=T||B.maxBufferLength;return B.maxMaxBufferLength>=N?(B.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+B.maxMaxBufferLength+"s"),!0):!1},h.getNextFragment=function(T,B){var N=B.fragments,j=N.length;if(!j)return null;var z=this.config,K=N[0].start,V;if(B.live){var $=z.initialLiveManifestSize;if(j<$)return this.warn("Not enough fragments to start playback (have: "+j+", need: "+$+")"),null;!B.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(V=this.getInitialLiveFragment(B,N),this.startPosition=V?this.hls.liveSyncPosition||V.start:T)}else T<=K&&(V=N[0]);if(!V){var X=z.lowLatencyMode?B.partEnd:B.fragmentEnd;V=this.getFragmentAtPosition(T,X,B)}return this.mapToInitFragWhenRequired(V)},h.mapToInitFragWhenRequired=function(T){return T!=null&&T.initSegment&&!(T!=null&&T.initSegment.data)&&!this.bitrateTest?T.initSegment:T},h.getNextPart=function(T,B,N){for(var j=-1,z=!1,K=!0,V=0,$=T.length;V<$;V++){var X=T[V];if(K=K&&!X.independent,j>-1&&N<X.start)break;var Z=X.loaded;Z?j=-1:(z||X.independent||K)&&X.fragment===B&&(j=V),z=Z}return j},h.loadedEndOfParts=function(T,B){var N=T[T.length-1];return N&&B>N.start&&N.loaded},h.getInitialLiveFragment=function(T,B){var N=this.fragPrevious,j=null;if(N){if(T.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+N.programDateTime),j=(0,c.findFragmentByPDT)(B,N.endProgramDateTime,this.config.maxFragLookUpTolerance)),!j){var z=N.sn+1;if(z>=T.startSN&&z<=T.endSN){var K=B[z-T.startSN];N.cc===K.cc&&(j=K,this.log("Live playlist, switching playlist, load frag with next SN: "+j.sn))}j||(j=(0,c.findFragWithCC)(B,N.cc),j&&this.log("Live playlist, switching playlist, load frag with same CC: "+j.sn))}}else{var V=this.hls.liveSyncPosition;V!==null&&(j=this.getFragmentAtPosition(V,this.bitrateTest?T.fragmentEnd:T.edge,T))}return j},h.getFragmentAtPosition=function(T,B,N){var j=this.config,z=this.fragPrevious,K=N.fragments,V=N.endSN,$=N.fragmentHint,X=j.maxFragLookUpTolerance,Z=!!(j.lowLatencyMode&&N.partList&&$);Z&&$&&!this.bitrateTest&&(K=K.concat($),V=$.sn);var q;if(T<B){var te=T>B-X?0:X;q=(0,c.findFragmentByPTS)(z,K,T,te)}else q=K[K.length-1];if(q){var ue=q.sn-N.startSN;if(this.fragmentTracker.getState(q)===S.FragmentState.OK&&(z=q),z&&q.sn===z.sn&&!Z){var oe=z&&q.level===z.level;if(oe){var le=K[ue+1];q.sn<V&&this.fragmentTracker.getState(le)!==S.FragmentState.OK?(this.log("SN "+q.sn+" just loaded, load next one: "+le.sn),q=le):q=null}}}return q},h.synchronizeToLiveEdge=function(T){var B=this.config,N=this.media;if(!!N){var j=this.hls.liveSyncPosition,z=N.currentTime,K=T.fragments[0].start,V=T.edge,$=z>=K-B.maxFragLookUpTolerance&&z<=V;if(j!==null&&N.duration>j&&(z<j||!$)){var X=B.liveMaxLatencyDuration!==void 0?B.liveMaxLatencyDuration:B.liveMaxLatencyDurationCount*T.targetduration;(!$&&N.readyState<4||z<V-X)&&(this.loadedmetadata||(this.nextLoadPosition=j),N.readyState&&(this.warn("Playback: "+z.toFixed(3)+" is located too far from the end of live sliding playlist: "+V+", reset currentTime to : "+j.toFixed(3)),N.currentTime=j))}}},h.alignPlaylists=function(T,B){var N=this.levels,j=this.levelLastLoaded,z=this.fragPrevious,K=j!==null?N[j]:null,V=T.fragments.length;if(!V)return this.warn("No fragments in live playlist"),0;var $=T.fragments[0].start,X=!B,Z=T.alignedSliding&&(0,g.isFiniteNumber)($);if(X||!Z&&!$){(0,I.alignStream)(z,K,T);var q=T.fragments[0].start;return this.log("Live playlist sliding: "+q.toFixed(2)+" start-sn: "+(B?B.startSN:"na")+"->"+T.startSN+" prev-sn: "+(z?z.sn:"na")+" fragments: "+V),q}return $},h.waitForCdnTuneIn=function(T){var B=3;return T.live&&T.canBlockReload&&T.partTarget&&T.tuneInGoal>Math.max(T.partHoldBack,T.partTarget*B)},h.setStartPosition=function(T,B){var N=this.startPosition;if(N<B&&(N=-1),N===-1||this.lastCurrentTime===-1){var j=T.startTimeOffset;(0,g.isFiniteNumber)(j)?(N=B+j,j<0&&(N+=T.totalduration),N=Math.min(Math.max(B,N),B+T.totalduration),this.log("Start time offset "+j+" found in playlist, adjust startPosition to "+N),this.startPosition=N):T.live?N=this.hls.liveSyncPosition||B:this.startPosition=N=0,this.lastCurrentTime=N}this.nextLoadPosition=N},h.getLoadPosition=function(){var T=this.media,B=0;return this.loadedmetadata&&T?B=T.currentTime:this.nextLoadPosition&&(B=this.nextLoadPosition),B},h.handleFragLoadAborted=function(T,B){this.transmuxer&&T.sn!=="initSegment"&&T.stats.aborted&&(this.warn("Fragment "+T.sn+(B?" part"+B.index:"")+" of level "+T.level+" was aborted"),this.resetFragmentLoading(T))},h.resetFragmentLoading=function(T){(!this.fragCurrent||!this.fragContextChanged(T)&&this.state!==y.FRAG_LOADING_WAITING_RETRY)&&(this.state=y.IDLE)},h.onFragmentOrKeyLoadError=function(T,B){if(B.fatal){this.stopLoad(),this.state=y.ERROR;return}var N=this.config;if(B.chunkMeta){var j=this.getCurrentContext(B.chunkMeta);j&&(B.frag=j.frag,B.levelRetry=!0,this.fragLoadError=N.fragLoadingMaxRetry)}var z=B.frag;if(!(!z||z.type!==T)){var K=this.fragCurrent;if(console.assert(K&&z.sn===K.sn&&z.level===K.level&&z.urlId===K.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=N.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var V=Math.min(Math.pow(2,this.fragLoadError)*N.fragLoadingRetryDelay,N.fragLoadingMaxRetryTimeout);this.warn("Fragment "+z.sn+" of "+T+" "+z.level+" failed to load, retrying in "+V+"ms"),this.retryDate=self.performance.now()+V,this.fragLoadError++,this.state=y.FRAG_LOADING_WAITING_RETRY}else B.levelRetry?(T===t.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=y.IDLE):(R.logger.error(B.details+" reaches max retry, redispatch as fatal ..."),B.fatal=!0,this.hls.stopLoad(),this.state=y.ERROR)}},h.afterBufferFlushed=function(T,B,N){if(!!T){var j=E.BufferHelper.getBuffered(T);this.fragmentTracker.detectEvictedFragments(B,j,N),this.state===y.ENDED&&this.resetLoadingState()}},h.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=y.IDLE},h.resetStartWhenNotLoaded=function(T){if(!this.loadedmetadata){this.startFragRequested=!1;var B=this.levels?this.levels[T].details:null;B!=null&&B.live?(this.startPosition=-1,this.setStartPosition(B,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},h.updateLevelTiming=function(T,B,N,j){var z=this,K=N.details;console.assert(!!K,"level.details must be defined");var V=Object.keys(T.elementaryStreams).reduce(function($,X){var Z=T.elementaryStreams[X];if(Z){var q=Z.endPTS-Z.startPTS;if(q<=0)return z.warn("Could not parse fragment "+T.sn+" "+X+" duration reliably ("+q+")"),$||!1;var te=j?0:(0,m.updateFragPTSDTS)(K,T,Z.startPTS,Z.endPTS,Z.startDTS,Z.endDTS);return z.hls.trigger(x.Events.LEVEL_PTS_UPDATED,{details:K,level:N,drift:te,type:X,frag:T,start:Z.startPTS,end:Z.endPTS}),!0}return $},!1);V||(this.warn("Found no media in fragment "+T.sn+" of level "+N.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=y.PARSED,this.hls.trigger(x.Events.FRAG_PARSED,{frag:T,part:B})},h.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},l(e,[{key:"state",get:function(){return this._state},set:function(T){var B=this._state;B!==T&&(this._state=T,this.log(B+"->"+T))}}]),e}(d.default)},"./src/controller/buffer-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>c});var g=a("./src/polyfills/number.ts"),d=a("./src/events.ts"),S=a("./src/utils/logger.ts"),E=a("./src/errors.ts"),R=a("./src/utils/buffer-helper.ts"),x=a("./src/utils/mediasource-helper.ts"),A=a("./src/loader/fragment.ts"),D=a("./src/controller/buffer-operation-queue.ts"),P=(0,x.getMediaSource)(),I=/([ha]vc.)(?:\.[^.,]+)+/,c=function(){function m(o){var i=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=i.media,r=i.mediaSource;S.logger.log("[buffer-controller]: Media source opened"),t&&(t.removeEventListener("emptied",i._onMediaEmptied),i.updateMediaElementDuration(),i.hls.trigger(d.Events.MEDIA_ATTACHED,{media:t})),r&&r.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},this._onMediaSourceClose=function(){S.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){S.logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var t=i.media,r=i._objectUrl;t&&t.src!==r&&S.logger.error("Media element src was set while attaching MediaSource ("+r+" > "+t.src+")")},this.hls=o,this._initSourceBuffer(),this.registerListeners()}var _=m.prototype;return _.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},_.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},_.registerListeners=function(){var i=this.hls;i.on(d.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(d.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(d.Events.BUFFER_RESET,this.onBufferReset,this),i.on(d.Events.BUFFER_APPENDING,this.onBufferAppending,this),i.on(d.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.on(d.Events.BUFFER_EOS,this.onBufferEos,this),i.on(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(d.Events.LEVEL_UPDATED,this.onLevelUpdated,this),i.on(d.Events.FRAG_PARSED,this.onFragParsed,this),i.on(d.Events.FRAG_CHANGED,this.onFragChanged,this)},_.unregisterListeners=function(){var i=this.hls;i.off(d.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(d.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(d.Events.BUFFER_RESET,this.onBufferReset,this),i.off(d.Events.BUFFER_APPENDING,this.onBufferAppending,this),i.off(d.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.off(d.Events.BUFFER_EOS,this.onBufferEos,this),i.off(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(d.Events.LEVEL_UPDATED,this.onLevelUpdated,this),i.off(d.Events.FRAG_PARSED,this.onFragParsed,this),i.off(d.Events.FRAG_CHANGED,this.onFragChanged,this)},_._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new D.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},_.onManifestParsed=function(i,t){var r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,S.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},_.onMediaAttaching=function(i,t){var r=this.media=t.media;if(r&&P){var l=this.mediaSource=new P;l.addEventListener("sourceopen",this._onMediaSourceOpen),l.addEventListener("sourceended",this._onMediaSourceEnded),l.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(l),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}},_.onMediaDetaching=function(){var i=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(S.logger.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(l){S.logger.warn("[buffer-controller]: onMediaDetaching: "+l.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),i&&(i.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),i.src===r?(i.removeAttribute("src"),i.load()):S.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(d.Events.MEDIA_DETACHED,void 0)},_.onBufferReset=function(){var i=this;this.getSourceBufferTypes().forEach(function(t){var r=i.sourceBuffer[t];try{r&&(i.removeBufferListeners(t),i.mediaSource&&i.mediaSource.removeSourceBuffer(r),i.sourceBuffer[t]=void 0)}catch(l){S.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",l)}}),this._initSourceBuffer()},_.onBufferCodecs=function(i,t){var r=this,l=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(p){if(l){var u=r.tracks[p];if(u&&typeof u.buffer.changeType=="function"){var f=t[p],L=f.id,v=f.codec,y=f.levelCodec,n=f.container,s=f.metadata,e=(u.levelCodec||u.codec).replace(I,"$1"),h=(y||v).replace(I,"$1");if(e!==h){var M=n+";codecs="+(y||v);r.appendChangeType(p,M),S.logger.log("[buffer-controller]: switching codec "+e+" to "+h),r.tracks[p]={buffer:u.buffer,codec:v,container:n,levelCodec:y,metadata:s,id:L}}}}else r.pendingTracks[p]=t[p]}),!l&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},_.appendChangeType=function(i,t){var r=this,l=this.operationQueue,p={execute:function(){var f=r.sourceBuffer[i];f&&(S.logger.log("[buffer-controller]: changing "+i+" sourceBuffer type to "+t),f.changeType(t)),l.shiftAndExecuteNext(i)},onStart:function(){},onComplete:function(){},onError:function(f){S.logger.warn("[buffer-controller]: Failed to change "+i+" SourceBuffer type",f)}};l.append(p,i)},_.onBufferAppending=function(i,t){var r=this,l=this.hls,p=this.operationQueue,u=this.tracks,f=t.data,L=t.type,v=t.frag,y=t.part,n=t.chunkMeta,s=n.buffering[L],e=self.performance.now();s.start=e;var h=v.stats.buffering,M=y?y.stats.buffering:null;h.start===0&&(h.start=e),M&&M.start===0&&(M.start=e);var T=u.audio,B=!1;L==="audio"&&(T==null?void 0:T.container)==="audio/mpeg"&&(B=!this.lastMpegAudioChunk||n.id===1||this.lastMpegAudioChunk.sn!==n.sn,this.lastMpegAudioChunk=n);var N=v.start,j={execute:function(){if(s.executeStart=self.performance.now(),B){var K=r.sourceBuffer[L];if(K){var V=N-K.timestampOffset;Math.abs(V)>=.1&&(S.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+N+" (delta: "+V+") sn: "+v.sn+")"),K.timestampOffset=N)}}r.appendExecutor(f,L)},onStart:function(){},onComplete:function(){var K=self.performance.now();s.executeEnd=s.end=K,h.first===0&&(h.first=K),M&&M.first===0&&(M.first=K);var V=r.sourceBuffer,$={};for(var X in V)$[X]=R.BufferHelper.getBuffered(V[X]);r.appendError=0,r.hls.trigger(d.Events.BUFFER_APPENDED,{type:L,frag:v,part:y,chunkMeta:n,parent:v.type,timeRanges:$})},onError:function(K){S.logger.error("[buffer-controller]: Error encountered while trying to append to the "+L+" SourceBuffer",K);var V={type:E.ErrorTypes.MEDIA_ERROR,parent:v.type,details:E.ErrorDetails.BUFFER_APPEND_ERROR,err:K,fatal:!1};K.code===DOMException.QUOTA_EXCEEDED_ERR?V.details=E.ErrorDetails.BUFFER_FULL_ERROR:(r.appendError++,V.details=E.ErrorDetails.BUFFER_APPEND_ERROR,r.appendError>l.config.appendErrorMaxRetry&&(S.logger.error("[buffer-controller]: Failed "+l.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),V.fatal=!0,l.stopLoad())),l.trigger(d.Events.ERROR,V)}};p.append(j,L)},_.onBufferFlushing=function(i,t){var r=this,l=this.operationQueue,p=function(f){return{execute:r.removeExecutor.bind(r,f,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(d.Events.BUFFER_FLUSHED,{type:f})},onError:function(v){S.logger.warn("[buffer-controller]: Failed to remove from "+f+" SourceBuffer",v)}}};t.type?l.append(p(t.type),t.type):this.getSourceBufferTypes().forEach(function(u){l.append(p(u),u)})},_.onFragParsed=function(i,t){var r=this,l=t.frag,p=t.part,u=[],f=p?p.elementaryStreams:l.elementaryStreams;f[A.ElementaryStreamTypes.AUDIOVIDEO]?u.push("audiovideo"):(f[A.ElementaryStreamTypes.AUDIO]&&u.push("audio"),f[A.ElementaryStreamTypes.VIDEO]&&u.push("video"));var L=function(){var y=self.performance.now();l.stats.buffering.end=y,p&&(p.stats.buffering.end=y);var n=p?p.stats:l.stats;r.hls.trigger(d.Events.FRAG_BUFFERED,{frag:l,part:p,stats:n,id:l.type})};u.length===0&&S.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+l.type+" level: "+l.level+" sn: "+l.sn),this.blockBuffers(L,u)},_.onFragChanged=function(i,t){this.flushBackBuffer()},_.onBufferEos=function(i,t){var r=this,l=this.getSourceBufferTypes().reduce(function(p,u){var f=r.sourceBuffer[u];return f&&(!t.type||t.type===u)&&(f.ending=!0,f.ended||(f.ended=!0,S.logger.log("[buffer-controller]: "+u+" sourceBuffer now EOS"))),p&&!!(!f||f.ended)},!0);l&&(S.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){r.getSourceBufferTypes().forEach(function(u){var f=r.sourceBuffer[u];f&&(f.ending=!1)});var p=r.mediaSource;if(!p||p.readyState!=="open"){p&&S.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+p.readyState);return}S.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),p.endOfStream()}))},_.onLevelUpdated=function(i,t){var r=t.details;!r.fragments.length||(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},_.flushBackBuffer=function(){var i=this.hls,t=this.details,r=this.media,l=this.sourceBuffer;if(!(!r||t===null)){var p=this.getSourceBufferTypes();if(!!p.length){var u=t.live&&i.config.liveBackBufferLength!==null?i.config.liveBackBufferLength:i.config.backBufferLength;if(!(!(0,g.isFiniteNumber)(u)||u<0)){var f=r.currentTime,L=t.levelTargetDuration,v=Math.max(u,L),y=Math.floor(f/L)*L-v;p.forEach(function(n){var s=l[n];if(s){var e=R.BufferHelper.getBuffered(s);if(e.length>0&&y>e.start(0)){if(i.trigger(d.Events.BACK_BUFFER_REACHED,{bufferEnd:y}),t.live)i.trigger(d.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:y});else if(s.ended&&e.end(e.length-1)-f<L*2){S.logger.info("[buffer-controller]: Cannot flush "+n+" back buffer while SourceBuffer is in ended state");return}i.trigger(d.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:y,type:n})}}})}}}},_.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var i=this.details,t=this.hls,r=this.media,l=this.mediaSource,p=i.fragments[0].start+i.totalduration,u=r.duration,f=(0,g.isFiniteNumber)(l.duration)?l.duration:0;i.live&&t.config.liveDurationInfinity?(S.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),l.duration=1/0,this.updateSeekableRange(i)):(p>f&&p>u||!(0,g.isFiniteNumber)(u))&&(S.logger.log("[buffer-controller]: Updating Media Source duration to "+p.toFixed(3)),l.duration=p)}},_.updateSeekableRange=function(i){var t=this.mediaSource,r=i.fragments,l=r.length;if(l&&i.live&&t!==null&&t!==void 0&&t.setLiveSeekableRange){var p=Math.max(0,r[0].start),u=Math.max(p,p+i.totalduration);t.setLiveSeekableRange(p,u)}},_.checkPendingTracks=function(){var i=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,l=Object.keys(r).length;if(l&&!i||l===2){this.createSourceBuffers(r),this.pendingTracks={};var p=this.getSourceBufferTypes();if(p.length===0){this.hls.trigger(d.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}p.forEach(function(u){t.executeNext(u)})}},_.createSourceBuffers=function(i){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var l=0;for(var p in i)if(!t[p]){var u=i[p];if(!u)throw Error("source buffer exists for track "+p+", however track does not");var f=u.levelCodec||u.codec,L=u.container+";codecs="+f;S.logger.log("[buffer-controller]: creating sourceBuffer("+L+")");try{var v=t[p]=r.addSourceBuffer(L),y=p;this.addBufferListener(y,"updatestart",this._onSBUpdateStart),this.addBufferListener(y,"updateend",this._onSBUpdateEnd),this.addBufferListener(y,"error",this._onSBUpdateError),this.tracks[p]={buffer:v,codec:f,container:u.container,levelCodec:u.levelCodec,metadata:u.metadata,id:u.id},l++}catch(n){S.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+n.message),this.hls.trigger(d.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:n,mimeType:L})}}l&&this.hls.trigger(d.Events.BUFFER_CREATED,{tracks:this.tracks})},_._onSBUpdateStart=function(i){var t=this.operationQueue,r=t.current(i);r.onStart()},_._onSBUpdateEnd=function(i){var t=this.operationQueue,r=t.current(i);r.onComplete(),t.shiftAndExecuteNext(i)},_._onSBUpdateError=function(i,t){S.logger.error("[buffer-controller]: "+i+" SourceBuffer error",t),this.hls.trigger(d.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var r=this.operationQueue.current(i);r&&r.onError(t)},_.removeExecutor=function(i,t,r){var l=this.media,p=this.mediaSource,u=this.operationQueue,f=this.sourceBuffer,L=f[i];if(!l||!p||!L){S.logger.warn("[buffer-controller]: Attempting to remove from the "+i+" SourceBuffer, but it does not exist"),u.shiftAndExecuteNext(i);return}var v=(0,g.isFiniteNumber)(l.duration)?l.duration:1/0,y=(0,g.isFiniteNumber)(p.duration)?p.duration:1/0,n=Math.max(0,t),s=Math.min(r,v,y);s>n&&!L.ending?(L.ended=!1,S.logger.log("[buffer-controller]: Removing ["+n+","+s+"] from the "+i+" SourceBuffer"),console.assert(!L.updating,i+" sourceBuffer must not be updating"),L.remove(n,s)):u.shiftAndExecuteNext(i)},_.appendExecutor=function(i,t){var r=this.operationQueue,l=this.sourceBuffer,p=l[t];if(!p){S.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),r.shiftAndExecuteNext(t);return}p.ended=!1,console.assert(!p.updating,t+" sourceBuffer must not be updating"),p.appendBuffer(i)},_.blockBuffers=function(i,t){var r=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length){S.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(i);return}var l=this.operationQueue,p=t.map(function(u){return l.appendBlocker(u)});Promise.all(p).then(function(){i(),t.forEach(function(u){var f=r.sourceBuffer[u];(!f||!f.updating)&&l.shiftAndExecuteNext(u)})})},_.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},_.addBufferListener=function(i,t,r){var l=this.sourceBuffer[i];if(!!l){var p=r.bind(this,i);this.listeners[i].push({event:t,listener:p}),l.addEventListener(t,p)}},_.removeBufferListeners=function(i){var t=this.sourceBuffer[i];!t||this.listeners[i].forEach(function(r){t.removeEventListener(r.event,r.listener)})},m}()},"./src/controller/buffer-operation-queue.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>d});var g=a("./src/utils/logger.ts"),d=function(){function S(R){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=R}var E=S.prototype;return E.append=function(x,A){var D=this.queues[A];D.push(x),D.length===1&&this.buffers[A]&&this.executeNext(A)},E.insertAbort=function(x,A){var D=this.queues[A];D.unshift(x),this.executeNext(A)},E.appendBlocker=function(x){var A,D=new Promise(function(I){A=I}),P={execute:A,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(P,x),D},E.executeNext=function(x){var A=this.buffers,D=this.queues,P=A[x],I=D[x];if(I.length){var c=I[0];try{c.execute()}catch(m){g.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),c.onError(m),(!P||!P.updating)&&(I.shift(),this.executeNext(x))}}},E.shiftAndExecuteNext=function(x){this.queues[x].shift(),this.executeNext(x)},E.current=function(x){return this.queues[x][0]},S}()},"./src/controller/cap-level-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>A});var g=a("./src/events.ts");function d(D,P){for(var I=0;I<P.length;I++){var c=P[I];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(D,E(c.key),c)}}function S(D,P,I){return P&&d(D.prototype,P),I&&d(D,I),Object.defineProperty(D,"prototype",{writable:!1}),D}function E(D){var P=R(D,"string");return typeof P=="symbol"?P:String(P)}function R(D,P){if(typeof D!="object"||D===null)return D;var I=D[Symbol.toPrimitive];if(I!==void 0){var c=I.call(D,P||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(P==="string"?String:Number)(D)}var x=function(){function D(I){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=I,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var P=D.prototype;return P.setStreamController=function(c){this.streamController=c},P.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},P.registerListeners=function(){var c=this.hls;c.on(g.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),c.on(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.on(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.on(g.Events.BUFFER_CODECS,this.onBufferCodecs,this),c.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},P.unregisterListener=function(){var c=this.hls;c.off(g.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),c.off(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.off(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.off(g.Events.BUFFER_CODECS,this.onBufferCodecs,this),c.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},P.onFpsDropLevelCapping=function(c,m){D.isLevelAllowed(m.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(m.droppedLevel)},P.onMediaAttaching=function(c,m){this.media=m.media instanceof HTMLVideoElement?m.media:null,this.clientRect=null},P.onManifestParsed=function(c,m){var _=this.hls;this.restrictedLevels=[],this.firstLevel=m.firstLevel,_.config.capLevelToPlayerSize&&m.video&&this.startCapping()},P.onBufferCodecs=function(c,m){var _=this.hls;_.config.capLevelToPlayerSize&&m.video&&this.startCapping()},P.onMediaDetaching=function(){this.stopCapping()},P.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var c=this.hls.levels;if(c.length){var m=this.hls;m.autoLevelCapping=this.getMaxLevel(c.length-1),m.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=m.autoLevelCapping}}},P.getMaxLevel=function(c){var m=this,_=this.hls.levels;if(!_.length)return-1;var o=_.filter(function(i,t){return D.isLevelAllowed(t,m.restrictedLevels)&&t<=c});return this.clientRect=null,D.getMaxLevelByMediaSize(o,this.mediaWidth,this.mediaHeight)},P.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},P.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},P.getDimensions=function(){if(this.clientRect)return this.clientRect;var c=this.media,m={width:0,height:0};if(c){var _=c.getBoundingClientRect();m.width=_.width,m.height=_.height,!m.width&&!m.height&&(m.width=_.right-_.left||c.width||0,m.height=_.bottom-_.top||c.height||0)}return this.clientRect=m,m},D.isLevelAllowed=function(c,m){return m===void 0&&(m=[]),m.indexOf(c)===-1},D.getMaxLevelByMediaSize=function(c,m,_){if(!c||!c.length)return-1;for(var o=function(p,u){return u?p.width!==u.width||p.height!==u.height:!0},i=c.length-1,t=0;t<c.length;t+=1){var r=c[t];if((r.width>=m||r.height>=_)&&o(r,c[t+1])){i=t;break}}return i},S(D,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var c=1;if(!this.hls.config.ignoreDevicePixelRatio)try{c=self.devicePixelRatio}catch(m){}return c}}]),D}();const A=x},"./src/controller/cmcd-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>_});var g=a("./src/events.ts"),d=a("./src/types/cmcd.ts"),S=a("./src/utils/buffer-helper.ts"),E=a("./src/utils/logger.ts");function R(o,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,A(r.key),r)}}function x(o,i,t){return i&&R(o.prototype,i),t&&R(o,t),Object.defineProperty(o,"prototype",{writable:!1}),o}function A(o){var i=D(o,"string");return typeof i=="symbol"?i:String(i)}function D(o,i){if(typeof o!="object"||o===null)return o;var t=o[Symbol.toPrimitive];if(t!==void 0){var r=t.call(o,i||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(o)}function P(o,i){var t=typeof Symbol!="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(t)return(t=t.call(o)).next.bind(t);if(Array.isArray(o)||(t=I(o))||i&&o&&typeof o.length=="number"){t&&(o=t);var r=0;return function(){return r>=o.length?{done:!0}:{done:!1,value:o[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function I(o,i){if(!!o){if(typeof o=="string")return c(o,i);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return c(o,i)}}function c(o,i){(i==null||i>o.length)&&(i=o.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=o[t];return r}function m(){return m=Object.assign?Object.assign.bind():function(o){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(o[r]=t[r])}return o},m.apply(this,arguments)}var _=function(){function o(t){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(u){try{r.apply(u,{ot:d.CMCDObjectType.MANIFEST,su:!r.initialized})}catch(f){E.logger.warn("Could not generate manifest CMCD data.",f)}},this.applyFragmentData=function(u){try{var f=u.frag,L=r.hls.levels[f.level],v=r.getObjectType(f),y={d:f.duration*1e3,ot:v};(v===d.CMCDObjectType.VIDEO||v===d.CMCDObjectType.AUDIO||v==d.CMCDObjectType.MUXED)&&(y.br=L.bitrate/1e3,y.tb=r.getTopBandwidth(v)/1e3,y.bl=r.getBufferLength(v)),r.apply(u,y)}catch(n){E.logger.warn("Could not generate segment CMCD data.",n)}},this.hls=t;var l=this.config=t.config,p=l.cmcd;p!=null&&(l.pLoader=this.createPlaylistLoader(),l.fLoader=this.createFragmentLoader(),this.sid=p.sessionId||o.uuid(),this.cid=p.contentId,this.useHeaders=p.useHeaders===!0,this.registerListeners())}var i=o.prototype;return i.registerListeners=function(){var r=this.hls;r.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(g.Events.MEDIA_DETACHED,this.onMediaDetached,this),r.on(g.Events.BUFFER_CREATED,this.onBufferCreated,this)},i.unregisterListeners=function(){var r=this.hls;r.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(g.Events.MEDIA_DETACHED,this.onMediaDetached,this),r.off(g.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},i.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},i.onMediaAttached=function(r,l){this.media=l.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},i.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},i.onBufferCreated=function(r,l){var p,u;this.audioBuffer=(p=l.tracks.audio)===null||p===void 0?void 0:p.buffer,this.videoBuffer=(u=l.tracks.video)===null||u===void 0?void 0:u.buffer},i.createData=function(){var r;return{v:d.CMCDVersion,sf:d.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(r=this.media)===null||r===void 0?void 0:r.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},i.apply=function(r,l){l===void 0&&(l={}),m(l,this.createData());var p=l.ot===d.CMCDObjectType.INIT||l.ot===d.CMCDObjectType.VIDEO||l.ot===d.CMCDObjectType.MUXED;if(this.starved&&p&&(l.bs=!0,l.su=!0,this.starved=!1),l.su==null&&(l.su=this.buffering),this.useHeaders){var u=o.toHeaders(l);if(!Object.keys(u).length)return;r.headers||(r.headers={}),m(r.headers,u)}else{var f=o.toQuery(l);if(!f)return;r.url=o.appendQueryToUri(r.url,f)}},i.getObjectType=function(r){var l=r.type;if(l==="subtitle")return d.CMCDObjectType.TIMED_TEXT;if(r.sn==="initSegment")return d.CMCDObjectType.INIT;if(l==="audio")return d.CMCDObjectType.AUDIO;if(l==="main")return this.hls.audioTracks.length?d.CMCDObjectType.VIDEO:d.CMCDObjectType.MUXED},i.getTopBandwidth=function(r){var l=0,p,u=this.hls;if(r===d.CMCDObjectType.AUDIO)p=u.audioTracks;else{var f=u.maxAutoLevel,L=f>-1?f+1:u.levels.length;p=u.levels.slice(0,L)}for(var v=P(p),y;!(y=v()).done;){var n=y.value;n.bitrate>l&&(l=n.bitrate)}return l>0?l:NaN},i.getBufferLength=function(r){var l=this.hls.media,p=r===d.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!p||!l)return NaN;var u=S.BufferHelper.bufferInfo(p,l.currentTime,this.config.maxBufferHole);return u.len*1e3},i.createPlaylistLoader=function(){var r=this.config.pLoader,l=this.applyPlaylistData,p=r||this.config.loader;return function(){function u(L){this.loader=void 0,this.loader=new p(L)}var f=u.prototype;return f.destroy=function(){this.loader.destroy()},f.abort=function(){this.loader.abort()},f.load=function(v,y,n){l(v),this.loader.load(v,y,n)},x(u,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),u}()},i.createFragmentLoader=function(){var r=this.config.fLoader,l=this.applyFragmentData,p=r||this.config.loader;return function(){function u(L){this.loader=void 0,this.loader=new p(L)}var f=u.prototype;return f.destroy=function(){this.loader.destroy()},f.abort=function(){this.loader.abort()},f.load=function(v,y,n){l(v),this.loader.load(v,y,n)},x(u,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),u}()},o.uuid=function(){var r=URL.createObjectURL(new Blob),l=r.toString();return URL.revokeObjectURL(r),l.slice(l.lastIndexOf("/")+1)},o.serialize=function(r){for(var l=[],p=function(j){return!Number.isNaN(j)&&j!=null&&j!==""&&j!==!1},u=function(j){return Math.round(j)},f=function(j){return u(j/100)*100},L=function(j){return encodeURIComponent(j)},v={br:u,d:u,bl:f,dl:f,mtp:f,nor:L,rtp:f,tb:u},y=Object.keys(r||{}).sort(),n=P(y),s;!(s=n()).done;){var e=s.value,h=r[e];if(!!p(h)&&!(e==="v"&&h===1)&&!(e=="pr"&&h===1)){var M=v[e];M&&(h=M(h));var T=typeof h,B=void 0;e==="ot"||e==="sf"||e==="st"?B=e+"="+h:T==="boolean"?B=e:T==="number"?B=e+"="+h:B=e+"="+JSON.stringify(h),l.push(B)}}return l.join(",")},o.toHeaders=function(r){for(var l=Object.keys(r),p={},u=["Object","Request","Session","Status"],f=[{},{},{},{}],L={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},v=0,y=l;v<y.length;v++){var n=y[v],s=L[n]!=null?L[n]:1;f[s][n]=r[n]}for(var e=0;e<f.length;e++){var h=o.serialize(f[e]);h&&(p["CMCD-"+u[e]]=h)}return p},o.toQuery=function(r){return"CMCD="+encodeURIComponent(o.serialize(r))},o.appendQueryToUri=function(r,l){if(!l)return r;var p=r.includes("?")?"&":"?";return""+r+p+l},o}()},"./src/controller/eme-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>v});var g=a("./src/events.ts"),d=a("./src/errors.ts"),S=a("./src/utils/logger.ts"),E=a("./src/utils/mediakeys-helper.ts"),R=a("./src/utils/keysystem-util.ts"),x=a("./src/utils/numeric-encoding-utils.ts"),A=a("./src/loader/level-key.ts"),D=a("./src/utils/hex.ts"),P=a("./src/utils/mp4-tools.ts"),I=a("./node_modules/eventemitter3/index.js"),c=a.n(I);function m(y,n){y.prototype=Object.create(n.prototype),y.prototype.constructor=y,r(y,n)}function _(y){var n=typeof Map=="function"?new Map:void 0;return _=function(e){if(e===null||!t(e))return e;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n!="undefined"){if(n.has(e))return n.get(e);n.set(e,h)}function h(){return o(e,arguments,l(this).constructor)}return h.prototype=Object.create(e.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),r(h,e)},_(y)}function o(y,n,s){return i()?o=Reflect.construct.bind():o=function(h,M,T){var B=[null];B.push.apply(B,M);var N=Function.bind.apply(h,B),j=new N;return T&&r(j,T.prototype),j},o.apply(null,arguments)}function i(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(y){return!1}}function t(y){return Function.toString.call(y).indexOf("[native code]")!==-1}function r(y,n){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,h){return e.__proto__=h,e},r(y,n)}function l(y){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},l(y)}var p=3,u="[eme]",f=function(){function y(s){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=y.CDMCleanupPromise?[y.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=S.logger.debug.bind(S.logger,u),this.log=S.logger.log.bind(S.logger,u),this.warn=S.logger.warn.bind(S.logger,u),this.error=S.logger.error.bind(S.logger,u),this.hls=s,this.config=s.config,this.registerListeners()}var n=y.prototype;return n.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},n.registerListeners=function(){this.hls.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(g.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},n.unregisterListeners=function(){this.hls.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(g.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},n.getLicenseServerUrl=function(e){var h=this.config,M=h.drmSystems,T=h.widevineLicenseUrl,B=M[e];if(B)return B.licenseUrl;if(e===E.KeySystems.WIDEVINE&&T)return T;throw new Error('no license server URL configured for key-system "'+e+'"')},n.getServerCertificateUrl=function(e){var h=this.config.drmSystems,M=h[e];if(M)return M.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},n.attemptKeySystemAccess=function(e){var h=this,M=this.hls.levels,T=function(z,K,V){return!!z&&V.indexOf(z)===K},B=M.map(function(j){return j.audioCodec}).filter(T),N=M.map(function(j){return j.videoCodec}).filter(T);return B.length+N.length===0&&N.push("avc1.42e01e"),new Promise(function(j,z){var K=function V($){var X=$.shift();h.getMediaKeysPromise(X,B,N).then(function(Z){return j({keySystem:X,mediaKeys:Z})}).catch(function(Z){$.length?V($):Z instanceof L?z(Z):z(new L({type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:Z,fatal:!0},Z.message))})};K(e)})},n.requestMediaKeySystemAccess=function(e,h){var M=this.config.requestMediaKeySystemAccessFunc;if(typeof M!="function"){var T="Configured requestMediaKeySystemAccess is not a function "+M;return E.requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(T="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(T))}return M(e,h)},n.getMediaKeysPromise=function(e,h,M){var T=this,B=(0,E.getSupportedMediaKeySystemConfigurations)(e,h,M,this.config.drmSystemOptions),N=this.keySystemAccessPromises[e],j=N==null?void 0:N.keySystemAccess;if(!j){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(B)),j=this.requestMediaKeySystemAccess(e,B);var z=this.keySystemAccessPromises[e]={keySystemAccess:j};return j.catch(function(K){T.log('Failed to obtain access to key-system "'+e+'": '+K)}),j.then(function(K){T.log('Access for key-system "'+K.keySystem+'" obtained');var V=T.fetchServerCertificate(e);return T.log('Create media-keys for "'+e+'"'),z.mediaKeys=K.createMediaKeys().then(function($){return T.log('Media-keys created for "'+e+'"'),V.then(function(X){return X?T.setMediaKeysServerCertificate($,e,X):$})}),z.mediaKeys.catch(function($){T.error('Failed to create media-keys for "'+e+'"}: '+$)}),z.mediaKeys})}return j.then(function(){return N.mediaKeys})},n.createMediaKeySessionContext=function(e){var h=e.decryptdata,M=e.keySystem,T=e.mediaKeys;console.assert(!!T,"mediaKeys is defined"),this.log('Creating key-system session "'+M+'" keyId: '+D.default.hexDump(h.keyId||[]));var B=T.createSession(),N={decryptdata:h,keySystem:M,mediaKeys:T,mediaKeysSession:B,keyStatus:"status-pending"};return this.mediaKeySessions.push(N),N},n.renewKeySession=function(e){var h=e.decryptdata;if(h.pssh){var M=this.createMediaKeySessionContext(e),T=this.getKeyIdString(h),B="cenc";this.keyIdToKeySessionPromise[T]=this.generateRequestWithPreferredKeySession(M,B,h.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},n.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return D.default.hexDump(e.keyId)},n.updateKeySession=function(e,h){var M,T=e.mediaKeysSession;return this.log('Updating key-session "'+T.sessionId+'" for keyID '+D.default.hexDump(((M=e.decryptdata)===null||M===void 0?void 0:M.keyId)||[])+`
      } (data length: `+(h&&h.byteLength)+")"),T.update(h)},n.selectKeySystemFormat=function(e){var h=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+h.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(h)),this.keyFormatPromise},n.getKeyFormatPromise=function(e){var h=this;return new Promise(function(M,T){var B=(0,E.getKeySystemsForConfig)(h.config),N=e.map(E.keySystemFormatToKeySystemDomain).filter(function(j){return!!j&&B.indexOf(j)!==-1});return h.getKeySystemSelectionPromise(N).then(function(j){var z=j.keySystem,K=(0,E.keySystemDomainToKeySystemFormat)(z);K?M(K):T(new Error('Unable to find format for key-system "'+z+'"'))}).catch(T)})},n.loadKey=function(e){var h=this,M=e.keyInfo.decryptdata,T=this.getKeyIdString(M),B="(keyId: "+T+' format: "'+M.keyFormat+'" method: '+M.method+" uri: "+M.uri+")";this.log("Starting session for key "+B);var N=this.keyIdToKeySessionPromise[T];return N||(N=this.keyIdToKeySessionPromise[T]=this.getKeySystemForKeyPromise(M).then(function(j){var z=j.keySystem,K=j.mediaKeys;return h.throwIfDestroyed(),h.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+B),h.attemptSetMediaKeys(z,K).then(function(){h.throwIfDestroyed();var V=h.createMediaKeySessionContext({keySystem:z,mediaKeys:K,decryptdata:M}),$="cenc";return h.generateRequestWithPreferredKeySession(V,$,M.pssh,"playlist-key")})}),N.catch(function(j){return h.handleError(j)})),N},n.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},n.handleError=function(e){!this.hls||(this.error(e.message),e instanceof L?this.hls.trigger(g.Events.ERROR,e.data):this.hls.trigger(g.Events.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},n.getKeySystemForKeyPromise=function(e){var h=this.getKeyIdString(e),M=this.keyIdToKeySessionPromise[h];if(!M){var T=(0,E.keySystemFormatToKeySystemDomain)(e.keyFormat),B=T?[T]:(0,E.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(B)}return M},n.getKeySystemSelectionPromise=function(e){if(e.length||(e=(0,E.getKeySystemsForConfig)(this.config)),e.length===0)throw new L({type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},n._onMediaEncrypted=function(e){var h=this,M=e.initDataType,T=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+M+'"'),T!==null){var B,N;if(M==="sinf"&&this.config.drmSystems[E.KeySystems.FAIRPLAY]){var j=(0,P.bin2str)(new Uint8Array(T));try{var z=(0,x.base64Decode)(JSON.parse(j).sinf),K=(0,P.parseSinf)(new Uint8Array(z));if(!K)return;B=K.subarray(8,24),N=E.KeySystems.FAIRPLAY}catch(le){this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{var V=(0,P.parsePssh)(T);if(V===null)return;V.version===0&&V.systemId===E.KeySystemIds.WIDEVINE&&V.data&&(B=V.data.subarray(8,24)),N=(0,E.keySystemIdToKeySystemDomain)(V.systemId)}if(!(!N||!B)){for(var $=D.default.hexDump(B),X=this.keyIdToKeySessionPromise,Z=this.mediaKeySessions,q=X[$],te=function(me){var _e=Z[me],ve=_e.decryptdata;if(ve.pssh||!ve.keyId)return"continue";var ce=D.default.hexDump(ve.keyId);if($===ce||ve.uri.replace(/-/g,"").indexOf($)!==-1)return q=X[ce],delete X[ce],ve.pssh=new Uint8Array(T),ve.keyId=B,q=X[$]=q.then(function(){return h.generateRequestWithPreferredKeySession(_e,M,T,"encrypted-event-key-match")}),"break"},ue=0;ue<Z.length;ue++){var oe=te(ue);if(oe!=="continue"&&oe==="break")break}q||(q=X[$]=this.getKeySystemSelectionPromise([N]).then(function(le){var me,_e=le.keySystem,ve=le.mediaKeys;h.throwIfDestroyed();var ce=new A.LevelKey("ISO-23001-7",$,(me=(0,E.keySystemDomainToKeySystemFormat)(_e))!=null?me:"");return ce.pssh=new Uint8Array(T),ce.keyId=B,h.attemptSetMediaKeys(_e,ve).then(function(){h.throwIfDestroyed();var he=h.createMediaKeySessionContext({decryptdata:ce,keySystem:_e,mediaKeys:ve});return h.generateRequestWithPreferredKeySession(he,M,T,"encrypted-event-no-match")})})),q.catch(function(le){return h.handleError(le)})}}},n._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},n.attemptSetMediaKeys=function(e,h){var M=this,T=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var B=Promise.all(T).then(function(){if(!M.media)throw new Error("Attempted to set mediaKeys without media element attached");return M.media.setMediaKeys(h)});return this.setMediaKeysQueue.push(B),B.then(function(){M.log('Media-keys set for "'+e+'"'),T.push(B),M.setMediaKeysQueue=M.setMediaKeysQueue.filter(function(N){return T.indexOf(N)===-1})})},n.generateRequestWithPreferredKeySession=function(e,h,M,T){var B,N,j=this,z=(B=this.config.drmSystems)===null||B===void 0||(N=B[e.keySystem])===null||N===void 0?void 0:N.generateRequest;if(z)try{var K=z.call(this.hls,h,M,e);if(!K)throw new Error("Invalid response from configured generateRequest filter");h=K.initDataType,M=e.decryptdata.pssh=K.initData?new Uint8Array(K.initData):null}catch(q){var V;if(this.warn(q.message),(V=this.hls)!==null&&V!==void 0&&V.config.debug)throw q}if(M===null)return this.log('Skipping key-session request for "'+T+'" (no initData)'),Promise.resolve(e);var $=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+T+'": '+$+" (init data type: "+h+" length: "+(M?M.byteLength:null)+")");var X=new(c());e.mediaKeysSession.onmessage=function(q){var te=e.mediaKeysSession;if(!te){X.emit("error",new Error("invalid state"));return}var ue=q.messageType,oe=q.message;j.log('"'+ue+'" message event for session "'+te.sessionId+'" message size: '+oe.byteLength),ue==="license-request"||ue==="license-renewal"?j.renewLicense(e,oe).catch(function(le){j.handleError(le),X.emit("error",le)}):ue==="license-release"?e.keySystem===E.KeySystems.FAIRPLAY&&(j.updateKeySession(e,(0,R.strToUtf8array)("acknowledged")),j.removeSession(e)):j.warn('unhandled media key message type "'+ue+'"')},e.mediaKeysSession.onkeystatuseschange=function(q){var te=e.mediaKeysSession;if(!te){X.emit("error",new Error("invalid state"));return}j.onKeyStatusChange(e);var ue=e.keyStatus;X.emit("keyStatus",ue),ue==="expired"&&(j.warn(e.keySystem+" expired for key "+$),j.renewKeySession(e))};var Z=new Promise(function(q,te){X.on("error",te),X.on("keyStatus",function(ue){ue.startsWith("usable")?q():ue==="output-restricted"?te(new L({type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):ue==="internal-error"?te(new L({type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+ue+'"')):ue==="expired"?te(new Error("key expired while generating request")):j.warn('unhandled key status change "'+ue+'"')})});return e.mediaKeysSession.generateRequest(h,M).then(function(){var q;j.log('Request generated for key-session "'+((q=e.mediaKeysSession)===null||q===void 0?void 0:q.sessionId)+'" keyId: '+$)}).catch(function(q){throw new L({type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:q,fatal:!1},"Error generating key-session request: "+q)}).then(function(){return Z}).catch(function(q){throw X.removeAllListeners(),j.removeSession(e),q}).then(function(){return X.removeAllListeners(),e})},n.onKeyStatusChange=function(e){var h=this;e.mediaKeysSession.keyStatuses.forEach(function(M,T){h.log('key status change "'+M+'" for keyStatuses keyId: '+D.default.hexDump("buffer"in T?new Uint8Array(T.buffer,T.byteOffset,T.byteLength):new Uint8Array(T))+" session keyId: "+D.default.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=M})},n.fetchServerCertificate=function(e){var h=this;return new Promise(function(M,T){var B=h.getServerCertificateUrl(e);if(!B)return M();h.log('Fetching serverCertificate for "'+e+'"');var N=new XMLHttpRequest;N.open("GET",B,!0),N.responseType="arraybuffer",N.onreadystatechange=function(){N.readyState===XMLHttpRequest.DONE&&(N.status===200?M(N.response):T(new L({type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:N},'"'+e+'" certificate request XHR failed ('+B+"). Status: "+N.status+" ("+N.statusText+")")))},N.send()})},n.setMediaKeysServerCertificate=function(e,h,M){var T=this;return new Promise(function(B,N){e.setServerCertificate(M).then(function(j){T.log("setServerCertificate "+(j?"success":"not supported by CDM")+" ("+(M==null?void 0:M.byteLength)+') on "'+h+'"'),B(e)}).catch(function(j){N(new L({type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:j,fatal:!0},j.message))})})},n.renewLicense=function(e,h){var M=this;return this.requestLicense(e,new Uint8Array(h)).then(function(T){return M.updateKeySession(e,new Uint8Array(T)).catch(function(B){throw new L({type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:B,fatal:!0},B.message)})})},n.setupLicenseXHR=function(e,h,M,T){var B=this,N=this.config.licenseXhrSetup;return N?Promise.resolve().then(function(){if(!M.decryptdata)throw new Error("Key removed");return N.call(B.hls,e,h,M,T)}).catch(function(j){if(!M.decryptdata)throw j;return e.open("POST",h,!0),N.call(B.hls,e,h,M,T)}).then(function(j){e.readyState||e.open("POST",h,!0);var z=j||T;return{xhr:e,licenseChallenge:z}}):(e.open("POST",h,!0),Promise.resolve({xhr:e,licenseChallenge:T}))},n.requestLicense=function(e,h){var M=this;return new Promise(function(T,B){var N=M.getLicenseServerUrl(e.keySystem);M.log("Sending license request to URL: "+N);var j=new XMLHttpRequest;j.responseType="arraybuffer",j.onreadystatechange=function(){if(!M.hls||!e.mediaKeysSession)return B(new Error("invalid state"));if(j.readyState===4)if(j.status===200){M._requestLicenseFailureCount=0;var z=j.response;M.log("License received "+(z instanceof ArrayBuffer?z.byteLength:z));var K=M.config.licenseResponseCallback;if(K)try{z=K.call(M.hls,j,N,e)}catch($){M.error($)}T(z)}else if(M._requestLicenseFailureCount++,M._requestLicenseFailureCount>p||j.status>=400&&j.status<500)B(new L({type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:j},"License Request XHR failed ("+N+"). Status: "+j.status+" ("+j.statusText+")"));else{var V=p-M._requestLicenseFailureCount+1;M.warn("Retrying license request, "+V+" attempts left"),M.requestLicense(e,h).then(T,B)}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=j,M.setupLicenseXHR(j,N,e,h).then(function(z){var K=z.xhr,V=z.licenseChallenge;K.send(V)})})},n.onMediaAttached=function(e,h){if(!!this.config.emeEnabled){var M=h.media;this.media=M,M.addEventListener("encrypted",this.onMediaEncrypted),M.addEventListener("waitingforkey",this.onWaitingForKey)}},n.onMediaDetached=function(){var e=this,h=this.media,M=this.mediaKeySessions;h&&(h.removeEventListener("encrypted",this.onMediaEncrypted),h.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},A.LevelKey.clearKeyUriToKeyIdMap();var T=M.length;y.CDMCleanupPromise=Promise.all(M.map(function(B){return e.removeSession(B)}).concat(h==null?void 0:h.setMediaKeys(null).catch(function(B){e.log("Could not clear media keys: "+B+". media.src: "+(h==null?void 0:h.src))}))).then(function(){T&&(e.log("finished closing key sessions and clearing media keys"),M.length=0)}).catch(function(B){e.log("Could not close sessions and clear media keys: "+B+". media.src: "+(h==null?void 0:h.src))})},n.onManifestLoaded=function(e,h){var M=h.sessionKeys;if(!(!M||!this.config.emeEnabled)&&!this.keyFormatPromise){var T=M.reduce(function(B,N){return B.indexOf(N.keyFormat)===-1&&B.push(N.keyFormat),B},[]);this.log("Selecting key-system from session-keys "+T.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(T)}},n.removeSession=function(e){var h=this,M=e.mediaKeysSession,T=e.licenseXhr;if(M){this.log("Remove licenses and keys and close session "+M.sessionId),M.onmessage=null,M.onkeystatuseschange=null,T&&T.readyState!==XMLHttpRequest.DONE&&T.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var B=this.mediaKeySessions.indexOf(e);return B>-1&&this.mediaKeySessions.splice(B,1),M.remove().catch(function(N){h.log("Could not remove session: "+N)}).then(function(){return M.close()}).catch(function(N){h.log("Could not close session: "+N)})}},y}();f.CDMCleanupPromise=void 0;var L=function(y){m(n,y);function n(s,e){var h;return h=y.call(this,e)||this,h.data=void 0,h.data=s,s.err=s.error,h}return n}(_(Error));const v=f},"./src/controller/fps-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>E});var g=a("./src/events.ts"),d=a("./src/utils/logger.ts"),S=function(){function R(A){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=A,this.registerListeners()}var x=R.prototype;return x.setStreamController=function(D){this.streamController=D},x.registerListeners=function(){this.hls.on(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},x.unregisterListeners=function(){this.hls.off(g.Events.MEDIA_ATTACHING,this.onMediaAttaching)},x.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},x.onMediaAttaching=function(D,P){var I=this.hls.config;if(I.capLevelOnFPSDrop){var c=P.media instanceof self.HTMLVideoElement?P.media:null;this.media=c,c&&typeof c.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),I.fpsDroppedMonitoringPeriod)}},x.checkFPS=function(D,P,I){var c=performance.now();if(P){if(this.lastTime){var m=c-this.lastTime,_=I-this.lastDroppedFrames,o=P-this.lastDecodedFrames,i=1e3*_/m,t=this.hls;if(t.trigger(g.Events.FPS_DROP,{currentDropped:_,currentDecoded:o,totalDroppedFrames:I}),i>0&&_>t.config.fpsDroppedMonitoringThreshold*o){var r=t.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+r),r>0&&(t.autoLevelCapping===-1||t.autoLevelCapping>=r)&&(r=r-1,t.trigger(g.Events.FPS_DROP_LEVEL_CAPPING,{level:r,droppedLevel:t.currentLevel}),t.autoLevelCapping=r,this.streamController.nextLevelSwitch())}}this.lastTime=c,this.lastDroppedFrames=I,this.lastDecodedFrames=P}},x.checkFPSInterval=function(){var D=this.media;if(D)if(this.isVideoPlaybackQualityAvailable){var P=D.getVideoPlaybackQuality();this.checkFPS(D,P.totalVideoFrames,P.droppedVideoFrames)}else this.checkFPS(D,D.webkitDecodedFrameCount,D.webkitDroppedFrameCount)},R}();const E=S},"./src/controller/fragment-finders.ts":(C,b,a)=>{a.r(b),a.d(b,{findFragWithCC:()=>A,findFragmentByPDT:()=>S,findFragmentByPTS:()=>E,fragmentWithinToleranceTest:()=>R,pdtWithinToleranceTest:()=>x});var g=a("./src/polyfills/number.ts"),d=a("./src/utils/binary-search.ts");function S(D,P,I){if(P===null||!Array.isArray(D)||!D.length||!(0,g.isFiniteNumber)(P))return null;var c=D[0].programDateTime;if(P<(c||0))return null;var m=D[D.length-1].endProgramDateTime;if(P>=(m||0))return null;I=I||0;for(var _=0;_<D.length;++_){var o=D[_];if(x(P,I,o))return o}return null}function E(D,P,I,c){I===void 0&&(I=0),c===void 0&&(c=0);var m=null;if(D?m=P[D.sn-P[0].sn+1]||null:I===0&&P[0].start===0&&(m=P[0]),m&&R(I,c,m)===0)return m;var _=d.default.search(P,R.bind(null,I,c));return _&&(_!==D||!m)?_:m}function R(D,P,I){if(D===void 0&&(D=0),P===void 0&&(P=0),I.start<=D&&I.start+I.duration>D)return 0;var c=Math.min(P,I.duration+(I.deltaPTS?I.deltaPTS:0));return I.start+I.duration-c<=D?1:I.start-c>D&&I.start?-1:0}function x(D,P,I){var c=Math.min(P,I.duration+(I.deltaPTS?I.deltaPTS:0))*1e3,m=I.endProgramDateTime||0;return m-c>D}function A(D,P){return d.default.search(D,function(I){return I.cc<P?1:I.cc>P?-1:0})}},"./src/controller/fragment-tracker.ts":(C,b,a)=>{a.r(b),a.d(b,{FragmentState:()=>S,FragmentTracker:()=>E});var g=a("./src/events.ts"),d=a("./src/types/loader.ts"),S;(function(A){A.NOT_LOADED="NOT_LOADED",A.APPENDING="APPENDING",A.PARTIAL="PARTIAL",A.OK="OK"})(S||(S={}));var E=function(){function A(P){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=P,this._registerListeners()}var D=A.prototype;return D._registerListeners=function(){var I=this.hls;I.on(g.Events.BUFFER_APPENDED,this.onBufferAppended,this),I.on(g.Events.FRAG_BUFFERED,this.onFragBuffered,this),I.on(g.Events.FRAG_LOADED,this.onFragLoaded,this)},D._unregisterListeners=function(){var I=this.hls;I.off(g.Events.BUFFER_APPENDED,this.onBufferAppended,this),I.off(g.Events.FRAG_BUFFERED,this.onFragBuffered,this),I.off(g.Events.FRAG_LOADED,this.onFragLoaded,this)},D.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},D.getAppendedFrag=function(I,c){if(c===d.PlaylistLevelType.MAIN){var m=this.activeFragment,_=this.activeParts;if(!m)return null;if(_)for(var o=_.length;o--;){var i=_[o],t=i?i.end:m.appendedPTS;if(i.start<=I&&t!==void 0&&I<=t)return o>9&&(this.activeParts=_.slice(o-9)),i}else if(m.start<=I&&m.appendedPTS!==void 0&&I<=m.appendedPTS)return m}return this.getBufferedFrag(I,c)},D.getBufferedFrag=function(I,c){for(var m=this.fragments,_=Object.keys(m),o=_.length;o--;){var i=m[_[o]];if((i==null?void 0:i.body.type)===c&&i.buffered){var t=i.body;if(t.start<=I&&I<=t.end)return t}}return null},D.detectEvictedFragments=function(I,c,m){var _=this;this.timeRanges&&(this.timeRanges[I]=c),Object.keys(this.fragments).forEach(function(o){var i=_.fragments[o];if(!!i){if(!i.buffered&&!i.loaded){i.body.type===m&&_.removeFragment(i.body);return}var t=i.range[I];!t||t.time.some(function(r){var l=!_.isTimeBuffered(r.startPTS,r.endPTS,c);return l&&_.removeFragment(i.body),l})}})},D.detectPartialFragments=function(I){var c=this,m=this.timeRanges,_=I.frag,o=I.part;if(!(!m||_.sn==="initSegment")){var i=x(_),t=this.fragments[i];!t||(Object.keys(m).forEach(function(r){var l=_.elementaryStreams[r];if(!!l){var p=m[r],u=o!==null||l.partial===!0;t.range[r]=c.getBufferedTimes(_,o,u,p)}}),t.loaded=null,Object.keys(t.range).length?(t.buffered=!0,t.body.endList&&(this.endListFragments[t.body.type]=t)):this.removeFragment(t.body))}},D.fragBuffered=function(I){var c=x(I),m=this.fragments[c];m&&(m.loaded=null,m.buffered=!0)},D.getBufferedTimes=function(I,c,m,_){for(var o={time:[],partial:m},i=c?c.start:I.start,t=c?c.end:I.end,r=I.minEndPTS||t,l=I.maxStartPTS||i,p=0;p<_.length;p++){var u=_.start(p)-this.bufferPadding,f=_.end(p)+this.bufferPadding;if(l>=u&&r<=f){o.time.push({startPTS:Math.max(i,_.start(p)),endPTS:Math.min(t,_.end(p))});break}else if(i<f&&t>u)o.partial=!0,o.time.push({startPTS:Math.max(i,_.start(p)),endPTS:Math.min(t,_.end(p))});else if(t<=u)break}return o},D.getPartialFragment=function(I){var c=null,m,_,o,i=0,t=this.bufferPadding,r=this.fragments;return Object.keys(r).forEach(function(l){var p=r[l];!p||R(p)&&(_=p.body.start-t,o=p.body.end+t,I>=_&&I<=o&&(m=Math.min(I-_,o-I),i<=m&&(c=p.body,i=m)))}),c},D.isEndListAppended=function(I){var c=this.endListFragments[I];return c!==void 0&&(c.buffered||R(c))},D.getState=function(I){var c=x(I),m=this.fragments[c];return m?m.buffered?R(m)?S.PARTIAL:S.OK:S.APPENDING:S.NOT_LOADED},D.isTimeBuffered=function(I,c,m){for(var _,o,i=0;i<m.length;i++){if(_=m.start(i)-this.bufferPadding,o=m.end(i)+this.bufferPadding,I>=_&&c<=o)return!0;if(c<=_)return!1}return!1},D.onFragLoaded=function(I,c){var m=c.frag,_=c.part;if(!(m.sn==="initSegment"||m.bitrateTest||_)){var o=x(m);this.fragments[o]={body:m,loaded:c,buffered:!1,range:Object.create(null)}}},D.onBufferAppended=function(I,c){var m=this,_=c.frag,o=c.part,i=c.timeRanges;if(_.type===d.PlaylistLevelType.MAIN)if(this.activeFragment!==_&&(this.activeFragment=_,_.appendedPTS=void 0),o){var t=this.activeParts;t||(this.activeParts=t=[]),t.push(o)}else this.activeParts=null;this.timeRanges=i,Object.keys(i).forEach(function(r){var l=i[r];if(m.detectEvictedFragments(r,l),!o&&_.type===d.PlaylistLevelType.MAIN){var p=_.elementaryStreams[r];if(!p)return;for(var u=0;u<l.length;u++){var f=l.end(u);f<=p.endPTS&&f>p.startPTS?_.appendedPTS=Math.max(f,_.appendedPTS||0):_.appendedPTS=p.endPTS}}})},D.onFragBuffered=function(I,c){this.detectPartialFragments(c)},D.hasFragment=function(I){var c=x(I);return!!this.fragments[c]},D.removeFragmentsInRange=function(I,c,m){var _=this;Object.keys(this.fragments).forEach(function(o){var i=_.fragments[o];if(!!i&&i.buffered){var t=i.body;t.type===m&&t.start<c&&t.end>I&&_.removeFragment(t)}})},D.removeFragment=function(I){var c=x(I);I.stats.loaded=0,I.clearElementaryStreamInfo(),I.appendedPTS=void 0,delete this.fragments[c],I.endList&&delete this.endListFragments[I.type]},D.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},A}();function R(A){var D,P;return A.buffered&&(((D=A.range.video)===null||D===void 0?void 0:D.partial)||((P=A.range.audio)===null||P===void 0?void 0:P.partial))}function x(A){return A.type+"_"+A.level+"_"+A.urlId+"_"+A.sn}},"./src/controller/gap-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{MAX_START_GAP_JUMP:()=>x,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>A,SKIP_BUFFER_RANGE_START:()=>D,STALL_MINIMUM_DURATION_MS:()=>R,default:()=>P});var g=a("./src/utils/buffer-helper.ts"),d=a("./src/errors.ts"),S=a("./src/events.ts"),E=a("./src/utils/logger.ts"),R=250,x=2,A=.1,D=.05,P=function(){function I(m,_,o,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=m,this.media=_,this.fragmentTracker=o,this.hls=i}var c=I.prototype;return c.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},c.poll=function(_,o){var i=this.config,t=this.media,r=this.stalled;if(t!==null){var l=t.currentTime,p=t.seeking,u=this.seeking&&!p,f=!this.seeking&&p;if(this.seeking=p,l!==_){if(this.moved=!0,r!==null){if(this.stallReported){var L=self.performance.now()-r;E.logger.warn("playback not stuck anymore @"+l+", after "+Math.round(L)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((f||u)&&(this.stalled=null),!(t.paused&&!p||t.ended||t.playbackRate===0||!g.BufferHelper.getBuffered(t).length)){var v=g.BufferHelper.bufferInfo(t,l,0),y=v.len>0,n=v.nextStart||0;if(!(!y&&!n)){if(p){var s=v.len>x,e=!n||o&&o.start<=l||n-l>x&&!this.fragmentTracker.getPartialFragment(l);if(s||e)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var h,M=Math.max(n,v.start||0)-l,T=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,B=T==null||(h=T.details)===null||h===void 0?void 0:h.live,N=B?T.details.targetduration*2:x;if(M>0&&M<=N){this._trySkipBufferHole(null);return}}var j=self.performance.now();if(r===null){this.stalled=j;return}var z=j-r;if(!(!p&&z>=R&&(this._reportStall(v),!this.media))){var K=g.BufferHelper.bufferInfo(t,l,i.maxBufferHole);this._tryFixBufferStall(K,z)}}}}},c._tryFixBufferStall=function(_,o){var i=this.config,t=this.fragmentTracker,r=this.media;if(r!==null){var l=r.currentTime,p=t.getPartialFragment(l);if(p){var u=this._trySkipBufferHole(p);if(u||!this.media)return}_.len>i.maxBufferHole&&o>i.highBufferWatchdogPeriod*1e3&&(E.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},c._reportStall=function(_){var o=this.hls,i=this.media,t=this.stallReported;!t&&i&&(this.stallReported=!0,E.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(_)+")"),o.trigger(S.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:_.len}))},c._trySkipBufferHole=function(_){var o=this.config,i=this.hls,t=this.media;if(t===null)return 0;for(var r=t.currentTime,l=0,p=g.BufferHelper.getBuffered(t),u=0;u<p.length;u++){var f=p.start(u);if(r+o.maxBufferHole>=l&&r<f){var L=Math.max(f+D,t.currentTime+A);return E.logger.warn("skipping hole, adjusting currentTime from "+r+" to "+L),this.moved=!0,this.stalled=null,t.currentTime=L,_&&i.trigger(S.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+r+" to "+L,frag:_}),L}l=p.end(u)}return 0},c._tryNudgeBuffer=function(){var _=this.config,o=this.hls,i=this.media,t=this.nudgeRetry;if(i!==null){var r=i.currentTime;if(this.nudgeRetry++,t<_.nudgeMaxRetry){var l=r+(t+1)*_.nudgeOffset;E.logger.warn("Nudging 'currentTime' from "+r+" to "+l),i.currentTime=l,o.trigger(S.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else E.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+_.nudgeMaxRetry+" nudges"),o.trigger(S.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},I}()},"./src/controller/id3-track-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>_});var g=a("./src/polyfills/number.ts"),d=a("./src/events.ts"),S=a("./src/utils/texttrack-utils.ts"),E=a("./src/demux/id3.ts"),R=a("./src/loader/date-range.ts"),x=a("./src/types/demuxer.ts"),A=.25;function D(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var P=function(){var o=D();try{new o(0,Number.POSITIVE_INFINITY,"")}catch(i){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function I(o,i){return o.getTime()/1e3-i}function c(o){return Uint8Array.from(o.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var m=function(){function o(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}var i=o.prototype;return i.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},i._registerListeners=function(){var r=this.hls;r.on(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(d.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.on(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(d.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},i._unregisterListeners=function(){var r=this.hls;r.off(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(d.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.off(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(d.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},i.onMediaAttached=function(r,l){this.media=l.media},i.onMediaDetaching=function(){!this.id3Track||((0,S.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},i.onManifestLoading=function(){this.dateRangeCuesAppended={}},i.createTrack=function(r){var l=this.getID3Track(r.textTracks);return l.mode="hidden",l},i.getID3Track=function(r){if(!!this.media){for(var l=0;l<r.length;l++){var p=r[l];if(p.kind==="metadata"&&p.label==="id3")return(0,S.sendAddTrackEvent)(p,this.media),p}return this.media.addTextTrack("metadata","id3")}},i.onFragParsingMetadata=function(r,l){if(!!this.media){var p=this.hls.config,u=p.enableEmsgMetadataCues,f=p.enableID3MetadataCues;if(!(!u&&!f)){var L=l.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var v=D(),y=0;y<L.length;y++){var n=L[y].type;if(!(n===x.MetadataSchema.emsg&&!u||!f)){var s=E.getID3Frames(L[y].data);if(s){var e=L[y].pts,h=e+L[y].duration;h>P&&(h=P);var M=h-e;M<=0&&(h=e+A);for(var T=0;T<s.length;T++){var B=s[T];if(!E.isTimeStampFrame(B)){this.updateId3CueEnds(e);var N=new v(e,h,"");N.value=B,n&&(N.type=n),this.id3Track.addCue(N)}}}}}}}},i.updateId3CueEnds=function(r){var l,p=(l=this.id3Track)===null||l===void 0?void 0:l.cues;if(p)for(var u=p.length;u--;){var f=p[u];f.startTime<r&&f.endTime===P&&(f.endTime=r)}},i.onBufferFlushing=function(r,l){var p=l.startOffset,u=l.endOffset,f=l.type,L=this.id3Track,v=this.hls;if(!!v){var y=v.config,n=y.enableEmsgMetadataCues,s=y.enableID3MetadataCues;if(L&&(n||s)){var e;f==="audio"?e=function(M){return M.type===x.MetadataSchema.audioId3&&s}:f==="video"?e=function(M){return M.type===x.MetadataSchema.emsg&&n}:e=function(M){return M.type===x.MetadataSchema.audioId3&&s||M.type===x.MetadataSchema.emsg&&n},(0,S.removeCuesInRange)(L,p,u,e)}}},i.onLevelUpdated=function(r,l){var p=this,u=l.details;if(!(!this.media||!u.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var f=this.dateRangeCuesAppended,L=this.id3Track,v=u.dateRanges,y=Object.keys(v);if(L)for(var n=Object.keys(f).filter(function(j){return!y.includes(j)}),s=function(z){var K=n[z];Object.keys(f[K].cues).forEach(function(V){L.removeCue(f[K].cues[V])}),delete f[K]},e=n.length;e--;)s(e);var h=u.fragments[u.fragments.length-1];if(!(y.length===0||!(0,g.isFiniteNumber)(h==null?void 0:h.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var M=h.programDateTime/1e3-h.start,T=D(),B=function(z){var K=y[z],V=v[K],$=f[K],X=($==null?void 0:$.cues)||{},Z=($==null?void 0:$.durationKnown)||!1,q=I(V.startDate,M),te=P,ue=V.endDate;if(ue)te=I(ue,M),Z=!0;else if(V.endOnNext&&!Z){var oe=y.reduce(function(he,Le){var De=v[Le];return De.class===V.class&&De.id!==Le&&De.startDate>V.startDate&&he.push(De),he},[]).sort(function(he,Le){return he.startDate.getTime()-Le.startDate.getTime()})[0];oe&&(te=I(oe.startDate,M),Z=!0)}for(var le=Object.keys(V.attr),me=0;me<le.length;me++){var _e=le[me];if(!(_e===R.DateRangeAttribute.ID||_e===R.DateRangeAttribute.CLASS||_e===R.DateRangeAttribute.START_DATE||_e===R.DateRangeAttribute.DURATION||_e===R.DateRangeAttribute.END_DATE||_e===R.DateRangeAttribute.END_ON_NEXT)){var ve=X[_e];if(ve)Z&&!$.durationKnown&&(ve.endTime=te);else{var ce=V.attr[_e];ve=new T(q,te,""),(_e===R.DateRangeAttribute.SCTE35_OUT||_e===R.DateRangeAttribute.SCTE35_IN)&&(ce=c(ce)),ve.value={key:_e,data:ce},ve.type=x.MetadataSchema.dateRange,p.id3Track.addCue(ve),X[_e]=ve}}}f[K]={cues:X,dateRange:V,durationKnown:Z}},N=0;N<y.length;N++)B(N)}}},o}();const _=m},"./src/controller/latency-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>D});var g=a("./src/errors.ts"),d=a("./src/events.ts"),S=a("./src/utils/logger.ts");function E(P,I){for(var c=0;c<I.length;c++){var m=I[c];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(P,x(m.key),m)}}function R(P,I,c){return I&&E(P.prototype,I),c&&E(P,c),Object.defineProperty(P,"prototype",{writable:!1}),P}function x(P){var I=A(P,"string");return typeof I=="symbol"?I:String(I)}function A(P,I){if(typeof P!="object"||P===null)return P;var c=P[Symbol.toPrimitive];if(c!==void 0){var m=c.call(P,I||"default");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return(I==="string"?String:Number)(P)}var D=function(){function P(c){var m=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return m.timeupdate()},this.hls=c,this.config=c.config,this.registerListeners()}var I=P.prototype;return I.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},I.registerListeners=function(){this.hls.on(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(d.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(d.Events.ERROR,this.onError,this)},I.unregisterListeners=function(){this.hls.off(d.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(d.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(d.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(d.Events.ERROR,this.onError)},I.onMediaAttached=function(m,_){this.media=_.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},I.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},I.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},I.onLevelUpdated=function(m,_){var o=_.details;this.levelDetails=o,o.advanced&&this.timeupdate(),!o.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},I.onError=function(m,_){_.details===g.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,S.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},I.timeupdate=function(){var m=this.media,_=this.levelDetails;if(!(!m||!_)){this.currentTime=m.currentTime;var o=this.computeLatency();if(o!==null){this._latency=o;var i=this.config,t=i.lowLatencyMode,r=i.maxLiveSyncPlaybackRate;if(!(!t||r===1)){var l=this.targetLatency;if(l!==null){var p=o-l,u=Math.min(this.maxLatency,l+_.targetduration),f=p<u;if(_.live&&f&&p>.05&&this.forwardBufferLength>1){var L=Math.min(2,Math.max(1,r)),v=Math.round(2/(1+Math.exp(-.75*p-this.edgeStalled))*20)/20;m.playbackRate=Math.min(L,Math.max(1,v))}else m.playbackRate!==1&&m.playbackRate!==0&&(m.playbackRate=1)}}}}},I.estimateLiveEdge=function(){var m=this.levelDetails;return m===null?null:m.edge+m.age},I.computeLatency=function(){var m=this.estimateLiveEdge();return m===null?null:m-this.currentTime},R(P,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var m=this.config,_=this.levelDetails;return m.liveMaxLatencyDuration!==void 0?m.liveMaxLatencyDuration:_?m.liveMaxLatencyDurationCount*_.targetduration:0}},{key:"targetLatency",get:function(){var m=this.levelDetails;if(m===null)return null;var _=m.holdBack,o=m.partHoldBack,i=m.targetduration,t=this.config,r=t.liveSyncDuration,l=t.liveSyncDurationCount,p=t.lowLatencyMode,u=this.hls.userConfig,f=p&&o||_;(u.liveSyncDuration||u.liveSyncDurationCount||f===0)&&(f=r!==void 0?r:l*i);var L=i,v=1;return f+Math.min(this.stallCount*v,L)}},{key:"liveSyncPosition",get:function(){var m=this.estimateLiveEdge(),_=this.targetLatency,o=this.levelDetails;if(m===null||_===null||o===null)return null;var i=o.edge,t=m-_-this.edgeStalled,r=i-o.totalduration,l=i-(this.config.lowLatencyMode&&o.partTarget||o.targetduration);return Math.min(Math.max(r,t),l)}},{key:"drift",get:function(){var m=this.levelDetails;return m===null?1:m.drift}},{key:"edgeStalled",get:function(){var m=this.levelDetails;if(m===null)return 0;var _=(this.config.lowLatencyMode&&m.partTarget||m.targetduration)*3;return Math.max(m.age-_,0)}},{key:"forwardBufferLength",get:function(){var m=this.media,_=this.levelDetails;if(!m||!_)return 0;var o=m.buffered.length;return(o?m.buffered.end(o-1):_.edge)-this.currentTime}}]),P}()},"./src/controller/level-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>t});var g=a("./src/types/level.ts"),d=a("./src/events.ts"),S=a("./src/errors.ts"),E=a("./src/utils/codecs.ts"),R=a("./src/controller/level-helper.ts"),x=a("./src/controller/base-playlist-controller.ts"),A=a("./src/types/loader.ts");function D(){return D=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var p=arguments[l];for(var u in p)Object.prototype.hasOwnProperty.call(p,u)&&(r[u]=p[u])}return r},D.apply(this,arguments)}function P(r,l){for(var p=0;p<l.length;p++){var u=l[p];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(r,c(u.key),u)}}function I(r,l,p){return l&&P(r.prototype,l),p&&P(r,p),Object.defineProperty(r,"prototype",{writable:!1}),r}function c(r){var l=m(r,"string");return typeof l=="symbol"?l:String(l)}function m(r,l){if(typeof r!="object"||r===null)return r;var p=r[Symbol.toPrimitive];if(p!==void 0){var u=p.call(r,l||"default");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(r)}function _(r,l){r.prototype=Object.create(l.prototype),r.prototype.constructor=r,o(r,l)}function o(r,l){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,f){return u.__proto__=f,u},o(r,l)}var i=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),t=function(r){_(l,r);function l(u){var f;return f=r.call(this,u,"[level-controller]")||this,f._levels=[],f._firstLevel=-1,f._startLevel=void 0,f.currentLevelIndex=-1,f.manualLevelIndex=-1,f.onParsedComplete=void 0,f._registerListeners(),f}var p=l.prototype;return p._registerListeners=function(){var f=this.hls;f.on(d.Events.MANIFEST_LOADED,this.onManifestLoaded,this),f.on(d.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.on(d.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),f.on(d.Events.FRAG_LOADED,this.onFragLoaded,this),f.on(d.Events.ERROR,this.onError,this)},p._unregisterListeners=function(){var f=this.hls;f.off(d.Events.MANIFEST_LOADED,this.onManifestLoaded,this),f.off(d.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.off(d.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),f.off(d.Events.FRAG_LOADED,this.onFragLoaded,this),f.off(d.Events.ERROR,this.onError,this)},p.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,r.prototype.destroy.call(this)},p.startLoad=function(){var f=this._levels;f.forEach(function(L){L.loadError=0}),r.prototype.startLoad.call(this)},p.onManifestLoaded=function(f,L){var v=[],y=[],n=[],s,e={},h,M=!1,T=!1,B=!1;if(L.levels.forEach(function(K){var V=K.attrs;M=M||!!(K.width&&K.height),T=T||!!K.videoCodec,B=B||!!K.audioCodec,i&&K.audioCodec&&K.audioCodec.indexOf("mp4a.40.34")!==-1&&(K.audioCodec=void 0);var $=K.bitrate+"-"+K.attrs.RESOLUTION+"-"+K.attrs.CODECS;h=e[$],h?h.url.push(K.url):(h=new g.Level(K),e[$]=h,v.push(h)),V&&(V.AUDIO&&(0,R.addGroupId)(h,"audio",V.AUDIO),V.SUBTITLES&&(0,R.addGroupId)(h,"text",V.SUBTITLES))}),(M||T)&&B&&(v=v.filter(function(K){var V=K.videoCodec,$=K.width,X=K.height;return!!V||!!($&&X)})),v=v.filter(function(K){var V=K.audioCodec,$=K.videoCodec;return(!V||(0,E.isCodecSupportedInMp4)(V,"audio"))&&(!$||(0,E.isCodecSupportedInMp4)($,"video"))}),L.audioTracks&&(y=L.audioTracks.filter(function(K){return!K.audioCodec||(0,E.isCodecSupportedInMp4)(K.audioCodec,"audio")}),(0,R.assignTrackIdsByGroup)(y)),L.subtitles&&(n=L.subtitles,(0,R.assignTrackIdsByGroup)(n)),v.length>0){s=v[0].bitrate,v.sort(function(K,V){return K.attrs["HDCP-LEVEL"]!==V.attrs["HDCP-LEVEL"]?(K.attrs["HDCP-LEVEL"]||"")>(V.attrs["HDCP-LEVEL"]||"")?1:-1:K.bitrate!==V.bitrate?K.bitrate-V.bitrate:K.attrs.SCORE!==V.attrs.SCORE?K.attrs.decimalFloatingPoint("SCORE")-V.attrs.decimalFloatingPoint("SCORE"):M&&K.height!==V.height?K.height-V.height:0}),this._levels=v;for(var N=0;N<v.length;N++)if(v[N].bitrate===s){this._firstLevel=N,this.log("manifest loaded, "+v.length+" level(s) found, first bitrate: "+s);break}var j=B&&!T,z={levels:v,audioTracks:y,subtitleTracks:n,sessionData:L.sessionData,sessionKeys:L.sessionKeys,firstLevel:this._firstLevel,stats:L.stats,audio:B,video:T,altAudio:!j&&y.some(function(K){return!!K.url})};this.hls.trigger(d.Events.MANIFEST_PARSED,z),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(d.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:L.url,reason:"no level with compatible codecs found in manifest"})},p.onError=function(f,L){var v,y;if(r.prototype.onError.call(this,f,L),!L.fatal){var n=L.context,s=this._levels[this.currentLevelIndex];if(n&&(n.type===A.PlaylistContextType.AUDIO_TRACK&&s.audioGroupIds&&n.groupId===s.audioGroupIds[s.urlId]||n.type===A.PlaylistContextType.SUBTITLE_TRACK&&s.textGroupIds&&n.groupId===s.textGroupIds[s.urlId])){this.redundantFailover(this.currentLevelIndex);return}var e=!1,h=!0,M;switch(L.details){case S.ErrorDetails.FRAG_LOAD_ERROR:case S.ErrorDetails.FRAG_LOAD_TIMEOUT:case S.ErrorDetails.KEY_LOAD_ERROR:case S.ErrorDetails.KEY_LOAD_TIMEOUT:if(L.frag){var T=L.frag.type===A.PlaylistLevelType.MAIN?L.frag.level:this.currentLevelIndex,B=this._levels[T];B?(B.fragmentError++,B.fragmentError>this.hls.config.fragLoadingMaxRetry&&(M=T)):M=T}break;case S.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var N=s.attrs["HDCP-LEVEL"];N&&(this.hls.maxHdcpLevel=g.HdcpLevels[g.HdcpLevels.indexOf(N)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'))}case S.ErrorDetails.FRAG_PARSING_ERROR:case S.ErrorDetails.KEY_SYSTEM_NO_SESSION:M=((v=L.frag)===null||v===void 0?void 0:v.type)===A.PlaylistLevelType.MAIN?L.frag.level:this.currentLevelIndex,L.levelRetry=!1;break;case S.ErrorDetails.LEVEL_LOAD_ERROR:case S.ErrorDetails.LEVEL_LOAD_TIMEOUT:n&&(n.deliveryDirectives&&(h=!1),M=n.level),e=!0;break;case S.ErrorDetails.REMUX_ALLOC_ERROR:M=(y=L.level)!=null?y:this.currentLevelIndex,e=!0;break}M!==void 0&&this.recoverLevel(L,M,e,h)}},p.recoverLevel=function(f,L,v,y){var n=f.details,s=this._levels[L];if(s.loadError++,v){var e=this.retryLoadingOrFail(f);if(e)f.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(y){var h=s.url.length;if(h>1&&s.loadError<h)f.levelRetry=!0,this.redundantFailover(L);else if(this.manualLevelIndex===-1){for(var M=-1,T=this._levels,B=T.length;B--;){var N=(B+this.currentLevelIndex)%T.length;if(N!==this.currentLevelIndex&&T[N].loadError===0){M=N;break}}M>-1&&this.currentLevelIndex!==M?(this.warn(n+": switch to "+M),f.levelRetry=!0,this.hls.nextAutoLevel=M):f.levelRetry===!1&&(f.fatal=!0)}}},p.redundantFailover=function(f){var L=this._levels[f],v=L.url.length;if(v>1){var y=(L.urlId+1)%v;this.warn("Switching to redundant URL-id "+y),this._levels.forEach(function(n){n.urlId=y}),this.level=f}},p.onFragLoaded=function(f,L){var v=L.frag;if(v!==void 0&&v.type===A.PlaylistLevelType.MAIN){var y=this._levels[v.level];y!==void 0&&(y.fragmentError=0,y.loadError=0)}},p.onLevelLoaded=function(f,L){var v,y=L.level,n=L.details,s=this._levels[y];if(!s){var e;this.warn("Invalid level index "+y),(e=L.deliveryDirectives)!==null&&e!==void 0&&e.skip&&(n.deltaUpdateFailed=!0);return}y===this.currentLevelIndex?(s.fragmentError===0&&(s.loadError=0,this.retryCount=0),this.playlistLoaded(y,L,s.details)):(v=L.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(n.deltaUpdateFailed=!0)},p.onAudioTrackSwitched=function(f,L){var v=this.hls.levels[this.currentLevelIndex];if(!!v&&v.audioGroupIds){for(var y=-1,n=this.hls.audioTracks[L.id].groupId,s=0;s<v.audioGroupIds.length;s++)if(v.audioGroupIds[s]===n){y=s;break}y!==v.urlId&&(v.urlId=y,this.startLoad())}},p.loadPlaylist=function(f){r.prototype.loadPlaylist.call(this);var L=this.currentLevelIndex,v=this._levels[L];if(this.canLoad&&v&&v.url.length>0){var y=v.urlId,n=v.url[y];if(f)try{n=f.addDirectives(n)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Attempt loading level index "+L+((f==null?void 0:f.msn)!==void 0?" at sn "+f.msn+" part "+f.part:"")+" with URL-id "+y+" "+n),this.clearTimer(),this.hls.trigger(d.Events.LEVEL_LOADING,{url:n,level:L,id:y,deliveryDirectives:f||null})}},p.removeLevel=function(f,L){var v=function(s,e){return e!==L},y=this._levels.filter(function(n,s){return s!==f?!0:n.url.length>1&&L!==void 0?(n.url=n.url.filter(v),n.audioGroupIds&&(n.audioGroupIds=n.audioGroupIds.filter(v)),n.textGroupIds&&(n.textGroupIds=n.textGroupIds.filter(v)),n.urlId=0,!0):!1}).map(function(n,s){var e=n.details;return e!=null&&e.fragments&&e.fragments.forEach(function(h){h.level=s}),n});this._levels=y,this.hls.trigger(d.Events.LEVELS_UPDATED,{levels:y})},I(l,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(f){var L,v=this._levels;if(v.length!==0&&!(this.currentLevelIndex===f&&(L=v[f])!==null&&L!==void 0&&L.details)){if(f<0||f>=v.length){var y=f<0;if(this.hls.trigger(d.Events.ERROR,{type:S.ErrorTypes.OTHER_ERROR,details:S.ErrorDetails.LEVEL_SWITCH_ERROR,level:f,fatal:y,reason:"invalid level idx"}),y)return;f=Math.min(f,v.length-1)}this.clearTimer();var n=this.currentLevelIndex,s=v[n],e=v[f];this.log("switching to level "+f+" from "+n),this.currentLevelIndex=f;var h=D({},e,{level:f,maxBitrate:e.maxBitrate,uri:e.uri,urlId:e.urlId});delete h._urlId,this.hls.trigger(d.Events.LEVEL_SWITCHING,h);var M=e.details;if(!M||M.live){var T=this.switchParams(e.uri,s==null?void 0:s.details);this.loadPlaylist(T)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(f){this.manualLevelIndex=f,this._startLevel===void 0&&(this._startLevel=f),f!==-1&&(this.level=f)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(f){this._firstLevel=f}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var f=this.hls.config.startLevel;return f!==void 0?f:this._firstLevel}else return this._startLevel},set:function(f){this._startLevel=f}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(f){this.level=f,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=f)}}]),l}(x.default)},"./src/controller/level-helper.ts":(C,b,a)=>{a.r(b),a.d(b,{addGroupId:()=>R,addSliding:()=>i,adjustSliding:()=>o,assignTrackIdsByGroup:()=>x,computeReloadInterval:()=>t,getFragmentWithSN:()=>r,getPartWith:()=>l,mapFragmentIntersection:()=>_,mapPartIntersection:()=>m,mergeDetails:()=>I,updateFragPTSDTS:()=>P,updatePTS:()=>A});var g=a("./src/polyfills/number.ts"),d=a("./src/utils/logger.ts"),S=a("./src/loader/date-range.ts");function E(){return E=Object.assign?Object.assign.bind():function(p){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var L in f)Object.prototype.hasOwnProperty.call(f,L)&&(p[L]=f[L])}return p},E.apply(this,arguments)}function R(p,u,f){switch(u){case"audio":p.audioGroupIds||(p.audioGroupIds=[]),p.audioGroupIds.push(f);break;case"text":p.textGroupIds||(p.textGroupIds=[]),p.textGroupIds.push(f);break}}function x(p){var u={};p.forEach(function(f){var L=f.groupId||"";f.id=u[L]=u[L]||0,u[L]++})}function A(p,u,f){var L=p[u],v=p[f];D(L,v)}function D(p,u){var f=u.startPTS;if((0,g.isFiniteNumber)(f)){var L=0,v;u.sn>p.sn?(L=f-p.start,v=p):(L=p.start-f,v=u),v.duration!==L&&(v.duration=L)}else if(u.sn>p.sn){var y=p.cc===u.cc;y&&p.minEndPTS?u.start=p.start+(p.minEndPTS-p.start):u.start=p.start+p.duration}else u.start=Math.max(p.start-u.duration,0)}function P(p,u,f,L,v,y){var n=L-f;n<=0&&(d.logger.warn("Fragment should have a positive duration",u),L=f+u.duration,y=v+u.duration);var s=f,e=L,h=u.startPTS,M=u.endPTS;if((0,g.isFiniteNumber)(h)){var T=Math.abs(h-f);(0,g.isFiniteNumber)(u.deltaPTS)?u.deltaPTS=Math.max(T,u.deltaPTS):u.deltaPTS=T,s=Math.max(f,h),f=Math.min(f,h),v=Math.min(v,u.startDTS),e=Math.min(L,M),L=Math.max(L,M),y=Math.max(y,u.endDTS)}u.duration=L-f;var B=f-u.start;u.start=u.startPTS=f,u.maxStartPTS=s,u.startDTS=v,u.endPTS=L,u.minEndPTS=e,u.endDTS=y;var N=u.sn;if(!p||N<p.startSN||N>p.endSN)return 0;var j,z=N-p.startSN,K=p.fragments;for(K[z]=u,j=z;j>0;j--)D(K[j],K[j-1]);for(j=z;j<K.length-1;j++)D(K[j],K[j+1]);return p.fragmentHint&&D(K[K.length-1],p.fragmentHint),p.PTSKnown=p.alignedSliding=!0,B}function I(p,u){for(var f=null,L=p.fragments,v=L.length-1;v>=0;v--){var y=L[v].initSegment;if(y){f=y;break}}p.fragmentHint&&delete p.fragmentHint.endPTS;var n=0,s;if(_(p,u,function(j,z){j.relurl&&(n=j.cc-z.cc),(0,g.isFiniteNumber)(j.startPTS)&&(0,g.isFiniteNumber)(j.endPTS)&&(z.start=z.startPTS=j.startPTS,z.startDTS=j.startDTS,z.appendedPTS=j.appendedPTS,z.maxStartPTS=j.maxStartPTS,z.endPTS=j.endPTS,z.endDTS=j.endDTS,z.minEndPTS=j.minEndPTS,z.duration=j.endPTS-j.startPTS,z.duration&&(s=z),u.PTSKnown=u.alignedSliding=!0),z.elementaryStreams=j.elementaryStreams,z.loader=j.loader,z.stats=j.stats,z.urlId=j.urlId,j.initSegment&&(z.initSegment=j.initSegment,f=j.initSegment)}),f){var e=u.fragmentHint?u.fragments.concat(u.fragmentHint):u.fragments;e.forEach(function(j){var z;(!j.initSegment||j.initSegment.relurl===((z=f)===null||z===void 0?void 0:z.relurl))&&(j.initSegment=f)})}if(u.skippedSegments)if(u.deltaUpdateFailed=u.fragments.some(function(j){return!j}),u.deltaUpdateFailed){d.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var h=u.skippedSegments;h--;)u.fragments.shift();u.startSN=u.fragments[0].sn,u.startCC=u.fragments[0].cc}else u.canSkipDateRanges&&(u.dateRanges=c(p.dateRanges,u.dateRanges,u.recentlyRemovedDateranges));var M=u.fragments;if(n){d.logger.warn("discontinuity sliding from playlist, take drift into account");for(var T=0;T<M.length;T++)M[T].cc+=n}u.skippedSegments&&(u.startCC=u.fragments[0].cc),m(p.partList,u.partList,function(j,z){z.elementaryStreams=j.elementaryStreams,z.stats=j.stats}),s?P(u,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):o(p,u),M.length&&(u.totalduration=u.edge-M[0].start),u.driftStartTime=p.driftStartTime,u.driftStart=p.driftStart;var B=u.advancedDateTime;if(u.advanced&&B){var N=u.edge;u.driftStart||(u.driftStartTime=B,u.driftStart=N),u.driftEndTime=B,u.driftEnd=N}else u.driftEndTime=p.driftEndTime,u.driftEnd=p.driftEnd,u.advancedDateTime=p.advancedDateTime}function c(p,u,f){var L=E({},p);return f&&f.forEach(function(v){delete L[v]}),Object.keys(u).forEach(function(v){var y=new S.DateRange(u[v].attr,L[v]);y.isValid?L[v]=y:d.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(u[v].attr)+'"')}),L}function m(p,u,f){if(p&&u)for(var L=0,v=0,y=p.length;v<=y;v++){var n=p[v],s=u[v+L];n&&s&&n.index===s.index&&n.fragment.sn===s.fragment.sn?f(n,s):L--}}function _(p,u,f){for(var L=u.skippedSegments,v=Math.max(p.startSN,u.startSN)-u.startSN,y=(p.fragmentHint?1:0)+(L?u.endSN:Math.min(p.endSN,u.endSN))-u.startSN,n=u.startSN-p.startSN,s=u.fragmentHint?u.fragments.concat(u.fragmentHint):u.fragments,e=p.fragmentHint?p.fragments.concat(p.fragmentHint):p.fragments,h=v;h<=y;h++){var M=e[n+h],T=s[h];L&&!T&&h<L&&(T=u.fragments[h]=M),M&&T&&f(M,T)}}function o(p,u){var f=u.startSN+u.skippedSegments-p.startSN,L=p.fragments;f<0||f>=L.length||i(u,L[f].start)}function i(p,u){if(u){for(var f=p.fragments,L=p.skippedSegments;L<f.length;L++)f[L].start+=u;p.fragmentHint&&(p.fragmentHint.start+=u)}}function t(p,u){u===void 0&&(u=1/0);var f=1e3*p.targetduration;if(p.updated){var L=p.fragments,v=4;if(L.length&&f*v>u){var y=L[L.length-1].duration*1e3;y<f&&(f=y)}}else f/=2;return Math.round(f)}function r(p,u,f){if(!p||!p.details)return null;var L=p.details,v=L.fragments[u-L.startSN];return v||(v=L.fragmentHint,v&&v.sn===u)?v:u<L.startSN&&f&&f.sn===u?f:null}function l(p,u,f){if(!p||!p.details)return null;var L=p.details.partList;if(L)for(var v=L.length;v--;){var y=L[v];if(y.index===f&&y.fragment.sn===u)return y}return null}},"./src/controller/stream-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>u});var g=a("./src/polyfills/number.ts"),d=a("./src/controller/base-stream-controller.ts"),S=a("./src/is-supported.ts"),E=a("./src/events.ts"),R=a("./src/utils/buffer-helper.ts"),x=a("./src/controller/fragment-tracker.ts"),A=a("./src/types/loader.ts"),D=a("./src/loader/fragment.ts"),P=a("./src/demux/transmuxer-interface.ts"),I=a("./src/types/transmuxer.ts"),c=a("./src/controller/gap-controller.ts"),m=a("./src/errors.ts");function _(f,L){for(var v=0;v<L.length;v++){var y=L[v];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(f,i(y.key),y)}}function o(f,L,v){return L&&_(f.prototype,L),v&&_(f,v),Object.defineProperty(f,"prototype",{writable:!1}),f}function i(f){var L=t(f,"string");return typeof L=="symbol"?L:String(L)}function t(f,L){if(typeof f!="object"||f===null)return f;var v=f[Symbol.toPrimitive];if(v!==void 0){var y=v.call(f,L||"default");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(L==="string"?String:Number)(f)}function r(f,L){f.prototype=Object.create(L.prototype),f.prototype.constructor=f,l(f,L)}function l(f,L){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,n){return y.__proto__=n,y},l(f,L)}var p=100,u=function(f){r(L,f);function L(y,n,s){var e;return e=f.call(this,y,n,s,"[stream-controller]")||this,e.audioCodecSwap=!1,e.gapController=null,e.level=-1,e._forceStartLoad=!1,e.altAudio=!1,e.audioOnly=!1,e.fragPlaying=null,e.onvplaying=null,e.onvseeked=null,e.fragLastKbps=0,e.couldBacktrack=!1,e.backtrackFragment=null,e.audioCodecSwitch=!1,e.videoBuffer=null,e._registerListeners(),e}var v=L.prototype;return v._registerListeners=function(){var n=this.hls;n.on(E.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(E.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(E.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(E.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(E.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),n.on(E.Events.ERROR,this.onError,this),n.on(E.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(E.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.on(E.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(E.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(E.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),n.on(E.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var n=this.hls;n.off(E.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(E.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(E.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(E.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),n.off(E.Events.ERROR,this.onError,this),n.off(E.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(E.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.off(E.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(E.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(E.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),n.off(E.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},v.startLoad=function(n){if(this.levels){var s=this.lastCurrentTime,e=this.hls;if(this.stopLoad(),this.setInterval(p),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var h=e.startLevel;h===-1&&(e.config.testBandwidth&&this.levels.length>1?(h=0,this.bitrateTest=!0):h=e.nextAutoLevel),this.level=e.nextLoadLevel=h,this.loadedmetadata=!1}s>0&&n===-1&&(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),n=s),this.state=d.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()}else this._forceStartLoad=!0,this.state=d.State.STOPPED},v.stopLoad=function(){this._forceStartLoad=!1,f.prototype.stopLoad.call(this)},v.doTick=function(){switch(this.state){case d.State.IDLE:this.doTickIdle();break;case d.State.WAITING_LEVEL:{var n,s=this.levels,e=this.level,h=s==null||(n=s[e])===null||n===void 0?void 0:n.details;if(h&&(!h.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(h))break;this.state=d.State.IDLE;break}break}case d.State.FRAG_LOADING_WAITING_RETRY:{var M,T=self.performance.now(),B=this.retryDate;(!B||T>=B||(M=this.media)!==null&&M!==void 0&&M.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=d.State.IDLE)}break}this.onTickEnd()},v.onTickEnd=function(){f.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},v.doTickIdle=function(){var n=this.hls,s=this.levelLastLoaded,e=this.levels,h=this.media,M=n.config,T=n.nextLoadLevel;if(!(s===null||!h&&(this.startFragRequested||!M.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!e||!e[T])){var B=e[T],N=this.getMainFwdBufferInfo();if(N!==null){var j=this.getLevelDetails();if(j&&this._streamEnded(N,j)){var z={};this.altAudio&&(z.type="video"),this.hls.trigger(E.Events.BUFFER_EOS,z),this.state=d.State.ENDED;return}this.level=n.nextLoadLevel=T;var K=B.details;if(!K||this.state===d.State.WAITING_LEVEL||K.live&&this.levelLastLoaded!==T){this.level=T,this.state=d.State.WAITING_LEVEL;return}var V=N.len,$=this.getMaxBufferLength(B.maxBitrate);if(!(V>=$)){this.backtrackFragment&&this.backtrackFragment.start>N.end&&(this.backtrackFragment=null);var X=this.backtrackFragment?this.backtrackFragment.start:N.end,Z=this.getNextFragment(X,K);if(this.couldBacktrack&&!this.fragPrevious&&Z&&Z.sn!=="initSegment"&&this.fragmentTracker.getState(Z)!==x.FragmentState.OK){var q,te=((q=this.backtrackFragment)!=null?q:Z).sn,ue=te-K.startSN,oe=K.fragments[ue-1];oe&&Z.cc===oe.cc&&(Z=oe,this.fragmentTracker.removeFragment(oe))}else this.backtrackFragment&&N.len&&(this.backtrackFragment=null);if(Z&&this.fragmentTracker.getState(Z)===x.FragmentState.OK&&this.nextLoadPosition>X){var le=this.audioOnly&&!this.altAudio?D.ElementaryStreamTypes.AUDIO:D.ElementaryStreamTypes.VIDEO,me=(le===D.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;me&&this.afterBufferFlushed(me,le,A.PlaylistLevelType.MAIN),Z=this.getNextFragment(this.nextLoadPosition,K)}!Z||(Z.initSegment&&!Z.initSegment.data&&!this.bitrateTest&&(Z=Z.initSegment),this.loadFragment(Z,K,X))}}}},v.loadFragment=function(n,s,e){var h,M=this.fragmentTracker.getState(n);this.fragCurrent=n,M===x.FragmentState.NOT_LOADED?n.sn==="initSegment"?this._loadInitSegment(n,s):this.bitrateTest?(this.log("Fragment "+n.sn+" of level "+n.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(n,s)):(this.startFragRequested=!0,f.prototype.loadFragment.call(this,n,s,e)):M===x.FragmentState.APPENDING?this.reduceMaxBufferLength(n.duration)&&this.fragmentTracker.removeFragment(n):((h=this.media)===null||h===void 0?void 0:h.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},v.getAppendedFrag=function(n){var s=this.fragmentTracker.getAppendedFrag(n,A.PlaylistLevelType.MAIN);return s&&"fragment"in s?s.fragment:s},v.getBufferedFrag=function(n){return this.fragmentTracker.getBufferedFrag(n,A.PlaylistLevelType.MAIN)},v.followingBufferedFrag=function(n){return n?this.getBufferedFrag(n.end+.5):null},v.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},v.nextLevelSwitch=function(){var n=this.levels,s=this.media;if(s!=null&&s.readyState){var e,h=this.getAppendedFrag(s.currentTime);if(h&&h.start>1&&this.flushMainBuffer(0,h.start-1),!s.paused&&n){var M=this.hls.nextLoadLevel,T=n[M],B=this.fragLastKbps;B&&this.fragCurrent?e=this.fragCurrent.duration*T.maxBitrate/(1e3*B)+1:e=0}else e=0;var N=this.getBufferedFrag(s.currentTime+e);if(N){var j=this.followingBufferedFrag(N);if(j){this.abortCurrentFrag();var z=j.maxStartPTS?j.maxStartPTS:j.start,K=j.duration,V=Math.max(N.end,z+Math.min(Math.max(K-this.config.maxFragLookUpTolerance,K*.5),K*.75));this.flushMainBuffer(V,Number.POSITIVE_INFINITY)}}}},v.abortCurrentFrag=function(){var n=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,n&&n.abortRequests(),this.state){case d.State.KEY_LOADING:case d.State.FRAG_LOADING:case d.State.FRAG_LOADING_WAITING_RETRY:case d.State.PARSING:case d.State.PARSED:this.state=d.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},v.flushMainBuffer=function(n,s){f.prototype.flushMainBuffer.call(this,n,s,this.altAudio?"video":null)},v.onMediaAttached=function(n,s){f.prototype.onMediaAttached.call(this,n,s);var e=s.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),e.addEventListener("playing",this.onvplaying),e.addEventListener("seeked",this.onvseeked),this.gapController=new c.default(this.config,e,this.fragmentTracker,this.hls)},v.onMediaDetaching=function(){var n=this.media;n&&this.onvplaying&&this.onvseeked&&(n.removeEventListener("playing",this.onvplaying),n.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),f.prototype.onMediaDetaching.call(this)},v.onMediaPlaying=function(){this.tick()},v.onMediaSeeked=function(){var n=this.media,s=n?n.currentTime:null;(0,g.isFiniteNumber)(s)&&this.log("Media seeked to "+s.toFixed(3)),this.tick()},v.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(E.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},v.onManifestParsed=function(n,s){var e=!1,h=!1,M;s.levels.forEach(function(T){M=T.audioCodec,M&&(M.indexOf("mp4a.40.2")!==-1&&(e=!0),M.indexOf("mp4a.40.5")!==-1&&(h=!0))}),this.audioCodecSwitch=e&&h&&!(0,S.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1},v.onLevelLoading=function(n,s){var e=this.levels;if(!(!e||this.state!==d.State.IDLE)){var h=e[s.level];(!h.details||h.details.live&&this.levelLastLoaded!==s.level||this.waitForCdnTuneIn(h.details))&&(this.state=d.State.WAITING_LEVEL)}},v.onLevelLoaded=function(n,s){var e,h=this.levels,M=s.level,T=s.details,B=T.totalduration;if(!h){this.warn("Levels were reset while loading level "+M);return}this.log("Level "+M+" loaded ["+T.startSN+","+T.endSN+"], cc ["+T.startCC+", "+T.endCC+"] duration:"+B);var N=this.fragCurrent;N&&(this.state===d.State.FRAG_LOADING||this.state===d.State.FRAG_LOADING_WAITING_RETRY)&&N.level!==s.level&&N.loader&&(this.state=d.State.IDLE,this.backtrackFragment=null,N.abortRequests());var j=h[M],z=0;if(T.live||(e=j.details)!==null&&e!==void 0&&e.live){if(T.fragments[0]||(T.deltaUpdateFailed=!0),T.deltaUpdateFailed)return;z=this.alignPlaylists(T,j.details)}if(j.details=T,this.levelLastLoaded=M,this.hls.trigger(E.Events.LEVEL_UPDATED,{details:T,level:M}),this.state===d.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(T))return;this.state=d.State.IDLE}this.startFragRequested?T.live&&this.synchronizeToLiveEdge(T):this.setStartPosition(T,z),this.tick()},v._handleFragmentLoadProgress=function(n){var s,e=n.frag,h=n.part,M=n.payload,T=this.levels;if(!T){this.warn("Levels were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered");return}var B=T[e.level],N=B.details;if(!N){this.warn("Dropping fragment "+e.sn+" of level "+e.level+" after level details were reset");return}var j=B.videoCodec,z=N.PTSKnown||!N.live,K=(s=e.initSegment)===null||s===void 0?void 0:s.data,V=this._getAudioCodec(B),$=this.transmuxer=this.transmuxer||new P.default(this.hls,A.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),X=h?h.index:-1,Z=X!==-1,q=new I.ChunkMetadata(e.level,e.sn,e.stats.chunkCount,M.byteLength,X,Z),te=this.initPTS[e.cc];$.push(M,K,V,j,e,h,N.totalduration,z,q,te)},v.onAudioTrackSwitching=function(n,s){var e=this.altAudio,h=!!s.url,M=s.id;if(!h){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var T=this.fragCurrent;T&&(this.log("Switching to main audio track, cancel main fragment load"),T.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var B=this.hls;e&&B.trigger(E.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),B.trigger(E.Events.AUDIO_TRACK_SWITCHED,{id:M})}},v.onAudioTrackSwitched=function(n,s){var e=s.id,h=!!this.hls.audioTracks[e].url;if(h){var M=this.videoBuffer;M&&this.mediaBuffer!==M&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=M)}this.altAudio=h,this.tick()},v.onBufferCreated=function(n,s){var e=s.tracks,h,M,T=!1;for(var B in e){var N=e[B];if(N.id==="main"){if(M=B,h=N,B==="video"){var j=e[B];j&&(this.videoBuffer=j.buffer)}}else T=!0}T&&h?(this.log("Alternate track found, use "+M+".buffered to schedule main fragment loading"),this.mediaBuffer=h.buffer):this.mediaBuffer=this.media},v.onFragBuffered=function(n,s){var e=s.frag,h=s.part;if(!(e&&e.type!==A.PlaylistLevelType.MAIN)){if(this.fragContextChanged(e)){this.warn("Fragment "+e.sn+(h?" p: "+h.index:"")+" of level "+e.level+" finished buffering, but was aborted. state: "+this.state),this.state===d.State.PARSED&&(this.state=d.State.IDLE);return}var M=h?h.stats:e.stats;this.fragLastKbps=Math.round(8*M.total/(M.buffering.end-M.loading.first)),e.sn!=="initSegment"&&(this.fragPrevious=e),this.fragBufferedComplete(e,h)}},v.onError=function(n,s){if(s.type===m.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(A.PlaylistLevelType.MAIN,s);return}switch(s.details){case m.ErrorDetails.FRAG_LOAD_ERROR:case m.ErrorDetails.FRAG_LOAD_TIMEOUT:case m.ErrorDetails.FRAG_PARSING_ERROR:case m.ErrorDetails.KEY_LOAD_ERROR:case m.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.MAIN,s);break;case m.ErrorDetails.LEVEL_LOAD_ERROR:case m.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==d.State.ERROR&&(s.fatal?(this.warn(""+s.details),this.state=d.State.ERROR):!s.levelRetry&&this.state===d.State.WAITING_LEVEL&&(this.state=d.State.IDLE));break;case m.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="main"&&(this.state===d.State.PARSING||this.state===d.State.PARSED)){var e=!0,h=this.getFwdBufferInfo(this.media,A.PlaylistLevelType.MAIN);h&&h.len>.5&&(e=!this.reduceMaxBufferLength(h.len)),e&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},v.checkBuffer=function(){var n=this.media,s=this.gapController;if(!(!n||!s||!n.readyState)){if(this.loadedmetadata||!R.BufferHelper.getBuffered(n).length){var e=this.state!==d.State.IDLE?this.fragCurrent:null;s.poll(this.lastCurrentTime,e)}this.lastCurrentTime=n.currentTime}},v.onFragLoadEmergencyAborted=function(){this.state=d.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},v.onBufferFlushed=function(n,s){var e=s.type;if(e!==D.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var h=(e===D.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(h,e,A.PlaylistLevelType.MAIN)}},v.onLevelsUpdated=function(n,s){this.levels=s.levels},v.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},v.seekToStartPos=function(){var n=this.media;if(!!n){var s=n.currentTime,e=this.startPosition;if(e>=0&&s<e){if(n.seeking){this.log("could not seek to "+e+", already seeking at "+s);return}var h=R.BufferHelper.getBuffered(n),M=h.length?h.start(0):0,T=M-e;T>0&&(T<this.config.maxBufferHole||T<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+T+" to match buffer start"),e+=T,this.startPosition=e),this.log("seek to target start position "+e+" from current time "+s),n.currentTime=e}}},v._getAudioCodec=function(n){var s=this.config.defaultAudioCodec||n.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s.indexOf("mp4a.40.5")!==-1?s="mp4a.40.2":s="mp4a.40.5"),s},v._loadBitrateTestFrag=function(n,s){var e=this;n.bitrateTest=!0,this._doFragLoad(n,s).then(function(h){var M=e.hls;if(!(!h||e.fragContextChanged(n))){e.fragLoadError=0,e.state=d.State.IDLE,e.startFragRequested=!1,e.bitrateTest=!1;var T=n.stats;T.parsing.start=T.parsing.end=T.buffering.start=T.buffering.end=self.performance.now(),M.trigger(E.Events.FRAG_LOADED,h),n.bitrateTest=!1}})},v._handleTransmuxComplete=function(n){var s,e="main",h=this.hls,M=n.remuxResult,T=n.chunkMeta,B=this.getCurrentContext(T);if(!B){this.warn("The loading context changed while buffering fragment "+T.sn+" of level "+T.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(T.level);return}var N=B.frag,j=B.part,z=B.level,K=M.video,V=M.text,$=M.id3,X=M.initSegment,Z=z.details,q=this.altAudio?void 0:M.audio;if(!this.fragContextChanged(N)){if(this.state=d.State.PARSING,X){X.tracks&&(this._bufferInitSegment(z,X.tracks,N,T),h.trigger(E.Events.FRAG_PARSING_INIT_SEGMENT,{frag:N,id:e,tracks:X.tracks}));var te=X.initPTS,ue=X.timescale;(0,g.isFiniteNumber)(te)&&(this.initPTS[N.cc]=te,h.trigger(E.Events.INIT_PTS_FOUND,{frag:N,id:e,initPTS:te,timescale:ue}))}if(K&&M.independent!==!1){if(Z){var oe=K.startPTS,le=K.endPTS,me=K.startDTS,_e=K.endDTS;if(j)j.elementaryStreams[K.type]={startPTS:oe,endPTS:le,startDTS:me,endDTS:_e};else if(K.firstKeyFrame&&K.independent&&T.id===1&&(this.couldBacktrack=!0),K.dropped&&K.independent){var ve=this.getMainFwdBufferInfo(),ce=(ve?ve.end:this.getLoadPosition())+this.config.maxBufferHole,he=K.firstKeyFramePTS?K.firstKeyFramePTS:oe;if(ce<he-this.config.maxBufferHole){this.backtrack(N);return}N.setElementaryStreamInfo(K.type,N.start,le,N.start,_e,!0)}N.setElementaryStreamInfo(K.type,oe,le,me,_e),this.backtrackFragment&&(this.backtrackFragment=N),this.bufferFragmentData(K,N,j,T)}}else if(M.independent===!1){this.backtrack(N);return}if(q){var Le=q.startPTS,De=q.endPTS,Fe=q.startDTS,Oe=q.endDTS;j&&(j.elementaryStreams[D.ElementaryStreamTypes.AUDIO]={startPTS:Le,endPTS:De,startDTS:Fe,endDTS:Oe}),N.setElementaryStreamInfo(D.ElementaryStreamTypes.AUDIO,Le,De,Fe,Oe),this.bufferFragmentData(q,N,j,T)}if(Z&&$!==null&&$!==void 0&&(s=$.samples)!==null&&s!==void 0&&s.length){var ke={id:e,frag:N,details:Z,samples:$.samples};h.trigger(E.Events.FRAG_PARSING_METADATA,ke)}if(Z&&V){var Ie={id:e,frag:N,details:Z,samples:V.samples};h.trigger(E.Events.FRAG_PARSING_USERDATA,Ie)}}},v._bufferInitSegment=function(n,s,e,h){var M=this;if(this.state===d.State.PARSING){this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio;var T=s.audio,B=s.video,N=s.audiovideo;if(T){var j=n.audioCodec,z=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(j&&(j.indexOf("mp4a.40.5")!==-1?j="mp4a.40.2":j="mp4a.40.5"),T.metadata.channelCount!==1&&z.indexOf("firefox")===-1&&(j="mp4a.40.5")),z.indexOf("android")!==-1&&T.container!=="audio/mpeg"&&(j="mp4a.40.2",this.log("Android: force audio codec to "+j)),n.audioCodec&&n.audioCodec!==j&&this.log('Swapping manifest audio codec "'+n.audioCodec+'" for "'+j+'"'),T.levelCodec=j,T.id="main",this.log("Init audio buffer, container:"+T.container+", codecs[selected/level/parsed]=["+(j||"")+"/"+(n.audioCodec||"")+"/"+T.codec+"]")}B&&(B.levelCodec=n.videoCodec,B.id="main",this.log("Init video buffer, container:"+B.container+", codecs[level/parsed]=["+(n.videoCodec||"")+"/"+B.codec+"]")),N&&this.log("Init audiovideo buffer, container:"+N.container+", codecs[level/parsed]=["+(n.attrs.CODECS||"")+"/"+N.codec+"]"),this.hls.trigger(E.Events.BUFFER_CODECS,s),Object.keys(s).forEach(function(K){var V=s[K],$=V.initSegment;$!=null&&$.byteLength&&M.hls.trigger(E.Events.BUFFER_APPENDING,{type:K,data:$,frag:e,part:null,chunkMeta:h,parent:e.type})}),this.tick()}},v.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,A.PlaylistLevelType.MAIN)},v.backtrack=function(n){this.couldBacktrack=!0,this.backtrackFragment=n,this.resetTransmuxer(),this.flushBufferGap(n),this.fragmentTracker.removeFragment(n),this.fragPrevious=null,this.nextLoadPosition=n.start,this.state=d.State.IDLE},v.checkFragmentChanged=function(){var n=this.media,s=null;if(n&&n.readyState>1&&n.seeking===!1){var e=n.currentTime;if(R.BufferHelper.isBuffered(n,e)?s=this.getAppendedFrag(e):R.BufferHelper.isBuffered(n,e+.1)&&(s=this.getAppendedFrag(e+.1)),s){this.backtrackFragment=null;var h=this.fragPlaying,M=s.level;(!h||s.sn!==h.sn||h.level!==M||s.urlId!==h.urlId)&&(this.fragPlaying=s,this.hls.trigger(E.Events.FRAG_CHANGED,{frag:s}),(!h||h.level!==M)&&this.hls.trigger(E.Events.LEVEL_SWITCHED,{level:M}))}}},o(L,[{key:"nextLevel",get:function(){var n=this.nextBufferedFrag;return n?n.level:-1}},{key:"currentFrag",get:function(){var n=this.media;return n?this.fragPlaying||this.getAppendedFrag(n.currentTime):null}},{key:"currentProgramDateTime",get:function(){var n=this.media;if(n){var s=n.currentTime,e=this.currentFrag;if(e&&(0,g.isFiniteNumber)(s)&&(0,g.isFiniteNumber)(e.programDateTime)){var h=e.programDateTime+(s-e.start)*1e3;return new Date(h)}}return null}},{key:"currentLevel",get:function(){var n=this.currentFrag;return n?n.level:-1}},{key:"nextBufferedFrag",get:function(){var n=this.currentFrag;return n?this.followingBufferedFrag(n):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),L}(d.default)},"./src/controller/subtitle-stream-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{SubtitleStreamController:()=>r});var g=a("./src/events.ts"),d=a("./src/utils/buffer-helper.ts"),S=a("./src/controller/fragment-finders.ts"),E=a("./src/utils/discontinuities.ts"),R=a("./src/controller/level-helper.ts"),x=a("./src/controller/fragment-tracker.ts"),A=a("./src/controller/base-stream-controller.ts"),D=a("./src/types/loader.ts"),P=a("./src/types/level.ts");function I(p,u){for(var f=0;f<u.length;f++){var L=u[f];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(p,m(L.key),L)}}function c(p,u,f){return u&&I(p.prototype,u),f&&I(p,f),Object.defineProperty(p,"prototype",{writable:!1}),p}function m(p){var u=_(p,"string");return typeof u=="symbol"?u:String(u)}function _(p,u){if(typeof p!="object"||p===null)return p;var f=p[Symbol.toPrimitive];if(f!==void 0){var L=f.call(p,u||"default");if(typeof L!="object")return L;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(p)}function o(p,u){p.prototype=Object.create(u.prototype),p.prototype.constructor=p,i(p,u)}function i(p,u){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(L,v){return L.__proto__=v,L},i(p,u)}var t=500,r=function(p){o(u,p);function u(L,v,y){var n;return n=p.call(this,L,v,y,"[subtitle-stream-controller]")||this,n.levels=[],n.currentTrackId=-1,n.tracksBuffered=[],n.mainDetails=null,n._registerListeners(),n}var f=u.prototype;return f.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},f._registerListeners=function(){var v=this.hls;v.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(g.Events.ERROR,this.onError,this),v.on(g.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.on(g.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.on(g.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.on(g.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.on(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),v.on(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},f._unregisterListeners=function(){var v=this.hls;v.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(g.Events.ERROR,this.onError,this),v.off(g.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.off(g.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.off(g.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.off(g.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.off(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),v.off(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},f.startLoad=function(v){this.stopLoad(),this.state=A.State.IDLE,this.setInterval(t),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=v,this.tick()},f.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},f.onLevelLoaded=function(v,y){this.mainDetails=y.details},f.onSubtitleFragProcessed=function(v,y){var n=y.frag,s=y.success;if(this.fragPrevious=n,this.state=A.State.IDLE,!!s){var e=this.tracksBuffered[this.currentTrackId];if(!!e){for(var h,M=n.start,T=0;T<e.length;T++)if(M>=e[T].start&&M<=e[T].end){h=e[T];break}var B=n.start+n.duration;h?h.end=B:(h={start:M,end:B},e.push(h)),this.fragmentTracker.fragBuffered(n)}}},f.onBufferFlushing=function(v,y){var n=y.startOffset,s=y.endOffset;if(n===0&&s!==Number.POSITIVE_INFINITY){var e=this.currentTrackId,h=this.levels;if(!h.length||!h[e]||!h[e].details)return;var M=h[e].details,T=M.targetduration,B=s-T;if(B<=0)return;y.endOffsetSubtitles=Math.max(0,B),this.tracksBuffered.forEach(function(N){for(var j=0;j<N.length;){if(N[j].end<=B){N.shift();continue}else if(N[j].start<B)N[j].start=B;else break;j++}}),this.fragmentTracker.removeFragmentsInRange(n,B,D.PlaylistLevelType.SUBTITLE)}},f.onFragBuffered=function(v,y){if(!this.loadedmetadata&&y.frag.type===D.PlaylistLevelType.MAIN){var n;(n=this.media)!==null&&n!==void 0&&n.buffered.length&&(this.loadedmetadata=!0)}},f.onError=function(v,y){var n=y.frag;!n||n.type!==D.PlaylistLevelType.SUBTITLE||(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=A.State.IDLE)},f.onSubtitleTracksUpdated=function(v,y){var n=this,s=y.subtitleTracks;this.tracksBuffered=[],this.levels=s.map(function(e){return new P.Level(e)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(e){n.tracksBuffered[e.id]=[]}),this.mediaBuffer=null},f.onSubtitleTrackSwitch=function(v,y){if(this.currentTrackId=y.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(t)},f.onSubtitleTrackLoaded=function(v,y){var n,s=y.details,e=y.id,h=this.currentTrackId,M=this.levels;if(!!M.length){var T=M[h];if(!(e>=M.length||e!==h||!T)){this.mediaBuffer=this.mediaBufferTimeRanges;var B=0;if(s.live||(n=T.details)!==null&&n!==void 0&&n.live){var N=this.mainDetails;if(s.deltaUpdateFailed||!N)return;var j=N.fragments[0];T.details?(B=this.alignPlaylists(s,T.details),B===0&&j&&(B=j.start,(0,R.addSliding)(s,B))):s.hasProgramDateTime&&N.hasProgramDateTime?((0,E.alignMediaPlaylistByPDT)(s,N),B=s.fragments[0].start):j&&(B=j.start,(0,R.addSliding)(s,B))}if(T.details=s,this.levelLastLoaded=e,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(T.details,B),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===A.State.IDLE){var z=(0,S.findFragmentByPTS)(null,s.fragments,this.media.currentTime,0);z||(this.warn("Subtitle playlist not aligned with playback"),T.details=void 0)}}}},f._handleFragmentLoadComplete=function(v){var y=this,n=v.frag,s=v.payload,e=n.decryptdata,h=this.hls;if(!this.fragContextChanged(n)&&s&&s.byteLength>0&&e&&e.key&&e.iv&&e.method==="AES-128"){var M=performance.now();this.decrypter.decrypt(new Uint8Array(s),e.key.buffer,e.iv.buffer).then(function(T){var B=performance.now();h.trigger(g.Events.FRAG_DECRYPTED,{frag:n,payload:T,stats:{tstart:M,tdecrypt:B}})}).catch(function(T){y.warn(T.name+": "+T.message),y.state=A.State.IDLE})}},f.doTick=function(){if(!this.media){this.state=A.State.IDLE;return}if(this.state===A.State.IDLE){var v=this.currentTrackId,y=this.levels;if(!y.length||!y[v]||!y[v].details)return;var n=y[v].details,s=n.targetduration,e=this.config,h=this.getLoadPosition(),M=d.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],h-s,e.maxBufferHole),T=M.end,B=M.len,N=this.getFwdBufferInfo(this.media,D.PlaylistLevelType.MAIN),j=this.getMaxBufferLength(N==null?void 0:N.len)+s;if(B>j)return;console.assert(n,"Subtitle track details are defined on idle subtitle stream controller tick");var z=n.fragments,K=z.length,V=n.edge,$=null,X=this.fragPrevious;if(T<V){var Z=e.maxFragLookUpTolerance;$=(0,S.findFragmentByPTS)(X,z,Math.max(z[0].start,T),Z),!$&&X&&X.start<z[0].start&&($=z[0])}else $=z[K-1];if(!$)return;$=this.mapToInitFragWhenRequired($),this.fragmentTracker.getState($)===x.FragmentState.NOT_LOADED&&this.loadFragment($,n,T)}},f.getMaxBufferLength=function(v){var y=p.prototype.getMaxBufferLength.call(this);return v?Math.max(y,v):y},f.loadFragment=function(v,y,n){this.fragCurrent=v,v.sn==="initSegment"?this._loadInitSegment(v,y):(this.startFragRequested=!0,p.prototype.loadFragment.call(this,v,y,n))},c(u,[{key:"mediaBufferTimeRanges",get:function(){return new l(this.tracksBuffered[this.currentTrackId]||[])}}]),u}(A.default),l=function(u){this.buffered=void 0;var f=function(v,y,n){if(y=y>>>0,y>n-1)throw new DOMException("Failed to execute '"+v+"' on 'TimeRanges': The index provided ("+y+") is greater than the maximum bound ("+n+")");return u[y][v]};this.buffered={get length(){return u.length},end:function(v){return f("end",v,u.length)},start:function(v){return f("start",v,u.length)}}}},"./src/controller/subtitle-track-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>_});var g=a("./src/events.ts"),d=a("./src/utils/texttrack-utils.ts"),S=a("./src/controller/base-playlist-controller.ts"),E=a("./src/types/loader.ts");function R(o,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,A(r.key),r)}}function x(o,i,t){return i&&R(o.prototype,i),t&&R(o,t),Object.defineProperty(o,"prototype",{writable:!1}),o}function A(o){var i=D(o,"string");return typeof i=="symbol"?i:String(i)}function D(o,i){if(typeof o!="object"||o===null)return o;var t=o[Symbol.toPrimitive];if(t!==void 0){var r=t.call(o,i||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(o)}function P(o,i){o.prototype=Object.create(i.prototype),o.prototype.constructor=o,I(o,i)}function I(o,i){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,l){return r.__proto__=l,r},I(o,i)}var c=function(o){P(i,o);function i(r){var l;return l=o.call(this,r,"[subtitle-track-controller]")||this,l.media=null,l.tracks=[],l.groupId=null,l.tracksInGroup=[],l.trackId=-1,l.selectDefaultTrack=!0,l.queuedDefaultTrack=-1,l.trackChangeListener=function(){return l.onTextTracksChanged()},l.asyncPollTrackChange=function(){return l.pollTrackChange(0)},l.useTextTrackPolling=!1,l.subtitlePollingInterval=-1,l._subtitleDisplay=!0,l.registerListeners(),l}var t=i.prototype;return t.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,o.prototype.destroy.call(this)},t.registerListeners=function(){var l=this.hls;l.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.on(g.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(g.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.on(g.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),l.on(g.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var l=this.hls;l.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.off(g.Events.LEVEL_LOADING,this.onLevelLoading,this),l.off(g.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.off(g.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),l.off(g.Events.ERROR,this.onError,this)},t.onMediaAttached=function(l,p){this.media=p.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},t.pollTrackChange=function(l){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,l)},t.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var l=m(this.media.textTracks);l.forEach(function(p){(0,d.clearCurrentCues)(p)}),this.subtitleTrack=-1,this.media=null}},t.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},t.onManifestParsed=function(l,p){this.tracks=p.subtitleTracks},t.onSubtitleTrackLoaded=function(l,p){var u=p.id,f=p.details,L=this.trackId,v=this.tracksInGroup[L];if(!v){this.warn("Invalid subtitle track id "+u);return}var y=v.details;v.details=p.details,this.log("subtitle track "+u+" loaded ["+f.startSN+"-"+f.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,p,y))},t.onLevelLoading=function(l,p){this.switchLevel(p.level)},t.onLevelSwitching=function(l,p){this.switchLevel(p.level)},t.switchLevel=function(l){var p=this.hls.levels[l];if(!!(p!=null&&p.textGroupIds)){var u=p.textGroupIds[p.urlId];if(this.groupId!==u){var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,L=this.tracks.filter(function(n){return!u||n.groupId===u});this.tracksInGroup=L;var v=this.findTrackId(f==null?void 0:f.name)||this.findTrackId();this.groupId=u;var y={subtitleTracks:L};this.log("Updating subtitle tracks, "+L.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(g.Events.SUBTITLE_TRACKS_UPDATED,y),v!==-1&&this.setSubtitleTrack(v,f)}}},t.findTrackId=function(l){for(var p=this.tracksInGroup,u=0;u<p.length;u++){var f=p[u];if((!this.selectDefaultTrack||f.default)&&(!l||l===f.name))return f.id}return-1},t.onError=function(l,p){o.prototype.onError.call(this,l,p),!(p.fatal||!p.context)&&p.context.type===E.PlaylistContextType.SUBTITLE_TRACK&&p.context.id===this.trackId&&p.context.groupId===this.groupId&&this.retryLoadingOrFail(p)},t.loadPlaylist=function(l){o.prototype.loadPlaylist.call(this);var p=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(p)){var u=p.id,f=p.groupId,L=p.url;if(l)try{L=l.addDirectives(L)}catch(v){this.warn("Could not construct new URL with HLS Delivery Directives: "+v)}this.log("Loading subtitle playlist for id "+u),this.hls.trigger(g.Events.SUBTITLE_TRACK_LOADING,{url:L,id:u,groupId:f,deliveryDirectives:l||null})}},t.toggleTrackModes=function(l){var p=this,u=this.media,f=this.trackId;if(!!u){var L=m(u.textTracks),v=L.filter(function(s){return s.groupId===p.groupId});if(l===-1)[].slice.call(L).forEach(function(s){s.mode="disabled"});else{var y=v[f];y&&(y.mode="disabled")}var n=v[l];n&&(n.mode=this.subtitleDisplay?"showing":"hidden")}},t.setSubtitleTrack=function(l,p){var u,f=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=l;return}if(this.trackId!==l&&this.toggleTrackModes(l),!(this.trackId===l&&(l===-1||(u=f[l])!==null&&u!==void 0&&u.details)||l<-1||l>=f.length)){this.clearTimer();var L=f[l];if(this.log("Switching to subtitle track "+l),this.trackId=l,L){var v=L.id,y=L.groupId,n=y===void 0?"":y,s=L.name,e=L.type,h=L.url;this.hls.trigger(g.Events.SUBTITLE_TRACK_SWITCH,{id:v,groupId:n,name:s,type:e,url:h});var M=this.switchParams(L.url,p==null?void 0:p.details);this.loadPlaylist(M)}else this.hls.trigger(g.Events.SUBTITLE_TRACK_SWITCH,{id:l})}},t.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var l=-1,p=m(this.media.textTracks),u=0;u<p.length;u++)if(p[u].mode==="hidden")l=u;else if(p[u].mode==="showing"){l=u;break}this.subtitleTrack!==l&&(this.subtitleTrack=l)}},x(i,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(l){this._subtitleDisplay=l,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(l){this.selectDefaultTrack=!1;var p=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(l,p)}}]),i}(S.default);function m(o){for(var i=[],t=0;t<o.length;t++){var r=o[t];r.kind==="subtitles"&&r.label&&i.push(o[t])}return i}const _=c},"./src/controller/timeline-controller.ts":(C,b,a)=>{a.r(b),a.d(b,{TimelineController:()=>c});var g=a("./src/polyfills/number.ts"),d=a("./src/events.ts"),S=a("./src/utils/cea-608-parser.ts"),E=a("./src/utils/output-filter.ts"),R=a("./src/utils/webvtt-parser.ts"),x=a("./src/utils/texttrack-utils.ts"),A=a("./src/utils/imsc1-ttml-parser.ts"),D=a("./src/utils/mp4-tools.ts"),P=a("./src/types/loader.ts"),I=a("./src/utils/logger.ts"),c=function(){function i(r){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=o(),this.captionsProperties=void 0,this.hls=r,this.config=r.config,this.Cues=r.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var l=new E.default(this,"textTrack1"),p=new E.default(this,"textTrack2"),u=new E.default(this,"textTrack3"),f=new E.default(this,"textTrack4");this.cea608Parser1=new S.default(1,l,p),this.cea608Parser2=new S.default(3,u,f)}r.on(d.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(d.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(d.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(d.Events.FRAG_LOADING,this.onFragLoading,this),r.on(d.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(d.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.on(d.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),r.on(d.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(d.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.on(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var t=i.prototype;return t.destroy=function(){var l=this.hls;l.off(d.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),l.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(d.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.off(d.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.off(d.Events.FRAG_LOADING,this.onFragLoading,this),l.off(d.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(d.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),l.off(d.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),l.off(d.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),l.off(d.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),l.off(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},t.addCues=function(l,p,u,f,L){for(var v=!1,y=L.length;y--;){var n=L[y],s=_(n[0],n[1],p,u);if(s>=0&&(n[0]=Math.min(n[0],p),n[1]=Math.max(n[1],u),v=!0,s/(u-p)>.5))return}if(v||L.push([p,u]),this.config.renderTextTracksNatively){var e=this.captionsTracks[l];this.Cues.newCue(e,p,u,f)}else{var h=this.Cues.newCue(null,p,u,f);this.hls.trigger(d.Events.CUES_PARSED,{type:"captions",cues:h,track:l})}},t.onInitPtsFound=function(l,p){var u=this,f=p.frag,L=p.id,v=p.initPTS,y=p.timescale,n=this.unparsedVttFrags;L==="main"&&(this.initPTS[f.cc]=v,this.timescale[f.cc]=y),n.length&&(this.unparsedVttFrags=[],n.forEach(function(s){u.onFragLoaded(d.Events.FRAG_LOADED,s)}))},t.getExistingTrack=function(l){var p=this.media;if(p)for(var u=0;u<p.textTracks.length;u++){var f=p.textTracks[u];if(f[l])return f}return null},t.createCaptionsTrack=function(l){this.config.renderTextTracksNatively?this.createNativeTrack(l):this.createNonNativeTrack(l)},t.createNativeTrack=function(l){if(!this.captionsTracks[l]){var p=this.captionsProperties,u=this.captionsTracks,f=this.media,L=p[l],v=L.label,y=L.languageCode,n=this.getExistingTrack(l);if(n)u[l]=n,(0,x.clearCurrentCues)(u[l]),(0,x.sendAddTrackEvent)(u[l],f);else{var s=this.createTextTrack("captions",v,y);s&&(s[l]=!0,u[l]=s)}}},t.createNonNativeTrack=function(l){if(!this.nonNativeCaptionsTracks[l]){var p=this.captionsProperties[l];if(!!p){var u=p.label,f={_id:l,label:u,kind:"captions",default:p.media?!!p.media.default:!1,closedCaptions:p.media};this.nonNativeCaptionsTracks[l]=f,this.hls.trigger(d.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[f]})}}},t.createTextTrack=function(l,p,u){var f=this.media;if(!!f)return f.addTextTrack(l,p,u)},t.onMediaAttaching=function(l,p){this.media=p.media,this._cleanTracks()},t.onMediaDetaching=function(){var l=this.captionsTracks;Object.keys(l).forEach(function(p){(0,x.clearCurrentCues)(l[p]),delete l[p]}),this.nonNativeCaptionsTracks={}},t.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=o(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},t._cleanTracks=function(){var l=this.media;if(!!l){var p=l.textTracks;if(p)for(var u=0;u<p.length;u++)(0,x.clearCurrentCues)(p[u])}},t.onSubtitleTracksUpdated=function(l,p){var u=this;this.textTracks=[];var f=p.subtitleTracks||[],L=f.some(function(s){return s.textCodec===A.IMSC1_CODEC});if(this.config.enableWebVTT||L&&this.config.enableIMSC1){var v=this.tracks&&f&&this.tracks.length===f.length;if(this.tracks=f||[],this.config.renderTextTracksNatively){var y=this.media?this.media.textTracks:[];this.tracks.forEach(function(s,e){var h;if(e<y.length){for(var M=null,T=0;T<y.length;T++)if(m(y[T],s)){M=y[T];break}M&&(h=M)}if(h)(0,x.clearCurrentCues)(h);else{var B=u._captionsOrSubtitlesFromCharacteristics(s);h=u.createTextTrack(B,s.name,s.lang),h&&(h.mode="disabled")}h&&(h.groupId=s.groupId,u.textTracks.push(h))})}else if(!v&&this.tracks&&this.tracks.length){var n=this.tracks.map(function(s){return{label:s.name,kind:s.type.toLowerCase(),default:s.default,subtitleTrack:s}});this.hls.trigger(d.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:n})}}},t._captionsOrSubtitlesFromCharacteristics=function(l){var p;if((p=l.attrs)!==null&&p!==void 0&&p.CHARACTERISTICS){var u=/transcribes-spoken-dialog/gi.test(l.attrs.CHARACTERISTICS),f=/describes-music-and-sound/gi.test(l.attrs.CHARACTERISTICS);if(u&&f)return"captions"}return"subtitles"},t.onManifestLoaded=function(l,p){var u=this;this.config.enableCEA708Captions&&p.captions&&p.captions.forEach(function(f){var L=/(?:CC|SERVICE)([1-4])/.exec(f.instreamId);if(!!L){var v="textTrack"+L[1],y=u.captionsProperties[v];!y||(y.label=f.name,f.lang&&(y.languageCode=f.lang),y.media=f)}})},t.closedCaptionsForLevel=function(l){var p=this.hls.levels[l.level];return p==null?void 0:p.attrs["CLOSED-CAPTIONS"]},t.onFragLoading=function(l,p){var u=this.cea608Parser1,f=this.cea608Parser2,L=this.lastSn,v=this.lastPartIndex;if(!(!this.enabled||!(u&&f))&&p.frag.type===P.PlaylistLevelType.MAIN){var y,n,s=p.frag.sn,e=(y=p==null||(n=p.part)===null||n===void 0?void 0:n.index)!=null?y:-1;s===L+1||s===L&&e===v+1||(u.reset(),f.reset()),this.lastSn=s,this.lastPartIndex=e}},t.onFragLoaded=function(l,p){var u=p.frag,f=p.payload,L=this.initPTS,v=this.unparsedVttFrags;if(u.type===P.PlaylistLevelType.SUBTITLE)if(f.byteLength){if(!(0,g.isFiniteNumber)(L[u.cc])){v.push(p),L.length&&this.hls.trigger(d.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:u,error:new Error("Missing initial subtitle PTS")});return}var y=u.decryptdata,n="stats"in p;if(y==null||!y.encrypted||n){var s=this.tracks[u.level],e=this.vttCCs;e[u.cc]||(e[u.cc]={start:u.start,prevCC:this.prevCC,new:!0},this.prevCC=u.cc),s&&s.textCodec===A.IMSC1_CODEC?this._parseIMSC1(u,f):this._parseVTTs(u,f,e)}}else this.hls.trigger(d.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:u,error:new Error("Empty subtitle payload")})},t._parseIMSC1=function(l,p){var u=this,f=this.hls;(0,A.parseIMSC1)(p,this.initPTS[l.cc],this.timescale[l.cc],function(L){u._appendCues(L,l.level),f.trigger(d.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:l})},function(L){I.logger.log("Failed to parse IMSC1: "+L),f.trigger(d.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:L})})},t._parseVTTs=function(l,p,u){var f,L=this,v=this.hls,y=(f=l.initSegment)!==null&&f!==void 0&&f.data?(0,D.appendUint8Array)(l.initSegment.data,new Uint8Array(p)):p;(0,R.parseWebVTT)(y,this.initPTS[l.cc],this.timescale[l.cc],u,l.cc,l.start,function(n){L._appendCues(n,l.level),v.trigger(d.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:l})},function(n){L._fallbackToIMSC1(l,p),I.logger.log("Failed to parse VTT cue: "+n),v.trigger(d.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:n})})},t._fallbackToIMSC1=function(l,p){var u=this,f=this.tracks[l.level];f.textCodec||(0,A.parseIMSC1)(p,this.initPTS[l.cc],this.timescale[l.cc],function(){f.textCodec=A.IMSC1_CODEC,u._parseIMSC1(l,p)},function(){f.textCodec="wvtt"})},t._appendCues=function(l,p){var u=this.hls;if(this.config.renderTextTracksNatively){var f=this.textTracks[p];if(!f||f.mode==="disabled")return;l.forEach(function(y){return(0,x.addCueToTrack)(f,y)})}else{var L=this.tracks[p];if(!L)return;var v=L.default?"default":"subtitles"+p;u.trigger(d.Events.CUES_PARSED,{type:"subtitles",cues:l,track:v})}},t.onFragDecrypted=function(l,p){var u=p.frag;if(u.type===P.PlaylistLevelType.SUBTITLE){if(!(0,g.isFiniteNumber)(this.initPTS[u.cc])){this.unparsedVttFrags.push(p);return}this.onFragLoaded(d.Events.FRAG_LOADED,p)}},t.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},t.onFragParsingUserdata=function(l,p){var u=this.cea608Parser1,f=this.cea608Parser2;if(!(!this.enabled||!(u&&f))){var L=p.frag,v=p.samples;if(!(L.type===P.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(L)==="NONE"))for(var y=0;y<v.length;y++){var n=v[y].bytes;if(n){var s=this.extractCea608Data(n);u.addData(v[y].pts,s[0]),f.addData(v[y].pts,s[1])}}}},t.onBufferFlushing=function(l,p){var u=p.startOffset,f=p.endOffset,L=p.endOffsetSubtitles,v=p.type,y=this.media;if(!(!y||y.currentTime<f)){if(!v||v==="video"){var n=this.captionsTracks;Object.keys(n).forEach(function(e){return(0,x.removeCuesInRange)(n[e],u,f)})}if(this.config.renderTextTracksNatively&&u===0&&L!==void 0){var s=this.textTracks;Object.keys(s).forEach(function(e){return(0,x.removeCuesInRange)(s[e],u,L)})}}},t.extractCea608Data=function(l){for(var p=[[],[]],u=l[0]&31,f=2,L=0;L<u;L++){var v=l[f++],y=127&l[f++],n=127&l[f++];if(!(y===0&&n===0)){var s=(4&v)!==0;if(s){var e=3&v;(e===0||e===1)&&(p[e].push(y),p[e].push(n))}}}return p},i}();function m(i,t){return i&&i.label===t.name&&!(i.textTrack1||i.textTrack2)}function _(i,t,r,l){return Math.min(t,l)-Math.max(i,r)}function o(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>g});var g=function(){function d(E,R){this.subtle=void 0,this.aesIV=void 0,this.subtle=E,this.aesIV=R}var S=d.prototype;return S.decrypt=function(R,x){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},x,R)},d}()},"./src/crypt/aes-decryptor.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>S,removePadding:()=>d});var g=a("./src/utils/typed-array.ts");function d(E){var R=E.byteLength,x=R&&new DataView(E.buffer).getUint8(R-1);return x?(0,g.sliceUint8)(E,0,R-x):E}var S=function(){function E(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var R=E.prototype;return R.uint8ArrayToUint32Array_=function(A){for(var D=new DataView(A),P=new Uint32Array(4),I=0;I<4;I++)P[I]=D.getUint32(I*4);return P},R.initTable=function(){var A=this.sBox,D=this.invSBox,P=this.subMix,I=P[0],c=P[1],m=P[2],_=P[3],o=this.invSubMix,i=o[0],t=o[1],r=o[2],l=o[3],p=new Uint32Array(256),u=0,f=0,L=0;for(L=0;L<256;L++)L<128?p[L]=L<<1:p[L]=L<<1^283;for(L=0;L<256;L++){var v=f^f<<1^f<<2^f<<3^f<<4;v=v>>>8^v&255^99,A[u]=v,D[v]=u;var y=p[u],n=p[y],s=p[n],e=p[v]*257^v*16843008;I[u]=e<<24|e>>>8,c[u]=e<<16|e>>>16,m[u]=e<<8|e>>>24,_[u]=e,e=s*16843009^n*65537^y*257^u*16843008,i[v]=e<<24|e>>>8,t[v]=e<<16|e>>>16,r[v]=e<<8|e>>>24,l[v]=e,u?(u=y^p[p[p[s^y]]],f^=p[p[f]]):u=f=1}},R.expandKey=function(A){for(var D=this.uint8ArrayToUint32Array_(A),P=!0,I=0;I<D.length&&P;)P=D[I]===this.key[I],I++;if(!P){this.key=D;var c=this.keySize=D.length;if(c!==4&&c!==6&&c!==8)throw new Error("Invalid aes key size="+c);var m=this.ksRows=(c+6+1)*4,_,o,i=this.keySchedule=new Uint32Array(m),t=this.invKeySchedule=new Uint32Array(m),r=this.sBox,l=this.rcon,p=this.invSubMix,u=p[0],f=p[1],L=p[2],v=p[3],y,n;for(_=0;_<m;_++){if(_<c){y=i[_]=D[_];continue}n=y,_%c===0?(n=n<<8|n>>>24,n=r[n>>>24]<<24|r[n>>>16&255]<<16|r[n>>>8&255]<<8|r[n&255],n^=l[_/c|0]<<24):c>6&&_%c===4&&(n=r[n>>>24]<<24|r[n>>>16&255]<<16|r[n>>>8&255]<<8|r[n&255]),i[_]=y=(i[_-c]^n)>>>0}for(o=0;o<m;o++)_=m-o,o&3?n=i[_]:n=i[_-4],o<4||_<=4?t[o]=n:t[o]=u[r[n>>>24]]^f[r[n>>>16&255]]^L[r[n>>>8&255]]^v[r[n&255]],t[o]=t[o]>>>0}},R.networkToHostOrderSwap=function(A){return A<<24|(A&65280)<<8|(A&16711680)>>8|A>>>24},R.decrypt=function(A,D,P){for(var I=this.keySize+6,c=this.invKeySchedule,m=this.invSBox,_=this.invSubMix,o=_[0],i=_[1],t=_[2],r=_[3],l=this.uint8ArrayToUint32Array_(P),p=l[0],u=l[1],f=l[2],L=l[3],v=new Int32Array(A),y=new Int32Array(v.length),n,s,e,h,M,T,B,N,j,z,K,V,$,X,Z=this.networkToHostOrderSwap;D<v.length;){for(j=Z(v[D]),z=Z(v[D+1]),K=Z(v[D+2]),V=Z(v[D+3]),M=j^c[0],T=V^c[1],B=K^c[2],N=z^c[3],$=4,X=1;X<I;X++)n=o[M>>>24]^i[T>>16&255]^t[B>>8&255]^r[N&255]^c[$],s=o[T>>>24]^i[B>>16&255]^t[N>>8&255]^r[M&255]^c[$+1],e=o[B>>>24]^i[N>>16&255]^t[M>>8&255]^r[T&255]^c[$+2],h=o[N>>>24]^i[M>>16&255]^t[T>>8&255]^r[B&255]^c[$+3],M=n,T=s,B=e,N=h,$=$+4;n=m[M>>>24]<<24^m[T>>16&255]<<16^m[B>>8&255]<<8^m[N&255]^c[$],s=m[T>>>24]<<24^m[B>>16&255]<<16^m[N>>8&255]<<8^m[M&255]^c[$+1],e=m[B>>>24]<<24^m[N>>16&255]<<16^m[M>>8&255]<<8^m[T&255]^c[$+2],h=m[N>>>24]<<24^m[M>>16&255]<<16^m[T>>8&255]<<8^m[B&255]^c[$+3],y[D]=Z(n^p),y[D+1]=Z(h^u),y[D+2]=Z(e^f),y[D+3]=Z(s^L),p=j,u=z,f=K,L=V,D=D+4}return y.buffer},E}()},"./src/crypt/decrypter.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>D});var g=a("./src/crypt/aes-crypto.ts"),d=a("./src/crypt/fast-aes-key.ts"),S=a("./src/crypt/aes-decryptor.ts"),E=a("./src/utils/logger.ts"),R=a("./src/utils/mp4-tools.ts"),x=a("./src/utils/typed-array.ts"),A=16,D=function(){function P(c,m){var _=m===void 0?{}:m,o=_.removePKCS7Padding,i=o===void 0?!0:o;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=c.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var t=self.crypto;t&&(this.subtle=t.subtle||t.webkitSubtle)}catch(r){}this.subtle===null&&(this.useSoftware=!0)}var I=P.prototype;return I.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},I.isSync=function(){return this.useSoftware},I.flush=function(){var m=this.currentResult,_=this.remainderData;if(!m||_)return this.reset(),null;var o=new Uint8Array(m);return this.reset(),this.removePKCS7Padding?(0,S.removePadding)(o):o},I.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},I.decrypt=function(m,_,o){var i=this;return this.useSoftware?new Promise(function(t,r){i.softwareDecrypt(new Uint8Array(m),_,o);var l=i.flush();l?t(l.buffer):r(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(m),_,o)},I.softwareDecrypt=function(m,_,o){var i=this.currentIV,t=this.currentResult,r=this.remainderData;this.logOnce("JS AES decrypt"),r&&(m=(0,R.appendUint8Array)(r,m),this.remainderData=null);var l=this.getValidChunk(m);if(!l.length)return null;i&&(o=i);var p=this.softwareDecrypter;p||(p=this.softwareDecrypter=new S.default),p.expandKey(_);var u=t;return this.currentResult=p.decrypt(l.buffer,0,o),this.currentIV=(0,x.sliceUint8)(l,-16).buffer,u||null},I.webCryptoDecrypt=function(m,_,o){var i=this,t=this.subtle;return(this.key!==_||!this.fastAesKey)&&(this.key=_,this.fastAesKey=new d.default(t,_)),this.fastAesKey.expandKey().then(function(r){if(!t)return Promise.reject(new Error("web crypto not initialized"));i.logOnce("WebCrypto AES decrypt");var l=new g.default(t,new Uint8Array(o));return l.decrypt(m.buffer,r)}).catch(function(r){return E.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+r.name+": "+r.message),i.onWebCryptoError(m,_,o)})},I.onWebCryptoError=function(m,_,o){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(m,_,o);var i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},I.getValidChunk=function(m){var _=m,o=m.length-m.length%A;return o!==m.length&&(_=(0,x.sliceUint8)(m,0,o),this.remainderData=(0,x.sliceUint8)(m,o)),_},I.logOnce=function(m){!this.logEnabled||(E.logger.log("[decrypter]: "+m),this.logEnabled=!1)},P}()},"./src/crypt/fast-aes-key.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>g});var g=function(){function d(E,R){this.subtle=void 0,this.key=void 0,this.subtle=E,this.key=R}var S=d.prototype;return S.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},d}()},"./src/demux/aacdemuxer.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>D});var g=a("./src/demux/base-audio-demuxer.ts"),d=a("./src/demux/adts.ts"),S=a("./src/utils/logger.ts"),E=a("./src/demux/id3.ts");function R(P,I){P.prototype=Object.create(I.prototype),P.prototype.constructor=P,x(P,I)}function x(P,I){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,_){return m.__proto__=_,m},x(P,I)}var A=function(P){R(I,P);function I(m,_){var o;return o=P.call(this)||this,o.observer=void 0,o.config=void 0,o.observer=m,o.config=_,o}var c=I.prototype;return c.resetInitSegment=function(_,o,i,t){P.prototype.resetInitSegment.call(this,_,o,i,t),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:o,duration:t,inputTimeScale:9e4,dropped:0}},I.probe=function(_){if(!_)return!1;for(var o=E.getID3Data(_,0)||[],i=o.length,t=_.length;i<t;i++)if(d.probe(_,i))return S.logger.log("ADTS sync word found !"),!0;return!1},c.canParse=function(_,o){return d.canParse(_,o)},c.appendFrame=function(_,o,i){d.initTrackConfig(_,this.observer,o,i,_.manifestCodec);var t=d.appendFrame(_,o,i,this.basePTS,this.frameIndex);if(t&&t.missing===0)return t},I}(g.default);const D=A},"./src/demux/adts.ts":(C,b,a)=>{a.r(b),a.d(b,{appendFrame:()=>i,canGetFrameLength:()=>D,canParse:()=>I,getAudioConfig:()=>E,getFrameDuration:()=>_,getFullFrameLength:()=>A,getHeaderLength:()=>x,initTrackConfig:()=>m,isHeader:()=>P,isHeaderPattern:()=>R,parseFrameHeader:()=>o,probe:()=>c});var g=a("./src/utils/logger.ts"),d=a("./src/errors.ts"),S=a("./src/events.ts");function E(t,r,l,p){var u,f,L,v,y=navigator.userAgent.toLowerCase(),n=p,s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];u=((r[l+2]&192)>>>6)+1;var e=(r[l+2]&60)>>>2;if(e>s.length-1){t.trigger(S.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+e});return}return L=(r[l+2]&1)<<2,L|=(r[l+3]&192)>>>6,g.logger.log("manifest codec:"+p+", ADTS type:"+u+", samplingIndex:"+e),/firefox/i.test(y)?e>=6?(u=5,v=new Array(4),f=e-3):(u=2,v=new Array(2),f=e):y.indexOf("android")!==-1?(u=2,v=new Array(2),f=e):(u=5,v=new Array(4),p&&(p.indexOf("mp4a.40.29")!==-1||p.indexOf("mp4a.40.5")!==-1)||!p&&e>=6?f=e-3:((p&&p.indexOf("mp4a.40.2")!==-1&&(e>=6&&L===1||/vivaldi/i.test(y))||!p&&L===1)&&(u=2,v=new Array(2)),f=e)),v[0]=u<<3,v[0]|=(e&14)>>1,v[1]|=(e&1)<<7,v[1]|=L<<3,u===5&&(v[1]|=(f&14)>>1,v[2]=(f&1)<<7,v[2]|=8,v[3]=0),{config:v,samplerate:s[e],channelCount:L,codec:"mp4a.40."+u,manifestCodec:n}}function R(t,r){return t[r]===255&&(t[r+1]&246)===240}function x(t,r){return t[r+1]&1?7:9}function A(t,r){return(t[r+3]&3)<<11|t[r+4]<<3|(t[r+5]&224)>>>5}function D(t,r){return r+5<t.length}function P(t,r){return r+1<t.length&&R(t,r)}function I(t,r){return D(t,r)&&R(t,r)&&A(t,r)<=t.length-r}function c(t,r){if(P(t,r)){var l=x(t,r);if(r+l>=t.length)return!1;var p=A(t,r);if(p<=l)return!1;var u=r+p;return u===t.length||P(t,u)}return!1}function m(t,r,l,p,u){if(!t.samplerate){var f=E(r,l,p,u);if(!f)return;t.config=f.config,t.samplerate=f.samplerate,t.channelCount=f.channelCount,t.codec=f.codec,t.manifestCodec=f.manifestCodec,g.logger.log("parsed codec:"+t.codec+", rate:"+f.samplerate+", channels:"+f.channelCount)}}function _(t){return 9216e4/t}function o(t,r){var l=x(t,r);if(r+l<=t.length){var p=A(t,r)-l;if(p>0)return{headerLength:l,frameLength:p}}}function i(t,r,l,p,u){var f=_(t.samplerate),L=p+u*f,v=o(r,l),y;if(v){var n=v.frameLength,s=v.headerLength,e=s+n,h=Math.max(0,l+e-r.length);h?(y=new Uint8Array(e-s),y.set(r.subarray(l+s,r.length),0)):y=r.subarray(l+s,l+e);var M={unit:y,pts:L};return h||t.samples.push(M),{sample:M,length:e,missing:h}}var T=r.length-l;y=new Uint8Array(T),y.set(r.subarray(l,r.length),0);var B={unit:y,pts:L};return{sample:B,length:T,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>P,initPTSFn:()=>D});var g=a("./src/polyfills/number.ts"),d=a("./src/demux/id3.ts"),S=a("./src/types/demuxer.ts"),E=a("./src/demux/dummy-demuxed-track.ts"),R=a("./src/utils/mp4-tools.ts"),x=a("./src/utils/typed-array.ts"),A=function(){function I(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var c=I.prototype;return c.resetInitSegment=function(_,o,i,t){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},c.resetTimeStamp=function(_){this.initPTS=_,this.resetContiguity()},c.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},c.canParse=function(_,o){return!1},c.appendFrame=function(_,o,i){},c.demux=function(_,o){this.cachedData&&(_=(0,R.appendUint8Array)(this.cachedData,_),this.cachedData=null);var i=d.getID3Data(_,0),t=i?i.length:0,r,l=this._audioTrack,p=this._id3Track,u=i?d.getTimeStamp(i):void 0,f=_.length;for((this.basePTS===null||this.frameIndex===0&&(0,g.isFiniteNumber)(u))&&(this.basePTS=D(u,o,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&p.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:S.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});t<f;){if(this.canParse(_,t)){var L=this.appendFrame(l,_,t);L?(this.frameIndex++,this.lastPTS=L.sample.pts,t+=L.length,r=t):t=f}else d.canParse(_,t)?(i=d.getID3Data(_,t),p.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:S.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),t+=i.length,r=t):t++;if(t===f&&r!==f){var v=(0,x.sliceUint8)(_,r);this.cachedData?this.cachedData=(0,R.appendUint8Array)(this.cachedData,v):this.cachedData=v}}return{audioTrack:l,videoTrack:(0,E.dummyTrack)(),id3Track:p,textTrack:(0,E.dummyTrack)()}},c.demuxSampleAes=function(_,o,i){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},c.flush=function(_){var o=this.cachedData;return o&&(this.cachedData=null,this.demux(o,0)),{audioTrack:this._audioTrack,videoTrack:(0,E.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,E.dummyTrack)()}},c.destroy=function(){},I}(),D=function(c,m,_){return(0,g.isFiniteNumber)(c)?c*90:m*9e4+(_||0)};const P=A},"./src/demux/chunk-cache.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>g});var g=function(){function S(){this.chunks=[],this.dataLength=0}var E=S.prototype;return E.push=function(x){this.chunks.push(x),this.dataLength+=x.length},E.flush=function(){var x=this.chunks,A=this.dataLength,D;if(x.length)x.length===1?D=x[0]:D=d(x,A);else return new Uint8Array(0);return this.reset(),D},E.reset=function(){this.chunks.length=0,this.dataLength=0},S}();function d(S,E){for(var R=new Uint8Array(E),x=0,A=0;A<S.length;A++){var D=S[A];R.set(D,x),x+=D.length}return R}},"./src/demux/dummy-demuxed-track.ts":(C,b,a)=>{a.r(b),a.d(b,{dummyTrack:()=>g});function g(d,S){return d===void 0&&(d=""),S===void 0&&(S=9e4),{type:d,id:-1,pid:-1,inputTimeScale:S,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>S});var g=a("./src/utils/logger.ts"),d=function(){function E(x){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=x,this.bytesAvailable=x.byteLength,this.word=0,this.bitsAvailable=0}var R=E.prototype;return R.loadWord=function(){var A=this.data,D=this.bytesAvailable,P=A.byteLength-D,I=new Uint8Array(4),c=Math.min(4,D);if(c===0)throw new Error("no bytes available");I.set(A.subarray(P,P+c)),this.word=new DataView(I.buffer).getUint32(0),this.bitsAvailable=c*8,this.bytesAvailable-=c},R.skipBits=function(A){var D;A=Math.min(A,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>A?(this.word<<=A,this.bitsAvailable-=A):(A-=this.bitsAvailable,D=A>>3,A-=D<<3,this.bytesAvailable-=D,this.loadWord(),this.word<<=A,this.bitsAvailable-=A)},R.readBits=function(A){var D=Math.min(this.bitsAvailable,A),P=this.word>>>32-D;if(A>32&&g.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=D,this.bitsAvailable>0)this.word<<=D;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return D=A-D,D>0&&this.bitsAvailable?P<<D|this.readBits(D):P},R.skipLZ=function(){var A;for(A=0;A<this.bitsAvailable;++A)if((this.word&2147483648>>>A)!==0)return this.word<<=A,this.bitsAvailable-=A,A;return this.loadWord(),A+this.skipLZ()},R.skipUEG=function(){this.skipBits(1+this.skipLZ())},R.skipEG=function(){this.skipBits(1+this.skipLZ())},R.readUEG=function(){var A=this.skipLZ();return this.readBits(A+1)-1},R.readEG=function(){var A=this.readUEG();return 1&A?1+A>>>1:-1*(A>>>1)},R.readBoolean=function(){return this.readBits(1)===1},R.readUByte=function(){return this.readBits(8)},R.readUShort=function(){return this.readBits(16)},R.readUInt=function(){return this.readBits(32)},R.skipScalingList=function(A){for(var D=8,P=8,I,c=0;c<A;c++)P!==0&&(I=this.readEG(),P=(D+I+256)%256),D=P===0?D:P},R.readSPS=function(){var A=0,D=0,P=0,I=0,c,m,_,o=this.readUByte.bind(this),i=this.readBits.bind(this),t=this.readUEG.bind(this),r=this.readBoolean.bind(this),l=this.skipBits.bind(this),p=this.skipEG.bind(this),u=this.skipUEG.bind(this),f=this.skipScalingList.bind(this);o();var L=o();if(i(5),l(3),o(),u(),L===100||L===110||L===122||L===244||L===44||L===83||L===86||L===118||L===128){var v=t();if(v===3&&l(1),u(),u(),l(1),r())for(m=v!==3?8:12,_=0;_<m;_++)r()&&(_<6?f(16):f(64))}u();var y=t();if(y===0)t();else if(y===1)for(l(1),p(),p(),c=t(),_=0;_<c;_++)p();u(),l(1);var n=t(),s=t(),e=i(1);e===0&&l(1),l(1),r()&&(A=t(),D=t(),P=t(),I=t());var h=[1,1];if(r()&&r()){var M=o();switch(M){case 1:h=[1,1];break;case 2:h=[12,11];break;case 3:h=[10,11];break;case 4:h=[16,11];break;case 5:h=[40,33];break;case 6:h=[24,11];break;case 7:h=[20,11];break;case 8:h=[32,11];break;case 9:h=[80,33];break;case 10:h=[18,11];break;case 11:h=[15,11];break;case 12:h=[64,33];break;case 13:h=[160,99];break;case 14:h=[4,3];break;case 15:h=[3,2];break;case 16:h=[2,1];break;case 255:{h=[o()<<8|o(),o()<<8|o()];break}}}return{width:Math.ceil((n+1)*16-A*2-D*2),height:(2-e)*(s+1)*16-(e?2:4)*(P+I),pixelRatio:h}},R.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},E}();const S=d},"./src/demux/id3.ts":(C,b,a)=>{a.r(b),a.d(b,{canParse:()=>R,decodeFrame:()=>I,getID3Data:()=>S,getID3Frames:()=>P,getTimeStamp:()=>x,isFooter:()=>d,isHeader:()=>g,isTimeStampFrame:()=>A,testables:()=>t,utf8ArrayToStr:()=>i});var g=function(u,f){return f+10<=u.length&&u[f]===73&&u[f+1]===68&&u[f+2]===51&&u[f+3]<255&&u[f+4]<255&&u[f+6]<128&&u[f+7]<128&&u[f+8]<128&&u[f+9]<128},d=function(u,f){return f+10<=u.length&&u[f]===51&&u[f+1]===68&&u[f+2]===73&&u[f+3]<255&&u[f+4]<255&&u[f+6]<128&&u[f+7]<128&&u[f+8]<128&&u[f+9]<128},S=function(u,f){for(var L=f,v=0;g(u,f);){v+=10;var y=E(u,f+6);v+=y,d(u,f+10)&&(v+=10),f+=v}if(v>0)return u.subarray(L,L+v)},E=function(u,f){var L=0;return L=(u[f]&127)<<21,L|=(u[f+1]&127)<<14,L|=(u[f+2]&127)<<7,L|=u[f+3]&127,L},R=function(u,f){return g(u,f)&&E(u,f+6)+10<=u.length-f},x=function(u){for(var f=P(u),L=0;L<f.length;L++){var v=f[L];if(A(v))return o(v)}},A=function(u){return u&&u.key==="PRIV"&&u.info==="com.apple.streaming.transportStreamTimestamp"},D=function(u){var f=String.fromCharCode(u[0],u[1],u[2],u[3]),L=E(u,4),v=10;return{type:f,size:L,data:u.subarray(v,v+L)}},P=function(u){for(var f=0,L=[];g(u,f);){var v=E(u,f+6);f+=10;for(var y=f+v;f+8<y;){var n=D(u.subarray(f)),s=I(n);s&&L.push(s),f+=n.size+10}d(u,f)&&(f+=10)}return L},I=function(u){return u.type==="PRIV"?c(u):u.type[0]==="W"?_(u):m(u)},c=function(u){if(!(u.size<2)){var f=i(u.data,!0),L=new Uint8Array(u.data.subarray(f.length+1));return{key:u.type,info:f,data:L.buffer}}},m=function(u){if(!(u.size<2)){if(u.type==="TXXX"){var f=1,L=i(u.data.subarray(f),!0);f+=L.length+1;var v=i(u.data.subarray(f));return{key:u.type,info:L,data:v}}var y=i(u.data.subarray(1));return{key:u.type,data:y}}},_=function(u){if(u.type==="WXXX"){if(u.size<2)return;var f=1,L=i(u.data.subarray(f),!0);f+=L.length+1;var v=i(u.data.subarray(f));return{key:u.type,info:L,data:v}}var y=i(u.data);return{key:u.type,data:y}},o=function(u){if(u.data.byteLength===8){var f=new Uint8Array(u.data),L=f[3]&1,v=(f[4]<<23)+(f[5]<<15)+(f[6]<<7)+f[7];return v/=45,L&&(v+=4772185884e-2),Math.round(v)}},i=function(u,f){f===void 0&&(f=!1);var L=l();if(L){var v=L.decode(u);if(f){var y=v.indexOf("\0");return y!==-1?v.substring(0,y):v}return v.replace(/\0/g,"")}for(var n=u.length,s,e,h,M="",T=0;T<n;){if(s=u[T++],s===0&&f)return M;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:M+=String.fromCharCode(s);break;case 12:case 13:e=u[T++],M+=String.fromCharCode((s&31)<<6|e&63);break;case 14:e=u[T++],h=u[T++],M+=String.fromCharCode((s&15)<<12|(e&63)<<6|(h&63)<<0);break}}return M},t={decodeTextFrame:m},r;function l(){return!r&&typeof self.TextDecoder!="undefined"&&(r=new self.TextDecoder("utf-8")),r}},"./src/demux/mp3demuxer.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>D});var g=a("./src/demux/base-audio-demuxer.ts"),d=a("./src/demux/id3.ts"),S=a("./src/utils/logger.ts"),E=a("./src/demux/mpegaudio.ts");function R(P,I){P.prototype=Object.create(I.prototype),P.prototype.constructor=P,x(P,I)}function x(P,I){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,_){return m.__proto__=_,m},x(P,I)}var A=function(P){R(I,P);function I(){return P.apply(this,arguments)||this}var c=I.prototype;return c.resetInitSegment=function(_,o,i,t){P.prototype.resetInitSegment.call(this,_,o,i,t),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:o,duration:t,inputTimeScale:9e4,dropped:0}},I.probe=function(_){if(!_)return!1;for(var o=d.getID3Data(_,0)||[],i=o.length,t=_.length;i<t;i++)if(E.probe(_,i))return S.logger.log("MPEG Audio sync word found !"),!0;return!1},c.canParse=function(_,o){return E.canParse(_,o)},c.appendFrame=function(_,o,i){if(this.basePTS!==null)return E.appendFrame(_,o,i,this.basePTS,this.frameIndex)},I}(g.default);const D=A},"./src/demux/mp4demuxer.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>A});var g=a("./src/polyfills/number.ts"),d=a("./src/types/demuxer.ts"),S=a("./src/utils/mp4-tools.ts"),E=a("./src/demux/dummy-demuxed-track.ts"),R=/\/emsg[-/]ID3/i,x=function(){function D(I,c){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=c}var P=D.prototype;return P.resetTimeStamp=function(){},P.resetInitSegment=function(c,m,_,o){var i=this.videoTrack=(0,E.dummyTrack)("video",1),t=this.audioTrack=(0,E.dummyTrack)("audio",1),r=this.txtTrack=(0,E.dummyTrack)("text",1);if(this.id3Track=(0,E.dummyTrack)("id3",1),this.timeOffset=0,!(!c||!c.byteLength)){var l=(0,S.parseInitSegment)(c);if(l.video){var p=l.video,u=p.id,f=p.timescale,L=p.codec;i.id=u,i.timescale=r.timescale=f,i.codec=L}if(l.audio){var v=l.audio,y=v.id,n=v.timescale,s=v.codec;t.id=y,t.timescale=n,t.codec=s}r.id=S.RemuxerTrackIdConfig.text,i.sampleDuration=0,i.duration=t.duration=o}},P.resetContiguity=function(){},D.probe=function(c){return c=c.length>16384?c.subarray(0,16384):c,(0,S.findBox)(c,["moof"]).length>0},P.demux=function(c,m){this.timeOffset=m;var _=c,o=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(_=(0,S.appendUint8Array)(this.remainderData,c));var t=(0,S.segmentValidRange)(_);this.remainderData=t.remainder,o.samples=t.valid||new Uint8Array}else o.samples=_;var r=this.extractID3Track(o,m);return i.samples=(0,S.parseSamples)(m,o),{videoTrack:o,audioTrack:this.audioTrack,id3Track:r,textTrack:this.txtTrack}},P.flush=function(){var c=this.timeOffset,m=this.videoTrack,_=this.txtTrack;m.samples=this.remainderData||new Uint8Array,this.remainderData=null;var o=this.extractID3Track(m,this.timeOffset);return _.samples=(0,S.parseSamples)(c,m),{videoTrack:m,audioTrack:(0,E.dummyTrack)(),id3Track:o,textTrack:(0,E.dummyTrack)()}},P.extractID3Track=function(c,m){var _=this.id3Track;if(c.samples.length){var o=(0,S.findBox)(c.samples,["emsg"]);o&&o.forEach(function(i){var t=(0,S.parseEmsg)(i);if(R.test(t.schemeIdUri)){var r=(0,g.isFiniteNumber)(t.presentationTime)?t.presentationTime/t.timeScale:m+t.presentationTimeDelta/t.timeScale,l=t.eventDuration===4294967295?Number.POSITIVE_INFINITY:t.eventDuration/t.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);var p=t.payload;_.samples.push({data:p,len:p.byteLength,dts:r,pts:r,type:d.MetadataSchema.emsg,duration:l})}})}return _},P.demuxSampleAes=function(c,m,_){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},P.destroy=function(){},D}();const A=x},"./src/demux/mpegaudio.ts":(C,b,a)=>{a.r(b),a.d(b,{appendFrame:()=>x,canParse:()=>I,isHeader:()=>P,isHeaderPattern:()=>D,parseHeader:()=>A,probe:()=>c});var g=null,d=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],S=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],E=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],R=[0,1,1,4];function x(m,_,o,i,t){if(!(o+24>_.length)){var r=A(_,o);if(r&&o+r.frameLength<=_.length){var l=r.samplesPerFrame*9e4/r.sampleRate,p=i+t*l,u={unit:_.subarray(o,o+r.frameLength),pts:p,dts:p};return m.config=[],m.channelCount=r.channelCount,m.samplerate=r.sampleRate,m.samples.push(u),{sample:u,length:r.frameLength,missing:0}}}}function A(m,_){var o=m[_+1]>>3&3,i=m[_+1]>>1&3,t=m[_+2]>>4&15,r=m[_+2]>>2&3;if(o!==1&&t!==0&&t!==15&&r!==3){var l=m[_+2]>>1&1,p=m[_+3]>>6,u=o===3?3-i:i===3?3:4,f=d[u*14+t-1]*1e3,L=o===3?0:o===2?1:2,v=S[L*3+r],y=p===3?1:2,n=E[o][i],s=R[i],e=n*8*s,h=Math.floor(n*f/v+l)*s;if(g===null){var M=navigator.userAgent||"",T=M.match(/Chrome\/(\d+)/i);g=T?parseInt(T[1]):0}var B=!!g&&g<=87;return B&&i===2&&f>=224e3&&p===0&&(m[_+3]=m[_+3]|128),{sampleRate:v,channelCount:y,frameLength:h,samplesPerFrame:e}}}function D(m,_){return m[_]===255&&(m[_+1]&224)===224&&(m[_+1]&6)!==0}function P(m,_){return _+1<m.length&&D(m,_)}function I(m,_){var o=4;return D(m,_)&&o<=m.length-_}function c(m,_){if(_+1<m.length&&D(m,_)){var o=4,i=A(m,_),t=o;i!=null&&i.frameLength&&(t=i.frameLength);var r=_+t;return r===m.length||P(m,r)}return!1}},"./src/demux/sample-aes.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>E});var g=a("./src/crypt/decrypter.ts"),d=a("./src/utils/mp4-tools.ts"),S=function(){function R(A,D,P){this.keyData=void 0,this.decrypter=void 0,this.keyData=P,this.decrypter=new g.default(D,{removePKCS7Padding:!1})}var x=R.prototype;return x.decryptBuffer=function(D){return this.decrypter.decrypt(D,this.keyData.key.buffer,this.keyData.iv.buffer)},x.decryptAacSample=function(D,P,I){var c=this,m=D[P].unit;if(!(m.length<=16)){var _=m.subarray(16,m.length-m.length%16),o=_.buffer.slice(_.byteOffset,_.byteOffset+_.length);this.decryptBuffer(o).then(function(i){var t=new Uint8Array(i);m.set(t,16),c.decrypter.isSync()||c.decryptAacSamples(D,P+1,I)})}},x.decryptAacSamples=function(D,P,I){for(;;P++){if(P>=D.length){I();return}if(!(D[P].unit.length<32)&&(this.decryptAacSample(D,P,I),!this.decrypter.isSync()))return}},x.getAvcEncryptedData=function(D){for(var P=Math.floor((D.length-48)/160)*16+16,I=new Int8Array(P),c=0,m=32;m<D.length-16;m+=160,c+=16)I.set(D.subarray(m,m+16),c);return I},x.getAvcDecryptedUnit=function(D,P){for(var I=new Uint8Array(P),c=0,m=32;m<D.length-16;m+=160,c+=16)D.set(I.subarray(c,c+16),m);return D},x.decryptAvcSample=function(D,P,I,c,m){var _=this,o=(0,d.discardEPB)(m.data),i=this.getAvcEncryptedData(o);this.decryptBuffer(i.buffer).then(function(t){m.data=_.getAvcDecryptedUnit(o,t),_.decrypter.isSync()||_.decryptAvcSamples(D,P,I+1,c)})},x.decryptAvcSamples=function(D,P,I,c){if(D instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;P++,I=0){if(P>=D.length){c();return}for(var m=D[P].units;!(I>=m.length);I++){var _=m[I];if(!(_.data.length<=48||_.type!==1&&_.type!==5)&&(this.decryptAvcSample(D,P,I,c,_),!this.decrypter.isSync()))return}}},R}();const E=S},"./src/demux/transmuxer-interface.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>P});var g=a("./src/demux/webworkify-webpack.js"),d=a("./src/events.ts"),S=a("./src/demux/transmuxer.ts"),E=a("./src/utils/logger.ts"),R=a("./src/errors.ts"),x=a("./src/utils/mediasource-helper.ts"),A=a("./node_modules/eventemitter3/index.js"),D=(0,x.getMediaSource)()||{isTypeSupported:function(){return!1}},P=function(){function I(m,_,o,i){var t=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var r=m.config;this.hls=m,this.id=_,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=o,this.onFlush=i;var l=function(v,y){y=y||{},y.frag=t.frag,y.id=t.id,t.hls.trigger(v,y)};this.observer=new A.EventEmitter,this.observer.on(d.Events.FRAG_DECRYPTED,l),this.observer.on(d.Events.ERROR,l);var p={mp4:D.isTypeSupported("video/mp4"),mpeg:D.isTypeSupported("audio/mpeg"),mp3:D.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"){E.logger.log("demuxing in webworker");var f;try{f=this.worker=(0,g.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),f.addEventListener("message",this.onwmsg),f.onerror=function(L){t.useWorker=!1,E.logger.warn("Exception in webworker, fallback to inline"),t.hls.trigger(d.Events.ERROR,{type:R.ErrorTypes.OTHER_ERROR,details:R.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(L.message+"  ("+L.filename+":"+L.lineno+")")})},f.postMessage({cmd:"init",typeSupported:p,vendor:u,id:_,config:JSON.stringify(r)})}catch(L){E.logger.warn("Error in worker:",L),E.logger.error("Error while initializing DemuxerWorker, fallback to inline"),f&&self.URL.revokeObjectURL(f.objectURL),this.transmuxer=new S.default(this.observer,p,r,u,_),this.worker=null}}else this.transmuxer=new S.default(this.observer,p,r,u,_)}var c=I.prototype;return c.destroy=function(){var _=this.worker;if(_)_.removeEventListener("message",this.onwmsg),_.terminate(),this.worker=null,this.onwmsg=void 0;else{var o=this.transmuxer;o&&(o.destroy(),this.transmuxer=null)}var i=this.observer;i&&i.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},c.push=function(_,o,i,t,r,l,p,u,f,L){var v,y,n=this;f.transmuxing.start=self.performance.now();var s=this.transmuxer,e=this.worker,h=l?l.start:r.start,M=r.decryptdata,T=this.frag,B=!(T&&r.cc===T.cc),N=!(T&&f.level===T.level),j=T?f.sn-T.sn:-1,z=this.part?f.part-this.part.index:-1,K=j===0&&f.id>1&&f.id===(T==null?void 0:T.stats.chunkCount),V=!N&&(j===1||j===0&&(z===1||K&&z<=0)),$=self.performance.now();(N||j||r.stats.parsing.start===0)&&(r.stats.parsing.start=$),l&&(z||!V)&&(l.stats.parsing.start=$);var X=!(T&&((v=r.initSegment)===null||v===void 0?void 0:v.url)===((y=T.initSegment)===null||y===void 0?void 0:y.url)),Z=new S.TransmuxState(B,V,u,N,h,X);if(!V||B||X){E.logger.log("[transmuxer-interface, "+r.type+"]: Starting new transmux session for sn: "+f.sn+" p: "+f.part+" level: "+f.level+" id: "+f.id+`
        discontinuity: `+B+`
        trackSwitch: `+N+`
        contiguous: `+V+`
        accurateTimeOffset: `+u+`
        timeOffset: `+h+`
        initSegmentChange: `+X);var q=new S.TransmuxConfig(i,t,o,p,L);this.configureTransmuxer(q)}if(this.frag=r,this.part=l,e)e.postMessage({cmd:"demux",data:_,decryptdata:M,chunkMeta:f,state:Z},_ instanceof ArrayBuffer?[_]:[]);else if(s){var te=s.push(_,M,f,Z);(0,S.isPromise)(te)?(s.async=!0,te.then(function(ue){n.handleTransmuxComplete(ue)}).catch(function(ue){n.transmuxerError(ue,f,"transmuxer-interface push error")})):(s.async=!1,this.handleTransmuxComplete(te))}},c.flush=function(_){var o=this;_.transmuxing.start=self.performance.now();var i=this.transmuxer,t=this.worker;if(t)t.postMessage({cmd:"flush",chunkMeta:_});else if(i){var r=i.flush(_),l=(0,S.isPromise)(r);l||i.async?((0,S.isPromise)(r)||(r=Promise.resolve(r)),r.then(function(p){o.handleFlushResult(p,_)}).catch(function(p){o.transmuxerError(p,_,"transmuxer-interface flush error")})):this.handleFlushResult(r,_)}},c.transmuxerError=function(_,o,i){!this.hls||this.hls.trigger(d.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:o,fatal:!1,error:_,err:_,reason:i})},c.handleFlushResult=function(_,o){var i=this;_.forEach(function(t){i.handleTransmuxComplete(t)}),this.onFlush(o)},c.onWorkerMessage=function(_){var o=_.data,i=this.hls;switch(o.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(o.data);break}case"flush":{this.onFlush(o.data);break}case"workerLog":E.logger[o.data.logType]&&E.logger[o.data.logType](o.data.message);break;default:{o.data=o.data||{},o.data.frag=this.frag,o.data.id=this.id,i.trigger(o.event,o.data);break}}},c.configureTransmuxer=function(_){var o=this.worker,i=this.transmuxer;o?o.postMessage({cmd:"configure",config:_}):i&&i.configure(_)},c.handleTransmuxComplete=function(_){_.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(_)},I}()},"./src/demux/transmuxer-worker.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>x});var g=a("./src/demux/transmuxer.ts"),d=a("./src/events.ts"),S=a("./src/utils/logger.ts"),E=a("./node_modules/eventemitter3/index.js"),R=a("./src/errors.ts");function x(c){var m=new E.EventEmitter,_=function(t,r){c.postMessage({event:t,data:r})};m.on(d.Events.FRAG_DECRYPTED,_),m.on(d.Events.ERROR,_);var o=function(){var t=function(p){var u=function(L){_("workerLog",{logType:p,message:L})};S.logger[p]=u};for(var r in S.logger)t(r)};c.addEventListener("message",function(i){var t=i.data;switch(t.cmd){case"init":{var r=JSON.parse(t.config);c.transmuxer=new g.default(m,t.typeSupported,r,t.vendor,t.id),(0,S.enableLogs)(r.debug,t.id),o(),_("init",null);break}case"configure":{c.transmuxer.configure(t.config);break}case"demux":{var l=c.transmuxer.push(t.data,t.decryptdata,t.chunkMeta,t.state);(0,g.isPromise)(l)?(c.transmuxer.async=!0,l.then(function(L){A(c,L)}).catch(function(L){_(d.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:t.chunkMeta,fatal:!1,error:L,err:L,reason:"transmuxer-worker push error"})})):(c.transmuxer.async=!1,A(c,l));break}case"flush":{var p=t.chunkMeta,u=c.transmuxer.flush(p),f=(0,g.isPromise)(u);f||c.transmuxer.async?((0,g.isPromise)(u)||(u=Promise.resolve(u)),u.then(function(L){P(c,L,p)}).catch(function(L){_(d.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:t.chunkMeta,fatal:!1,error:L,err:L,reason:"transmuxer-worker flush error"})})):P(c,u,p);break}}})}function A(c,m){if(I(m.remuxResult))return!1;var _=[],o=m.remuxResult,i=o.audio,t=o.video;return i&&D(_,i),t&&D(_,t),c.postMessage({event:"transmuxComplete",data:m},_),!0}function D(c,m){m.data1&&c.push(m.data1.buffer),m.data2&&c.push(m.data2.buffer)}function P(c,m,_){var o=m.reduce(function(i,t){return A(c,t)||i},!1);o||c.postMessage({event:"transmuxComplete",data:m[0]}),c.postMessage({event:"flush",data:_})}function I(c){return!c.audio&&!c.video&&!c.text&&!c.id3&&!c.initSegment}},"./src/demux/transmuxer.ts":(C,b,a)=>{a.r(b),a.d(b,{TransmuxConfig:()=>r,TransmuxState:()=>l,default:()=>_,isPromise:()=>t});var g=a("./src/events.ts"),d=a("./src/errors.ts"),S=a("./src/crypt/decrypter.ts"),E=a("./src/demux/aacdemuxer.ts"),R=a("./src/demux/mp4demuxer.ts"),x=a("./src/demux/tsdemuxer.ts"),A=a("./src/demux/mp3demuxer.ts"),D=a("./src/remux/mp4-remuxer.ts"),P=a("./src/remux/passthrough-remuxer.ts"),I=a("./src/utils/logger.ts"),c;try{c=self.performance.now.bind(self.performance)}catch(p){I.logger.debug("Unable to use Performance API on this environment"),c=self.Date.now}var m=[{demux:R.default,remux:P.default},{demux:x.default,remux:D.default},{demux:E.default,remux:D.default},{demux:A.default,remux:D.default}],_=function(){function p(f,L,v,y,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=f,this.typeSupported=L,this.config=v,this.vendor=y,this.id=n}var u=p.prototype;return u.configure=function(L){this.transmuxConfig=L,this.decrypter&&this.decrypter.reset()},u.push=function(L,v,y,n){var s=this,e=y.transmuxing;e.executeStart=c();var h=new Uint8Array(L),M=this.currentTransmuxState,T=this.transmuxConfig;n&&(this.currentTransmuxState=n);var B=n||M,N=B.contiguous,j=B.discontinuity,z=B.trackSwitch,K=B.accurateTimeOffset,V=B.timeOffset,$=B.initSegmentChange,X=T.audioCodec,Z=T.videoCodec,q=T.defaultInitPts,te=T.duration,ue=T.initSegmentData,oe=o(h,v);if(oe&&oe.method==="AES-128"){var le=this.getDecrypter();if(le.isSync()){var me=le.softwareDecrypt(h,oe.key.buffer,oe.iv.buffer),_e=y.part>-1;if(_e&&(me=le.flush()),!me)return e.executeEnd=c(),i(y);h=new Uint8Array(me)}else return this.decryptionPromise=le.webCryptoDecrypt(h,oe.key.buffer,oe.iv.buffer).then(function(Le){var De=s.push(Le,null,y);return s.decryptionPromise=null,De}),this.decryptionPromise}var ve=this.needsProbing(j,z);ve&&this.configureTransmuxer(h),(j||z||$||ve)&&this.resetInitSegment(ue,X,Z,te,v),(j||$||ve)&&this.resetInitialTimestamp(q),N||this.resetContiguity();var ce=this.transmux(h,oe,V,K,y),he=this.currentTransmuxState;return he.contiguous=!0,he.discontinuity=!1,he.trackSwitch=!1,e.executeEnd=c(),ce},u.flush=function(L){var v=this,y=L.transmuxing;y.executeStart=c();var n=this.decrypter,s=this.currentTransmuxState,e=this.decryptionPromise;if(e)return e.then(function(){return v.flush(L)});var h=[],M=s.timeOffset;if(n){var T=n.flush();T&&h.push(this.push(T,null,L))}var B=this.demuxer,N=this.remuxer;if(!B||!N)return this.observer.emit(g.Events.ERROR,g.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),y.executeEnd=c(),[i(L)];var j=B.flush(M);return t(j)?j.then(function(z){return v.flushRemux(h,z,L),h}):(this.flushRemux(h,j,L),h)},u.flushRemux=function(L,v,y){var n=v.audioTrack,s=v.videoTrack,e=v.id3Track,h=v.textTrack,M=this.currentTransmuxState,T=M.accurateTimeOffset,B=M.timeOffset;I.logger.log("[transmuxer.ts]: Flushed fragment "+y.sn+(y.part>-1?" p: "+y.part:"")+" of level "+y.level);var N=this.remuxer.remux(n,s,e,h,B,T,!0,this.id);L.push({remuxResult:N,chunkMeta:y}),y.transmuxing.executeEnd=c()},u.resetInitialTimestamp=function(L){var v=this.demuxer,y=this.remuxer;!v||!y||(v.resetTimeStamp(L),y.resetTimeStamp(L))},u.resetContiguity=function(){var L=this.demuxer,v=this.remuxer;!L||!v||(L.resetContiguity(),v.resetNextTimestamp())},u.resetInitSegment=function(L,v,y,n,s){var e=this.demuxer,h=this.remuxer;!e||!h||(e.resetInitSegment(L,v,y,n),h.resetInitSegment(L,v,y,s))},u.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},u.transmux=function(L,v,y,n,s){var e;return v&&v.method==="SAMPLE-AES"?e=this.transmuxSampleAes(L,v,y,n,s):e=this.transmuxUnencrypted(L,y,n,s),e},u.transmuxUnencrypted=function(L,v,y,n){var s=this.demuxer.demux(L,v,!1,!this.config.progressive),e=s.audioTrack,h=s.videoTrack,M=s.id3Track,T=s.textTrack,B=this.remuxer.remux(e,h,M,T,v,y,!1,this.id);return{remuxResult:B,chunkMeta:n}},u.transmuxSampleAes=function(L,v,y,n,s){var e=this;return this.demuxer.demuxSampleAes(L,v,y).then(function(h){var M=e.remuxer.remux(h.audioTrack,h.videoTrack,h.id3Track,h.textTrack,y,n,!1,e.id);return{remuxResult:M,chunkMeta:s}})},u.configureTransmuxer=function(L){for(var v=this.config,y=this.observer,n=this.typeSupported,s=this.vendor,e,h=0,M=m.length;h<M;h++)if(m[h].demux.probe(L)){e=m[h];break}e||(I.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),e={demux:R.default,remux:P.default});var T=this.demuxer,B=this.remuxer,N=e.remux,j=e.demux;(!B||!(B instanceof N))&&(this.remuxer=new N(y,v,n,s)),(!T||!(T instanceof j))&&(this.demuxer=new j(y,v,n),this.probe=j.probe)},u.needsProbing=function(L,v){return!this.demuxer||!this.remuxer||L||v},u.getDecrypter=function(){var L=this.decrypter;return L||(L=this.decrypter=new S.default(this.config)),L},p}();function o(p,u){var f=null;return p.byteLength>0&&u!=null&&u.key!=null&&u.iv!==null&&u.method!=null&&(f=u),f}var i=function(u){return{remuxResult:{},chunkMeta:u}};function t(p){return"then"in p&&p.then instanceof Function}var r=function(u,f,L,v,y){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=u,this.videoCodec=f,this.initSegmentData=L,this.duration=v,this.defaultInitPts=y},l=function(u,f,L,v,y,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=u,this.contiguous=f,this.accurateTimeOffset=L,this.trackSwitch=v,this.timeOffset=y,this.initSegmentChange=n}},"./src/demux/tsdemuxer.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>p});var g=a("./src/demux/adts.ts"),d=a("./src/demux/mpegaudio.ts"),S=a("./src/demux/exp-golomb.ts"),E=a("./src/demux/sample-aes.ts"),R=a("./src/events.ts"),x=a("./src/utils/mp4-tools.ts"),A=a("./src/utils/logger.ts"),D=a("./src/errors.ts"),P=a("./src/types/demuxer.ts");function I(){return I=Object.assign?Object.assign.bind():function(u){for(var f=1;f<arguments.length;f++){var L=arguments[f];for(var v in L)Object.prototype.hasOwnProperty.call(L,v)&&(u[v]=L[v])}return u},I.apply(this,arguments)}var c=188,m=function(){function u(L,v,y){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=L,this.config=v,this.typeSupported=y}u.probe=function(v){var y=u.syncOffset(v);return y>0&&A.logger.warn("MPEG2-TS detected but first sync word found @ offset "+y),y!==-1},u.syncOffset=function(v){for(var y=v.length,n=Math.min(c*5,v.length-c)+1,s=0;s<n;){for(var e=!1,h=s;h<y&&v[h]===71;h+=c)if(!e&&o(v,h)===0&&(e=!0),e&&h+c>n)return s;s++}return-1},u.createTrack=function(v,y){return{container:v==="video"||v==="audio"?"video/mp2t":void 0,type:v,id:x.RemuxerTrackIdConfig[v],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:v==="audio"?y:void 0}};var f=u.prototype;return f.resetInitSegment=function(v,y,n,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=u.createTrack("video"),this._audioTrack=u.createTrack("audio",s),this._id3Track=u.createTrack("id3"),this._txtTrack=u.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=y,this.videoCodec=n,this._duration=s},f.resetTimeStamp=function(){},f.resetContiguity=function(){var v=this._audioTrack,y=this._avcTrack,n=this._id3Track;v&&(v.pesData=null),y&&(y.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},f.demux=function(v,y,n,s){n===void 0&&(n=!1),s===void 0&&(s=!1),n||(this.sampleAes=null);var e,h=this._avcTrack,M=this._audioTrack,T=this._id3Track,B=this._txtTrack,N=h.pid,j=h.pesData,z=M.pid,K=T.pid,V=M.pesData,$=T.pesData,X=null,Z=this.pmtParsed,q=this._pmtId,te=v.length;if(this.remainderData&&(v=(0,x.appendUint8Array)(this.remainderData,v),te=v.length,this.remainderData=null),te<c&&!s)return this.remainderData=v,{audioTrack:M,videoTrack:h,id3Track:T,textTrack:B};var ue=Math.max(0,u.syncOffset(v));te-=(te-ue)%c,te<v.byteLength&&!s&&(this.remainderData=new Uint8Array(v.buffer,te,v.buffer.byteLength-te));for(var oe=0,le=ue;le<te;le+=c)if(v[le]===71){var me=!!(v[le+1]&64),_e=o(v,le),ve=(v[le+3]&48)>>4,ce=void 0;if(ve>1){if(ce=le+5+v[le+4],ce===le+c)continue}else ce=le+4;switch(_e){case N:me&&(j&&(e=r(j))&&this.parseAVCPES(h,B,e,!1),j={data:[],size:0}),j&&(j.data.push(v.subarray(ce,le+c)),j.size+=le+c-ce);break;case z:if(me){if(V&&(e=r(V)))switch(M.segmentCodec){case"aac":this.parseAACPES(M,e);break;case"mp3":this.parseMPEGPES(M,e);break}V={data:[],size:0}}V&&(V.data.push(v.subarray(ce,le+c)),V.size+=le+c-ce);break;case K:me&&($&&(e=r($))&&this.parseID3PES(T,e),$={data:[],size:0}),$&&($.data.push(v.subarray(ce,le+c)),$.size+=le+c-ce);break;case 0:me&&(ce+=v[ce]+1),q=this._pmtId=i(v,ce);break;case q:{me&&(ce+=v[ce]+1);var he=t(v,ce,this.typeSupported,n);N=he.avc,N>0&&(h.pid=N),z=he.audio,z>0&&(M.pid=z,M.segmentCodec=he.segmentCodec),K=he.id3,K>0&&(T.pid=K),X!==null&&!Z&&(A.logger.warn("MPEG-TS PMT found at "+le+" after unknown PID '"+X+"'. Backtracking to sync byte @"+ue+" to parse all TS packets."),X=null,le=ue-188),Z=this.pmtParsed=!0;break}case 17:case 8191:break;default:X=_e;break}}else oe++;oe>0&&this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+oe+" TS packet/s that do not start with 0x47"}),h.pesData=j,M.pesData=V,T.pesData=$;var Le={audioTrack:M,videoTrack:h,id3Track:T,textTrack:B};return s&&this.extractRemainingSamples(Le),Le},f.flush=function(){var v=this.remainderData;this.remainderData=null;var y;return v?y=this.demux(v,-1,!1,!0):y={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(y),this.sampleAes?this.decrypt(y,this.sampleAes):y},f.extractRemainingSamples=function(v){var y=v.audioTrack,n=v.videoTrack,s=v.id3Track,e=v.textTrack,h=n.pesData,M=y.pesData,T=s.pesData,B;if(h&&(B=r(h))?(this.parseAVCPES(n,e,B,!0),n.pesData=null):n.pesData=h,M&&(B=r(M))){switch(y.segmentCodec){case"aac":this.parseAACPES(y,B);break;case"mp3":this.parseMPEGPES(y,B);break}y.pesData=null}else M!=null&&M.size&&A.logger.log("last AAC PES packet truncated,might overlap between fragments"),y.pesData=M;T&&(B=r(T))?(this.parseID3PES(s,B),s.pesData=null):s.pesData=T},f.demuxSampleAes=function(v,y,n){var s=this.demux(v,n,!0,!this.config.progressive),e=this.sampleAes=new E.default(this.observer,this.config,y);return this.decrypt(s,e)},f.decrypt=function(v,y){return new Promise(function(n){var s=v.audioTrack,e=v.videoTrack;s.samples&&s.segmentCodec==="aac"?y.decryptAacSamples(s.samples,0,function(){e.samples?y.decryptAvcSamples(e.samples,0,0,function(){n(v)}):n(v)}):e.samples&&y.decryptAvcSamples(e.samples,0,0,function(){n(v)})})},f.destroy=function(){this._duration=0},f.parseAVCPES=function(v,y,n,s){var e=this,h=this.parseAVCNALu(v,n.data),M=this.avcSample,T,B=!1;n.data=null,M&&h.length&&!v.audFound&&(l(M,v),M=this.avcSample=_(!1,n.pts,n.dts,"")),h.forEach(function(N){switch(N.type){case 1:{T=!0,M||(M=e.avcSample=_(!0,n.pts,n.dts,"")),M.frame=!0;var j=N.data;if(B&&j.length>4){var z=new S.default(j).readSliceType();(z===2||z===4||z===7||z===9)&&(M.key=!0)}break}case 5:T=!0,M||(M=e.avcSample=_(!0,n.pts,n.dts,"")),M.key=!0,M.frame=!0;break;case 6:{T=!0,(0,x.parseSEIMessageFromNALu)(N.data,1,n.pts,y.samples);break}case 7:if(T=!0,B=!0,!v.sps){var K=new S.default(N.data),V=K.readSPS();v.width=V.width,v.height=V.height,v.pixelRatio=V.pixelRatio,v.sps=[N.data],v.duration=e._duration;for(var $=N.data.subarray(1,4),X="avc1.",Z=0;Z<3;Z++){var q=$[Z].toString(16);q.length<2&&(q="0"+q),X+=q}v.codec=X}break;case 8:T=!0,v.pps||(v.pps=[N.data]);break;case 9:T=!1,v.audFound=!0,M&&l(M,v),M=e.avcSample=_(!1,n.pts,n.dts,"");break;case 12:T=!0;break;default:T=!1,M&&(M.debug+="unknown NAL "+N.type+" ");break}if(M&&T){var te=M.units;te.push(N)}}),s&&M&&(l(M,v),this.avcSample=null)},f.getLastNalUnit=function(v){var y,n=this.avcSample,s;if((!n||n.units.length===0)&&(n=v[v.length-1]),(y=n)!==null&&y!==void 0&&y.units){var e=n.units;s=e[e.length-1]}return s},f.parseAVCNALu=function(v,y){var n=y.byteLength,s=v.naluState||0,e=s,h=[],M=0,T,B,N,j=-1,z=0;for(s===-1&&(j=0,z=y[0]&31,s=0,M=1);M<n;){if(T=y[M++],!s){s=T?0:1;continue}if(s===1){s=T?0:2;continue}if(!T)s=3;else if(T===1){if(j>=0){var K={data:y.subarray(j,M-s-1),type:z};h.push(K)}else{var V=this.getLastNalUnit(v.samples);if(V&&(e&&M<=4-e&&V.state&&(V.data=V.data.subarray(0,V.data.byteLength-e)),B=M-s-1,B>0)){var $=new Uint8Array(V.data.byteLength+B);$.set(V.data,0),$.set(y.subarray(0,B),V.data.byteLength),V.data=$,V.state=0}}M<n?(N=y[M]&31,j=M,z=N,s=0):s=-1}else s=0}if(j>=0&&s>=0){var X={data:y.subarray(j,n),type:z,state:s};h.push(X)}if(h.length===0){var Z=this.getLastNalUnit(v.samples);if(Z){var q=new Uint8Array(Z.data.byteLength+y.byteLength);q.set(Z.data,0),q.set(y,Z.data.byteLength),Z.data=q}}return v.naluState=s,h},f.parseAACPES=function(v,y){var n=0,s=this.aacOverFlow,e=y.data;if(s){this.aacOverFlow=null;var h=s.missing,M=s.sample.unit.byteLength;if(h===-1){var T=new Uint8Array(M+e.byteLength);T.set(s.sample.unit,0),T.set(e,M),e=T}else{var B=M-h;s.sample.unit.set(e.subarray(0,h),B),v.samples.push(s.sample),n=s.missing}}var N,j;for(N=n,j=e.length;N<j-1&&!g.isHeader(e,N);N++);if(N!==n){var z,K;if(N<j-1?(z="AAC PES did not start with ADTS header,offset:"+N,K=!1):(z="no ADTS header found in AAC PES",K=!0),A.logger.warn("parsing error:"+z),this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:K,reason:z}),K)return}g.initTrackConfig(v,this.observer,e,N,this.audioCodec);var V;if(y.pts!==void 0)V=y.pts;else if(s){var $=g.getFrameDuration(v.samplerate);V=s.sample.pts+$}else{A.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var X=0,Z;N<j;)if(Z=g.appendFrame(v,e,N,V,X),N+=Z.length,Z.missing){this.aacOverFlow=Z;break}else for(X++;N<j-1&&!g.isHeader(e,N);N++);},f.parseMPEGPES=function(v,y){var n=y.data,s=n.length,e=0,h=0,M=y.pts;if(M===void 0){A.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;h<s;)if(d.isHeader(n,h)){var T=d.appendFrame(v,n,h,M,e);if(T)h+=T.length,e++;else break}else h++},f.parseID3PES=function(v,y){if(y.pts===void 0){A.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var n=I({},y,{type:this._avcTrack?P.MetadataSchema.emsg:P.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});v.samples.push(n)},u}();function _(u,f,L,v){return{key:u,frame:!1,pts:f,dts:L,units:[],debug:v,length:0}}function o(u,f){return((u[f+1]&31)<<8)+u[f+2]}function i(u,f){return(u[f+10]&31)<<8|u[f+11]}function t(u,f,L,v){var y={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},n=(u[f+1]&15)<<8|u[f+2],s=f+3+n-4,e=(u[f+10]&15)<<8|u[f+11];for(f+=12+e;f<s;){var h=o(u,f);switch(u[f]){case 207:if(!v){A.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:y.audio===-1&&(y.audio=h);break;case 21:y.id3===-1&&(y.id3=h);break;case 219:if(!v){A.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:y.avc===-1&&(y.avc=h);break;case 3:case 4:L.mpeg!==!0&&L.mp3!==!0?A.logger.log("MPEG audio found, not supported in this browser"):y.audio===-1&&(y.audio=h,y.segmentCodec="mp3");break;case 36:A.logger.warn("Unsupported HEVC stream type found");break}f+=((u[f+3]&15)<<8|u[f+4])+5}return y}function r(u){var f=0,L,v,y,n,s,e=u.data;if(!u||u.size===0)return null;for(;e[0].length<19&&e.length>1;){var h=new Uint8Array(e[0].length+e[1].length);h.set(e[0]),h.set(e[1],e[0].length),e[0]=h,e.splice(1,1)}L=e[0];var M=(L[0]<<16)+(L[1]<<8)+L[2];if(M===1){if(v=(L[4]<<8)+L[5],v&&v>u.size-6)return null;var T=L[7];T&192&&(n=(L[9]&14)*536870912+(L[10]&255)*4194304+(L[11]&254)*16384+(L[12]&255)*128+(L[13]&254)/2,T&64?(s=(L[14]&14)*536870912+(L[15]&255)*4194304+(L[16]&254)*16384+(L[17]&255)*128+(L[18]&254)/2,n-s>54e5&&(A.logger.warn(Math.round((n-s)/9e4)+"s delta between PTS and DTS, align them"),n=s)):s=n),y=L[8];var B=y+9;if(u.size<=B)return null;u.size-=B;for(var N=new Uint8Array(u.size),j=0,z=e.length;j<z;j++){L=e[j];var K=L.byteLength;if(B)if(B>K){B-=K;continue}else L=L.subarray(B),K-=B,B=0;N.set(L,f),f+=K}return v&&(v-=y+3),{data:N,pts:n,dts:s,len:v}}return null}function l(u,f){if(u.units.length&&u.frame){if(u.pts===void 0){var L=f.samples,v=L.length;if(v){var y=L[v-1];u.pts=y.pts,u.dts=y.dts}else{f.dropped++;return}}f.samples.push(u)}u.debug.length&&A.logger.log(u.pts+"/"+u.dts+":"+u.debug)}const p=m},"./src/demux/webworkify-webpack.js":(C,b,a)=>{a.r(b),a.d(b,{default:()=>c});var g=function(){var _=ENTRY_MODULE,o={},i=function r(l){var p=o[l];if(p!==void 0)return p.exports;var u=o[l]={exports:{}};return _[l].call(u.exports,u,u.exports,r),u.exports};i.m=_,function(){i.n=function(r){var l=r&&r.__esModule?function(){return r.default}:function(){return r};return i.d(l,{a:l}),l}}(),function(){i.d=function(r,l){for(var p in l)i.o(l,p)&&!i.o(r,p)&&Object.defineProperty(r,p,{enumerable:!0,get:l[p]})}}(),function(){i.o=function(r,l){return Object.prototype.hasOwnProperty.call(r,l)}}(),function(){i.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})}}();var t=i(ENTRY_MODULE);return t.default||t},d=g.toString().split("ENTRY_MODULE"),S="[\\.|\\-|\\+|\\w|/|@]+",E="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+S+").*?\\)";function R(m){return(m+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function x(m){return!isNaN(1*m)}function A(m,_,o){var i={};i[o]=[];var t=_.toString().replace(/^"[^"]+"/,"function"),r=t.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||t.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!r)return i;for(var l=r[1],p=new RegExp("(\\\\n|\\W)"+R(l)+E,"g"),u;u=p.exec(t);)u[3]!=="dll-reference"&&i[o].push(u[3]);for(p=new RegExp("\\("+R(l)+'\\("(dll-reference\\s('+S+'))"\\)\\)'+E,"g");u=p.exec(t);)m[u[2]]||(i[o].push(u[1]),m[u[2]]=a(u[1]).m),i[u[2]]=i[u[2]]||[],i[u[2]].push(u[4]);for(var f=Object.keys(i),L=0;L<f.length;L++)for(var v=0;v<i[f[L]].length;v++)x(i[f[L]][v])&&(i[f[L]][v]=1*i[f[L]][v]);return i}function D(m){var _=Object.keys(m);return _.reduce(function(o,i){return o||m[i].length>0},!1)}function P(m,_){for(var o={main:[_]},i={main:[]},t={main:{}};D(o);)for(var r=Object.keys(o),l=0;l<r.length;l++){var p=r[l],u=o[p],f=u.pop();if(t[p]=t[p]||{},!(t[p][f]||!m[p][f])){t[p][f]=!0,i[p]=i[p]||[],i[p].push(f);for(var L=A(m,m[p][f],p),v=Object.keys(L),y=0;y<v.length;y++)o[v[y]]=o[v[y]]||[],o[v[y]]=o[v[y]].concat(L[v[y]])}}return i}function I(m,_,o,i){var t=m[i].map(function(r){return'"'+r+'": '+_[i][r].toString().replace(/^"[^"]+"/,"function")}).join(",");return d[0]+"{"+t+"}"+d[1]+'"'+o+'"'+d[2]}function c(m,_){_=_||{};var o={main:a.m},i=_.all?{main:Object.keys(o.main)}:P(o,m),t="";Object.keys(i).filter(function(f){return f!=="main"}).forEach(function(f){for(var L=0;i[f][L];)L++;i[f].push(L),o[f][L]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",t=t+("var "+f+" = ("+I(i,o,L,modules)+`)();
`)}),t=t+("new (("+I(i,o,m,"main")+")())(self);");var r=new window.Blob([t],{type:"text/javascript"}),l=window.URL||window.webkitURL||window.mozURL||window.msURL,p=l.createObjectURL(r),u=new window.Worker(p);return u.objectURL=p,u}},"./src/errors.ts":(C,b,a)=>{a.r(b),a.d(b,{ErrorDetails:()=>d,ErrorTypes:()=>g});var g;(function(S){S.NETWORK_ERROR="networkError",S.MEDIA_ERROR="mediaError",S.KEY_SYSTEM_ERROR="keySystemError",S.MUX_ERROR="muxError",S.OTHER_ERROR="otherError"})(g||(g={}));var d;(function(S){S.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",S.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",S.KEY_SYSTEM_NO_SESSION="keySystemNoSession",S.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",S.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",S.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",S.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",S.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",S.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",S.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",S.MANIFEST_LOAD_ERROR="manifestLoadError",S.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",S.MANIFEST_PARSING_ERROR="manifestParsingError",S.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",S.LEVEL_EMPTY_ERROR="levelEmptyError",S.LEVEL_LOAD_ERROR="levelLoadError",S.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",S.LEVEL_SWITCH_ERROR="levelSwitchError",S.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",S.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",S.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",S.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",S.FRAG_LOAD_ERROR="fragLoadError",S.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",S.FRAG_DECRYPT_ERROR="fragDecryptError",S.FRAG_PARSING_ERROR="fragParsingError",S.REMUX_ALLOC_ERROR="remuxAllocError",S.KEY_LOAD_ERROR="keyLoadError",S.KEY_LOAD_TIMEOUT="keyLoadTimeOut",S.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",S.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",S.BUFFER_APPEND_ERROR="bufferAppendError",S.BUFFER_APPENDING_ERROR="bufferAppendingError",S.BUFFER_STALLED_ERROR="bufferStalledError",S.BUFFER_FULL_ERROR="bufferFullError",S.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",S.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",S.INTERNAL_EXCEPTION="internalException",S.INTERNAL_ABORTED="aborted",S.UNKNOWN="unknown"})(d||(d={}))},"./src/events.ts":(C,b,a)=>{a.r(b),a.d(b,{Events:()=>g});var g;(function(d){d.MEDIA_ATTACHING="hlsMediaAttaching",d.MEDIA_ATTACHED="hlsMediaAttached",d.MEDIA_DETACHING="hlsMediaDetaching",d.MEDIA_DETACHED="hlsMediaDetached",d.BUFFER_RESET="hlsBufferReset",d.BUFFER_CODECS="hlsBufferCodecs",d.BUFFER_CREATED="hlsBufferCreated",d.BUFFER_APPENDING="hlsBufferAppending",d.BUFFER_APPENDED="hlsBufferAppended",d.BUFFER_EOS="hlsBufferEos",d.BUFFER_FLUSHING="hlsBufferFlushing",d.BUFFER_FLUSHED="hlsBufferFlushed",d.MANIFEST_LOADING="hlsManifestLoading",d.MANIFEST_LOADED="hlsManifestLoaded",d.MANIFEST_PARSED="hlsManifestParsed",d.LEVEL_SWITCHING="hlsLevelSwitching",d.LEVEL_SWITCHED="hlsLevelSwitched",d.LEVEL_LOADING="hlsLevelLoading",d.LEVEL_LOADED="hlsLevelLoaded",d.LEVEL_UPDATED="hlsLevelUpdated",d.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",d.LEVELS_UPDATED="hlsLevelsUpdated",d.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",d.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",d.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",d.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",d.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",d.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",d.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",d.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",d.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",d.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",d.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",d.CUES_PARSED="hlsCuesParsed",d.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",d.INIT_PTS_FOUND="hlsInitPtsFound",d.FRAG_LOADING="hlsFragLoading",d.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",d.FRAG_LOADED="hlsFragLoaded",d.FRAG_DECRYPTED="hlsFragDecrypted",d.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",d.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",d.FRAG_PARSING_METADATA="hlsFragParsingMetadata",d.FRAG_PARSED="hlsFragParsed",d.FRAG_BUFFERED="hlsFragBuffered",d.FRAG_CHANGED="hlsFragChanged",d.FPS_DROP="hlsFpsDrop",d.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",d.ERROR="hlsError",d.DESTROYING="hlsDestroying",d.KEY_LOADING="hlsKeyLoading",d.KEY_LOADED="hlsKeyLoaded",d.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",d.BACK_BUFFER_REACHED="hlsBackBufferReached"})(g||(g={}))},"./src/hls.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>u});var g=a("./node_modules/url-toolkit/src/url-toolkit.js"),d=a("./src/loader/playlist-loader.ts"),S=a("./src/controller/id3-track-controller.ts"),E=a("./src/controller/latency-controller.ts"),R=a("./src/controller/level-controller.ts"),x=a("./src/controller/fragment-tracker.ts"),A=a("./src/loader/key-loader.ts"),D=a("./src/controller/stream-controller.ts"),P=a("./src/is-supported.ts"),I=a("./src/utils/logger.ts"),c=a("./src/config.ts"),m=a("./node_modules/eventemitter3/index.js"),_=a("./src/events.ts"),o=a("./src/errors.ts"),i=a("./src/types/level.ts");function t(f,L){for(var v=0;v<L.length;v++){var y=L[v];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(f,l(y.key),y)}}function r(f,L,v){return L&&t(f.prototype,L),v&&t(f,v),Object.defineProperty(f,"prototype",{writable:!1}),f}function l(f){var L=p(f,"string");return typeof L=="symbol"?L:String(L)}function p(f,L){if(typeof f!="object"||f===null)return f;var v=f[Symbol.toPrimitive];if(v!==void 0){var y=v.call(f,L||"default");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(L==="string"?String:Number)(f)}var u=function(){f.isSupported=function(){return(0,P.isSupported)()};function f(v){v===void 0&&(v={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new m.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var y=this.config=(0,c.mergeConfig)(f.DefaultConfig,v);this.userConfig=v,(0,I.enableLogs)(y.debug,"Hls instance"),this._autoLevelCapping=-1,y.progressive&&(0,c.enableStreamingMode)(y);var n=y.abrController,s=y.bufferController,e=y.capLevelController,h=y.fpsController,M=this.abrController=new n(this),T=this.bufferController=new s(this),B=this.capLevelController=new e(this),N=new h(this),j=new d.default(this),z=new S.default(this),K=this.levelController=new R.default(this),V=new x.FragmentTracker(this),$=new A.default(this.config),X=this.streamController=new D.default(this,V,$);B.setStreamController(X),N.setStreamController(X);var Z=[j,K,X];this.networkControllers=Z;var q=[M,T,B,N,z,V];this.audioTrackController=this.createController(y.audioTrackController,Z);var te=y.audioStreamController;te&&Z.push(new te(this,V,$)),this.subtitleTrackController=this.createController(y.subtitleTrackController,Z);var ue=y.subtitleStreamController;ue&&Z.push(new ue(this,V,$)),this.createController(y.timelineController,q),$.emeController=this.emeController=this.createController(y.emeController,q),this.cmcdController=this.createController(y.cmcdController,q),this.latencyController=this.createController(E.default,q),this.coreComponents=q}var L=f.prototype;return L.createController=function(y,n){if(y){var s=new y(this);return n&&n.push(s),s}return null},L.on=function(y,n,s){s===void 0&&(s=this),this._emitter.on(y,n,s)},L.once=function(y,n,s){s===void 0&&(s=this),this._emitter.once(y,n,s)},L.removeAllListeners=function(y){this._emitter.removeAllListeners(y)},L.off=function(y,n,s,e){s===void 0&&(s=this),this._emitter.off(y,n,s,e)},L.listeners=function(y){return this._emitter.listeners(y)},L.emit=function(y,n,s){return this._emitter.emit(y,n,s)},L.trigger=function(y,n){if(this.config.debug)return this.emit(y,y,n);try{return this.emit(y,y,n)}catch(s){I.logger.error("An internal error happened while handling event "+y+'. Error message: "'+s.message+'". Here is a stacktrace:',s),this.trigger(_.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:y,error:s})}return!1},L.listenerCount=function(y){return this._emitter.listenerCount(y)},L.destroy=function(){I.logger.log("destroy"),this.trigger(_.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(y){return y.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(y){return y.destroy()}),this.coreComponents.length=0},L.attachMedia=function(y){I.logger.log("attachMedia"),this._media=y,this.trigger(_.Events.MEDIA_ATTACHING,{media:y})},L.detachMedia=function(){I.logger.log("detachMedia"),this.trigger(_.Events.MEDIA_DETACHING,void 0),this._media=null},L.loadSource=function(y){this.stopLoad();var n=this.media,s=this.url,e=this.url=g.buildAbsoluteURL(self.location.href,y,{alwaysNormalize:!0});I.logger.log("loadSource:"+e),n&&s&&s!==e&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(n)),this.trigger(_.Events.MANIFEST_LOADING,{url:y})},L.startLoad=function(y){y===void 0&&(y=-1),I.logger.log("startLoad("+y+")"),this.networkControllers.forEach(function(n){n.startLoad(y)})},L.stopLoad=function(){I.logger.log("stopLoad"),this.networkControllers.forEach(function(y){y.stopLoad()})},L.swapAudioCodec=function(){I.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},L.recoverMediaError=function(){I.logger.log("recoverMediaError");var y=this._media;this.detachMedia(),y&&this.attachMedia(y)},L.removeLevel=function(y,n){n===void 0&&(n=0),this.levelController.removeLevel(y,n)},r(f,[{key:"levels",get:function(){var y=this.levelController.levels;return y||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(y){I.logger.log("set currentLevel:"+y),this.loadLevel=y,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(y){I.logger.log("set nextLevel:"+y),this.levelController.manualLevel=y,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(y){I.logger.log("set loadLevel:"+y),this.levelController.manualLevel=y}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(y){this.levelController.nextLoadLevel=y}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(y){I.logger.log("set firstLevel:"+y),this.levelController.firstLevel=y}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(y){I.logger.log("set startLevel:"+y),y!==-1&&(y=Math.max(y,this.minAutoLevel)),this.levelController.startLevel=y}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(y){var n=!!y;n!==this.config.capLevelToPlayerSize&&(n?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=n)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(y){this._autoLevelCapping!==y&&(I.logger.log("set autoLevelCapping:"+y),this._autoLevelCapping=y)}},{key:"bandwidthEstimate",get:function(){var y=this.abrController.bwEstimator;return y?y.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(y){i.HdcpLevels.indexOf(y)>-1&&(this._maxHdcpLevel=y)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var y=this.levels,n=this.config.minAutoBitrate;if(!y)return 0;for(var s=y.length,e=0;e<s;e++)if(y[e].maxBitrate>=n)return e;return 0}},{key:"maxAutoLevel",get:function(){var y=this.levels,n=this.autoLevelCapping,s=this.maxHdcpLevel,e;if(n===-1&&y&&y.length?e=y.length-1:e=n,s)for(var h=e;h--;){var M=y[h].attrs["HDCP-LEVEL"];if(M&&M<=s)return h}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(y){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,y)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var y=this.audioTrackController;return y?y.audioTracks:[]}},{key:"audioTrack",get:function(){var y=this.audioTrackController;return y?y.audioTrack:-1},set:function(y){var n=this.audioTrackController;n&&(n.audioTrack=y)}},{key:"subtitleTracks",get:function(){var y=this.subtitleTrackController;return y?y.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var y=this.subtitleTrackController;return y?y.subtitleTrack:-1},set:function(y){var n=this.subtitleTrackController;n&&(n.subtitleTrack=y)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var y=this.subtitleTrackController;return y?y.subtitleDisplay:!1},set:function(y){var n=this.subtitleTrackController;n&&(n.subtitleDisplay=y)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(y){this.config.lowLatencyMode=y}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.3.4"}},{key:"Events",get:function(){return _.Events}},{key:"ErrorTypes",get:function(){return o.ErrorTypes}},{key:"ErrorDetails",get:function(){return o.ErrorDetails}},{key:"DefaultConfig",get:function(){return f.defaultConfig?f.defaultConfig:c.hlsDefaultConfig},set:function(y){f.defaultConfig=y}}]),f}();u.defaultConfig=void 0},"./src/is-supported.ts":(C,b,a)=>{a.r(b),a.d(b,{changeTypeSupported:()=>E,isSupported:()=>S});var g=a("./src/utils/mediasource-helper.ts");function d(){return self.SourceBuffer||self.WebKitSourceBuffer}function S(){var R=(0,g.getMediaSource)();if(!R)return!1;var x=d(),A=R&&typeof R.isTypeSupported=="function"&&R.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),D=!x||x.prototype&&typeof x.prototype.appendBuffer=="function"&&typeof x.prototype.remove=="function";return!!A&&!!D}function E(){var R,x=d();return typeof(x==null||(R=x.prototype)===null||R===void 0?void 0:R.changeType)=="function"}},"./src/loader/date-range.ts":(C,b,a)=>{a.r(b),a.d(b,{DateRange:()=>I,DateRangeAttribute:()=>P});var g=a("./src/polyfills/number.ts"),d=a("./src/utils/attr-list.ts"),S=a("./src/utils/logger.ts");function E(){return E=Object.assign?Object.assign.bind():function(c){for(var m=1;m<arguments.length;m++){var _=arguments[m];for(var o in _)Object.prototype.hasOwnProperty.call(_,o)&&(c[o]=_[o])}return c},E.apply(this,arguments)}function R(c,m){for(var _=0;_<m.length;_++){var o=m[_];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(c,A(o.key),o)}}function x(c,m,_){return m&&R(c.prototype,m),_&&R(c,_),Object.defineProperty(c,"prototype",{writable:!1}),c}function A(c){var m=D(c,"string");return typeof m=="symbol"?m:String(m)}function D(c,m){if(typeof c!="object"||c===null)return c;var _=c[Symbol.toPrimitive];if(_!==void 0){var o=_.call(c,m||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(c)}var P;(function(c){c.ID="ID",c.CLASS="CLASS",c.START_DATE="START-DATE",c.DURATION="DURATION",c.END_DATE="END-DATE",c.END_ON_NEXT="END-ON-NEXT",c.PLANNED_DURATION="PLANNED-DURATION",c.SCTE35_OUT="SCTE35-OUT",c.SCTE35_IN="SCTE35-IN"})(P||(P={}));var I=function(){function c(m,_){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,_){var o=_.attr;for(var i in o)if(Object.prototype.hasOwnProperty.call(m,i)&&m[i]!==o[i]){S.logger.warn('DATERANGE tag attribute: "'+i+'" does not match for tags with ID: "'+m.ID+'"'),this._badValueForSameId=i;break}m=E(new d.AttrList({}),o,m)}if(this.attr=m,this._startDate=new Date(m[P.START_DATE]),P.END_DATE in this.attr){var t=new Date(this.attr[P.END_DATE]);(0,g.isFiniteNumber)(t.getTime())&&(this._endDate=t)}}return x(c,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var _=this.duration;return _!==null?new Date(this._startDate.getTime()+_*1e3):null}},{key:"duration",get:function(){if(P.DURATION in this.attr){var _=this.attr.decimalFloatingPoint(P.DURATION);if((0,g.isFiniteNumber)(_))return _}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return P.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(P.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(P.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,g.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),c}()},"./src/loader/fragment-loader.ts":(C,b,a)=>{a.r(b),a.d(b,{LoadError:()=>_,default:()=>c});var g=a("./src/polyfills/number.ts"),d=a("./src/errors.ts");function S(o,i){o.prototype=Object.create(i.prototype),o.prototype.constructor=o,D(o,i)}function E(o){var i=typeof Map=="function"?new Map:void 0;return E=function(r){if(r===null||!A(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(r))return i.get(r);i.set(r,l)}function l(){return R(r,arguments,P(this).constructor)}return l.prototype=Object.create(r.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),D(l,r)},E(o)}function R(o,i,t){return x()?R=Reflect.construct.bind():R=function(l,p,u){var f=[null];f.push.apply(f,p);var L=Function.bind.apply(l,f),v=new L;return u&&D(v,u.prototype),v},R.apply(null,arguments)}function x(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(o){return!1}}function A(o){return Function.toString.call(o).indexOf("[native code]")!==-1}function D(o,i){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,l){return r.__proto__=l,r},D(o,i)}function P(o){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},P(o)}var I=Math.pow(2,17),c=function(){function o(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var i=o.prototype;return i.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},i.abort=function(){this.loader&&this.loader.abort()},i.load=function(r,l){var p=this,u=r.url;if(!u)return Promise.reject(new _({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,networkDetails:null},"Fragment does not have a "+(u?"part list":"url")));this.abort();var f=this.config,L=f.fLoader,v=f.loader;return new Promise(function(y,n){p.loader&&p.loader.destroy();var s=p.loader=r.loader=L?new L(f):new v(f),e=m(r),h={timeout:f.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:f.fragLoadingMaxRetryTimeout,highWaterMark:r.sn==="initSegment"?1/0:I};r.stats=s.stats,s.load(e,h,{onSuccess:function(T,B,N,j){p.resetLoader(r,s);var z=T.data;N.resetIV&&r.decryptdata&&(r.decryptdata.iv=new Uint8Array(z.slice(0,16)),z=z.slice(16)),y({frag:r,part:null,payload:z,networkDetails:j})},onError:function(T,B,N){p.resetLoader(r,s),n(new _({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,response:T,networkDetails:N}))},onAbort:function(T,B,N){p.resetLoader(r,s),n(new _({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:r,networkDetails:N}))},onTimeout:function(T,B,N){p.resetLoader(r,s),n(new _({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,networkDetails:N}))},onProgress:function(T,B,N,j){l&&l({frag:r,part:null,payload:N,networkDetails:j})}})})},i.loadPart=function(r,l,p){var u=this;this.abort();var f=this.config,L=f.fLoader,v=f.loader;return new Promise(function(y,n){u.loader&&u.loader.destroy();var s=u.loader=r.loader=L?new L(f):new v(f),e=m(r,l),h={timeout:f.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:f.fragLoadingMaxRetryTimeout,highWaterMark:I};l.stats=s.stats,s.load(e,h,{onSuccess:function(T,B,N,j){u.resetLoader(r,s),u.updateStatsFromPart(r,l);var z={frag:r,part:l,payload:T.data,networkDetails:j};p(z),y(z)},onError:function(T,B,N){u.resetLoader(r,s),n(new _({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,part:l,response:T,networkDetails:N}))},onAbort:function(T,B,N){r.stats.aborted=l.stats.aborted,u.resetLoader(r,s),n(new _({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:r,part:l,networkDetails:N}))},onTimeout:function(T,B,N){u.resetLoader(r,s),n(new _({type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,part:l,networkDetails:N}))}})})},i.updateStatsFromPart=function(r,l){var p=r.stats,u=l.stats,f=u.total;if(p.loaded+=u.loaded,f){var L=Math.round(r.duration/l.duration),v=Math.min(Math.round(p.loaded/f),L),y=L-v,n=y*Math.round(p.loaded/v);p.total=p.loaded+n}else p.total=Math.max(p.loaded,p.total);var s=p.loading,e=u.loading;s.start?s.first+=e.first-e.start:(s.start=e.start,s.first=e.first),s.end=e.end},i.resetLoader=function(r,l){r.loader=null,this.loader===l&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),l.destroy()},o}();function m(o,i){i===void 0&&(i=null);var t=i||o,r={frag:o,part:i,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},l=t.byteRangeStartOffset,p=t.byteRangeEndOffset;if((0,g.isFiniteNumber)(l)&&(0,g.isFiniteNumber)(p)){var u,f=l,L=p;if(o.sn==="initSegment"&&((u=o.decryptdata)===null||u===void 0?void 0:u.method)==="AES-128"){var v=p-l;v%16&&(L=p+(16-v%16)),l!==0&&(r.resetIV=!0,f=l-16)}r.rangeStart=f,r.rangeEnd=L}return r}var _=function(o){S(i,o);function i(t){for(var r,l=arguments.length,p=new Array(l>1?l-1:0),u=1;u<l;u++)p[u-1]=arguments[u];return r=o.call.apply(o,[this].concat(p))||this,r.data=void 0,r.data=t,r}return i}(E(Error))},"./src/loader/fragment.ts":(C,b,a)=>{a.r(b),a.d(b,{BaseSegment:()=>c,ElementaryStreamTypes:()=>I,Fragment:()=>m,Part:()=>_});var g=a("./src/polyfills/number.ts"),d=a("./node_modules/url-toolkit/src/url-toolkit.js"),S=a("./src/loader/load-stats.ts");function E(o,i){o.prototype=Object.create(i.prototype),o.prototype.constructor=o,R(o,i)}function R(o,i){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,l){return r.__proto__=l,r},R(o,i)}function x(o,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,D(r.key),r)}}function A(o,i,t){return i&&x(o.prototype,i),t&&x(o,t),Object.defineProperty(o,"prototype",{writable:!1}),o}function D(o){var i=P(o,"string");return typeof i=="symbol"?i:String(i)}function P(o,i){if(typeof o!="object"||o===null)return o;var t=o[Symbol.toPrimitive];if(t!==void 0){var r=t.call(o,i||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(o)}var I;(function(o){o.AUDIO="audio",o.VIDEO="video",o.AUDIOVIDEO="audiovideo"})(I||(I={}));var c=function(){function o(t){var r;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(r={},r[I.AUDIO]=null,r[I.VIDEO]=null,r[I.AUDIOVIDEO]=null,r),this.baseurl=t}var i=o.prototype;return i.setByteRange=function(r,l){var p=r.split("@",2),u=[];p.length===1?u[0]=l?l.byteRangeEndOffset:0:u[0]=parseInt(p[1]),u[1]=parseInt(p[0])+u[0],this._byteRange=u},A(o,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,d.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(r){this._url=r}}]),o}(),m=function(o){E(i,o);function i(r,l){var p;return p=o.call(this,l)||this,p._decryptdata=null,p.rawProgramDateTime=null,p.programDateTime=null,p.tagList=[],p.duration=0,p.sn=0,p.levelkeys=void 0,p.type=void 0,p.loader=null,p.keyLoader=null,p.level=-1,p.cc=0,p.startPTS=void 0,p.endPTS=void 0,p.appendedPTS=void 0,p.startDTS=void 0,p.endDTS=void 0,p.start=0,p.deltaPTS=void 0,p.maxStartPTS=void 0,p.minEndPTS=void 0,p.stats=new S.LoadStats,p.urlId=0,p.data=void 0,p.bitrateTest=!1,p.title=null,p.initSegment=null,p.endList=void 0,p.type=r,p}var t=i.prototype;return t.setKeyFormat=function(l){if(this.levelkeys){var p=this.levelkeys[l];p&&!this._decryptdata&&(this._decryptdata=p.getDecryptData(this.sn))}},t.abortRequests=function(){var l,p;(l=this.loader)===null||l===void 0||l.abort(),(p=this.keyLoader)===null||p===void 0||p.abort()},t.setElementaryStreamInfo=function(l,p,u,f,L,v){v===void 0&&(v=!1);var y=this.elementaryStreams,n=y[l];if(!n){y[l]={startPTS:p,endPTS:u,startDTS:f,endDTS:L,partial:v};return}n.startPTS=Math.min(n.startPTS,p),n.endPTS=Math.max(n.endPTS,u),n.startDTS=Math.min(n.startDTS,f),n.endDTS=Math.max(n.endDTS,L)},t.clearElementaryStreamInfo=function(){var l=this.elementaryStreams;l[I.AUDIO]=null,l[I.VIDEO]=null,l[I.AUDIOVIDEO]=null},A(i,[{key:"decryptdata",get:function(){var l=this.levelkeys;if(!l&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var p=this.levelkeys.identity;if(p)this._decryptdata=p.getDecryptData(this.sn);else{var u=Object.keys(this.levelkeys);if(u.length===1)return this._decryptdata=this.levelkeys[u[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,g.isFiniteNumber)(this.programDateTime))return null;var l=(0,g.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+l*1e3}},{key:"encrypted",get:function(){var l;if((l=this._decryptdata)!==null&&l!==void 0&&l.encrypted)return!0;if(this.levelkeys){var p=Object.keys(this.levelkeys),u=p.length;if(u>1||u===1&&this.levelkeys[p[0]].encrypted)return!0}return!1}}]),i}(c),_=function(o){E(i,o);function i(t,r,l,p,u){var f;f=o.call(this,l)||this,f.fragOffset=0,f.duration=0,f.gap=!1,f.independent=!1,f.relurl=void 0,f.fragment=void 0,f.index=void 0,f.stats=new S.LoadStats,f.duration=t.decimalFloatingPoint("DURATION"),f.gap=t.bool("GAP"),f.independent=t.bool("INDEPENDENT"),f.relurl=t.enumeratedString("URI"),f.fragment=r,f.index=p;var L=t.enumeratedString("BYTERANGE");return L&&f.setByteRange(L,u),u&&(f.fragOffset=u.fragOffset+u.duration),f}return A(i,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var r=this.elementaryStreams;return!!(r.audio||r.video||r.audiovideo)}}]),i}(c)},"./src/loader/key-loader.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>S});var g=a("./src/errors.ts"),d=a("./src/loader/fragment-loader.ts"),S=function(){function E(x){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=x}var R=E.prototype;return R.abort=function(){for(var A in this.keyUriToKeyInfo){var D=this.keyUriToKeyInfo[A].loader;D&&D.abort()}},R.detach=function(){for(var A in this.keyUriToKeyInfo){var D=this.keyUriToKeyInfo[A];(D.mediaKeySessionContext||D.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[A]}},R.destroy=function(){this.detach();for(var A in this.keyUriToKeyInfo){var D=this.keyUriToKeyInfo[A].loader;D&&D.destroy()}this.keyUriToKeyInfo={}},R.createKeyLoadError=function(A,D,P,I){return D===void 0&&(D=g.ErrorDetails.KEY_LOAD_ERROR),new d.LoadError({type:g.ErrorTypes.NETWORK_ERROR,details:D,fatal:!1,frag:A,networkDetails:P})},R.loadClear=function(A,D){var P=this;if(this.emeController&&this.config.emeEnabled)for(var I=A.sn,c=A.cc,m=function(t){var r=D[t];if(c<=r.cc&&(I==="initSegment"||I<r.sn))return P.emeController.selectKeySystemFormat(r).then(function(l){r.setKeyFormat(l)}),"break"},_=0;_<D.length;_++){var o=m(_);if(o==="break")break}},R.load=function(A){var D=this;return!A.decryptdata&&A.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(A).then(function(P){return D.loadInternal(A,P)}):this.loadInternal(A)},R.loadInternal=function(A,D){var P,I;D&&A.setKeyFormat(D);var c=A.decryptdata;if(!c){var m=D?"Expected frag.decryptdata to be defined after setting format "+D:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(A,g.ErrorDetails.KEY_LOAD_ERROR,null,m))}var _=c.uri;if(!_)return Promise.reject(this.createKeyLoadError(A,g.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+_+'"'));var o=this.keyUriToKeyInfo[_];if((P=o)!==null&&P!==void 0&&P.decryptdata.key)return c.key=o.decryptdata.key,Promise.resolve({frag:A,keyInfo:o});if((I=o)!==null&&I!==void 0&&I.keyLoadPromise){var i;switch((i=o.mediaKeySessionContext)===null||i===void 0?void 0:i.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(function(t){return c.key=t.keyInfo.decryptdata.key,{frag:A,keyInfo:o}})}}switch(o=this.keyUriToKeyInfo[_]={decryptdata:c,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},c.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return c.keyFormat==="identity"?this.loadKeyHTTP(o,A):this.loadKeyEME(o,A);case"AES-128":return this.loadKeyHTTP(o,A);default:return Promise.reject(this.createKeyLoadError(A,g.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+c.method+'"'))}},R.loadKeyEME=function(A,D){var P={frag:D,keyInfo:A};if(this.emeController&&this.config.emeEnabled){var I=this.emeController.loadKey(P);if(I)return(A.keyLoadPromise=I.then(function(c){return A.mediaKeySessionContext=c,P})).catch(function(c){throw A.keyLoadPromise=null,c})}return Promise.resolve(P)},R.loadKeyHTTP=function(A,D){var P=this,I=this.config,c=I.loader,m=new c(I);return D.keyLoader=A.loader=m,A.keyLoadPromise=new Promise(function(_,o){var i={keyInfo:A,frag:D,responseType:"arraybuffer",url:A.decryptdata.uri},t={timeout:I.fragLoadingTimeOut,maxRetry:0,retryDelay:I.fragLoadingRetryDelay,maxRetryDelay:I.fragLoadingMaxRetryTimeout,highWaterMark:0},r={onSuccess:function(p,u,f,L){var v=f.frag,y=f.keyInfo,n=f.url;if(!v.decryptdata||y!==P.keyUriToKeyInfo[n])return o(P.createKeyLoadError(v,g.ErrorDetails.KEY_LOAD_ERROR,L,"after key load, decryptdata unset or changed"));y.decryptdata.key=v.decryptdata.key=new Uint8Array(p.data),v.keyLoader=null,y.loader=null,_({frag:v,keyInfo:y})},onError:function(p,u,f){P.resetLoader(u),o(P.createKeyLoadError(D,g.ErrorDetails.KEY_LOAD_ERROR,f))},onTimeout:function(p,u,f){P.resetLoader(u),o(P.createKeyLoadError(D,g.ErrorDetails.KEY_LOAD_TIMEOUT,f))},onAbort:function(p,u,f){P.resetLoader(u),o(P.createKeyLoadError(D,g.ErrorDetails.INTERNAL_ABORTED,f))}};m.load(i,t,r)})},R.resetLoader=function(A){var D=A.frag,P=A.keyInfo,I=A.url,c=P.loader;D.keyLoader===c&&(D.keyLoader=null,P.loader=null),delete this.keyUriToKeyInfo[I],c&&c.destroy()},E}()},"./src/loader/level-details.ts":(C,b,a)=>{a.r(b),a.d(b,{LevelDetails:()=>A});var g=a("./src/polyfills/number.ts");function d(D,P){for(var I=0;I<P.length;I++){var c=P[I];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(D,E(c.key),c)}}function S(D,P,I){return P&&d(D.prototype,P),I&&d(D,I),Object.defineProperty(D,"prototype",{writable:!1}),D}function E(D){var P=R(D,"string");return typeof P=="symbol"?P:String(P)}function R(D,P){if(typeof D!="object"||D===null)return D;var I=D[Symbol.toPrimitive];if(I!==void 0){var c=I.call(D,P||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(P==="string"?String:Number)(D)}var x=10,A=function(){function D(I){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=I}var P=D.prototype;return P.reloaded=function(c){if(!c){this.advanced=!0,this.updated=!0;return}var m=this.lastPartSn-c.lastPartSn,_=this.lastPartIndex-c.lastPartIndex;this.updated=this.endSN!==c.endSN||!!_||!!m,this.advanced=this.endSN>c.endSN||m>0||m===0&&_>0,this.updated||this.advanced?this.misses=Math.floor(c.misses*.6):this.misses=c.misses+1,this.availabilityDelay=c.availabilityDelay},S(D,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,g.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||x}},{key:"drift",get:function(){var c=this.driftEndTime-this.driftStartTime;if(c>0){var m=this.driftEnd-this.driftStart;return m*1e3/c}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var c;return(c=this.partList)!==null&&c!==void 0&&c.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var c;return(c=this.fragments)!==null&&c!==void 0&&c.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var c;return(c=this.partList)!==null&&c!==void 0&&c.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var c;return(c=this.partList)!==null&&c!==void 0&&c.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),D}()},"./src/loader/level-key.ts":(C,b,a)=>{a.r(b),a.d(b,{LevelKey:()=>A});var g=a("./src/utils/keysystem-util.ts"),d=a("./src/utils/mediakeys-helper.ts"),S=a("./src/utils/mp4-tools.ts"),E=a("./src/utils/logger.ts"),R=a("./src/utils/numeric-encoding-utils.ts"),x={},A=function(){P.clearKeyUriToKeyIdMap=function(){x={}};function P(c,m,_,o,i){o===void 0&&(o=[1]),i===void 0&&(i=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=c,this.uri=m,this.keyFormat=_,this.keyFormatVersions=o,this.iv=i,this.encrypted=c?c!=="NONE":!1,this.isCommonEncryption=this.encrypted&&c!=="AES-128"}var I=P.prototype;return I.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;switch(this.keyFormat){case"identity":return this.method==="SAMPLE-AES";case d.KeySystemFormats.FAIRPLAY:case d.KeySystemFormats.WIDEVINE:case d.KeySystemFormats.PLAYREADY:case d.KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},I.getDecryptData=function(m){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof m!="number"&&(this.method==="AES-128"&&!this.iv&&E.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),m=0);var _=D(m),o=new P(this.method,this.uri,"identity",this.keyFormatVersions,_);return o}var i=(0,g.convertDataUriToArrayBytes)(this.uri);if(i)switch(this.keyFormat){case d.KeySystemFormats.WIDEVINE:this.pssh=i,i.length>=22&&(this.keyId=i.subarray(i.length-22,i.length-6));break;case d.KeySystemFormats.PLAYREADY:{var t=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,S.mp4pssh)(t,null,i);var r=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),l=String.fromCharCode.apply(null,Array.from(r)),p=l.substring(l.indexOf("<"),l.length),u=new DOMParser,f=u.parseFromString(p,"text/xml"),L=f.getElementsByTagName("KID")[0];if(L){var v=L.childNodes[0]?L.childNodes[0].nodeValue:L.getAttribute("VALUE");if(v){var y=(0,R.base64Decode)(v).subarray(0,16);(0,g.changeEndianness)(y),this.keyId=y}}break}default:{var n=i.subarray(0,16);if(n.length!==16){var s=new Uint8Array(16);s.set(n,16-n.length),n=s}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){var e=x[this.uri];if(!e){var h=Object.keys(x).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);var M=new DataView(e.buffer,12,4);M.setUint32(0,h),x[this.uri]=e}this.keyId=e}return this},P}();function D(P){for(var I=new Uint8Array(16),c=12;c<16;c++)I[c]=P>>8*(15-c)&255;return I}},"./src/loader/load-stats.ts":(C,b,a)=>{a.r(b),a.d(b,{LoadStats:()=>g});var g=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>i});var g=a("./src/polyfills/number.ts"),d=a("./node_modules/url-toolkit/src/url-toolkit.js"),S=a("./src/loader/date-range.ts"),E=a("./src/loader/fragment.ts"),R=a("./src/loader/level-details.ts"),x=a("./src/loader/level-key.ts"),A=a("./src/utils/attr-list.ts"),D=a("./src/utils/logger.ts"),P=a("./src/utils/codecs.ts");function I(){return I=Object.assign?Object.assign.bind():function(v){for(var y=1;y<arguments.length;y++){var n=arguments[y];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(v[s]=n[s])}return v},I.apply(this,arguments)}var c=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,m=/#EXT-X-MEDIA:(.*)/g,_=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),o=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),i=function(){function v(){}return v.findGroup=function(n,s){for(var e=0;e<n.length;e++){var h=n[e];if(h.id===s)return h}},v.convertAVC1ToAVCOTI=function(n){var s=n.split(".");if(s.length>2){var e=s.shift()+".";return e+=parseInt(s.shift()).toString(16),e+=("000"+parseInt(s.shift()).toString(16)).slice(-4),e}return n},v.resolve=function(n,s){return(0,d.buildAbsoluteURL)(s,n,{alwaysNormalize:!0})},v.parseMasterPlaylist=function(n,s){var e=[],h=[],M={},T=[],B=!1;c.lastIndex=0;for(var N;(N=c.exec(n))!=null;)if(N[1]){var j,z=new A.AttrList(N[1]),K={attrs:z,bitrate:z.decimalInteger("AVERAGE-BANDWIDTH")||z.decimalInteger("BANDWIDTH"),name:z.NAME,url:v.resolve(N[2],s)},V=z.decimalResolution("RESOLUTION");V&&(K.width=V.width,K.height=V.height),r((z.CODECS||"").split(/[ ,]+/).filter(function(te){return te}),K),K.videoCodec&&K.videoCodec.indexOf("avc1")!==-1&&(K.videoCodec=v.convertAVC1ToAVCOTI(K.videoCodec)),(j=K.unknownCodecs)!==null&&j!==void 0&&j.length||h.push(K),e.push(K)}else if(N[3]){var $=new A.AttrList(N[3]);$["DATA-ID"]&&(B=!0,M[$["DATA-ID"]]=$)}else if(N[4]){var X=N[4],Z=t(X,s);Z.encrypted&&Z.isSupported()?T.push(Z):D.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+X+'"')}var q=h.length>0&&h.length<e.length;return{levels:q?h:e,sessionData:B?M:null,sessionKeys:T.length?T:null}},v.parseMasterPlaylistMedia=function(n,s,e,h){h===void 0&&(h=[]);var M,T=[],B=0;for(m.lastIndex=0;(M=m.exec(n))!==null;){var N=new A.AttrList(M[1]);if(N.TYPE===e){var j={attrs:N,bitrate:0,id:B++,groupId:N["GROUP-ID"],instreamId:N["INSTREAM-ID"],name:N.NAME||N.LANGUAGE||"",type:e,default:N.bool("DEFAULT"),autoselect:N.bool("AUTOSELECT"),forced:N.bool("FORCED"),lang:N.LANGUAGE,url:N.URI?v.resolve(N.URI,s):""};if(h.length){var z=v.findGroup(h,j.groupId)||h[0];l(j,z,"audioCodec"),l(j,z,"textCodec")}T.push(j)}}return T},v.parseLevelPlaylist=function(n,s,e,h,M){var T=new R.LevelDetails(s),B=T.fragments,N=null,j=0,z=0,K=0,V=0,$=null,X=new E.Fragment(h,s),Z,q,te,ue=-1,oe=!1;for(_.lastIndex=0,T.m3u8=n;(Z=_.exec(n))!==null;){oe&&(oe=!1,X=new E.Fragment(h,s),X.start=K,X.sn=j,X.cc=V,X.level=e,N&&(X.initSegment=N,X.rawProgramDateTime=N.rawProgramDateTime,N.rawProgramDateTime=null));var le=Z[1];if(le){X.duration=parseFloat(le);var me=(" "+Z[2]).slice(1);X.title=me||null,X.tagList.push(me?["INF",le,me]:["INF",le])}else if(Z[3])(0,g.isFiniteNumber)(X.duration)&&(X.start=K,te&&L(X,te,T),X.sn=j,X.level=e,X.cc=V,X.urlId=M,B.push(X),X.relurl=(" "+Z[3]).slice(1),u(X,$),$=X,K+=X.duration,j++,z=0,oe=!0);else if(Z[4]){var _e=(" "+Z[4]).slice(1);$?X.setByteRange(_e,$):X.setByteRange(_e)}else if(Z[5])X.rawProgramDateTime=(" "+Z[5]).slice(1),X.tagList.push(["PROGRAM-DATE-TIME",X.rawProgramDateTime]),ue===-1&&(ue=B.length);else{if(Z=Z[0].match(o),!Z){D.logger.warn("No matches on slow regex match for level playlist!");continue}for(q=1;q<Z.length&&typeof Z[q]=="undefined";q++);var ve=(" "+Z[q]).slice(1),ce=(" "+Z[q+1]).slice(1),he=Z[q+2]?(" "+Z[q+2]).slice(1):"";switch(ve){case"PLAYLIST-TYPE":T.type=ce.toUpperCase();break;case"MEDIA-SEQUENCE":j=T.startSN=parseInt(ce);break;case"SKIP":{var Le=new A.AttrList(ce),De=Le.decimalInteger("SKIPPED-SEGMENTS");if((0,g.isFiniteNumber)(De)){T.skippedSegments=De;for(var Fe=De;Fe--;)B.unshift(null);j+=De}var Oe=Le.enumeratedString("RECENTLY-REMOVED-DATERANGES");Oe&&(T.recentlyRemovedDateranges=Oe.split("	"));break}case"TARGETDURATION":T.targetduration=parseFloat(ce);break;case"VERSION":T.version=parseInt(ce);break;case"EXTM3U":break;case"ENDLIST":T.live=!1;break;case"#":(ce||he)&&X.tagList.push(he?[ce,he]:[ce]);break;case"DISCONTINUITY":V++,X.tagList.push(["DIS"]);break;case"GAP":X.tagList.push([ve]);break;case"BITRATE":X.tagList.push([ve,ce]);break;case"DATERANGE":{var ke=new A.AttrList(ce),Ie=new S.DateRange(ke,T.dateRanges[ke.ID]);Ie.isValid||T.skippedSegments?T.dateRanges[Ie.id]=Ie:D.logger.warn('Ignoring invalid DATERANGE tag: "'+ce+'"'),X.tagList.push(["EXT-X-DATERANGE",ce]);break}case"DISCONTINUITY-SEQUENCE":V=parseInt(ce);break;case"KEY":{var we=t(ce,s);if(we.isSupported()){if(we.method==="NONE"){te=void 0;break}te||(te={}),te[we.keyFormat]&&(te=I({},te)),te[we.keyFormat]=we}else D.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+ce+'"');break}case"START":{var Ue=new A.AttrList(ce),We=Ue.decimalFloatingPoint("TIME-OFFSET");(0,g.isFiniteNumber)(We)&&(T.startTimeOffset=We);break}case"MAP":{var tt=new A.AttrList(ce);if(X.duration){var je=new E.Fragment(h,s);f(je,tt,e,te),N=je,X.initSegment=N,N.rawProgramDateTime&&!X.rawProgramDateTime&&(X.rawProgramDateTime=N.rawProgramDateTime)}else f(X,tt,e,te),N=X,oe=!0;break}case"SERVER-CONTROL":{var Je=new A.AttrList(ce);T.canBlockReload=Je.bool("CAN-BLOCK-RELOAD"),T.canSkipUntil=Je.optionalFloat("CAN-SKIP-UNTIL",0),T.canSkipDateRanges=T.canSkipUntil>0&&Je.bool("CAN-SKIP-DATERANGES"),T.partHoldBack=Je.optionalFloat("PART-HOLD-BACK",0),T.holdBack=Je.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var ot=new A.AttrList(ce);T.partTarget=ot.decimalFloatingPoint("PART-TARGET");break}case"PART":{var He=T.partList;He||(He=T.partList=[]);var ut=z>0?He[He.length-1]:void 0,Qe=z++,be=new E.Part(new A.AttrList(ce),X,s,Qe,ut);He.push(be),X.duration+=be.duration;break}case"PRELOAD-HINT":{var dt=new A.AttrList(ce);T.preloadHint=dt;break}case"RENDITION-REPORT":{var Be=new A.AttrList(ce);T.renditionReports=T.renditionReports||[],T.renditionReports.push(Be);break}default:D.logger.warn("line parsed but not handled: "+Z);break}}}$&&!$.relurl?(B.pop(),K-=$.duration,T.partList&&(T.fragmentHint=$)):T.partList&&(u(X,$),X.cc=V,T.fragmentHint=X,te&&L(X,te,T));var it=B.length,U=B[0],k=B[it-1];if(K+=T.skippedSegments*T.targetduration,K>0&&it&&k){T.averagetargetduration=K/it;var F=k.sn;T.endSN=F!=="initSegment"?F:0,T.live||(k.endList=!0),U&&(T.startCC=U.cc)}else T.endSN=0,T.startCC=0;return T.fragmentHint&&(K+=T.fragmentHint.duration),T.totalduration=K,T.endCC=V,ue>0&&p(B,ue),T},v}();function t(v,y){var n,s,e=new A.AttrList(v),h=(n=e.enumeratedString("METHOD"))!=null?n:"",M=e.URI,T=e.hexadecimalInteger("IV"),B=e.enumeratedString("KEYFORMATVERSIONS"),N=(s=e.enumeratedString("KEYFORMAT"))!=null?s:"identity";M&&e.IV&&!T&&D.logger.error("Invalid IV: "+e.IV);var j=M?i.resolve(M,y):"",z=(B||"1").split("/").map(Number).filter(Number.isFinite);return new x.LevelKey(h,j,N,z,T)}function r(v,y){["video","audio","text"].forEach(function(n){var s=v.filter(function(h){return(0,P.isCodecType)(h,n)});if(s.length){var e=s.filter(function(h){return h.lastIndexOf("avc1",0)===0||h.lastIndexOf("mp4a",0)===0});y[n+"Codec"]=e.length>0?e[0]:s[0],v=v.filter(function(h){return s.indexOf(h)===-1})}}),y.unknownCodecs=v}function l(v,y,n){var s=y[n];s&&(v[n]=s)}function p(v,y){for(var n=v[y],s=y;s--;){var e=v[s];if(!e)return;e.programDateTime=n.programDateTime-e.duration*1e3,n=e}}function u(v,y){v.rawProgramDateTime?v.programDateTime=Date.parse(v.rawProgramDateTime):y!=null&&y.programDateTime&&(v.programDateTime=y.endProgramDateTime),(0,g.isFiniteNumber)(v.programDateTime)||(v.programDateTime=null,v.rawProgramDateTime=null)}function f(v,y,n,s){v.relurl=y.URI,y.BYTERANGE&&v.setByteRange(y.BYTERANGE),v.level=n,v.sn="initSegment",s&&(v.levelkeys=s),v.initSegment=null}function L(v,y,n){v.levelkeys=y;var s=n.encryptedFragments;(!s.length||s[s.length-1].levelkeys!==y)&&Object.keys(y).some(function(e){return y[e].isCommonEncryption})&&s.push(v)}},"./src/loader/playlist-loader.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>c});var g=a("./src/polyfills/number.ts"),d=a("./src/events.ts"),S=a("./src/errors.ts"),E=a("./src/utils/logger.ts"),R=a("./src/loader/m3u8-parser.ts"),x=a("./src/types/loader.ts"),A=a("./src/utils/attr-list.ts");function D(m){var _=m.type;switch(_){case x.PlaylistContextType.AUDIO_TRACK:return x.PlaylistLevelType.AUDIO;case x.PlaylistContextType.SUBTITLE_TRACK:return x.PlaylistLevelType.SUBTITLE;default:return x.PlaylistLevelType.MAIN}}function P(m,_){var o=m.url;return(o===void 0||o.indexOf("data:")===0)&&(o=_.url),o}var I=function(){function m(o){this.hls=void 0,this.loaders=Object.create(null),this.hls=o,this.registerListeners()}var _=m.prototype;return _.startLoad=function(i){},_.stopLoad=function(){this.destroyInternalLoaders()},_.registerListeners=function(){var i=this.hls;i.on(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(d.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(d.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),i.on(d.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},_.unregisterListeners=function(){var i=this.hls;i.off(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(d.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(d.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),i.off(d.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},_.createInternalLoader=function(i){var t=this.hls.config,r=t.pLoader,l=t.loader,p=r||l,u=new p(t);return i.loader=u,this.loaders[i.type]=u,u},_.getInternalLoader=function(i){return this.loaders[i.type]},_.resetInternalLoader=function(i){this.loaders[i]&&delete this.loaders[i]},_.destroyInternalLoaders=function(){for(var i in this.loaders){var t=this.loaders[i];t&&t.destroy(),this.resetInternalLoader(i)}},_.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},_.onManifestLoading=function(i,t){var r=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:x.PlaylistContextType.MANIFEST,url:r,deliveryDirectives:null})},_.onLevelLoading=function(i,t){var r=t.id,l=t.level,p=t.url,u=t.deliveryDirectives;this.load({id:r,groupId:null,level:l,responseType:"text",type:x.PlaylistContextType.LEVEL,url:p,deliveryDirectives:u})},_.onAudioTrackLoading=function(i,t){var r=t.id,l=t.groupId,p=t.url,u=t.deliveryDirectives;this.load({id:r,groupId:l,level:null,responseType:"text",type:x.PlaylistContextType.AUDIO_TRACK,url:p,deliveryDirectives:u})},_.onSubtitleTrackLoading=function(i,t){var r=t.id,l=t.groupId,p=t.url,u=t.deliveryDirectives;this.load({id:r,groupId:l,level:null,responseType:"text",type:x.PlaylistContextType.SUBTITLE_TRACK,url:p,deliveryDirectives:u})},_.load=function(i){var t,r=this.hls.config,l=this.getInternalLoader(i);if(l){var p=l.context;if(p&&p.url===i.url){E.logger.trace("[playlist-loader]: playlist request ongoing");return}E.logger.log("[playlist-loader]: aborting previous loader for type: "+i.type),l.abort()}var u,f,L,v;switch(i.type){case x.PlaylistContextType.MANIFEST:u=r.manifestLoadingMaxRetry,f=r.manifestLoadingTimeOut,L=r.manifestLoadingRetryDelay,v=r.manifestLoadingMaxRetryTimeout;break;case x.PlaylistContextType.LEVEL:case x.PlaylistContextType.AUDIO_TRACK:case x.PlaylistContextType.SUBTITLE_TRACK:u=0,f=r.levelLoadingTimeOut;break;default:u=r.levelLoadingMaxRetry,f=r.levelLoadingTimeOut,L=r.levelLoadingRetryDelay,v=r.levelLoadingMaxRetryTimeout;break}if(l=this.createInternalLoader(i),(t=i.deliveryDirectives)!==null&&t!==void 0&&t.part){var y;if(i.type===x.PlaylistContextType.LEVEL&&i.level!==null?y=this.hls.levels[i.level].details:i.type===x.PlaylistContextType.AUDIO_TRACK&&i.id!==null?y=this.hls.audioTracks[i.id].details:i.type===x.PlaylistContextType.SUBTITLE_TRACK&&i.id!==null&&(y=this.hls.subtitleTracks[i.id].details),y){var n=y.partTarget,s=y.targetduration;n&&s&&(f=Math.min(Math.max(n*3,s*.8)*1e3,f))}}var e={timeout:f,maxRetry:u,retryDelay:L,maxRetryDelay:v,highWaterMark:0},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};l.load(i,e,h)},_.loadsuccess=function(i,t,r,l){l===void 0&&(l=null),this.resetInternalLoader(r.type);var p=i.data;if(p.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(i,r,"no EXTM3U delimiter",l);return}t.parsing.start=performance.now(),p.indexOf("#EXTINF:")>0||p.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(i,t,r,l):this.handleMasterPlaylist(i,t,r,l)},_.loaderror=function(i,t,r){r===void 0&&(r=null),this.handleNetworkError(t,r,!1,i)},_.loadtimeout=function(i,t,r){r===void 0&&(r=null),this.handleNetworkError(t,r,!0)},_.handleMasterPlaylist=function(i,t,r,l){var p=this.hls,u=i.data,f=P(i,r),L=R.default.parseMasterPlaylist(u,f),v=L.levels,y=L.sessionData,n=L.sessionKeys;if(!v.length){this.handleManifestParsingError(i,r,"no level found in manifest",l);return}var s=v.map(function(N){return{id:N.attrs.AUDIO,audioCodec:N.audioCodec}}),e=v.map(function(N){return{id:N.attrs.SUBTITLES,textCodec:N.textCodec}}),h=R.default.parseMasterPlaylistMedia(u,f,"AUDIO",s),M=R.default.parseMasterPlaylistMedia(u,f,"SUBTITLES",e),T=R.default.parseMasterPlaylistMedia(u,f,"CLOSED-CAPTIONS");if(h.length){var B=h.some(function(N){return!N.url});!B&&v[0].audioCodec&&!v[0].attrs.AUDIO&&(E.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new A.AttrList({}),bitrate:0,url:""}))}p.trigger(d.Events.MANIFEST_LOADED,{levels:v,audioTracks:h,subtitles:M,captions:T,url:f,stats:t,networkDetails:l,sessionData:y,sessionKeys:n})},_.handleTrackOrLevelPlaylist=function(i,t,r,l){var p=this.hls,u=r.id,f=r.level,L=r.type,v=P(i,r),y=(0,g.isFiniteNumber)(u)?u:0,n=(0,g.isFiniteNumber)(f)?f:y,s=D(r),e=R.default.parseLevelPlaylist(i.data,v,n,s,y);if(!e.fragments.length){p.trigger(d.Events.ERROR,{type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:typeof r.level=="number"?r.level:void 0});return}if(L===x.PlaylistContextType.MANIFEST){var h={attrs:new A.AttrList({}),bitrate:0,details:e,name:"",url:v};p.trigger(d.Events.MANIFEST_LOADED,{levels:[h],audioTracks:[],url:v,stats:t,networkDetails:l,sessionData:null,sessionKeys:null})}t.parsing.end=performance.now(),r.levelDetails=e,this.handlePlaylistLoaded(i,t,r,l)},_.handleManifestParsingError=function(i,t,r,l){this.hls.trigger(d.Events.ERROR,{type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===x.PlaylistContextType.MANIFEST,url:i.url,reason:r,response:i,context:t,networkDetails:l})},_.handleNetworkError=function(i,t,r,l){r===void 0&&(r=!1),E.logger.warn("[playlist-loader]: A network "+(r?"timeout":"error")+" occurred while loading "+i.type+" level: "+i.level+" id: "+i.id+' group-id: "'+i.groupId+'"');var p=S.ErrorDetails.UNKNOWN,u=!1,f=this.getInternalLoader(i);switch(i.type){case x.PlaylistContextType.MANIFEST:p=r?S.ErrorDetails.MANIFEST_LOAD_TIMEOUT:S.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case x.PlaylistContextType.LEVEL:p=r?S.ErrorDetails.LEVEL_LOAD_TIMEOUT:S.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case x.PlaylistContextType.AUDIO_TRACK:p=r?S.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:S.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case x.PlaylistContextType.SUBTITLE_TRACK:p=r?S.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:S.ErrorDetails.SUBTITLE_LOAD_ERROR,u=!1;break}f&&this.resetInternalLoader(i.type);var L={type:S.ErrorTypes.NETWORK_ERROR,details:p,fatal:u,url:i.url,loader:f,context:i,networkDetails:t};l&&(L.response=l),this.hls.trigger(d.Events.ERROR,L)},_.handlePlaylistLoaded=function(i,t,r,l){var p=r.type,u=r.level,f=r.id,L=r.groupId,v=r.loader,y=r.levelDetails,n=r.deliveryDirectives;if(!(y!=null&&y.targetduration)){this.handleManifestParsingError(i,r,"invalid target duration",l);return}if(!!v)switch(y.live&&(v.getCacheAge&&(y.ageHeader=v.getCacheAge()||0),(!v.getCacheAge||isNaN(y.ageHeader))&&(y.ageHeader=0)),p){case x.PlaylistContextType.MANIFEST:case x.PlaylistContextType.LEVEL:this.hls.trigger(d.Events.LEVEL_LOADED,{details:y,level:u||0,id:f||0,stats:t,networkDetails:l,deliveryDirectives:n});break;case x.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(d.Events.AUDIO_TRACK_LOADED,{details:y,id:f||0,groupId:L||"",stats:t,networkDetails:l,deliveryDirectives:n});break;case x.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(d.Events.SUBTITLE_TRACK_LOADED,{details:y,id:f||0,groupId:L||"",stats:t,networkDetails:l,deliveryDirectives:n});break}},m}();const c=I},"./src/polyfills/number.ts":(C,b,a)=>{a.r(b),a.d(b,{MAX_SAFE_INTEGER:()=>d,isFiniteNumber:()=>g});var g=Number.isFinite||function(S){return typeof S=="number"&&isFinite(S)},d=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>d});var g=function(){function S(){}return S.getSilentFrame=function(R,x){switch(R){case"mp4a.40.2":if(x===1)return new Uint8Array([0,200,0,128,35,128]);if(x===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(x===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(x===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(x===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(x===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(x===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(x===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(x===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},S}();const d=g},"./src/remux/mp4-generator.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>S});var g=Math.pow(2,32)-1,d=function(){function E(){}return E.init=function(){E.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var x;for(x in E.types)E.types.hasOwnProperty(x)&&(E.types[x]=[x.charCodeAt(0),x.charCodeAt(1),x.charCodeAt(2),x.charCodeAt(3)]);var A=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),D=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);E.HDLR_TYPES={video:A,audio:D};var P=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),I=new Uint8Array([0,0,0,0,0,0,0,0]);E.STTS=E.STSC=E.STCO=I,E.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),E.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),E.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),E.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var c=new Uint8Array([105,115,111,109]),m=new Uint8Array([97,118,99,49]),_=new Uint8Array([0,0,0,1]);E.FTYP=E.box(E.types.ftyp,c,_,c,m),E.DINF=E.box(E.types.dinf,E.box(E.types.dref,P))},E.box=function(x){for(var A=8,D=arguments.length,P=new Array(D>1?D-1:0),I=1;I<D;I++)P[I-1]=arguments[I];for(var c=P.length,m=c;c--;)A+=P[c].byteLength;var _=new Uint8Array(A);for(_[0]=A>>24&255,_[1]=A>>16&255,_[2]=A>>8&255,_[3]=A&255,_.set(x,4),c=0,A=8;c<m;c++)_.set(P[c],A),A+=P[c].byteLength;return _},E.hdlr=function(x){return E.box(E.types.hdlr,E.HDLR_TYPES[x])},E.mdat=function(x){return E.box(E.types.mdat,x)},E.mdhd=function(x,A){A*=x;var D=Math.floor(A/(g+1)),P=Math.floor(A%(g+1));return E.box(E.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,D>>24,D>>16&255,D>>8&255,D&255,P>>24,P>>16&255,P>>8&255,P&255,85,196,0,0]))},E.mdia=function(x){return E.box(E.types.mdia,E.mdhd(x.timescale,x.duration),E.hdlr(x.type),E.minf(x))},E.mfhd=function(x){return E.box(E.types.mfhd,new Uint8Array([0,0,0,0,x>>24,x>>16&255,x>>8&255,x&255]))},E.minf=function(x){return x.type==="audio"?E.box(E.types.minf,E.box(E.types.smhd,E.SMHD),E.DINF,E.stbl(x)):E.box(E.types.minf,E.box(E.types.vmhd,E.VMHD),E.DINF,E.stbl(x))},E.moof=function(x,A,D){return E.box(E.types.moof,E.mfhd(x),E.traf(D,A))},E.moov=function(x){for(var A=x.length,D=[];A--;)D[A]=E.trak(x[A]);return E.box.apply(null,[E.types.moov,E.mvhd(x[0].timescale,x[0].duration)].concat(D).concat(E.mvex(x)))},E.mvex=function(x){for(var A=x.length,D=[];A--;)D[A]=E.trex(x[A]);return E.box.apply(null,[E.types.mvex].concat(D))},E.mvhd=function(x,A){A*=x;var D=Math.floor(A/(g+1)),P=Math.floor(A%(g+1)),I=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,D>>24,D>>16&255,D>>8&255,D&255,P>>24,P>>16&255,P>>8&255,P&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return E.box(E.types.mvhd,I)},E.sdtp=function(x){var A=x.samples||[],D=new Uint8Array(4+A.length),P,I;for(P=0;P<A.length;P++)I=A[P].flags,D[P+4]=I.dependsOn<<4|I.isDependedOn<<2|I.hasRedundancy;return E.box(E.types.sdtp,D)},E.stbl=function(x){return E.box(E.types.stbl,E.stsd(x),E.box(E.types.stts,E.STTS),E.box(E.types.stsc,E.STSC),E.box(E.types.stsz,E.STSZ),E.box(E.types.stco,E.STCO))},E.avc1=function(x){var A=[],D=[],P,I,c;for(P=0;P<x.sps.length;P++)I=x.sps[P],c=I.byteLength,A.push(c>>>8&255),A.push(c&255),A=A.concat(Array.prototype.slice.call(I));for(P=0;P<x.pps.length;P++)I=x.pps[P],c=I.byteLength,D.push(c>>>8&255),D.push(c&255),D=D.concat(Array.prototype.slice.call(I));var m=E.box(E.types.avcC,new Uint8Array([1,A[3],A[4],A[5],255,224|x.sps.length].concat(A).concat([x.pps.length]).concat(D))),_=x.width,o=x.height,i=x.pixelRatio[0],t=x.pixelRatio[1];return E.box(E.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,_>>8&255,_&255,o>>8&255,o&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),m,E.box(E.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),E.box(E.types.pasp,new Uint8Array([i>>24,i>>16&255,i>>8&255,i&255,t>>24,t>>16&255,t>>8&255,t&255])))},E.esds=function(x){var A=x.config.length;return new Uint8Array([0,0,0,0,3,23+A,0,1,0,4,15+A,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([A]).concat(x.config).concat([6,1,2]))},E.mp4a=function(x){var A=x.samplerate;return E.box(E.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,x.channelCount,0,16,0,0,0,0,A>>8&255,A&255,0,0]),E.box(E.types.esds,E.esds(x)))},E.mp3=function(x){var A=x.samplerate;return E.box(E.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,x.channelCount,0,16,0,0,0,0,A>>8&255,A&255,0,0]))},E.stsd=function(x){return x.type==="audio"?x.segmentCodec==="mp3"&&x.codec==="mp3"?E.box(E.types.stsd,E.STSD,E.mp3(x)):E.box(E.types.stsd,E.STSD,E.mp4a(x)):E.box(E.types.stsd,E.STSD,E.avc1(x))},E.tkhd=function(x){var A=x.id,D=x.duration*x.timescale,P=x.width,I=x.height,c=Math.floor(D/(g+1)),m=Math.floor(D%(g+1));return E.box(E.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,A&255,0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255,m>>24,m>>16&255,m>>8&255,m&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,P>>8&255,P&255,0,0,I>>8&255,I&255,0,0]))},E.traf=function(x,A){var D=E.sdtp(x),P=x.id,I=Math.floor(A/(g+1)),c=Math.floor(A%(g+1));return E.box(E.types.traf,E.box(E.types.tfhd,new Uint8Array([0,0,0,0,P>>24,P>>16&255,P>>8&255,P&255])),E.box(E.types.tfdt,new Uint8Array([1,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,c>>24,c>>16&255,c>>8&255,c&255])),E.trun(x,D.length+16+20+8+16+8+8),D)},E.trak=function(x){return x.duration=x.duration||4294967295,E.box(E.types.trak,E.tkhd(x),E.mdia(x))},E.trex=function(x){var A=x.id;return E.box(E.types.trex,new Uint8Array([0,0,0,0,A>>24,A>>16&255,A>>8&255,A&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},E.trun=function(x,A){var D=x.samples||[],P=D.length,I=12+16*P,c=new Uint8Array(I),m,_,o,i,t,r;for(A+=8+I,c.set([x.type==="video"?1:0,0,15,1,P>>>24&255,P>>>16&255,P>>>8&255,P&255,A>>>24&255,A>>>16&255,A>>>8&255,A&255],0),m=0;m<P;m++)_=D[m],o=_.duration,i=_.size,t=_.flags,r=_.cts,c.set([o>>>24&255,o>>>16&255,o>>>8&255,o&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.paddingValue<<1|t.isNonSync,t.degradPrio&240<<8,t.degradPrio&15,r>>>24&255,r>>>16&255,r>>>8&255,r&255],12+16*m);return E.box(E.types.trun,c)},E.initSegment=function(x){E.types||E.init();var A=E.moov(x),D=new Uint8Array(E.FTYP.byteLength+A.byteLength);return D.set(E.FTYP),D.set(A,E.FTYP.byteLength),D},E}();d.types=void 0,d.HDLR_TYPES=void 0,d.STTS=void 0,d.STSC=void 0,d.STCO=void 0,d.STSZ=void 0,d.VMHD=void 0,d.SMHD=void 0,d.STSD=void 0,d.FTYP=void 0,d.DINF=void 0;const S=d},"./src/remux/mp4-remuxer.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>i,flushTextTrackMetadataCueSamples:()=>l,flushTextTrackUserdataCueSamples:()=>p,normalizePts:()=>t});var g=a("./src/polyfills/number.ts"),d=a("./src/remux/aac-helper.ts"),S=a("./src/remux/mp4-generator.ts"),E=a("./src/events.ts"),R=a("./src/errors.ts"),x=a("./src/utils/logger.ts"),A=a("./src/types/loader.ts"),D=a("./src/utils/timescale-conversion.ts");function P(){return P=Object.assign?Object.assign.bind():function(L){for(var v=1;v<arguments.length;v++){var y=arguments[v];for(var n in y)Object.prototype.hasOwnProperty.call(y,n)&&(L[n]=y[n])}return L},P.apply(this,arguments)}var I=10*1e3,c=1024,m=1152,_=null,o=null,i=function(){function L(y,n,s,e){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=y,this.config=n,this.typeSupported=s,this.ISGenerated=!1,_===null){var h=navigator.userAgent||"",M=h.match(/Chrome\/(\d+)/i);_=M?parseInt(M[1]):0}if(o===null){var T=navigator.userAgent.match(/Safari\/(\d+)/i);o=T?parseInt(T[1]):0}}var v=L.prototype;return v.destroy=function(){},v.resetTimeStamp=function(n){x.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=n},v.resetNextTimestamp=function(){x.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},v.resetInitSegment=function(){x.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},v.getVideoStartPts=function(n){var s=!1,e=n.reduce(function(h,M){var T=M.pts-h;return T<-4294967296?(s=!0,t(h,M.pts)):T>0?h:M.pts},n[0].pts);return s&&x.logger.debug("PTS rollover detected"),e},v.remux=function(n,s,e,h,M,T,B,N){var j,z,K,V,$,X,Z=M,q=M,te=n.pid>-1,ue=s.pid>-1,oe=s.samples.length,le=n.samples.length>0,me=B&&oe>0||oe>1,_e=(!te||le)&&(!ue||me)||this.ISGenerated||B;if(_e){this.ISGenerated||(K=this.generateIS(n,s,M));var ve=this.isVideoContiguous,ce=-1,he;if(me&&(ce=r(s.samples),!ve&&this.config.forceKeyFrameOnDiscontinuity))if(X=!0,ce>0){x.logger.warn("[mp4-remuxer]: Dropped "+ce+" out of "+oe+" video samples due to a missing keyframe");var Le=this.getVideoStartPts(s.samples);s.samples=s.samples.slice(ce),s.dropped+=ce,q+=(s.samples[0].pts-Le)/s.inputTimeScale,he=q}else ce===-1&&(x.logger.warn("[mp4-remuxer]: No keyframe found out of "+oe+" video samples"),X=!1);if(this.ISGenerated){if(le&&me){var De=this.getVideoStartPts(s.samples),Fe=t(n.samples[0].pts,De)-De,Oe=Fe/s.inputTimeScale;Z+=Math.max(0,Oe),q+=Math.max(0,-Oe)}if(le){if(n.samplerate||(x.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),K=this.generateIS(n,s,M)),z=this.remuxAudio(n,Z,this.isAudioContiguous,T,ue||me||N===A.PlaylistLevelType.AUDIO?q:void 0),me){var ke=z?z.endPTS-z.startPTS:0;s.inputTimeScale||(x.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),K=this.generateIS(n,s,M)),j=this.remuxVideo(s,q,ve,ke)}}else me&&(j=this.remuxVideo(s,q,ve,0));j&&(j.firstKeyFrame=ce,j.independent=ce!==-1,j.firstKeyFramePTS=he)}}return this.ISGenerated&&(e.samples.length&&($=l(e,M,this._initPTS,this._initDTS)),h.samples.length&&(V=p(h,M,this._initPTS))),{audio:z,video:j,initSegment:K,independent:X,text:V,id3:$}},v.generateIS=function(n,s,e){var h=n.samples,M=s.samples,T=this.typeSupported,B={},N=!(0,g.isFiniteNumber)(this._initPTS),j="audio/mp4",z,K,V;if(N&&(z=K=1/0),n.config&&h.length){switch(n.timescale=n.samplerate,n.segmentCodec){case"mp3":T.mpeg?(j="audio/mpeg",n.codec=""):T.mp3&&(n.codec="mp3");break}B.audio={id:"audio",container:j,codec:n.codec,initSegment:n.segmentCodec==="mp3"&&T.mpeg?new Uint8Array(0):S.default.initSegment([n]),metadata:{channelCount:n.channelCount}},N&&(V=n.inputTimeScale,z=K=h[0].pts-Math.round(V*e))}if(s.sps&&s.pps&&M.length&&(s.timescale=s.inputTimeScale,B.video={id:"main",container:"video/mp4",codec:s.codec,initSegment:S.default.initSegment([s]),metadata:{width:s.width,height:s.height}},N)){V=s.inputTimeScale;var $=this.getVideoStartPts(M),X=Math.round(V*e);K=Math.min(K,t(M[0].dts,$)-X),z=Math.min(z,$-X)}if(Object.keys(B).length)return this.ISGenerated=!0,N&&(this._initPTS=z,this._initDTS=K),{tracks:B,initPTS:z,timescale:V}},v.remuxVideo=function(n,s,e,h){var M=n.inputTimeScale,T=n.samples,B=[],N=T.length,j=this._initPTS,z=this.nextAvcDts,K=8,V=this.videoSampleDuration,$,X,Z=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY,te=!1;if(!e||z===null){var ue=s*M,oe=T[0].pts-t(T[0].dts,T[0].pts);z=ue-oe}for(var le=0;le<N;le++){var me=T[le];me.pts=t(me.pts-j,z),me.dts=t(me.dts-j,z),me.dts<T[le>0?le-1:le].dts&&(te=!0)}te&&T.sort(function(Ae,Ce){var Ye=Ae.dts-Ce.dts,Pe=Ae.pts-Ce.pts;return Ye||Pe}),$=T[0].dts,X=T[T.length-1].dts;var _e=X-$,ve=_e?Math.round(_e/(N-1)):V||n.inputTimeScale/30;if(e){var ce=$-z,he=ce>ve,Le=ce<-1;if((he||Le)&&(he?x.logger.warn("AVC: "+(0,D.toMsFromMpegTsClock)(ce,!0)+" ms ("+ce+"dts) hole between fragments detected, filling it"):x.logger.warn("AVC: "+(0,D.toMsFromMpegTsClock)(-ce,!0)+" ms ("+ce+"dts) overlapping between fragments detected"),!Le||z>T[0].pts)){$=z;var De=T[0].pts-ce;T[0].dts=$,T[0].pts=De,x.logger.log("Video: First PTS/DTS adjusted: "+(0,D.toMsFromMpegTsClock)(De,!0)+"/"+(0,D.toMsFromMpegTsClock)($,!0)+", delta: "+(0,D.toMsFromMpegTsClock)(ce,!0)+" ms")}}$=Math.max(0,$);for(var Fe=0,Oe=0,ke=0;ke<N;ke++){for(var Ie=T[ke],we=Ie.units,Ue=we.length,We=0,tt=0;tt<Ue;tt++)We+=we[tt].data.length;Oe+=We,Fe+=Ue,Ie.length=We,Ie.dts=Math.max(Ie.dts,$),Z=Math.min(Ie.pts,Z),q=Math.max(Ie.pts,q)}X=T[N-1].dts;var je=Oe+4*Fe+8,Je;try{Je=new Uint8Array(je)}catch(Ae){this.observer.emit(E.Events.ERROR,E.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:je,reason:"fail allocating video mdat "+je});return}var ot=new DataView(Je.buffer);ot.setUint32(0,je),Je.set(S.default.types.mdat,4);for(var He=!1,ut=Number.POSITIVE_INFINITY,Qe=Number.POSITIVE_INFINITY,be=Number.NEGATIVE_INFINITY,dt=Number.NEGATIVE_INFINITY,Be=0;Be<N;Be++){for(var it=T[Be],U=it.units,k=0,F=0,w=U.length;F<w;F++){var H=U[F],Q=H.data,Y=H.data.byteLength;ot.setUint32(K,Y),K+=4,Je.set(Q,K),K+=Y,k+=4+Y}var J=void 0;if(Be<N-1)V=T[Be+1].dts-it.dts,J=T[Be+1].pts-it.pts;else{var ie=this.config,re=Be>0?it.dts-T[Be-1].dts:ve;if(J=Be>0?it.pts-T[Be-1].pts:ve,ie.stretchShortVideoTrack&&this.nextAudioPts!==null){var ae=Math.floor(ie.maxBufferHole*M),de=(h?Z+h*M:this.nextAudioPts)-it.pts;de>ae?(V=de-re,V<0?V=re:He=!0,x.logger.log("[mp4-remuxer]: It is approximately "+de/90+" ms to the next segment; using duration "+V/90+" ms for the last video frame.")):V=re}else V=re}var ne=Math.round(it.pts-it.dts);ut=Math.min(ut,V),be=Math.max(be,V),Qe=Math.min(Qe,J),dt=Math.max(dt,J),B.push(new u(it.key,V,k,ne))}if(B.length){if(_){if(_<70){var se=B[0].flags;se.dependsOn=2,se.isNonSync=0}}else if(o&&dt-Qe<be-ut&&ve/be<.025&&B[0].cts===0){x.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var fe=$,ge=0,pe=B.length;ge<pe;ge++){var Te=fe+B[ge].duration,xe=fe+B[ge].cts;if(ge<pe-1){var Ee=Te+B[ge+1].cts;B[ge].duration=Ee-xe}else B[ge].duration=ge?B[ge-1].duration:ve;B[ge].cts=0,fe=Te}}}console.assert(V!==null,"mp4SampleDuration must be computed"),V=He||!V?ve:V,this.nextAvcDts=z=X+V,this.videoSampleDuration=V,this.isVideoContiguous=!0;var Me=S.default.moof(n.sequenceNumber++,$,P({},n,{samples:B})),Se="video",ye={data1:Me,data2:Je,startPTS:Z/M,endPTS:(q+V)/M,startDTS:$/M,endDTS:z/M,type:Se,hasAudio:!1,hasVideo:!0,nb:B.length,dropped:n.dropped};return n.samples=[],n.dropped=0,console.assert(Je.length,"MDAT length must not be zero"),ye},v.remuxAudio=function(n,s,e,h,M){var T=n.inputTimeScale,B=n.samplerate?n.samplerate:T,N=T/B,j=n.segmentCodec==="aac"?c:m,z=j*N,K=this._initPTS,V=n.segmentCodec==="mp3"&&this.typeSupported.mpeg,$=[],X=M!==void 0,Z=n.samples,q=V?0:8,te=this.nextAudioPts||-1,ue=s*T;if(this.isAudioContiguous=e=e||Z.length&&te>0&&(h&&Math.abs(ue-te)<9e3||Math.abs(t(Z[0].pts-K,ue)-te)<20*z),Z.forEach(function(H){H.pts=t(H.pts-K,ue)}),!e||te<0){if(Z=Z.filter(function(H){return H.pts>=0}),!Z.length)return;M===0?te=0:h&&!X?te=Math.max(0,ue):te=Z[0].pts}if(n.segmentCodec==="aac")for(var oe=this.config.maxAudioFramesDrift,le=0,me=te;le<Z.length;le++){var _e=Z[le],ve=_e.pts,ce=ve-me,he=Math.abs(1e3*ce/T);if(ce<=-oe*z&&X)le===0&&(x.logger.warn("Audio frame @ "+(ve/T).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ce/T)+" ms."),this.nextAudioPts=te=me=ve);else if(ce>=oe*z&&he<I&&X){var Le=Math.round(ce/z);me=ve-Le*z,me<0&&(Le--,me+=z),le===0&&(this.nextAudioPts=te=me),x.logger.warn("[mp4-remuxer]: Injecting "+Le+" audio frame @ "+(me/T).toFixed(3)+"s due to "+Math.round(1e3*ce/T)+" ms gap.");for(var De=0;De<Le;De++){var Fe=Math.max(me,0),Oe=d.default.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);Oe||(x.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Oe=_e.unit.subarray()),Z.splice(le,0,{unit:Oe,pts:Fe}),me+=z,le++}}_e.pts=me,me+=z}for(var ke=null,Ie=null,we,Ue=0,We=Z.length;We--;)Ue+=Z[We].unit.byteLength;for(var tt=0,je=Z.length;tt<je;tt++){var Je=Z[tt],ot=Je.unit,He=Je.pts;if(Ie!==null){var ut=$[tt-1];ut.duration=Math.round((He-Ie)/N)}else if(e&&n.segmentCodec==="aac"&&(He=te),ke=He,Ue>0){Ue+=q;try{we=new Uint8Array(Ue)}catch(H){this.observer.emit(E.Events.ERROR,E.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ue,reason:"fail allocating audio mdat "+Ue});return}if(!V){var Qe=new DataView(we.buffer);Qe.setUint32(0,Ue),we.set(S.default.types.mdat,4)}}else return;we.set(ot,q);var be=ot.byteLength;q+=be,$.push(new u(!0,j,be,0)),Ie=He}var dt=$.length;if(!!dt){var Be=$[$.length-1];this.nextAudioPts=te=Ie+N*Be.duration;var it=V?new Uint8Array(0):S.default.moof(n.sequenceNumber++,ke/N,P({},n,{samples:$}));n.samples=[];var U=ke/T,k=te/T,F="audio",w={data1:it,data2:we,startPTS:U,endPTS:k,startDTS:U,endDTS:k,type:F,hasAudio:!0,hasVideo:!1,nb:dt};return this.isAudioContiguous=!0,console.assert(we.length,"MDAT length must not be zero"),w}},v.remuxEmptyAudio=function(n,s,e,h){var M=n.inputTimeScale,T=n.samplerate?n.samplerate:M,B=M/T,N=this.nextAudioPts,j=(N!==null?N:h.startDTS*M)+this._initDTS,z=h.endDTS*M+this._initDTS,K=B*c,V=Math.ceil((z-j)/K),$=d.default.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);if(x.logger.warn("[mp4-remuxer]: remux empty Audio"),!$){x.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var X=[],Z=0;Z<V;Z++){var q=j+Z*K;X.push({unit:$,pts:q,dts:q})}return n.samples=X,this.remuxAudio(n,s,e,!1)},L}();function t(L,v){var y;if(v===null)return L;for(v<L?y=-8589934592:y=8589934592;Math.abs(L-v)>4294967296;)L+=y;return L}function r(L){for(var v=0;v<L.length;v++)if(L[v].key)return v;return-1}function l(L,v,y,n){var s=L.samples.length;if(!!s){for(var e=L.inputTimeScale,h=0;h<s;h++){var M=L.samples[h];M.pts=t(M.pts-y,v*e)/e,M.dts=t(M.dts-n,v*e)/e}var T=L.samples;return L.samples=[],{samples:T}}}function p(L,v,y){var n=L.samples.length;if(!!n){for(var s=L.inputTimeScale,e=0;e<n;e++){var h=L.samples[e];h.pts=t(h.pts-y,v*s)/s}L.samples.sort(function(T,B){return T.pts-B.pts});var M=L.samples;return L.samples=[],{samples:M}}}var u=function(v,y,n,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=y,this.size=n,this.cts=s,this.flags=new f(v)},f=function(v){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=v?2:1,this.isNonSync=v?0:1}},"./src/remux/passthrough-remuxer.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>D});var g=a("./src/polyfills/number.ts"),d=a("./src/remux/mp4-remuxer.ts"),S=a("./src/utils/mp4-tools.ts"),E=a("./src/loader/fragment.ts"),R=a("./src/utils/logger.ts"),x=function(){function P(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var I=P.prototype;return I.destroy=function(){},I.resetTimeStamp=function(m){this.initPTS=m,this.lastEndTime=null},I.resetNextTimestamp=function(){this.lastEndTime=null},I.resetInitSegment=function(m,_,o,i){this.audioCodec=_,this.videoCodec=o,this.generateInitSegment((0,S.patchEncyptionData)(m,i)),this.emitInitSegment=!0},I.generateInitSegment=function(m){var _=this.audioCodec,o=this.videoCodec;if(!m||!m.byteLength){this.initTracks=void 0,this.initData=void 0;return}var i=this.initData=(0,S.parseInitSegment)(m);_||(_=A(i.audio,E.ElementaryStreamTypes.AUDIO)),o||(o=A(i.video,E.ElementaryStreamTypes.VIDEO));var t={};i.audio&&i.video?t.audiovideo={container:"video/mp4",codec:_+","+o,initSegment:m,id:"main"}:i.audio?t.audio={container:"audio/mp4",codec:_,initSegment:m,id:"audio"}:i.video?t.video={container:"video/mp4",codec:o,initSegment:m,id:"main"}:R.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=t},I.remux=function(m,_,o,i,t){var r,l=this.initPTS,p=this.lastEndTime,u={audio:void 0,video:void 0,text:i,id3:o,initSegment:void 0};(0,g.isFiniteNumber)(p)||(p=this.lastEndTime=t||0);var f=_.samples;if(!f||!f.length)return u;var L={initPTS:void 0,timescale:1},v=this.initData;if((!v||!v.length)&&(this.generateInitSegment(f),v=this.initData),!v||!v.length)return R.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),u;this.emitInitSegment&&(L.tracks=this.initTracks,this.emitInitSegment=!1);var y=(0,S.getStartDTS)(v,f);(0,g.isFiniteNumber)(l)||(this.initPTS=L.initPTS=l=y-t);var n=(0,S.getDuration)(f,v),s=m?y-l:p,e=s+n;(0,S.offsetStartDTS)(v,f,l),n>0?this.lastEndTime=e:(R.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var h=!!v.audio,M=!!v.video,T="";h&&(T+="audio"),M&&(T+="video");var B={data1:f,startPTS:s,startDTS:s,endPTS:e,endDTS:e,type:T,hasAudio:h,hasVideo:M,nb:1,dropped:0};u.audio=B.type==="audio"?B:void 0,u.video=B.type!=="audio"?B:void 0,u.initSegment=L;var N=(r=this.initPTS)!=null?r:0;return u.id3=(0,d.flushTextTrackMetadataCueSamples)(o,t,N,N),i.samples.length&&(u.text=(0,d.flushTextTrackUserdataCueSamples)(i,t,N)),u},P}();function A(P,I){var c=P==null?void 0:P.codec;return c&&c.length>4?c:c==="hvc1"||c==="hev1"?"hvc1.1.c.L120.90":c==="av01"?"av01.0.04M.08":c==="avc1"||I===E.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const D=x},"./src/task-loop.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>g});var g=function(){function d(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var S=d.prototype;return S.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},S.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},S.onHandlerDestroyed=function(){},S.hasInterval=function(){return!!this._tickInterval},S.hasNextTick=function(){return!!this._tickTimer},S.setInterval=function(R){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,R),!0)},S.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},S.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},S.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},S.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},S.doTick=function(){},d}()},"./src/types/cmcd.ts":(C,b,a)=>{a.r(b),a.d(b,{CMCDObjectType:()=>d,CMCDStreamType:()=>E,CMCDStreamingFormat:()=>S,CMCDVersion:()=>g});var g=1,d;(function(R){R.MANIFEST="m",R.AUDIO="a",R.VIDEO="v",R.MUXED="av",R.INIT="i",R.CAPTION="c",R.TIMED_TEXT="tt",R.KEY="k",R.OTHER="o"})(d||(d={}));var S;(function(R){R.DASH="d",R.HLS="h",R.SMOOTH="s",R.OTHER="o"})(S||(S={}));var E;(function(R){R.VOD="v",R.LIVE="l"})(E||(E={}))},"./src/types/demuxer.ts":(C,b,a)=>{a.r(b),a.d(b,{MetadataSchema:()=>g});var g;(function(d){d.audioId3="org.id3",d.dateRange="com.apple.quicktime.HLS",d.emsg="https://aomedia.org/emsg/ID3"})(g||(g={}))},"./src/types/level.ts":(C,b,a)=>{a.r(b),a.d(b,{HdcpLevels:()=>R,HlsSkip:()=>x,HlsUrlParameters:()=>D,Level:()=>P,getSkipValue:()=>A});function g(I,c){for(var m=0;m<c.length;m++){var _=c[m];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(I,S(_.key),_)}}function d(I,c,m){return c&&g(I.prototype,c),m&&g(I,m),Object.defineProperty(I,"prototype",{writable:!1}),I}function S(I){var c=E(I,"string");return typeof c=="symbol"?c:String(c)}function E(I,c){if(typeof I!="object"||I===null)return I;var m=I[Symbol.toPrimitive];if(m!==void 0){var _=m.call(I,c||"default");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return(c==="string"?String:Number)(I)}var R=["NONE","TYPE-0","TYPE-1","TYPE-2",null],x;(function(I){I.No="",I.Yes="YES",I.v2="v2"})(x||(x={}));function A(I,c){var m=I.canSkipUntil,_=I.canSkipDateRanges,o=I.endSN,i=c!==void 0?c-o:0;return m&&i<m?_?x.v2:x.Yes:x.No}var D=function(){function I(m,_,o){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=m,this.part=_,this.skip=o}var c=I.prototype;return c.addDirectives=function(_){var o=new self.URL(_);return this.msn!==void 0&&o.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&o.searchParams.set("_HLS_part",this.part.toString()),this.skip&&o.searchParams.set("_HLS_skip",this.skip),o.href},I}(),P=function(){function I(c){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[c.url],this.attrs=c.attrs,this.bitrate=c.bitrate,c.details&&(this.details=c.details),this.id=c.id||0,this.name=c.name,this.width=c.width||0,this.height=c.height||0,this.audioCodec=c.audioCodec,this.videoCodec=c.videoCodec,this.unknownCodecs=c.unknownCodecs,this.codecSet=[c.videoCodec,c.audioCodec].filter(function(m){return m}).join(",").replace(/\.[^.,]+/g,"")}return d(I,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(m){var _=m%this.url.length;this._urlId!==_&&(this.details=void 0,this._urlId=_)}}]),I}()},"./src/types/loader.ts":(C,b,a)=>{a.r(b),a.d(b,{PlaylistContextType:()=>g,PlaylistLevelType:()=>d});var g;(function(S){S.MANIFEST="manifest",S.LEVEL="level",S.AUDIO_TRACK="audioTrack",S.SUBTITLE_TRACK="subtitleTrack"})(g||(g={}));var d;(function(S){S.MAIN="main",S.AUDIO="audio",S.SUBTITLE="subtitle"})(d||(d={}))},"./src/types/transmuxer.ts":(C,b,a)=>{a.r(b),a.d(b,{ChunkMetadata:()=>g});var g=function(E,R,x,A,D,P){A===void 0&&(A=0),D===void 0&&(D=-1),P===void 0&&(P=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=d(),this.buffering={audio:d(),video:d(),audiovideo:d()},this.level=E,this.sn=R,this.id=x,this.size=A,this.part=D,this.partial=P};function d(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(C,b,a)=>{a.r(b),a.d(b,{AttrList:()=>S});var g=/^(\d+)x(\d+)$/,d=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,S=function(){function E(x){typeof x=="string"&&(x=E.parseAttrList(x));for(var A in x)x.hasOwnProperty(A)&&(this[A]=x[A])}var R=E.prototype;return R.decimalInteger=function(A){var D=parseInt(this[A],10);return D>Number.MAX_SAFE_INTEGER?1/0:D},R.hexadecimalInteger=function(A){if(this[A]){var D=(this[A]||"0x").slice(2);D=(D.length&1?"0":"")+D;for(var P=new Uint8Array(D.length/2),I=0;I<D.length/2;I++)P[I]=parseInt(D.slice(I*2,I*2+2),16);return P}else return null},R.hexadecimalIntegerAsNumber=function(A){var D=parseInt(this[A],16);return D>Number.MAX_SAFE_INTEGER?1/0:D},R.decimalFloatingPoint=function(A){return parseFloat(this[A])},R.optionalFloat=function(A,D){var P=this[A];return P?parseFloat(P):D},R.enumeratedString=function(A){return this[A]},R.bool=function(A){return this[A]==="YES"},R.decimalResolution=function(A){var D=g.exec(this[A]);if(D!==null)return{width:parseInt(D[1],10),height:parseInt(D[2],10)}},E.parseAttrList=function(A){var D,P={},I='"';for(d.lastIndex=0;(D=d.exec(A))!==null;){var c=D[2];c.indexOf(I)===0&&c.lastIndexOf(I)===c.length-1&&(c=c.slice(1,-1)),P[D[1]]=c}return P},E}()},"./src/utils/binary-search.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>d});var g={search:function(E,R){for(var x=0,A=E.length-1,D=null,P=null;x<=A;){D=(x+A)/2|0,P=E[D];var I=R(P);if(I>0)x=D+1;else if(I<0)A=D-1;else return P}return null}};const d=g},"./src/utils/buffer-helper.ts":(C,b,a)=>{a.r(b),a.d(b,{BufferHelper:()=>S});var g=a("./src/utils/logger.ts"),d={length:0,start:function(){return 0},end:function(){return 0}},S=function(){function E(){}return E.isBuffered=function(x,A){try{if(x){for(var D=E.getBuffered(x),P=0;P<D.length;P++)if(A>=D.start(P)&&A<=D.end(P))return!0}}catch(I){}return!1},E.bufferInfo=function(x,A,D){try{if(x){var P=E.getBuffered(x),I=[],c;for(c=0;c<P.length;c++)I.push({start:P.start(c),end:P.end(c)});return this.bufferedInfo(I,A,D)}}catch(m){}return{len:0,start:A,end:A,nextStart:void 0}},E.bufferedInfo=function(x,A,D){A=Math.max(0,A),x.sort(function(u,f){var L=u.start-f.start;return L||f.end-u.end});var P=[];if(D)for(var I=0;I<x.length;I++){var c=P.length;if(c){var m=P[c-1].end;x[I].start-m<D?x[I].end>m&&(P[c-1].end=x[I].end):P.push(x[I])}else P.push(x[I])}else P=x;for(var _=0,o,i=A,t=A,r=0;r<P.length;r++){var l=P[r].start,p=P[r].end;if(A+D>=l&&A<p)i=l,t=p,_=t-A;else if(A+D<l){o=l;break}}return{len:_,start:i||0,end:t||0,nextStart:o}},E.getBuffered=function(x){try{return x.buffered}catch(A){return g.logger.log("failed to get media.buffered",A),d}},E}()},"./src/utils/cea-608-parser.ts":(C,b,a)=>{a.r(b),a.d(b,{CaptionScreen:()=>r,Row:()=>t,default:()=>v});var g=a("./src/utils/logger.ts"),d={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},S=function(n){var s=n;return d.hasOwnProperty(n)&&(s=d[n]),String.fromCharCode(s)},E=15,R=100,x={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},A={17:2,18:4,21:6,22:8,23:10,19:13,20:15},D={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},P={25:2,26:4,29:6,30:8,31:10,27:13,28:15},I=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],c;(function(y){y[y.ERROR=0]="ERROR",y[y.TEXT=1]="TEXT",y[y.WARNING=2]="WARNING",y[y.INFO=2]="INFO",y[y.DEBUG=3]="DEBUG",y[y.DATA=3]="DATA"})(c||(c={}));var m=function(){function y(){this.time=null,this.verboseLevel=c.ERROR}var n=y.prototype;return n.log=function(e,h){if(this.verboseLevel>=e){var M=typeof h=="function"?h():h;g.logger.log(this.time+" ["+e+"] "+M)}},y}(),_=function(n){for(var s=[],e=0;e<n.length;e++)s.push(n[e].toString(16));return s},o=function(){function y(s,e,h,M,T){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=s||"white",this.underline=e||!1,this.italics=h||!1,this.background=M||"black",this.flash=T||!1}var n=y.prototype;return n.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},n.setStyles=function(e){for(var h=["foreground","underline","italics","background","flash"],M=0;M<h.length;M++){var T=h[M];e.hasOwnProperty(T)&&(this[T]=e[T])}},n.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},n.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},n.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},n.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},y}(),i=function(){function y(s,e,h,M,T,B){this.uchar=void 0,this.penState=void 0,this.uchar=s||" ",this.penState=new o(e,h,M,T,B)}var n=y.prototype;return n.reset=function(){this.uchar=" ",this.penState.reset()},n.setChar=function(e,h){this.uchar=e,this.penState.copy(h)},n.setPenState=function(e){this.penState.copy(e)},n.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},n.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},n.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},y}(),t=function(){function y(s){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<R;e++)this.chars.push(new i);this.logger=s,this.pos=0,this.currPenState=new o}var n=y.prototype;return n.equals=function(e){for(var h=!0,M=0;M<R;M++)if(!this.chars[M].equals(e.chars[M])){h=!1;break}return h},n.copy=function(e){for(var h=0;h<R;h++)this.chars[h].copy(e.chars[h])},n.isEmpty=function(){for(var e=!0,h=0;h<R;h++)if(!this.chars[h].isEmpty()){e=!1;break}return e},n.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(c.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>R&&(this.logger.log(c.DEBUG,"Too large cursor position "+this.pos),this.pos=R)},n.moveCursor=function(e){var h=this.pos+e;if(e>1)for(var M=this.pos+1;M<h+1;M++)this.chars[M].setPenState(this.currPenState);this.setCursor(h)},n.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},n.insertChar=function(e){var h=this;e>=144&&this.backSpace();var M=S(e);if(this.pos>=R){this.logger.log(c.ERROR,function(){return"Cannot insert "+e.toString(16)+" ("+M+") at position "+h.pos+". Skipping it!"});return}this.chars[this.pos].setChar(M,this.currPenState),this.moveCursor(1)},n.clearFromPos=function(e){var h;for(h=e;h<R;h++)this.chars[h].reset()},n.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},n.clearToEndOfRow=function(){this.clearFromPos(this.pos)},n.getTextString=function(){for(var e=[],h=!0,M=0;M<R;M++){var T=this.chars[M].uchar;T!==" "&&(h=!1),e.push(T)}return h?"":e.join("")},n.setPenStyles=function(e){this.currPenState.setStyles(e);var h=this.chars[this.pos];h.setPenState(this.currPenState)},y}(),r=function(){function y(s){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<E;e++)this.rows.push(new t(s));this.logger=s,this.currRow=E-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var n=y.prototype;return n.reset=function(){for(var e=0;e<E;e++)this.rows[e].clear();this.currRow=E-1},n.equals=function(e){for(var h=!0,M=0;M<E;M++)if(!this.rows[M].equals(e.rows[M])){h=!1;break}return h},n.copy=function(e){for(var h=0;h<E;h++)this.rows[h].copy(e.rows[h])},n.isEmpty=function(){for(var e=!0,h=0;h<E;h++)if(!this.rows[h].isEmpty()){e=!1;break}return e},n.backSpace=function(){var e=this.rows[this.currRow];e.backSpace()},n.clearToEndOfRow=function(){var e=this.rows[this.currRow];e.clearToEndOfRow()},n.insertChar=function(e){var h=this.rows[this.currRow];h.insertChar(e)},n.setPen=function(e){var h=this.rows[this.currRow];h.setPenStyles(e)},n.moveCursor=function(e){var h=this.rows[this.currRow];h.moveCursor(e)},n.setCursor=function(e){this.logger.log(c.INFO,"setCursor: "+e);var h=this.rows[this.currRow];h.setCursor(e)},n.setPAC=function(e){this.logger.log(c.INFO,function(){return"pacData = "+JSON.stringify(e)});var h=e.row-1;if(this.nrRollUpRows&&h<this.nrRollUpRows-1&&(h=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==h){for(var M=0;M<E;M++)this.rows[M].clear();var T=this.currRow+1-this.nrRollUpRows,B=this.lastOutputScreen;if(B){var N=B.rows[T].cueStartTime,j=this.logger.time;if(N&&j!==null&&N<j)for(var z=0;z<this.nrRollUpRows;z++)this.rows[h-this.nrRollUpRows+z+1].copy(B.rows[T+z])}}this.currRow=h;var K=this.rows[this.currRow];if(e.indent!==null){var V=e.indent,$=Math.max(V-1,0);K.setCursor(e.indent),e.color=K.chars[$].penState.foreground}var X={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(X)},n.setBkgData=function(e){this.logger.log(c.INFO,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},n.setRollUpRows=function(e){this.nrRollUpRows=e},n.rollUp=function(){var e=this;if(this.nrRollUpRows===null){this.logger.log(c.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(c.TEXT,function(){return e.getDisplayText()});var h=this.currRow+1-this.nrRollUpRows,M=this.rows.splice(h,1)[0];M.clear(),this.rows.splice(this.currRow,0,M),this.logger.log(c.INFO,"Rolling up")},n.getDisplayText=function(e){e=e||!1;for(var h=[],M="",T=-1,B=0;B<E;B++){var N=this.rows[B].getTextString();N&&(T=B+1,e?h.push("Row "+T+": '"+N+"'"):h.push(N.trim()))}return h.length>0&&(e?M="["+h.join(" | ")+"]":M=h.join(`
`)),M},n.getTextAndFormat=function(){return this.rows},y}(),l=function(){function y(s,e,h){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=s,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new r(h),this.nonDisplayedMemory=new r(h),this.lastOutputScreen=new r(h),this.currRollUpRow=this.displayedMemory.rows[E-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=h}var n=y.prototype;return n.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[E-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},n.getHandler=function(){return this.outputFilter},n.setHandler=function(e){this.outputFilter=e},n.setPAC=function(e){this.writeScreen.setPAC(e)},n.setBkgData=function(e){this.writeScreen.setBkgData(e)},n.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(c.INFO,function(){return"MODE="+e}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},n.insertChars=function(e){for(var h=this,M=0;M<e.length;M++)this.writeScreen.insertChar(e[M]);var T=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(c.INFO,function(){return T+": "+h.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(c.TEXT,function(){return"DISPLAYED: "+h.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},n.ccRCL=function(){this.logger.log(c.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},n.ccBS=function(){this.logger.log(c.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},n.ccAOF=function(){},n.ccAON=function(){},n.ccDER=function(){this.logger.log(c.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},n.ccRU=function(e){this.logger.log(c.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},n.ccFON=function(){this.logger.log(c.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},n.ccRDC=function(){this.logger.log(c.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},n.ccTR=function(){this.logger.log(c.INFO,"TR"),this.setMode("MODE_TEXT")},n.ccRTD=function(){this.logger.log(c.INFO,"RTD"),this.setMode("MODE_TEXT")},n.ccEDM=function(){this.logger.log(c.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},n.ccCR=function(){this.logger.log(c.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},n.ccENM=function(){this.logger.log(c.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},n.ccEOC=function(){var e=this;if(this.logger.log(c.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var h=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=h,this.writeScreen=this.nonDisplayedMemory,this.logger.log(c.TEXT,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},n.ccTO=function(e){this.logger.log(c.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},n.ccMIDROW=function(e){var h={flash:!1};if(h.underline=e%2===1,h.italics=e>=46,h.italics)h.foreground="white";else{var M=Math.floor(e/2)-16,T=["white","green","blue","cyan","red","yellow","magenta"];h.foreground=T[M]}this.logger.log(c.INFO,"MIDROW: "+JSON.stringify(h)),this.writeScreen.setPen(h)},n.outputDataUpdate=function(e){e===void 0&&(e=!1);var h=this.logger.time;h!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=h:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,h,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:h),this.lastOutputScreen.copy(this.displayedMemory))},n.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},y}(),p=function(){function y(s,e,h){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var M=new m;this.channels=[null,new l(s,e,M),new l(s+1,h,M)],this.cmdHistory=L(),this.logger=M}var n=y.prototype;return n.getHandler=function(e){return this.channels[e].getHandler()},n.setHandler=function(e,h){this.channels[e].setHandler(h)},n.addData=function(e,h){var M,T,B,N=!1;this.logger.time=e;for(var j=0;j<h.length;j+=2)if(T=h[j]&127,B=h[j+1]&127,!(T===0&&B===0)){if(this.logger.log(c.DATA,"["+_([h[j],h[j+1]])+"] -> ("+_([T,B])+")"),M=this.parseCmd(T,B),M||(M=this.parseMidrow(T,B)),M||(M=this.parsePAC(T,B)),M||(M=this.parseBackgroundAttributes(T,B)),!M&&(N=this.parseChars(T,B),N)){var z=this.currentChannel;if(z&&z>0){var K=this.channels[z];K.insertChars(N)}else this.logger.log(c.WARNING,"No channel found yet. TEXT-MODE?")}!M&&!N&&this.logger.log(c.WARNING,"Couldn't parse cleaned data "+_([T,B])+" orig: "+_([h[j],h[j+1]]))}},n.parseCmd=function(e,h){var M=this.cmdHistory,T=(e===20||e===28||e===21||e===29)&&h>=32&&h<=47,B=(e===23||e===31)&&h>=33&&h<=35;if(!(T||B))return!1;if(f(e,h,M))return u(null,null,M),this.logger.log(c.DEBUG,"Repeated command ("+_([e,h])+") is dropped"),!0;var N=e===20||e===21||e===23?1:2,j=this.channels[N];return e===20||e===21||e===28||e===29?h===32?j.ccRCL():h===33?j.ccBS():h===34?j.ccAOF():h===35?j.ccAON():h===36?j.ccDER():h===37?j.ccRU(2):h===38?j.ccRU(3):h===39?j.ccRU(4):h===40?j.ccFON():h===41?j.ccRDC():h===42?j.ccTR():h===43?j.ccRTD():h===44?j.ccEDM():h===45?j.ccCR():h===46?j.ccENM():h===47&&j.ccEOC():j.ccTO(h-32),u(e,h,M),this.currentChannel=N,!0},n.parseMidrow=function(e,h){var M=0;if((e===17||e===25)&&h>=32&&h<=47){if(e===17?M=1:M=2,M!==this.currentChannel)return this.logger.log(c.ERROR,"Mismatch channel in midrow parsing"),!1;var T=this.channels[M];return T?(T.ccMIDROW(h),this.logger.log(c.DEBUG,"MIDROW ("+_([e,h])+")"),!0):!1}return!1},n.parsePAC=function(e,h){var M,T=this.cmdHistory,B=(e>=17&&e<=23||e>=25&&e<=31)&&h>=64&&h<=127,N=(e===16||e===24)&&h>=64&&h<=95;if(!(B||N))return!1;if(f(e,h,T))return u(null,null,T),!0;var j=e<=23?1:2;h>=64&&h<=95?M=j===1?x[e]:D[e]:M=j===1?A[e]:P[e];var z=this.channels[j];return z?(z.setPAC(this.interpretPAC(M,h)),u(e,h,T),this.currentChannel=j,!0):!1},n.interpretPAC=function(e,h){var M,T={color:null,italics:!1,indent:null,underline:!1,row:e};return h>95?M=h-96:M=h-64,T.underline=(M&1)===1,M<=13?T.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(M/2)]:M<=15?(T.italics=!0,T.color="white"):T.indent=Math.floor((M-16)/2)*4,T},n.parseChars=function(e,h){var M,T=null,B=null;if(e>=25?(M=2,B=e-8):(M=1,B=e),B>=17&&B<=19){var N;B===17?N=h+80:B===18?N=h+112:N=h+144,this.logger.log(c.INFO,"Special char '"+S(N)+"' in channel "+M),T=[N]}else e>=32&&e<=127&&(T=h===0?[e]:[e,h]);if(T){var j=_(T);this.logger.log(c.DEBUG,"Char codes =  "+j.join(",")),u(e,h,this.cmdHistory)}return T},n.parseBackgroundAttributes=function(e,h){var M=(e===16||e===24)&&h>=32&&h<=47,T=(e===23||e===31)&&h>=45&&h<=47;if(!(M||T))return!1;var B,N={};e===16||e===24?(B=Math.floor((h-32)/2),N.background=I[B],h%2===1&&(N.background=N.background+"_semi")):h===45?N.background="transparent":(N.foreground="black",h===47&&(N.underline=!0));var j=e<=23?1:2,z=this.channels[j];return z.setBkgData(N),u(e,h,this.cmdHistory),!0},n.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var h=this.channels[e];h&&h.reset()}this.cmdHistory=L()},n.cueSplitAtTime=function(e){for(var h=0;h<this.channels.length;h++){var M=this.channels[h];M&&M.cueSplitAtTime(e)}},y}();function u(y,n,s){s.a=y,s.b=n}function f(y,n,s){return s.a===y&&s.b===n}function L(){return{a:null,b:null}}const v=p},"./src/utils/codecs.ts":(C,b,a)=>{a.r(b),a.d(b,{isCodecSupportedInMp4:()=>S,isCodecType:()=>d});var g={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function d(E,R){var x=g[R];return!!x&&x[E.slice(0,4)]===!0}function S(E,R){return MediaSource.isTypeSupported((R||"video")+'/mp4;codecs="'+E+'"')}},"./src/utils/cues.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>x});var g=a("./src/utils/vttparser.ts"),d=a("./src/utils/webvtt-parser.ts"),S=a("./src/utils/texttrack-utils.ts"),E=/\s/,R={newCue:function(D,P,I,c){for(var m=[],_,o,i,t,r,l=self.VTTCue||self.TextTrackCue,p=0;p<c.rows.length;p++)if(_=c.rows[p],i=!0,t=0,r="",!_.isEmpty()){for(var u=0;u<_.chars.length;u++)E.test(_.chars[u].uchar)&&i?t++:(r+=_.chars[u].uchar,i=!1);_.cueStartTime=P,P===I&&(I+=1e-4),t>=16?t--:t++;var f=(0,g.fixLineBreaks)(r.trim()),L=(0,d.generateCueId)(P,I,f);(!D||!D.cues||!D.cues.getCueById(L))&&(o=new l(P,I,f),o.id=L,o.line=p+1,o.align="left",o.position=10+Math.min(80,Math.floor(t*8/32)*10),m.push(o))}return D&&m.length&&(m.sort(function(v,y){return v.line==="auto"||y.line==="auto"?0:v.line>8&&y.line>8?y.line-v.line:v.line-y.line}),m.forEach(function(v){return(0,S.addCueToTrack)(D,v)})),m}};const x=R},"./src/utils/discontinuities.ts":(C,b,a)=>{a.r(b),a.d(b,{adjustSlidingStart:()=>D,alignMediaPlaylistByPDT:()=>m,alignPDT:()=>c,alignStream:()=>P,findDiscontinuousReferenceFrag:()=>x,findFirstFragWithCC:()=>E,shouldAlignOnDiscontinuities:()=>R});var g=a("./src/polyfills/number.ts"),d=a("./src/utils/logger.ts"),S=a("./src/controller/level-helper.ts");function E(_,o){for(var i=null,t=0,r=_.length;t<r;t++){var l=_[t];if(l&&l.cc===o){i=l;break}}return i}function R(_,o,i){return!!(o.details&&(i.endCC>i.startCC||_&&_.cc<i.startCC))}function x(_,o,i){var t=_.fragments,r=o.fragments;if(!r.length||!t.length){d.logger.log("No fragments to align");return}var l=E(t,r[0].cc);if(!l||l&&!l.startPTS){d.logger.log("No frag in previous level to align on");return}return l}function A(_,o){if(_){var i=_.start+o;_.start=_.startPTS=i,_.endPTS=i+_.duration}}function D(_,o){for(var i=o.fragments,t=0,r=i.length;t<r;t++)A(i[t],_);o.fragmentHint&&A(o.fragmentHint,_),o.alignedSliding=!0}function P(_,o,i){!o||(I(_,i,o),!i.alignedSliding&&o.details&&c(i,o.details),!i.alignedSliding&&o.details&&!i.skippedSegments&&(0,S.adjustSliding)(o.details,i))}function I(_,o,i){if(R(_,i,o)){var t=x(i.details,o);t&&(0,g.isFiniteNumber)(t.start)&&(d.logger.log("Adjusting PTS using last level due to CC increase within current level "+o.url),D(t.start,o))}}function c(_,o){if(!(!o.fragments.length||!_.hasProgramDateTime||!o.hasProgramDateTime)){var i=o.fragments[0].programDateTime,t=_.fragments[0].programDateTime,r=(t-i)/1e3+o.fragments[0].start;r&&(0,g.isFiniteNumber)(r)&&(d.logger.log("Adjusting PTS using programDateTime delta "+(t-i)+"ms, sliding:"+r.toFixed(3)+" "+_.url+" "),D(r,_))}}function m(_,o){if(!(!_.hasProgramDateTime||!o.hasProgramDateTime)){var i=_.fragments,t=o.fragments;if(!(!i.length||!t.length)){var r=Math.round(t.length/2)-1,l=t[r],p=E(i,l.cc)||i[Math.round(i.length/2)-1],u=l.programDateTime,f=p.programDateTime;if(!(u===null||f===null)){var L=(f-u)/1e3-(p.start-l.start);D(L,_)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>S});var g=a("./src/utils/ewma.ts"),d=function(){function E(x,A,D){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=D,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new g.default(x),this.fast_=new g.default(A)}var R=E.prototype;return R.update=function(A,D){var P=this.slow_,I=this.fast_;this.slow_.halfLife!==A&&(this.slow_=new g.default(A,P.getEstimate(),P.getTotalWeight())),this.fast_.halfLife!==D&&(this.fast_=new g.default(D,I.getEstimate(),I.getTotalWeight()))},R.sample=function(A,D){A=Math.max(A,this.minDelayMs_);var P=8*D,I=A/1e3,c=P/I;this.fast_.sample(I,c),this.slow_.sample(I,c)},R.canEstimate=function(){var A=this.fast_;return A&&A.getTotalWeight()>=this.minWeight_},R.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},R.destroy=function(){},E}();const S=d},"./src/utils/ewma.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>d});var g=function(){function S(R,x,A){x===void 0&&(x=0),A===void 0&&(A=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=R,this.alpha_=R?Math.exp(Math.log(.5)/R):0,this.estimate_=x,this.totalWeight_=A}var E=S.prototype;return E.sample=function(x,A){var D=Math.pow(this.alpha_,x);this.estimate_=A*(1-D)+D*this.estimate_,this.totalWeight_+=x},E.getTotalWeight=function(){return this.totalWeight_},E.getEstimate=function(){if(this.alpha_){var x=1-Math.pow(this.alpha_,this.totalWeight_);if(x)return this.estimate_/x}return this.estimate_},S}();const d=g},"./src/utils/fetch-loader.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>r,fetchSupported:()=>m});var g=a("./src/polyfills/number.ts"),d=a("./src/loader/load-stats.ts"),S=a("./src/demux/chunk-cache.ts");function E(l,p){l.prototype=Object.create(p.prototype),l.prototype.constructor=l,P(l,p)}function R(l){var p=typeof Map=="function"?new Map:void 0;return R=function(f){if(f===null||!D(f))return f;if(typeof f!="function")throw new TypeError("Super expression must either be null or a function");if(typeof p!="undefined"){if(p.has(f))return p.get(f);p.set(f,L)}function L(){return x(f,arguments,I(this).constructor)}return L.prototype=Object.create(f.prototype,{constructor:{value:L,enumerable:!1,writable:!0,configurable:!0}}),P(L,f)},R(l)}function x(l,p,u){return A()?x=Reflect.construct.bind():x=function(L,v,y){var n=[null];n.push.apply(n,v);var s=Function.bind.apply(L,n),e=new s;return y&&P(e,y.prototype),e},x.apply(null,arguments)}function A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(l){return!1}}function D(l){return Function.toString.call(l).indexOf("[native code]")!==-1}function P(l,p){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,L){return f.__proto__=L,f},P(l,p)}function I(l){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},I(l)}function c(){return c=Object.assign?Object.assign.bind():function(l){for(var p=1;p<arguments.length;p++){var u=arguments[p];for(var f in u)Object.prototype.hasOwnProperty.call(u,f)&&(l[f]=u[f])}return l},c.apply(this,arguments)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(l){}return!1}var _=function(){function l(u){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=u.fetchSetup||i,this.controller=new self.AbortController,this.stats=new d.LoadStats}var p=l.prototype;return p.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},p.abortInternal=function(){var f=this.response;(!f||!f.ok)&&(this.stats.aborted=!0,this.controller.abort())},p.abort=function(){var f;this.abortInternal(),(f=this.callbacks)!==null&&f!==void 0&&f.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},p.load=function(f,L,v){var y=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var s=o(f,this.controller.signal),e=v.onProgress,h=f.responseType==="arraybuffer",M=h?"byteLength":"length";this.context=f,this.config=L,this.callbacks=v,this.request=this.fetchSetup(f,s),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){y.abortInternal(),v.onTimeout(n,f,y.response)},L.timeout),self.fetch(this.request).then(function(T){if(y.response=y.loader=T,!T.ok){var B=T.status,N=T.statusText;throw new t(N||"fetch, bad network response",B,T)}return n.loading.first=Math.max(self.performance.now(),n.loading.start),n.total=parseInt(T.headers.get("Content-Length")||"0"),e&&(0,g.isFiniteNumber)(L.highWaterMark)?y.loadProgressively(T,n,f,L.highWaterMark,e):h?T.arrayBuffer():T.text()}).then(function(T){var B=y.response;self.clearTimeout(y.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);var N=T[M];N&&(n.loaded=n.total=N);var j={url:B.url,data:T};e&&!(0,g.isFiniteNumber)(L.highWaterMark)&&e(n,f,T,B),v.onSuccess(j,n,f,B)}).catch(function(T){if(self.clearTimeout(y.requestTimeout),!n.aborted){var B=T&&T.code||0,N=T?T.message:null;v.onError({code:B,text:N},f,T?T.details:null)}})},p.getCacheAge=function(){var f=null;if(this.response){var L=this.response.headers.get("age");f=L?parseFloat(L):null}return f},p.loadProgressively=function(f,L,v,y,n){y===void 0&&(y=0);var s=new S.default,e=f.body.getReader(),h=function M(){return e.read().then(function(T){if(T.done)return s.dataLength&&n(L,v,s.flush(),f),Promise.resolve(new ArrayBuffer(0));var B=T.value,N=B.length;return L.loaded+=N,N<y||s.dataLength?(s.push(B),s.dataLength>=y&&n(L,v,s.flush(),f)):n(L,v,B,f),M()}).catch(function(){return Promise.reject()})};return h()},l}();function o(l,p){var u={method:"GET",mode:"cors",credentials:"same-origin",signal:p,headers:new self.Headers(c({},l.headers))};return l.rangeEnd&&u.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),u}function i(l,p){return new self.Request(l.url,p)}var t=function(l){E(p,l);function p(u,f,L){var v;return v=l.call(this,u)||this,v.code=void 0,v.details=void 0,v.code=f,v.details=L,v}return p}(R(Error));const r=_},"./src/utils/hex.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>d});var g={hexDump:function(E){for(var R="",x=0;x<E.length;x++){var A=E[x].toString(16);A.length<2&&(A="0"+A),R+=A}return R}};const d=g},"./src/utils/imsc1-ttml-parser.ts":(C,b,a)=>{a.r(b),a.d(b,{IMSC1_CODEC:()=>D,parseIMSC1:()=>m});var g=a("./src/utils/mp4-tools.ts"),d=a("./src/utils/vttparser.ts"),S=a("./src/utils/vttcue.ts"),E=a("./src/demux/id3.ts"),R=a("./src/utils/timescale-conversion.ts"),x=a("./src/utils/webvtt-parser.ts");function A(){return A=Object.assign?Object.assign.bind():function(v){for(var y=1;y<arguments.length;y++){var n=arguments[y];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(v[s]=n[s])}return v},A.apply(this,arguments)}var D="stpp.ttml.im1t",P=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,I=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,c={left:"start",center:"center",right:"end",start:"start",end:"end"};function m(v,y,n,s,e){var h=(0,g.findBox)(new Uint8Array(v),["mdat"]);if(h.length===0){e(new Error("Could not parse IMSC1 mdat"));return}var M=h.map(function(B){return(0,E.utf8ArrayToStr)(B)}),T=(0,R.toTimescaleFromScale)(y,1,n);try{M.forEach(function(B){return s(_(B,T))})}catch(B){e(B)}}function _(v,y){var n=new DOMParser,s=n.parseFromString(v,"text/xml"),e=s.getElementsByTagName("tt")[0];if(!e)throw new Error("Invalid ttml");var h={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},M=Object.keys(h).reduce(function(z,K){return z[K]=e.getAttribute("ttp:"+K)||h[K],z},{}),T=e.getAttribute("xml:space")!=="preserve",B=i(o(e,"styling","style")),N=i(o(e,"layout","region")),j=o(e,"body","[begin]");return[].map.call(j,function(z){var K=t(z,T);if(!K||!z.hasAttribute("begin"))return null;var V=u(z.getAttribute("begin"),M),$=u(z.getAttribute("dur"),M),X=u(z.getAttribute("end"),M);if(V===null)throw p(z);if(X===null){if($===null)throw p(z);X=V+$}var Z=new S.default(V-y,X-y,K);Z.id=(0,x.generateCueId)(Z.startTime,Z.endTime,Z.text);var q=N[z.getAttribute("region")],te=B[z.getAttribute("style")],ue=r(q,te,B),oe=ue.textAlign;if(oe){var le=c[oe];le&&(Z.lineAlign=le),Z.align=oe}return A(Z,ue),Z}).filter(function(z){return z!==null})}function o(v,y,n){var s=v.getElementsByTagName(y)[0];return s?[].slice.call(s.querySelectorAll(n)):[]}function i(v){return v.reduce(function(y,n){var s=n.getAttribute("xml:id");return s&&(y[s]=n),y},{})}function t(v,y){return[].slice.call(v.childNodes).reduce(function(n,s,e){var h;return s.nodeName==="br"&&e?n+`
`:(h=s.childNodes)!==null&&h!==void 0&&h.length?t(s,y):y?n+s.textContent.trim().replace(/\s+/g," "):n+s.textContent},"")}function r(v,y,n){var s="http://www.w3.org/ns/ttml#styling",e=null,h=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],M=v!=null&&v.hasAttribute("style")?v.getAttribute("style"):null;return M&&n.hasOwnProperty(M)&&(e=n[M]),h.reduce(function(T,B){var N=l(y,s,B)||l(v,s,B)||l(e,s,B);return N&&(T[B]=N),T},{})}function l(v,y,n){return v&&v.hasAttributeNS(y,n)?v.getAttributeNS(y,n):null}function p(v){return new Error("Could not parse ttml timestamp "+v)}function u(v,y){if(!v)return null;var n=(0,d.parseTimeStamp)(v);return n===null&&(P.test(v)?n=f(v,y):I.test(v)&&(n=L(v,y))),n}function f(v,y){var n=P.exec(v),s=(n[4]|0)+(n[5]|0)/y.subFrameRate;return(n[1]|0)*3600+(n[2]|0)*60+(n[3]|0)+s/y.frameRate}function L(v,y){var n=I.exec(v),s=Number(n[1]),e=n[2];switch(e){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/y.frameRate;case"t":return s/y.tickRate}return s}},"./src/utils/keysystem-util.ts":(C,b,a)=>{a.r(b),a.d(b,{changeEndianness:()=>S,convertDataUriToArrayBytes:()=>E,strToUtf8array:()=>R});var g=a("./src/utils/numeric-encoding-utils.ts");function d(x){var A=R(x).subarray(0,16),D=new Uint8Array(16);return D.set(A,16-A.length),D}function S(x){var A=function(P,I,c){var m=P[I];P[I]=P[c],P[c]=m};A(x,0,3),A(x,1,2),A(x,4,5),A(x,6,7)}function E(x){var A=x.split(":"),D=null;if(A[0]==="data"&&A.length===2){var P=A[1].split(";"),I=P[P.length-1].split(",");if(I.length===2){var c=I[0]==="base64",m=I[1];c?(P.splice(-1,1),D=(0,g.base64Decode)(m)):D=d(m)}}return D}function R(x){return Uint8Array.from(unescape(encodeURIComponent(x)),function(A){return A.charCodeAt(0)})}},"./src/utils/logger.ts":(C,b,a)=>{a.r(b),a.d(b,{enableLogs:()=>x,logger:()=>A});var g=function(){},d={trace:g,debug:g,log:g,warn:g,info:g,error:g},S=d;function E(D){var P=self.console[D];return P?P.bind(self.console,"["+D+"] >"):g}function R(D){for(var P=arguments.length,I=new Array(P>1?P-1:0),c=1;c<P;c++)I[c-1]=arguments[c];I.forEach(function(m){S[m]=D[m]?D[m].bind(D):E(m)})}function x(D,P){if(self.console&&D===!0||typeof D=="object"){R(D,"debug","log","info","warn","error");try{S.log('Debug logs enabled for "'+P+'"')}catch(I){S=d}}else S=d}var A=S},"./src/utils/mediakeys-helper.ts":(C,b,a)=>{a.r(b),a.d(b,{KeySystemFormats:()=>d,KeySystemIds:()=>E,KeySystems:()=>g,getKeySystemsForConfig:()=>A,getSupportedMediaKeySystemConfigurations:()=>P,keySystemDomainToKeySystemFormat:()=>x,keySystemFormatToKeySystemDomain:()=>S,keySystemIdToKeySystemDomain:()=>R,requestMediaKeySystemAccess:()=>D});var g;(function(c){c.CLEARKEY="org.w3.clearkey",c.FAIRPLAY="com.apple.fps",c.PLAYREADY="com.microsoft.playready",c.WIDEVINE="com.widevine.alpha"})(g||(g={}));var d;(function(c){c.CLEARKEY="org.w3.clearkey",c.FAIRPLAY="com.apple.streamingkeydelivery",c.PLAYREADY="com.microsoft.playready",c.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"})(d||(d={}));function S(c){switch(c){case d.FAIRPLAY:return g.FAIRPLAY;case d.PLAYREADY:return g.PLAYREADY;case d.WIDEVINE:return g.WIDEVINE;case d.CLEARKEY:return g.CLEARKEY}}var E;(function(c){c.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"})(E||(E={}));function R(c){if(c===E.WIDEVINE)return g.WIDEVINE}function x(c){switch(c){case g.FAIRPLAY:return d.FAIRPLAY;case g.PLAYREADY:return d.PLAYREADY;case g.WIDEVINE:return d.WIDEVINE;case g.CLEARKEY:return d.CLEARKEY}}function A(c){var m=c.drmSystems,_=c.widevineLicenseUrl,o=m?[g.FAIRPLAY,g.WIDEVINE,g.PLAYREADY,g.CLEARKEY].filter(function(i){return!!m[i]}):[];return!o[g.WIDEVINE]&&_&&o.push(g.WIDEVINE),o}var D=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function P(c,m,_,o){var i;switch(c){case g.FAIRPLAY:i=["cenc","sinf"];break;case g.WIDEVINE:case g.PLAYREADY:i=["cenc"];break;case g.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+c)}return I(i,m,_,o)}function I(c,m,_,o){var i={initDataTypes:c,persistentState:o.persistentState||"not-allowed",distinctiveIdentifier:o.distinctiveIdentifier||"not-allowed",sessionTypes:o.sessionTypes||[o.sessionType||"temporary"],audioCapabilities:m.map(function(t){return{contentType:'audio/mp4; codecs="'+t+'"',robustness:o.audioRobustness||"",encryptionScheme:o.audioEncryptionScheme||null}}),videoCapabilities:_.map(function(t){return{contentType:'video/mp4; codecs="'+t+'"',robustness:o.videoRobustness||"",encryptionScheme:o.videoEncryptionScheme||null}})};return[i]}},"./src/utils/mediasource-helper.ts":(C,b,a)=>{a.r(b),a.d(b,{getMediaSource:()=>g});function g(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(C,b,a)=>{a.r(b),a.d(b,{RemuxerTrackIdConfig:()=>D,appendUint8Array:()=>y,bin2str:()=>P,computeRawDurationFromSamples:()=>f,discardEPB:()=>M,findBox:()=>o,getDuration:()=>u,getStartDTS:()=>p,mp4Box:()=>B,mp4pssh:()=>N,offsetStartDTS:()=>L,parseEmsg:()=>T,parseInitSegment:()=>t,parsePssh:()=>j,parseSEIMessageFromNALu:()=>h,parseSamples:()=>n,parseSegmentIndex:()=>i,parseSinf:()=>l,patchEncyptionData:()=>r,readSint32:()=>m,readUint16:()=>I,readUint32:()=>c,segmentValidRange:()=>v,writeUint32:()=>_});var g=a("./src/loader/fragment.ts"),d=a("./src/utils/typed-array.ts"),S=a("./src/demux/id3.ts"),E=a("./src/utils/logger.ts"),R=a("./src/utils/hex.ts"),x=Math.pow(2,32)-1,A=[].push,D={video:1,audio:2,id3:3,text:4};function P(z){return String.fromCharCode.apply(null,z)}function I(z,K){var V=z[K]<<8|z[K+1];return V<0?65536+V:V}function c(z,K){var V=m(z,K);return V<0?4294967296+V:V}function m(z,K){return z[K]<<24|z[K+1]<<16|z[K+2]<<8|z[K+3]}function _(z,K,V){z[K]=V>>24,z[K+1]=V>>16&255,z[K+2]=V>>8&255,z[K+3]=V&255}function o(z,K){var V=[];if(!K.length)return V;for(var $=z.byteLength,X=0;X<$;){var Z=c(z,X),q=P(z.subarray(X+4,X+8)),te=Z>1?X+Z:$;if(q===K[0])if(K.length===1)V.push(z.subarray(X+8,te));else{var ue=o(z.subarray(X+8,te),K.slice(1));ue.length&&A.apply(V,ue)}X=te}return V}function i(z){var K=[],V=z[0],$=8,X=c(z,$);$+=4;var Z=0,q=0;V===0?$+=8:$+=16,$+=2;var te=z.length+q,ue=I(z,$);$+=2;for(var oe=0;oe<ue;oe++){var le=$,me=c(z,le);le+=4;var _e=me&2147483647,ve=(me&2147483648)>>>31;if(ve===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var ce=c(z,le);le+=4,K.push({referenceSize:_e,subsegmentDuration:ce,info:{duration:ce/X,start:te,end:te+_e-1}}),te+=_e,le+=4,$=le}return{earliestPresentationTime:Z,timescale:X,version:V,referencesCount:ue,references:K}}function t(z){for(var K=[],V=o(z,["moov","trak"]),$=0;$<V.length;$++){var X=V[$],Z=o(X,["tkhd"])[0];if(Z){var q=Z[0],te=q===0?12:20,ue=c(Z,te),oe=o(X,["mdia","mdhd"])[0];if(oe){q=oe[0],te=q===0?12:20;var le=c(oe,te),me=o(X,["mdia","hdlr"])[0];if(me){var _e=P(me.subarray(8,12)),ve={soun:g.ElementaryStreamTypes.AUDIO,vide:g.ElementaryStreamTypes.VIDEO}[_e];if(ve){var ce=o(X,["mdia","minf","stbl","stsd"])[0],he=void 0;ce&&(he=P(ce.subarray(12,16))),K[ue]={timescale:le,type:ve},K[ve]={timescale:le,id:ue,codec:he}}}}}}var Le=o(z,["moov","mvex","trex"]);return Le.forEach(function(De){var Fe=c(De,4),Oe=K[Fe];Oe&&(Oe.default={duration:c(De,12),flags:c(De,20)})}),K}function r(z,K){if(!z||!K)return z;var V=K.keyId;if(V&&K.isCommonEncryption){var $=o(z,["moov","trak"]);$.forEach(function(X){var Z=o(X,["mdia","minf","stbl","stsd"])[0],q=Z.subarray(8),te=o(q,["enca"]),ue=te.length>0;ue||(te=o(q,["encv"])),te.forEach(function(oe){var le=ue?oe.subarray(28):oe.subarray(78),me=o(le,["sinf"]);me.forEach(function(_e){var ve=l(_e);if(ve){var ce=ve.subarray(8,24);ce.some(function(he){return he!==0})||(E.logger.log("[eme] Patching keyId in 'enc"+(ue?"a":"v")+">sinf>>tenc' box: "+R.default.hexDump(ce)+" -> "+R.default.hexDump(V)),ve.set(V,8))}})})})}return z}function l(z){var K=o(z,["schm"])[0];if(K){var V=P(K.subarray(4,8));if(V==="cbcs"||V==="cenc")return o(z,["schi","tenc"])[0]}return E.logger.error("[eme] missing 'schm' box"),null}function p(z,K){return o(K,["moof","traf"]).reduce(function(V,$){var X=o($,["tfdt"])[0],Z=X[0],q=o($,["tfhd"]).reduce(function(te,ue){var oe=c(ue,4),le=z[oe];if(le){var me=c(X,4);Z===1&&(me*=Math.pow(2,32),me+=c(X,8));var _e=le.timescale||9e4,ve=me/_e;if(isFinite(ve)&&(te===null||ve<te))return ve}return te},null);return q!==null&&isFinite(q)&&(V===null||q<V)?q:V},null)||0}function u(z,K){for(var V=0,$=0,X=0,Z=o(z,["moof","traf"]),q=0;q<Z.length;q++){var te=Z[q],ue=o(te,["tfhd"])[0],oe=c(ue,4),le=K[oe];if(!!le){var me=le.default,_e=c(ue,0)|(me==null?void 0:me.flags),ve=me==null?void 0:me.duration;_e&8&&(_e&2?ve=c(ue,12):ve=c(ue,8));for(var ce=le.timescale||9e4,he=o(te,["trun"]),Le=0;Le<he.length;Le++){if(V=f(he[Le]),!V&&ve){var De=c(he[Le],4);V=ve*De}le.type===g.ElementaryStreamTypes.VIDEO?$+=V/ce:le.type===g.ElementaryStreamTypes.AUDIO&&(X+=V/ce)}}}if($===0&&X===0){for(var Fe=0,Oe=o(z,["sidx"]),ke=0;ke<Oe.length;ke++){var Ie=i(Oe[ke]);Ie!=null&&Ie.references&&(Fe+=Ie.references.reduce(function(we,Ue){return we+Ue.info.duration||0},0))}return Fe}return $||X}function f(z){var K=c(z,0),V=8;K&1&&(V+=4),K&4&&(V+=4);for(var $=0,X=c(z,4),Z=0;Z<X;Z++){if(K&256){var q=c(z,V);$+=q,V+=4}K&512&&(V+=4),K&1024&&(V+=4),K&2048&&(V+=4)}return $}function L(z,K,V){o(K,["moof","traf"]).forEach(function($){o($,["tfhd"]).forEach(function(X){var Z=c(X,4),q=z[Z];if(!!q){var te=q.timescale||9e4;o($,["tfdt"]).forEach(function(ue){var oe=ue[0],le=c(ue,4);if(oe===0)le-=V*te,le=Math.max(le,0),_(ue,4,le);else{le*=Math.pow(2,32),le+=c(ue,8),le-=V*te,le=Math.max(le,0);var me=Math.floor(le/(x+1)),_e=Math.floor(le%(x+1));_(ue,4,me),_(ue,8,_e)}})}})})}function v(z){var K={valid:null,remainder:null},V=o(z,["moof"]);if(V){if(V.length<2)return K.remainder=z,K}else return K;var $=V[V.length-1];return K.valid=(0,d.sliceUint8)(z,0,$.byteOffset-8),K.remainder=(0,d.sliceUint8)(z,$.byteOffset-8),K}function y(z,K){var V=new Uint8Array(z.length+K.length);return V.set(z),V.set(K,z.length),V}function n(z,K){var V=[],$=K.samples,X=K.timescale,Z=K.id,q=!1,te=o($,["moof"]);return te.map(function(ue){var oe=ue.byteOffset-8,le=o(ue,["traf"]);le.map(function(me){var _e=o(me,["tfdt"]).map(function(ve){var ce=ve[0],he=c(ve,4);return ce===1&&(he*=Math.pow(2,32),he+=c(ve,8)),he/X})[0];return _e!==void 0&&(z=_e),o(me,["tfhd"]).map(function(ve){var ce=c(ve,4),he=c(ve,0)&16777215,Le=(he&1)!==0,De=(he&2)!==0,Fe=(he&8)!==0,Oe=0,ke=(he&16)!==0,Ie=0,we=(he&32)!==0,Ue=8;ce===Z&&(Le&&(Ue+=8),De&&(Ue+=4),Fe&&(Oe=c(ve,Ue),Ue+=4),ke&&(Ie=c(ve,Ue),Ue+=4),we&&(Ue+=4),K.type==="video"&&(q=s(K.codec)),o(me,["trun"]).map(function(We){var tt=We[0],je=c(We,0)&16777215,Je=(je&1)!==0,ot=0,He=(je&4)!==0,ut=(je&256)!==0,Qe=0,be=(je&512)!==0,dt=0,Be=(je&1024)!==0,it=(je&2048)!==0,U=0,k=c(We,4),F=8;Je&&(ot=c(We,F),F+=4),He&&(F+=4);for(var w=ot+oe,H=0;H<k;H++){if(ut?(Qe=c(We,F),F+=4):Qe=Oe,be?(dt=c(We,F),F+=4):dt=Ie,Be&&(F+=4),it&&(tt===0?U=c(We,F):U=m(We,F),F+=4),K.type===g.ElementaryStreamTypes.VIDEO)for(var Q=0;Q<dt;){var Y=c($,w);if(w+=4,e(q,$[w])){var J=$.subarray(w,w+Y);h(J,q?2:1,z+U/X,V)}w+=Y,Q+=Y+4}z+=Qe/X}}))})})}),V}function s(z){if(!z)return!1;var K=z.indexOf("."),V=K<0?z:z.substring(0,K);return V==="hvc1"||V==="hev1"||V==="dvh1"||V==="dvhe"}function e(z,K){if(z){var V=K>>1&63;return V===39||V===40}else{var $=K&31;return $===6}}function h(z,K,V,$){var X=M(z),Z=0;Z+=K;for(var q=0,te=0,ue=!1,oe=0;Z<X.length;){q=0;do{if(Z>=X.length)break;oe=X[Z++],q+=oe}while(oe===255);te=0;do{if(Z>=X.length)break;oe=X[Z++],te+=oe}while(oe===255);var le=X.length-Z;if(!ue&&q===4&&Z<X.length){ue=!0;var me=X[Z++];if(me===181){var _e=I(X,Z);if(Z+=2,_e===49){var ve=c(X,Z);if(Z+=4,ve===1195456820){var ce=X[Z++];if(ce===3){var he=X[Z++],Le=31&he,De=64&he,Fe=De?2+Le*3:0,Oe=new Uint8Array(Fe);if(De){Oe[0]=he;for(var ke=1;ke<Fe;ke++)Oe[ke]=X[Z++]}$.push({type:ce,payloadType:q,pts:V,bytes:Oe})}}}}}else if(q===5&&te<le){if(ue=!0,te>16){for(var Ie=[],we=0;we<16;we++){var Ue=X[Z++].toString(16);Ie.push(Ue.length==1?"0"+Ue:Ue),(we===3||we===5||we===7||we===9)&&Ie.push("-")}for(var We=te-16,tt=new Uint8Array(We),je=0;je<We;je++)tt[je]=X[Z++];$.push({payloadType:q,pts:V,uuid:Ie.join(""),userData:(0,S.utf8ArrayToStr)(tt),userDataBytes:tt})}}else if(te<le)Z+=te;else if(te>le)break}}function M(z){for(var K=z.byteLength,V=[],$=1;$<K-2;)z[$]===0&&z[$+1]===0&&z[$+2]===3?(V.push($+2),$+=2):$++;if(V.length===0)return z;var X=K-V.length,Z=new Uint8Array(X),q=0;for($=0;$<X;q++,$++)q===V[0]&&(q++,V.shift()),Z[$]=z[q];return Z}function T(z){var K=z[0],V="",$="",X=0,Z=0,q=0,te=0,ue=0,oe=0;if(K===0){for(;P(z.subarray(oe,oe+1))!=="\0";)V+=P(z.subarray(oe,oe+1)),oe+=1;for(V+=P(z.subarray(oe,oe+1)),oe+=1;P(z.subarray(oe,oe+1))!=="\0";)$+=P(z.subarray(oe,oe+1)),oe+=1;$+=P(z.subarray(oe,oe+1)),oe+=1,X=c(z,12),Z=c(z,16),te=c(z,20),ue=c(z,24),oe=28}else if(K===1){oe+=4,X=c(z,oe),oe+=4;var le=c(z,oe);oe+=4;var me=c(z,oe);for(oe+=4,q=Math.pow(2,32)*le+me,Number.isSafeInteger(q)||(q=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),te=c(z,oe),oe+=4,ue=c(z,oe),oe+=4;P(z.subarray(oe,oe+1))!=="\0";)V+=P(z.subarray(oe,oe+1)),oe+=1;for(V+=P(z.subarray(oe,oe+1)),oe+=1;P(z.subarray(oe,oe+1))!=="\0";)$+=P(z.subarray(oe,oe+1)),oe+=1;$+=P(z.subarray(oe,oe+1)),oe+=1}var _e=z.subarray(oe,z.byteLength);return{schemeIdUri:V,value:$,timeScale:X,presentationTime:q,presentationTimeDelta:Z,eventDuration:te,id:ue,payload:_e}}function B(z){for(var K=arguments.length,V=new Array(K>1?K-1:0),$=1;$<K;$++)V[$-1]=arguments[$];for(var X=V.length,Z=8,q=X;q--;)Z+=V[q].byteLength;var te=new Uint8Array(Z);for(te[0]=Z>>24&255,te[1]=Z>>16&255,te[2]=Z>>8&255,te[3]=Z&255,te.set(z,4),q=0,Z=8;q<X;q++)te.set(V[q],Z),Z+=V[q].byteLength;return te}function N(z,K,V){if(z.byteLength!==16)throw new RangeError("Invalid system id");var $,X;if(K){$=1,X=new Uint8Array(K.length*16);for(var Z=0;Z<K.length;Z++){var q=K[Z];if(q.byteLength!==16)throw new RangeError("Invalid key");X.set(q,Z*16)}}else $=0,X=new Uint8Array;var te;$>0?(te=new Uint8Array(4),K.length>0&&new DataView(te.buffer).setUint32(0,K.length,!1)):te=new Uint8Array;var ue=new Uint8Array(4);return V&&V.byteLength>0&&new DataView(ue.buffer).setUint32(0,V.byteLength,!1),B([112,115,115,104],new Uint8Array([$,0,0,0]),z,te,X,ue,V||new Uint8Array)}function j(z){if(!(z instanceof ArrayBuffer)||z.byteLength<32)return null;var K={version:0,systemId:"",kids:null,data:null},V=new DataView(z),$=V.getUint32(0);if(z.byteLength!==$&&$>44)return null;var X=V.getUint32(4);if(X!==1886614376||(K.version=V.getUint32(8)>>>24,K.version>1))return null;K.systemId=R.default.hexDump(new Uint8Array(z,12,16));var Z=V.getUint32(28);if(K.version===0){if($-32<Z)return null;K.data=new Uint8Array(z,32,Z)}else if(K.version===1){K.kids=[];for(var q=0;q<Z;q++)K.kids.push(new Uint8Array(z,32+q*16,16))}return K}},"./src/utils/numeric-encoding-utils.ts":(C,b,a)=>{a.r(b),a.d(b,{base64Decode:()=>x,base64DecodeToStr:()=>S,base64Encode:()=>E,base64ToBase64Url:()=>g,base64UrlEncode:()=>R,strToBase64Encode:()=>d});function g(A){return A.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function d(A){return btoa(A)}function S(A){return atob(A)}function E(A){return btoa(String.fromCharCode.apply(String,A))}function R(A){return g(E(A))}function x(A){return Uint8Array.from(atob(A),function(D){return D.charCodeAt(0)})}},"./src/utils/output-filter.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>g});var g=function(){function d(E,R){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=E,this.trackName=R}var S=d.prototype;return S.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},S.newCue=function(R,x,A){(this.startTime===null||this.startTime>R)&&(this.startTime=R),this.endTime=x,this.screen=A,this.timelineController.createCaptionsTrack(this.trackName)},S.reset=function(){this.cueRanges=[],this.startTime=null},d}()},"./src/utils/texttrack-utils.ts":(C,b,a)=>{a.r(b),a.d(b,{addCueToTrack:()=>S,clearCurrentCues:()=>E,getCuesInRange:()=>A,removeCuesInRange:()=>R,sendAddTrackEvent:()=>d});var g=a("./src/utils/logger.ts");function d(D,P){var I;try{I=new Event("addtrack")}catch(c){I=document.createEvent("Event"),I.initEvent("addtrack",!1,!1)}I.track=D,P.dispatchEvent(I)}function S(D,P){var I=D.mode;if(I==="disabled"&&(D.mode="hidden"),D.cues&&!D.cues.getCueById(P.id))try{if(D.addCue(P),!D.cues.getCueById(P.id))throw new Error("addCue is failed for: "+P)}catch(m){g.logger.debug("[texttrack-utils]: "+m);var c=new self.TextTrackCue(P.startTime,P.endTime,P.text);c.id=P.id,D.addCue(c)}I==="disabled"&&(D.mode=I)}function E(D){var P=D.mode;if(P==="disabled"&&(D.mode="hidden"),D.cues)for(var I=D.cues.length;I--;)D.removeCue(D.cues[I]);P==="disabled"&&(D.mode=P)}function R(D,P,I,c){var m=D.mode;if(m==="disabled"&&(D.mode="hidden"),D.cues&&D.cues.length>0)for(var _=A(D.cues,P,I),o=0;o<_.length;o++)(!c||c(_[o]))&&D.removeCue(_[o]);m==="disabled"&&(D.mode=m)}function x(D,P){if(P<D[0].startTime)return 0;var I=D.length-1;if(P>D[I].endTime)return-1;for(var c=0,m=I;c<=m;){var _=Math.floor((m+c)/2);if(P<D[_].startTime)m=_-1;else if(P>D[_].startTime&&c<I)c=_+1;else return _}return D[c].startTime-P<P-D[m].startTime?c:m}function A(D,P,I){var c=[],m=x(D,P);if(m>-1)for(var _=m,o=D.length;_<o;_++){var i=D[_];if(i.startTime>=P&&i.endTime<=I)c.push(i);else if(i.startTime>I)return c}return c}},"./src/utils/time-ranges.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>d});var g={toString:function(E){for(var R="",x=E.length,A=0;A<x;A++)R+="["+E.start(A).toFixed(3)+"-"+E.end(A).toFixed(3)+"]";return R}};const d=g},"./src/utils/timescale-conversion.ts":(C,b,a)=>{a.r(b),a.d(b,{toMpegTsClockFromTimescale:()=>R,toMsFromMpegTsClock:()=>E,toTimescaleFromBase:()=>d,toTimescaleFromScale:()=>S});var g=9e4;function d(x,A,D,P){D===void 0&&(D=1),P===void 0&&(P=!1);var I=x*A*D;return P?Math.round(I):I}function S(x,A,D,P){return D===void 0&&(D=1),P===void 0&&(P=!1),d(x,A,1/D,P)}function E(x,A){return A===void 0&&(A=!1),d(x,1e3,1/g,A)}function R(x,A){return A===void 0&&(A=1),d(x,g,1/A)}},"./src/utils/typed-array.ts":(C,b,a)=>{a.r(b),a.d(b,{sliceUint8:()=>g});function g(d,S,E){return Uint8Array.prototype.slice?d.slice(S,E):new Uint8Array(Array.prototype.slice.call(d,S,E))}},"./src/utils/vttcue.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>g});const g=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var d=["","lr","rl"],S=["start","middle","end","left","right"];function E(P,I){if(typeof I!="string"||!Array.isArray(P))return!1;var c=I.toLowerCase();return~P.indexOf(c)?c:!1}function R(P){return E(d,P)}function x(P){return E(S,P)}function A(P){for(var I=arguments.length,c=new Array(I>1?I-1:0),m=1;m<I;m++)c[m-1]=arguments[m];for(var _=1;_<arguments.length;_++){var o=arguments[_];for(var i in o)P[i]=o[i]}return P}function D(P,I,c){var m=this,_={enumerable:!0};m.hasBeenReset=!1;var o="",i=!1,t=P,r=I,l=c,p=null,u="",f=!0,L="auto",v="start",y=50,n="middle",s=50,e="middle";Object.defineProperty(m,"id",A({},_,{get:function(){return o},set:function(M){o=""+M}})),Object.defineProperty(m,"pauseOnExit",A({},_,{get:function(){return i},set:function(M){i=!!M}})),Object.defineProperty(m,"startTime",A({},_,{get:function(){return t},set:function(M){if(typeof M!="number")throw new TypeError("Start time must be set to a number.");t=M,this.hasBeenReset=!0}})),Object.defineProperty(m,"endTime",A({},_,{get:function(){return r},set:function(M){if(typeof M!="number")throw new TypeError("End time must be set to a number.");r=M,this.hasBeenReset=!0}})),Object.defineProperty(m,"text",A({},_,{get:function(){return l},set:function(M){l=""+M,this.hasBeenReset=!0}})),Object.defineProperty(m,"region",A({},_,{get:function(){return p},set:function(M){p=M,this.hasBeenReset=!0}})),Object.defineProperty(m,"vertical",A({},_,{get:function(){return u},set:function(M){var T=R(M);if(T===!1)throw new SyntaxError("An invalid or illegal string was specified.");u=T,this.hasBeenReset=!0}})),Object.defineProperty(m,"snapToLines",A({},_,{get:function(){return f},set:function(M){f=!!M,this.hasBeenReset=!0}})),Object.defineProperty(m,"line",A({},_,{get:function(){return L},set:function(M){if(typeof M!="number"&&M!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");L=M,this.hasBeenReset=!0}})),Object.defineProperty(m,"lineAlign",A({},_,{get:function(){return v},set:function(M){var T=x(M);if(!T)throw new SyntaxError("An invalid or illegal string was specified.");v=T,this.hasBeenReset=!0}})),Object.defineProperty(m,"position",A({},_,{get:function(){return y},set:function(M){if(M<0||M>100)throw new Error("Position must be between 0 and 100.");y=M,this.hasBeenReset=!0}})),Object.defineProperty(m,"positionAlign",A({},_,{get:function(){return n},set:function(M){var T=x(M);if(!T)throw new SyntaxError("An invalid or illegal string was specified.");n=T,this.hasBeenReset=!0}})),Object.defineProperty(m,"size",A({},_,{get:function(){return s},set:function(M){if(M<0||M>100)throw new Error("Size must be between 0 and 100.");s=M,this.hasBeenReset=!0}})),Object.defineProperty(m,"align",A({},_,{get:function(){return e},set:function(M){var T=x(M);if(!T)throw new SyntaxError("An invalid or illegal string was specified.");e=T,this.hasBeenReset=!0}})),m.displayState=void 0}return D.prototype.getCueAsHTML=function(){var P=self.WebVTT;return P.convertCueToDOMTree(self,this.text)},D}()},"./src/utils/vttparser.ts":(C,b,a)=>{a.r(b),a.d(b,{VTTParser:()=>I,fixLineBreaks:()=>P,parseTimeStamp:()=>S});var g=a("./src/utils/vttcue.ts"),d=function(){function c(){}var m=c.prototype;return m.decode=function(o,i){if(!o)return"";if(typeof o!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(o))},c}();function S(c){function m(o,i,t,r){return(o|0)*3600+(i|0)*60+(t|0)+parseFloat(r||0)}var _=c.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return _?parseFloat(_[2])>59?m(_[2],_[3],0,_[4]):m(_[1],_[2],_[3],_[4]):null}var E=function(){function c(){this.values=Object.create(null)}var m=c.prototype;return m.set=function(o,i){!this.get(o)&&i!==""&&(this.values[o]=i)},m.get=function(o,i,t){return t?this.has(o)?this.values[o]:i[t]:this.has(o)?this.values[o]:i},m.has=function(o){return o in this.values},m.alt=function(o,i,t){for(var r=0;r<t.length;++r)if(i===t[r]){this.set(o,i);break}},m.integer=function(o,i){/^-?\d+$/.test(i)&&this.set(o,parseInt(i,10))},m.percent=function(o,i){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(i)){var t=parseFloat(i);if(t>=0&&t<=100)return this.set(o,t),!0}return!1},c}();function R(c,m,_,o){var i=o?c.split(o):[c];for(var t in i)if(typeof i[t]=="string"){var r=i[t].split(_);if(r.length===2){var l=r[0],p=r[1];m(l,p)}}}var x=new g.default(0,0,""),A=x.align==="middle"?"middle":"center";function D(c,m,_){var o=c;function i(){var l=S(c);if(l===null)throw new Error("Malformed timestamp: "+o);return c=c.replace(/^[^\sa-zA-Z-]+/,""),l}function t(l,p){var u=new E;R(l,function(v,y){var n;switch(v){case"region":for(var s=_.length-1;s>=0;s--)if(_[s].id===y){u.set(v,_[s].region);break}break;case"vertical":u.alt(v,y,["rl","lr"]);break;case"line":n=y.split(","),u.integer(v,n[0]),u.percent(v,n[0])&&u.set("snapToLines",!1),u.alt(v,n[0],["auto"]),n.length===2&&u.alt("lineAlign",n[1],["start",A,"end"]);break;case"position":n=y.split(","),u.percent(v,n[0]),n.length===2&&u.alt("positionAlign",n[1],["start",A,"end","line-left","line-right","auto"]);break;case"size":u.percent(v,y);break;case"align":u.alt(v,y,["start",A,"end","left","right"]);break}},/:/,/\s/),p.region=u.get("region",null),p.vertical=u.get("vertical","");var f=u.get("line","auto");f==="auto"&&x.line===-1&&(f=-1),p.line=f,p.lineAlign=u.get("lineAlign","start"),p.snapToLines=u.get("snapToLines",!0),p.size=u.get("size",100),p.align=u.get("align",A);var L=u.get("position","auto");L==="auto"&&x.position===50&&(L=p.align==="start"||p.align==="left"?0:p.align==="end"||p.align==="right"?100:50),p.position=L}function r(){c=c.replace(/^\s+/,"")}if(r(),m.startTime=i(),r(),c.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+o);c=c.slice(3),r(),m.endTime=i(),r(),t(c,m)}function P(c){return c.replace(/<br(?: \/)?>/gi,`
`)}var I=function(){function c(){this.state="INITIAL",this.buffer="",this.decoder=new d,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var m=c.prototype;return m.parse=function(o){var i=this;o&&(i.buffer+=i.decoder.decode(o,{stream:!0}));function t(){var L=i.buffer,v=0;for(L=P(L);v<L.length&&L[v]!=="\r"&&L[v]!==`
`;)++v;var y=L.slice(0,v);return L[v]==="\r"&&++v,L[v]===`
`&&++v,i.buffer=L.slice(v),y}function r(L){R(L,function(v,y){},/:/)}try{var l="";if(i.state==="INITIAL"){if(!/\r\n|\n/.test(i.buffer))return this;l=t();var p=l.match(/^()?WEBVTT([ \t].*)?$/);if(!p||!p[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var u=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(u?u=!1:l=t(),i.state){case"HEADER":/:/.test(l)?r(l):l||(i.state="ID");continue;case"NOTE":l||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){i.state="NOTE";break}if(!l)continue;if(i.cue=new g.default(0,0,""),i.state="CUE",l.indexOf("-->")===-1){i.cue.id=l;continue}case"CUE":if(!i.cue){i.state="BADCUE";continue}try{D(l,i.cue,i.regionList)}catch(L){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":{var f=l.indexOf("-->")!==-1;if(!l||f&&(u=!0)){i.oncue&&i.cue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}if(i.cue===null)continue;i.cue.text&&(i.cue.text+=`
`),i.cue.text+=l}continue;case"BADCUE":l||(i.state="ID")}}}catch(L){i.state==="CUETEXT"&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state=i.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},m.flush=function(){var o=this;try{if((o.cue||o.state==="HEADER")&&(o.buffer+=`

`,o.parse()),o.state==="INITIAL"||o.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(i){o.onparsingerror&&o.onparsingerror(i)}return o.onflush&&o.onflush(),this},c}()},"./src/utils/webvtt-parser.ts":(C,b,a)=>{a.r(b),a.d(b,{generateCueId:()=>I,parseWebVTT:()=>m});var g=a("./src/polyfills/number.ts"),d=a("./src/utils/vttparser.ts"),S=a("./src/demux/id3.ts"),E=a("./src/utils/timescale-conversion.ts"),R=a("./src/remux/mp4-remuxer.ts"),x=/\r\n|\n\r|\n|\r/g,A=function(o,i,t){return t===void 0&&(t=0),o.slice(t,t+i.length)===i},D=function(o){var i=parseInt(o.slice(-3)),t=parseInt(o.slice(-6,-4)),r=parseInt(o.slice(-9,-7)),l=o.length>9?parseInt(o.substring(0,o.indexOf(":"))):0;if(!(0,g.isFiniteNumber)(i)||!(0,g.isFiniteNumber)(t)||!(0,g.isFiniteNumber)(r)||!(0,g.isFiniteNumber)(l))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+o);return i+=1e3*t,i+=60*1e3*r,i+=60*60*1e3*l,i},P=function(o){for(var i=5381,t=o.length;t;)i=i*33^o.charCodeAt(--t);return(i>>>0).toString()};function I(_,o,i){return P(_.toString())+P(o.toString())+P(i)}var c=function(o,i,t){var r=o[i],l=o[r.prevCC];if(!l||!l.new&&r.new){o.ccOffset=o.presentationOffset=r.start,r.new=!1;return}for(;(p=l)!==null&&p!==void 0&&p.new;){var p;o.ccOffset+=r.start-l.start,r.new=!1,r=l,l=o[r.prevCC]}o.presentationOffset=t};function m(_,o,i,t,r,l,p,u){var f=new d.VTTParser,L=(0,S.utf8ArrayToStr)(new Uint8Array(_)).trim().replace(x,`
`).split(`
`),v=[],y=(0,E.toMpegTsClockFromTimescale)(o,i),n="00:00.000",s=0,e=0,h,M=!0;f.oncue=function(T){var B=t[r],N=t.ccOffset,j=(s-y)/9e4;B!=null&&B.new&&(e!==void 0?N=t.ccOffset=B.start:c(t,r,j)),j&&(N=j-t.presentationOffset);var z=T.endTime-T.startTime,K=(0,R.normalizePts)((T.startTime+N-e)*9e4,l*9e4)/9e4;T.startTime=Math.max(K,0),T.endTime=Math.max(K+z,0);var V=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(V)),T.id||(T.id=I(T.startTime,T.endTime,V)),T.endTime>0&&v.push(T)},f.onparsingerror=function(T){h=T},f.onflush=function(){if(h){u(h);return}p(v)},L.forEach(function(T){if(M)if(A(T,"X-TIMESTAMP-MAP=")){M=!1,T.slice(16).split(",").forEach(function(B){A(B,"LOCAL:")?n=B.slice(6):A(B,"MPEGTS:")&&(s=parseInt(B.slice(7)))});try{e=D(n)/1e3}catch(B){h=B}return}else T===""&&(M=!1);f.parse(T+`
`)}),f.flush()}},"./src/utils/xhr-loader.ts":(C,b,a)=>{a.r(b),a.d(b,{default:()=>R});var g=a("./src/utils/logger.ts"),d=a("./src/loader/load-stats.ts"),S=/^age:\s*[\d.]+\s*$/m,E=function(){function x(D){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=D?D.xhrSetup:null,this.stats=new d.LoadStats,this.retryDelay=0}var A=x.prototype;return A.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},A.abortInternal=function(){var P=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),P&&(P.onreadystatechange=null,P.onprogress=null,P.readyState!==4&&(this.stats.aborted=!0,P.abort()))},A.abort=function(){var P;this.abortInternal(),(P=this.callbacks)!==null&&P!==void 0&&P.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},A.load=function(P,I,c){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=P,this.config=I,this.callbacks=c,this.retryDelay=I.retryDelay,this.loadInternal()},A.loadInternal=function(){var P=this.config,I=this.context;if(!!P){var c=this.loader=new self.XMLHttpRequest,m=this.stats;m.loading.first=0,m.loaded=0;var _=this.xhrSetup;try{if(_)try{_(c,I.url)}catch(t){c.open("GET",I.url,!0),_(c,I.url)}c.readyState||c.open("GET",I.url,!0);var o=this.context.headers;if(o)for(var i in o)c.setRequestHeader(i,o[i])}catch(t){this.callbacks.onError({code:c.status,text:t.message},I,c);return}I.rangeEnd&&c.setRequestHeader("Range","bytes="+I.rangeStart+"-"+(I.rangeEnd-1)),c.onreadystatechange=this.readystatechange.bind(this),c.onprogress=this.loadprogress.bind(this),c.responseType=I.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),P.timeout),c.send()}},A.readystatechange=function(){var P=this.context,I=this.loader,c=this.stats;if(!(!P||!I)){var m=I.readyState,_=this.config;if(!c.aborted&&m>=2)if(self.clearTimeout(this.requestTimeout),c.loading.first===0&&(c.loading.first=Math.max(self.performance.now(),c.loading.start)),m===4){I.onreadystatechange=null,I.onprogress=null;var o=I.status,i=I.responseType==="arraybuffer";if(o>=200&&o<300&&(i&&I.response||I.responseText!==null)){c.loading.end=Math.max(self.performance.now(),c.loading.first);var t,r;if(i?(t=I.response,r=t.byteLength):(t=I.responseText,r=t.length),c.loaded=c.total=r,!this.callbacks)return;var l=this.callbacks.onProgress;if(l&&l(c,P,t,I),!this.callbacks)return;var p={url:I.responseURL,data:t};this.callbacks.onSuccess(p,c,P,I)}else c.retry>=_.maxRetry||o>=400&&o<499?(g.logger.error(o+" while loading "+P.url),this.callbacks.onError({code:o,text:I.statusText},P,I)):(g.logger.warn(o+" while loading "+P.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,_.maxRetryDelay),c.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),_.timeout)}},A.loadtimeout=function(){g.logger.warn("timeout while loading "+this.context.url);var P=this.callbacks;P&&(this.abortInternal(),P.onTimeout(this.stats,this.context,this.loader))},A.loadprogress=function(P){var I=this.stats;I.loaded=P.loaded,P.lengthComputable&&(I.total=P.total)},A.getCacheAge=function(){var P=null;if(this.loader&&S.test(this.loader.getAllResponseHeaders())){var I=this.loader.getResponseHeader("age");P=I?parseFloat(I):null}return P},x}();const R=E},"./node_modules/eventemitter3/index.js":C=>{var b=Object.prototype.hasOwnProperty,a="~";function g(){}Object.create&&(g.prototype=Object.create(null),new g().__proto__||(a=!1));function d(x,A,D){this.fn=x,this.context=A,this.once=D||!1}function S(x,A,D,P,I){if(typeof D!="function")throw new TypeError("The listener must be a function");var c=new d(D,P||x,I),m=a?a+A:A;return x._events[m]?x._events[m].fn?x._events[m]=[x._events[m],c]:x._events[m].push(c):(x._events[m]=c,x._eventsCount++),x}function E(x,A){--x._eventsCount===0?x._events=new g:delete x._events[A]}function R(){this._events=new g,this._eventsCount=0}R.prototype.eventNames=function(){var A=[],D,P;if(this._eventsCount===0)return A;for(P in D=this._events)b.call(D,P)&&A.push(a?P.slice(1):P);return Object.getOwnPropertySymbols?A.concat(Object.getOwnPropertySymbols(D)):A},R.prototype.listeners=function(A){var D=a?a+A:A,P=this._events[D];if(!P)return[];if(P.fn)return[P.fn];for(var I=0,c=P.length,m=new Array(c);I<c;I++)m[I]=P[I].fn;return m},R.prototype.listenerCount=function(A){var D=a?a+A:A,P=this._events[D];return P?P.fn?1:P.length:0},R.prototype.emit=function(A,D,P,I,c,m){var _=a?a+A:A;if(!this._events[_])return!1;var o=this._events[_],i=arguments.length,t,r;if(o.fn){switch(o.once&&this.removeListener(A,o.fn,void 0,!0),i){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,D),!0;case 3:return o.fn.call(o.context,D,P),!0;case 4:return o.fn.call(o.context,D,P,I),!0;case 5:return o.fn.call(o.context,D,P,I,c),!0;case 6:return o.fn.call(o.context,D,P,I,c,m),!0}for(r=1,t=new Array(i-1);r<i;r++)t[r-1]=arguments[r];o.fn.apply(o.context,t)}else{var l=o.length,p;for(r=0;r<l;r++)switch(o[r].once&&this.removeListener(A,o[r].fn,void 0,!0),i){case 1:o[r].fn.call(o[r].context);break;case 2:o[r].fn.call(o[r].context,D);break;case 3:o[r].fn.call(o[r].context,D,P);break;case 4:o[r].fn.call(o[r].context,D,P,I);break;default:if(!t)for(p=1,t=new Array(i-1);p<i;p++)t[p-1]=arguments[p];o[r].fn.apply(o[r].context,t)}}return!0},R.prototype.on=function(A,D,P){return S(this,A,D,P,!1)},R.prototype.once=function(A,D,P){return S(this,A,D,P,!0)},R.prototype.removeListener=function(A,D,P,I){var c=a?a+A:A;if(!this._events[c])return this;if(!D)return E(this,c),this;var m=this._events[c];if(m.fn)m.fn===D&&(!I||m.once)&&(!P||m.context===P)&&E(this,c);else{for(var _=0,o=[],i=m.length;_<i;_++)(m[_].fn!==D||I&&!m[_].once||P&&m[_].context!==P)&&o.push(m[_]);o.length?this._events[c]=o.length===1?o[0]:o:E(this,c)}return this},R.prototype.removeAllListeners=function(A){var D;return A?(D=a?a+A:A,this._events[D]&&E(this,D)):(this._events=new g,this._eventsCount=0),this},R.prototype.off=R.prototype.removeListener,R.prototype.addListener=R.prototype.on,R.prefixed=a,R.EventEmitter=R,C.exports=R},"./node_modules/url-toolkit/src/url-toolkit.js":function(C){(function(b){var a=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,g=/^(?=([^\/?#]*))\1([^]*)$/,d=/(?:\/|^)\.(?=\/)/g,S=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,E={buildAbsoluteURL:function(R,x,A){if(A=A||{},R=R.trim(),x=x.trim(),!x){if(!A.alwaysNormalize)return R;var D=E.parseURL(R);if(!D)throw new Error("Error trying to parse base URL.");return D.path=E.normalizePath(D.path),E.buildURLFromParts(D)}var P=E.parseURL(x);if(!P)throw new Error("Error trying to parse relative URL.");if(P.scheme)return A.alwaysNormalize?(P.path=E.normalizePath(P.path),E.buildURLFromParts(P)):x;var I=E.parseURL(R);if(!I)throw new Error("Error trying to parse base URL.");if(!I.netLoc&&I.path&&I.path[0]!=="/"){var c=g.exec(I.path);I.netLoc=c[1],I.path=c[2]}I.netLoc&&!I.path&&(I.path="/");var m={scheme:I.scheme,netLoc:P.netLoc,path:null,params:P.params,query:P.query,fragment:P.fragment};if(!P.netLoc&&(m.netLoc=I.netLoc,P.path[0]!=="/"))if(!P.path)m.path=I.path,P.params||(m.params=I.params,P.query||(m.query=I.query));else{var _=I.path,o=_.substring(0,_.lastIndexOf("/")+1)+P.path;m.path=E.normalizePath(o)}return m.path===null&&(m.path=A.alwaysNormalize?E.normalizePath(P.path):P.path),E.buildURLFromParts(m)},parseURL:function(R){var x=a.exec(R);return x?{scheme:x[1]||"",netLoc:x[2]||"",path:x[3]||"",params:x[4]||"",query:x[5]||"",fragment:x[6]||""}:null},normalizePath:function(R){for(R=R.split("").reverse().join("").replace(d,"");R.length!==(R=R.replace(S,"")).length;);return R.split("").reverse().join("")},buildURLFromParts:function(R){return R.scheme+R.netLoc+R.path+R.params+R.query+R.fragment}};C.exports=E})()}},ee={};function W(C){var b=ee[C];if(b!==void 0)return b.exports;var a=ee[C]={exports:{}};return G[C].call(a.exports,a,a.exports,W),a.exports}W.m=G,W.n=C=>{var b=C&&C.__esModule?()=>C.default:()=>C;return W.d(b,{a:b}),b},W.d=(C,b)=>{for(var a in b)W.o(b,a)&&!W.o(C,a)&&Object.defineProperty(C,a,{enumerable:!0,get:b[a]})},W.o=(C,b)=>Object.prototype.hasOwnProperty.call(C,b),W.r=C=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(C,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(C,"__esModule",{value:!0})};var O=W("./src/hls.ts");return O=O.default,O})())})(Zt);var $t=Ot(Zt.exports);const pt=Ge=>(cr("data-v-384a3467"),Ge=Ge(),fr(),Ge),Ur=pt(()=>Ze("div",{class:"artplayer-app"},null,-1)),jr={key:0,class:"zfile-video-switch-tools"},Kr=pt(()=>Ze("img",{src:yr,alt:"\u4E0B\u8F7D"},null,-1)),Gr=pt(()=>Ze("img",{src:Er,alt:"\u8FC5\u96F7"},null,-1)),Wr=pt(()=>Ze("img",{src:Tr,alt:"motrix"},null,-1)),Vr=pt(()=>Ze("img",{src:Sr,alt:"PotPlayer"},null,-1)),zr=pt(()=>Ze("img",{src:xr,alt:"IINA"},null,-1)),Hr=pt(()=>Ze("img",{src:Ar,alt:"VLC"},null,-1)),Yr=pt(()=>Ze("img",{src:br,alt:"nPlayer"},null,-1)),$r=pt(()=>Ze("img",{src:Lr,alt:"MXPlayer(Free)"},null,-1)),Qr=pt(()=>Ze("img",{src:Dr,alt:"MXPlayer(Pro)"},null,-1)),Xr={__name:"VideoPlayer",setup(Ge){let ze=gr();sr();let{getPathPwd:G}=vr(),{currentPath:ee,storageKey:W}=or(),O=hr(),C=pr();const b=l=>{let p=[];return O.filterFileByType("video").forEach(u=>{p.push({default:u.name===l,html:u.name,url:u.url})}),p};let a=lr(null);const g=l=>{switch(l){case"download":window.location=a.value.url;break;case"thunder":window.location=`thunder://${btoa("AA"+a.value.url+"ZZ")}`;break;case"motrix":window.location=`motrix://new-task?uri=${encodeURIComponent(a.value.url)}&out=${encodeURIComponent(a.value.name)}`;break;case"potplayer":window.location=`potplayer://${a.value.url}`;break;case"iina":window.location=`iina://weblink?url=${encodeURIComponent(a.value.url)}`;break;case"vlc":window.location=`vlc://${a.value.url}`;break;case"nplayer":window.location=`nplayer-${a.value.url}`;break;case"mxplayer":window.location="intent:"+a.value.url+"#Intent;package=com.mxtech.videoplayer.ad;S.title="+a.value.name+";end";break;case"mxplayer-pro":window.location="intent:"+a.value.url+"#Intent;package=com.mxtech.videoplayer.pro;S.title="+a.value.name+";end";break}},d=l=>{let p=O.filterFileByType("video");S();for(let u=0;u<p.length;u++)if(p[u].name===l)return{prev:p[u-1]||null,next:p[u+1]||null}},S=()=>{let l=JSON.parse(localStorage.getItem("_h5_player_play_progress_"));if(l){for(let p of Object.keys(l))p.endsWith(l[p].progress)&&delete l[p];localStorage.setItem("_h5_player_play_progress_",JSON.stringify(l))}},E=l=>{let p=[];return O.fileList.find((u,f)=>{let L=u.name.toLowerCase();(L===l+".vtt"||L===l+".srt"||L===l+".ass")&&p.push({default:p.length===0,url:u.url,html:L})}),p.length>0&&p.push({url:"",html:"\u5173\u95ED\u5B57\u5E55"}),p};let R='<i class="art-icon art-icon-not-hidden"><svg t="1662978336444" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="968" width="128" height="128"><path d="M711.456 377.184c32.736 31.52 60.928 72.256 84.64 122.208a40.64 40.64 0 0 1 0 34.72c-63.776 135.04-160.48 202.528-290.112 202.528-46.752 0-89.248-8.832-127.456-26.464l37.184-37.184c27.52 10.048 57.6 15.104 90.272 15.104 108.864 0 188.48-55.168 244.608-171.296-21.088-43.584-45.44-78.56-73.44-105.28l34.304-34.336z m13.024-122.816l28.768 28.8a5.376 5.376 0 0 1 0 7.616L272.96 771.04a5.408 5.408 0 0 1-7.648 0l-28.8-28.8a5.376 5.376 0 0 1 0-7.616l71.36-71.36c-35.84-32.384-66.56-75.392-92.032-129.088a40.64 40.64 0 0 1 0-34.72C279.68 364.48 376.384 296.96 505.984 296.96c50.752 0 96.448 10.4 137.12 31.168l73.76-73.728a5.376 5.376 0 0 1 7.616 0z m-218.496 91.136c-108.8 0-188.416 55.168-244.608 171.296 22.944 47.36 49.792 84.608 80.928 112.096l56.256-56.256a118.688 118.688 0 0 1 160.576-160.576l47.424-47.424c-30.336-12.832-63.776-19.136-100.576-19.136z m-70.016 137.088a75.616 75.616 0 0 0-4.64 57.28l95.04-95.04a75.616 75.616 0 0 0-90.4 37.76z m60.416 109.504a75.456 75.456 0 0 0 82.144-82.112l35.616-35.616a118.72 118.72 0 0 1-153.376 153.344l35.616-35.616z" p-id="969"></path></svg></i>',x='<i class="art-icon art-icon-hidden"><svg t="1662978261880" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4451" width="128" height="128"><path d="M512.032 648a136.128 136.128 0 0 1-136-136c0-74.976 60.992-136 136-136s136 61.024 136 136a136.128 136.128 0 0 1-136 136z m0-224c-48.544 0-88 39.456-88 88s39.456 88 88 88 88-39.456 88-88-39.456-88-88-88z" p-id="4452"></path><path d="M512.032 743.616a327.68 327.68 0 0 1-231.872-95.616L142.88 512l137.28-136a327.68 327.68 0 0 1 231.872-95.584c87.328 0 169.664 33.952 231.872 95.584l137.28 136-137.28 136a327.52 327.52 0 0 1-231.872 95.616zM206.528 512l107.424 101.952c53.152 52.672 123.488 81.696 198.048 81.696s144.896-29.024 198.08-81.696L817.536 512l-107.424-101.952c-53.152-52.672-123.488-81.696-198.048-81.696s-144.896 29.024-198.08 81.696L206.528 512z" p-id="4453"></path></svg></i>',A='<i class="art-icon art-icon-video-list"><svg t="1650551038453" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12028" width="20" height="20"><path d="M111.395066 179.64038l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12029"></path><path d="M111.395066 468.067418l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12030"></path><path d="M111.395066 756.493433l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12031"></path></svg></i>',D=`<i class="art-icon art-icon-subtitle"><svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 48 48">
    <path d="M0 0h48v48H0z" fill="none"></path>
    <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>
</svg></i>`,P='<i class="art-icon art-icon-next-video"><svg height="25" width="25"  viewBox="0 0 22 22"><path d="M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"></path></svg></i>',I='<i class="art-icon art-icon-prev-video" style="transform: scale(-1,1);"><svg height="25" width="25"  viewBox="0 0 22 22"><path d="M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"></path></svg></i>';const c=Ct("zfile-video-auto-player-next",!1),m=Ct("zfile-video-auto-player",!1),_=Ct("zfile-video-hiddle-tools",!1);let o=null;const i=(l,p)=>st(this,null,function*(){var s;a.value={name:l,url:p},document.querySelector(".zfile-video-dialog .el-dialog__title").innerHTML=l,o&&o.destroy();let u="mp4";l.toLowerCase().endsWith("flv")?u="flv":l.toLowerCase().endsWith("m3u8")&&(u="m3u8"),ze.removeDuplicateSeparator(`${ee.value}/${l}`);let f=ze.removeDuplicateSeparator(`${ee.value}/__${l}__/video.m3u8`),L={storageKey:W.value,path:f,password:G()},v=yield mr(L);((s=v==null?void 0:v.data)==null?void 0:s.code)===0&&(console.log("\u68C0\u6D4B\u5230\u5F53\u524D\u4E3A h5ai_dplayer \u517C\u5BB9\u6A21\u5F0F, \u66FF\u6362\u64AD\u653E\u6587\u4EF6\u4E3A: "+f),u="m3u8");let y={container:".artplayer-app",title:l,url:a.value.url,type:u,setting:!0,playbackRate:!0,flip:!0,fullscreen:!0,fastForward:!0,autoOrientation:!0,aspectRatio:!0,fullscreenWeb:!0,theme:"#23ade5",lock:!0,subtitleOffset:!0,miniProgressBar:!0,autoplay:m.value,whitelist:["*"],airplay:!0,moreVideoAttr:{"x5-video-player-type":"h5","x5-video-player-fullscreen":!1,"x5-video-orientation":"portraint",preload:"metadata",crossOrigin:"anonymous"},customType:{flv:function(e,h){if(Yt.isSupported()){const M=Yt.createPlayer({type:"flv",url:h});M.attachMediaElement(e),M.load()}else o.notice.show="\u4E0D\u652F\u6301\u64AD\u653E\u683C\u5F0F\uFF1Aflv"},m3u8:function(e,h){if($t.isSupported()){const M=new $t({xhrSetup:(T,B)=>{let N=B.substring(B.lastIndexOf("/")+1);if(B!==h){let j=O.getFileUrlByName(N);j?T.open("GET",j,!0):T.open("GET",B,!0)}}});M.loadSource(h),M.attachMedia(e)}else{const M=e.canPlayType("application/vnd.apple.mpegurl");M==="probably"||M=="maybe"?e.src=h:o.notice.show="\u4E0D\u652F\u6301\u64AD\u653E\u683C\u5F0F\uFF1Am3u8"}}},contextmenu:[{html:"\u4E0B\u8F7D",click:function(){window.open(p)}}],settings:[{html:"\u81EA\u52A8\u64AD\u653E",tooltip:m.value?"\u5F00\u542F":"\u5173\u95ED",icon:'<img width="22" heigth="22" src="data:image/svg+xml;base64,Cjxzdmcgdmlld0JveD0iMCAwIDgwIDgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48cGF0aCBpZD0icGlkLTY0LXN2Z28tYSIgZD0iTTAgMGg4MHY4MEgweiI+PC9wYXRoPjxwYXRoIGQ9Ik01Mi41NDYgOC4wMTRhMy45OTggMy45OTggMCAwMTQuMjIyIDMuMDc3Yy4xMDQuNDQ2LjA5My44MDguMDM5IDEuMTM4YTIuNzQgMi43NCAwIDAxLS4zMTIuODgxYy0uMDczLjEzMi0uMTYuMjU0LS4yNDYuMzc2bC0uMjU3LjM2Ni0uNTIxLjczYy0uNy45NjktMS40MTUgMS45MjYtMi4xNTQgMi44NjZsLS4wMTUuMDJhMjQwLjk0NSAyNDAuOTQ1IDAgMDE1Ljk4Ni4zNDFsMS42NDMuMTIzLjgyMi4wNjYuNDEuMDM0LjIwNi4wMTguMTAzLjAwOC4xMTUuMDEyYzEuMjY2LjExNiAyLjUxNi40NSAzLjY3Ny45NzVhMTEuNjYzIDExLjY2MyAwIDAxMy4xNjYgMi4xMTRjLjkzMS44NyAxLjcxOSAxLjg5NSAyLjMyMSAzLjAyMmExMS41OTUgMTEuNTk1IDAgMDExLjIyNCAzLjYxM2MuMDMuMTU3LjA0Ni4zMTYuMDY4LjQ3NGwuMDE1LjExOS4wMTMuMTEyLjAyMi4yMDYuMDg1LjgyMi4xNTkgMS42NDZjLjEgMS4wOTguMTkgMi4xOTguMjcgMy4yOTguMzE1IDQuNC40NjMgOC44MjkuMzYgMTMuMjU1YTE2Ni40ODkgMTY2LjQ4OSAwIDAxLS44NDMgMTMuMjEzYy0uMDEyLjEyNy0uMDM0LjI5Ny0uMDUzLjQ1NGE3LjU4OSA3LjU4OSAwIDAxLS4wNzIuNDc1bC0uMDQuMjM3LS4wNS4yMzZhMTEuNzYyIDExLjc2MiAwIDAxLS43NCAyLjI4NyAxMS43NTUgMTEuNzU1IDAgMDEtNS4xMTggNS41NyAxMS43MDUgMTEuNzA1IDAgMDEtMy42MjMgMS4yNjNjLS4xNTguMDI0LS4zMTYuMDUyLS40NzUuMDcybC0uNDc3LjA1My0uODIxLjA3MS0xLjY0NC4xMzRjLTEuMDk2LjA4Ni0yLjE5Mi4xNi0zLjI4OC4yM2EyNjAuMDggMjYwLjA4IDAgMDEtNi41NzguMzI1Yy04Ljc3Mi4zMjQtMTcuNTQ2LjIyLTI2LjMxMy0uMzAyYTI0Mi40NTggMjQyLjQ1OCAwIDAxLTMuMjg3LS4yMmwtMS42NDMtLjEyOS0uODIyLS4wNjktLjQxLS4wMzUtLjIwNi0uMDE4Yy0uMDY4LS4wMDYtLjEzMy0uMDEtLjIxOC0uMDJhMTEuNTY2IDExLjU2NiAwIDAxLTMuNy0uOTkyIDExLjczMiAxMS43MzIgMCAwMS01LjQ5Ny01LjE3OCAxMS43MyAxMS43MyAwIDAxLTEuMjE1LTMuNjI3Yy0uMDI0LS4xNTgtLjA1MS0uMzE2LS4wNjctLjQ3NWwtLjAyNi0uMjM4LS4wMTMtLjExOS0uMDEtLjEwMy0uMDctLjgyMy0uMTMyLTEuNjQ4YTE5MC42MzcgMTkwLjYzNyAwIDAxLS4yMi0zLjI5OGMtLjI1Ni00LjM5OS0uMzU4LTguODE3LS4yNTgtMTMuMjMzLjA5OS00LjQxMi4zNzItOC44MTEuNzg4LTEzLjE5N2ExMS42NSAxMS42NSAwIDAxMy4wMzktNi44MzUgMTEuNTg1IDExLjU4NSAwIDAxNi41NzItMy41NjNjLjE1Ny0uMDIzLjMxMi0uMDUxLjQ3LS4wN2wuNDctLjA1LjgyLS4wNyAxLjY0My0uMTNhMjI4LjQ5MyAyMjguNDkzIDAgMDE2LjY0Ny0uNDA1bC0uMDQxLS4wNWE4OC4xNDUgODguMTQ1IDAgMDEtMi4xNTQtMi44NjdsLS41Mi0uNzMtLjI1OC0uMzY2Yy0uMDg2LS4xMjItLjE3My0uMjQ0LS4yNDYtLjM3NmEyLjc0IDIuNzQgMCAwMS0uMzEyLS44ODEgMi44MDggMi44MDggMCAwMS4wNC0xLjEzOCAzLjk5OCAzLjk5OCAwIDAxNC4yMi0zLjA3NyAyLjggMi44IDAgMDExLjA5My4zMTNjLjI5NC4xNTUuNTM4LjM0Ny43NDIuNTY4LjEwMi4xMS4xOS4yMy4yOC4zNWwuMjcuMzU5LjUzMi43MmE4OC4wNTkgODguMDU5IDAgMDEyLjA2IDIuOTM2IDczLjAzNiA3My4wMzYgMCAwMTEuOTI5IDMuMDNjLjE4Ny4zMTMuMzczLjYyOC41NTYuOTQ1IDIuNzI0LS4wNDcgNS40NDctLjA1NiA4LjE3LS4wMzguNzQ4LjAwNiAxLjQ5Ni4wMTUgMi4yNDQuMDI2LjE4LS4zMTMuMzY0LS42MjQuNTQ5LS45MzRhNzMuMjgxIDczLjI4MSAwIDAxMS45My0zLjAzIDg4LjczNyA4OC43MzcgMCAwMTIuMDU5LTIuOTM1bC41MzMtLjcyLjI2OC0uMzU5Yy4wOS0uMTIuMTc5LS4yNC4yODEtLjM1YTIuOCAyLjggMCAwMTEuODM0LS44ODF6TTMwLjEzIDM0LjYzMWE0IDQgMCAwMC0uNDE4IDEuNDIgOTEuMTU3IDkxLjE1NyAwIDAwLS40NDYgOS4xMjhjMCAyLjgyOC4xMjEgNS42NTYuMzY0IDguNDgzbC4xMSAxLjIxMmE0IDQgMCAwMDUuODU4IDMuMTQzYzIuODItMS40OTggNS41NS0zLjAzMyA4LjE5My00LjYwNmExNzcuNDEgMTc3LjQxIDAgMDA1Ljg5Ni0zLjY2NmwxLjQzNC0uOTQyYTQgNCAwIDAwLjA0Ny02LjYzMiAxMzcuNzAzIDEzNy43MDMgMCAwMC03LjM3Ny00LjcwOCAxNDYuODggMTQ2Ljg4IDAgMDAtNi44NzktMy44NDlsLTEuNC0uNzI1YTQgNCAwIDAwLTUuMzgyIDEuNzQyeiIgaWQ9InBpZC02NC1zdmdvLWQiPjwvcGF0aD48ZmlsdGVyIHg9Ii0xNS40JSIgeT0iLTE2LjMlIiB3aWR0aD0iMTMwLjklIiBoZWlnaHQ9IjEzMi41JSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBpZD0icGlkLTY0LXN2Z28tYyI+PGZlT2Zmc2V0IGR5PSIyIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIj48L2ZlT2Zmc2V0PjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjEiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMSI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMyAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMSIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjEiPjwvZmVDb2xvck1hdHJpeD48ZmVPZmZzZXQgaW49IlNvdXJjZUFscGhhIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMiI+PC9mZU9mZnNldD48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIzLjUiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjIiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMiI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMiAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMiIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjIiPjwvZmVDb2xvck1hdHJpeD48ZmVNZXJnZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMSI+PC9mZU1lcmdlTm9kZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMiI+PC9mZU1lcmdlTm9kZT48L2ZlTWVyZ2U+PC9maWx0ZXI+PC9kZWZzPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgb3BhY2l0eT0iLjgiPjxtYXNrIGlkPSJwaWQtNjQtc3Znby1iIiBmaWxsPSIjZmZmIj48dXNlIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1hIj48L3VzZT48L21hc2s+PGcgbWFzaz0idXJsKCNwaWQtNjQtc3Znby1iKSI+PHVzZSBmaWxsPSIjMDAwIiBmaWx0ZXI9InVybCgjcGlkLTY0LXN2Z28tYykiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48L2c+PC9nPjwvc3ZnPg==">',switch:m.value,onSwitch:function(e,h,M){const T=!e.switch;return m.value=T,o.autoplay=T,e.tooltip=T?"\u5F00\u542F":"\u5173\u95ED",T}},{html:"\u81EA\u52A8\u64AD\u653E\u4E0B\u4E00\u4E2A\u89C6\u9891",tooltip:c.value?"\u5F00\u542F":"\u5173\u95ED",icon:'<img width="22" heigth="22" src="data:image/svg+xml;base64,Cjxzdmcgdmlld0JveD0iMCAwIDgwIDgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48cGF0aCBpZD0icGlkLTY0LXN2Z28tYSIgZD0iTTAgMGg4MHY4MEgweiI+PC9wYXRoPjxwYXRoIGQ9Ik01Mi41NDYgOC4wMTRhMy45OTggMy45OTggMCAwMTQuMjIyIDMuMDc3Yy4xMDQuNDQ2LjA5My44MDguMDM5IDEuMTM4YTIuNzQgMi43NCAwIDAxLS4zMTIuODgxYy0uMDczLjEzMi0uMTYuMjU0LS4yNDYuMzc2bC0uMjU3LjM2Ni0uNTIxLjczYy0uNy45NjktMS40MTUgMS45MjYtMi4xNTQgMi44NjZsLS4wMTUuMDJhMjQwLjk0NSAyNDAuOTQ1IDAgMDE1Ljk4Ni4zNDFsMS42NDMuMTIzLjgyMi4wNjYuNDEuMDM0LjIwNi4wMTguMTAzLjAwOC4xMTUuMDEyYzEuMjY2LjExNiAyLjUxNi40NSAzLjY3Ny45NzVhMTEuNjYzIDExLjY2MyAwIDAxMy4xNjYgMi4xMTRjLjkzMS44NyAxLjcxOSAxLjg5NSAyLjMyMSAzLjAyMmExMS41OTUgMTEuNTk1IDAgMDExLjIyNCAzLjYxM2MuMDMuMTU3LjA0Ni4zMTYuMDY4LjQ3NGwuMDE1LjExOS4wMTMuMTEyLjAyMi4yMDYuMDg1LjgyMi4xNTkgMS42NDZjLjEgMS4wOTguMTkgMi4xOTguMjcgMy4yOTguMzE1IDQuNC40NjMgOC44MjkuMzYgMTMuMjU1YTE2Ni40ODkgMTY2LjQ4OSAwIDAxLS44NDMgMTMuMjEzYy0uMDEyLjEyNy0uMDM0LjI5Ny0uMDUzLjQ1NGE3LjU4OSA3LjU4OSAwIDAxLS4wNzIuNDc1bC0uMDQuMjM3LS4wNS4yMzZhMTEuNzYyIDExLjc2MiAwIDAxLS43NCAyLjI4NyAxMS43NTUgMTEuNzU1IDAgMDEtNS4xMTggNS41NyAxMS43MDUgMTEuNzA1IDAgMDEtMy42MjMgMS4yNjNjLS4xNTguMDI0LS4zMTYuMDUyLS40NzUuMDcybC0uNDc3LjA1My0uODIxLjA3MS0xLjY0NC4xMzRjLTEuMDk2LjA4Ni0yLjE5Mi4xNi0zLjI4OC4yM2EyNjAuMDggMjYwLjA4IDAgMDEtNi41NzguMzI1Yy04Ljc3Mi4zMjQtMTcuNTQ2LjIyLTI2LjMxMy0uMzAyYTI0Mi40NTggMjQyLjQ1OCAwIDAxLTMuMjg3LS4yMmwtMS42NDMtLjEyOS0uODIyLS4wNjktLjQxLS4wMzUtLjIwNi0uMDE4Yy0uMDY4LS4wMDYtLjEzMy0uMDEtLjIxOC0uMDJhMTEuNTY2IDExLjU2NiAwIDAxLTMuNy0uOTkyIDExLjczMiAxMS43MzIgMCAwMS01LjQ5Ny01LjE3OCAxMS43MyAxMS43MyAwIDAxLTEuMjE1LTMuNjI3Yy0uMDI0LS4xNTgtLjA1MS0uMzE2LS4wNjctLjQ3NWwtLjAyNi0uMjM4LS4wMTMtLjExOS0uMDEtLjEwMy0uMDctLjgyMy0uMTMyLTEuNjQ4YTE5MC42MzcgMTkwLjYzNyAwIDAxLS4yMi0zLjI5OGMtLjI1Ni00LjM5OS0uMzU4LTguODE3LS4yNTgtMTMuMjMzLjA5OS00LjQxMi4zNzItOC44MTEuNzg4LTEzLjE5N2ExMS42NSAxMS42NSAwIDAxMy4wMzktNi44MzUgMTEuNTg1IDExLjU4NSAwIDAxNi41NzItMy41NjNjLjE1Ny0uMDIzLjMxMi0uMDUxLjQ3LS4wN2wuNDctLjA1LjgyLS4wNyAxLjY0My0uMTNhMjI4LjQ5MyAyMjguNDkzIDAgMDE2LjY0Ny0uNDA1bC0uMDQxLS4wNWE4OC4xNDUgODguMTQ1IDAgMDEtMi4xNTQtMi44NjdsLS41Mi0uNzMtLjI1OC0uMzY2Yy0uMDg2LS4xMjItLjE3My0uMjQ0LS4yNDYtLjM3NmEyLjc0IDIuNzQgMCAwMS0uMzEyLS44ODEgMi44MDggMi44MDggMCAwMS4wNC0xLjEzOCAzLjk5OCAzLjk5OCAwIDAxNC4yMi0zLjA3NyAyLjggMi44IDAgMDExLjA5My4zMTNjLjI5NC4xNTUuNTM4LjM0Ny43NDIuNTY4LjEwMi4xMS4xOS4yMy4yOC4zNWwuMjcuMzU5LjUzMi43MmE4OC4wNTkgODguMDU5IDAgMDEyLjA2IDIuOTM2IDczLjAzNiA3My4wMzYgMCAwMTEuOTI5IDMuMDNjLjE4Ny4zMTMuMzczLjYyOC41NTYuOTQ1IDIuNzI0LS4wNDcgNS40NDctLjA1NiA4LjE3LS4wMzguNzQ4LjAwNiAxLjQ5Ni4wMTUgMi4yNDQuMDI2LjE4LS4zMTMuMzY0LS42MjQuNTQ5LS45MzRhNzMuMjgxIDczLjI4MSAwIDAxMS45My0zLjAzIDg4LjczNyA4OC43MzcgMCAwMTIuMDU5LTIuOTM1bC41MzMtLjcyLjI2OC0uMzU5Yy4wOS0uMTIuMTc5LS4yNC4yODEtLjM1YTIuOCAyLjggMCAwMTEuODM0LS44ODF6TTMwLjEzIDM0LjYzMWE0IDQgMCAwMC0uNDE4IDEuNDIgOTEuMTU3IDkxLjE1NyAwIDAwLS40NDYgOS4xMjhjMCAyLjgyOC4xMjEgNS42NTYuMzY0IDguNDgzbC4xMSAxLjIxMmE0IDQgMCAwMDUuODU4IDMuMTQzYzIuODItMS40OTggNS41NS0zLjAzMyA4LjE5My00LjYwNmExNzcuNDEgMTc3LjQxIDAgMDA1Ljg5Ni0zLjY2NmwxLjQzNC0uOTQyYTQgNCAwIDAwLjA0Ny02LjYzMiAxMzcuNzAzIDEzNy43MDMgMCAwMC03LjM3Ny00LjcwOCAxNDYuODggMTQ2Ljg4IDAgMDAtNi44NzktMy44NDlsLTEuNC0uNzI1YTQgNCAwIDAwLTUuMzgyIDEuNzQyeiIgaWQ9InBpZC02NC1zdmdvLWQiPjwvcGF0aD48ZmlsdGVyIHg9Ii0xNS40JSIgeT0iLTE2LjMlIiB3aWR0aD0iMTMwLjklIiBoZWlnaHQ9IjEzMi41JSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBpZD0icGlkLTY0LXN2Z28tYyI+PGZlT2Zmc2V0IGR5PSIyIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIj48L2ZlT2Zmc2V0PjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjEiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMSI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMyAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMSIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjEiPjwvZmVDb2xvck1hdHJpeD48ZmVPZmZzZXQgaW49IlNvdXJjZUFscGhhIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMiI+PC9mZU9mZnNldD48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIzLjUiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjIiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMiI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMiAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMiIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjIiPjwvZmVDb2xvck1hdHJpeD48ZmVNZXJnZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMSI+PC9mZU1lcmdlTm9kZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMiI+PC9mZU1lcmdlTm9kZT48L2ZlTWVyZ2U+PC9maWx0ZXI+PC9kZWZzPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgb3BhY2l0eT0iLjgiPjxtYXNrIGlkPSJwaWQtNjQtc3Znby1iIiBmaWxsPSIjZmZmIj48dXNlIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1hIj48L3VzZT48L21hc2s+PGcgbWFzaz0idXJsKCNwaWQtNjQtc3Znby1iKSI+PHVzZSBmaWxsPSIjMDAwIiBmaWx0ZXI9InVybCgjcGlkLTY0LXN2Z28tYykiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48L2c+PC9nPjwvc3ZnPg==">',switch:c.value,onSwitch:function(e,h,M){const T=!e.switch;return c.value=T,e.tooltip=T?"\u5F00\u542F":"\u5173\u95ED",T}}],controls:[{position:"right",html:_.value?R:x,click:function(e,h){_.value=!_.value,h.target.parentNode.parentNode.innerHTML=_.value?R:x}},{name:"video-list",position:"right",html:A,selector:b(l),onSelect:function(e,h){return i(e.html,e.url),A}}]},n=E(l);n.length>0&&n.length>1&&y.controls.push({name:"video-subtitle",position:"right",html:D,selector:n,onSelect:e=>(e.html==="\u5173\u95ED\u5B57\u5E55"?o.subtitle.show=!1:(o.subtitle.show=!0,o.subtitle.url=e.url),D)}),o=new Ir(y),o.on("destory",()=>{}),ze.isMobile.value===!1&&o.on("ready",()=>{let e=d(o.option.title);e.prev&&o.controls.add({name:"prev-video",position:"left",index:5,tooltip:"\u64AD\u653E\u4E0A\u4E00\u4E2A",html:I,click:()=>{r()}}),e.next&&o.controls.add({name:"next-video",position:"left",index:15,tooltip:"\u64AD\u653E\u4E0B\u4E00\u4E2A",html:P,click:()=>{t()}})}),o.on("video:ended",()=>{c.value&&t()}),n.length>0&&(o.subtitle.url=n[0].url)}),t=()=>{const l=d(o.option.title).next;l&&i(l.name,l.url)},r=()=>{const l=d(o.option.title).prev;l&&i(l.name,l.url)};return ur(()=>{i(O.currentClickRow.name,O.currentClickRow.url)}),(l,p)=>{const u=nr,f=ar;return At(),bt("div",null,[Ur,vt(a)&&vt(ze).isMobile.value?(At(),bt("div",jr,[ft(u,{disabled:!d(vt(a).name).prev,icon:vt(wr),onClick:r},{default:rt(()=>[ht("\u4E0A\u4E00\u4E2A\u89C6\u9891")]),_:1},8,["disabled","icon"]),ft(u,{disabled:!d(vt(a).name).next,icon:vt(Nr),onClick:t},{default:rt(()=>[ht("\u4E0B\u4E00\u4E2A\u89C6\u9891")]),_:1},8,["disabled","icon"])])):zt("",!0),Ze("div",{class:Ht(["zfile-video-tools",vt(_)?"hidden-important":""])},[vt(C).permission.download?(At(),bt(dr,{key:0},[Ze("div",{class:"zfile-video-tools-item",onClick:p[0]||(p[0]=L=>g("download"))},[ft(f,{placement:"top"},{content:rt(()=>[ht(" \u76F4\u63A5\u4E0B\u8F7D ")]),default:rt(()=>[Kr]),_:1})]),Ze("div",{class:"zfile-video-tools-item",onClick:p[1]||(p[1]=L=>g("thunder"))},[ft(f,{placement:"top"},{content:rt(()=>[ht(" \u4F7F\u7528\u8FC5\u96F7\u4E0B\u8F7D ")]),default:rt(()=>[Gr]),_:1})]),Ze("div",{class:"zfile-video-tools-item",onClick:p[2]||(p[2]=L=>g("motrix"))},[ft(f,{placement:"top"},{content:rt(()=>[ht(" \u4F7F\u7528 motrix \u4E0B\u8F7D ")]),default:rt(()=>[Wr]),_:1})])],64)):zt("",!0),Ze("div",{class:"zfile-video-tools-item",onClick:p[3]||(p[3]=L=>g("potplayer"))},[ft(f,{placement:"top"},{content:rt(()=>[ht(" \u4F7F\u7528 PotPlayer \u64AD\u653E ")]),default:rt(()=>[Vr]),_:1})]),Ze("div",{class:"zfile-video-tools-item",onClick:p[4]||(p[4]=L=>g("iina"))},[ft(f,{placement:"top"},{content:rt(()=>[ht(" \u4F7F\u7528 IINA \u64AD\u653E ")]),default:rt(()=>[zr]),_:1})]),Ze("div",{class:"zfile-video-tools-item",onClick:p[5]||(p[5]=L=>g("vlc"))},[ft(f,{placement:"top"},{content:rt(()=>[ht(" \u4F7F\u7528 VLC \u64AD\u653E ")]),default:rt(()=>[Hr]),_:1})]),Ze("div",{class:"zfile-video-tools-item",onClick:p[6]||(p[6]=L=>g("nplayer"))},[ft(f,{placement:"top"},{content:rt(()=>[ht(" \u4F7F\u7528 nPlayer \u64AD\u653E ")]),default:rt(()=>[Yr]),_:1})]),Ze("div",{class:"zfile-video-tools-item",onClick:p[7]||(p[7]=L=>g("mxplayer"))},[ft(f,{placement:"top"},{content:rt(()=>[ht(" \u4F7F\u7528 MXPlayer(Free) \u64AD\u653E ")]),default:rt(()=>[$r]),_:1})]),Ze("div",{class:"zfile-video-tools-item",onClick:p[8]||(p[8]=L=>g("mxplayer-pro"))},[ft(f,{placement:"top"},{content:rt(()=>[ht(" \u4F7F\u7528 MXPlayer(Pro) \u64AD\u653E ")]),default:rt(()=>[Qr]),_:1})])],2),Ze("div",{class:Ht(["zfile-video-tools-tips",vt(_)?"hidden-important":""])}," tips: \u53EF\u70B9\u51FB\u4E0A\u65B9\u7684\u8F6F\u4EF6\u56FE\u6807\u8FDB\u884C\u4E0B\u8F7D\u64AD\u653E, \u672C\u5730\u64AD\u653E\u5668\u89E3\u7801\u6548\u679C\u66F4\u4F73. ",2)])}}};var gi=_r(Xr,[["__scopeId","data-v-384a3467"]]);export{gi as default};
